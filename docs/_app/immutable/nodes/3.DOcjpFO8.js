var un=Object.defineProperty;var sn=(e,a,t)=>a in e?un(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var Dt=(e,a,t)=>sn(e,typeof a!="symbol"?a+"":a,t);import"../chunks/CWj6FrbW.js";import{o as Ce}from"../chunks/oqWMDIqs.js";import{aU as ln,aK as dn,a0 as cn,d as fn,k as vn,aN as qe,p as ke,b as ve,R as J,aC as Nt,aD as W,T as q,U as R,aQ as gn,W as ie,X as V,Y as X,a as Le,aO as Y,J as Ht,f as p,K as L,aT as wt,aR as Yt,aP as pn}from"../chunks/GhzuZPbW.js";import{s as O,a as Se,i as te}from"../chunks/Bx6F5iLl.js";import{g as _n}from"../chunks/Xq7zXZLB.js";import{e as ue,f as se,c as Me,u as $t,p as Zt,g as Ct,h as qt,i as Tt,j as Re,r as Xa,k as za,b as Te,l as Bt,n as mn,d as hn,o as be,s as yn}from"../chunks/Imq0FHGS.js";import{b as bn}from"../chunks/CbjPuu5r.js";import{_ as Pn,p as Ot}from"../chunks/Dd8MT0ga.js";import{t as Z,e as xt,i as It}from"../chunks/B0J7BoOv.js";import"../chunks/C8NLdOkt.js";import{i as Mn}from"../chunks/DVXJ7Kgq.js";import{r as kn,s as Oe,a as Jt}from"../chunks/CNasZ-5C.js";import{L as Ln}from"../chunks/Cwvqw05V.js";function Sn(e,a,t=a){var c=ln();dn(e,"input",n=>{var u=n?e.defaultValue:e.value;if(u=jt(e)?Ut(u):u,t(u),c&&u!==(u=a())){var i=e.selectionStart,o=e.selectionEnd;e.value=u??"",o!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(o,e.value.length))}}),(cn&&e.defaultValue!==e.value||fn(a)==null&&e.value)&&t(jt(e)?Ut(e.value):e.value),vn(()=>{var n=a();jt(e)&&n===Ut(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}function jt(e){var a=e.type;return a==="number"||a==="range"}function Ut(e){return e===""?null:+e}let Xt=null,Rt=null;async function Ae(){return Rt||(Xt||(Xt=(async()=>{const e=await Pn(()=>import("../chunks/D-8nYH0_.js"),[],import.meta.url),a=e.Loader||e.default&&e.default.Loader;if(!a)throw new Error("Could not load Google Maps Loader");return Rt=new a({apiKey:"AIzaSyAixRzVqb7kii3XrzzL3OxsN7k_2CoMeaM",version:"weekly"}),Rt})()),Xt)}async function Ha(){return await(await Ae()).importLibrary("core")}async function Ya(){return await(await Ae()).importLibrary("maps")}async function Dn(){return await(await Ae()).importLibrary("marker")}async function On(){return await(await Ae()).importLibrary("places")}async function ta(){return await(await Ae()).importLibrary("routes")}async function Rn(){return await(await Ae()).importLibrary("geometry")}async function Cn(e,a={}){const{Map:t}=await Ya();return new t(e,a)}async function At(e){const a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch ${e}`);const t=await a.text();return`data:image/svg+xml;base64,${btoa(t)}`}function wn(){ue.set(!0),se.set({key:"ending_session",params:{}}),Xa()}var $n=J('<div class="map-container svelte-zwa6j7"></div> <button class="end-session-button svelte-zwa6j7"> </button> <!>',1);function qn(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(za,"$isDriving",t),u=()=>O(Me,"$carStatus",t),i=()=>O($t,"$userLocation",t),o=()=>O(Zt,"$pathCarToBusStopPickup",t),r=()=>O(Ct,"$pathBusStopPickupToBusStopDestination",t),s=()=>O(qt,"$pathChosenPickupToBusStopPickup",t),d=()=>O(Tt,"$pathBusStopDestinationToChosenDestination",t),l=()=>O(Re,"$fitBoundsTarget",t),v=()=>O(ne,"$endSessionText",t);let _,g=null,y=null,b=null,k=null,S=null,x=null,C=null,M=null,D=null,$=null,B=null,z=null,Q=null;function K(m,P){if(g&&m){const T={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},N={path:z,strokeOpacity:1,scale:4},h={path:Q,strokeOpacity:1,scale:4};return P?m.setOptions({strokeOpacity:0,icons:[{icon:T,offset:"0",repeat:"20px"},{icon:N,offset:"0",repeat:"0"},{icon:h,offset:"100%",repeat:"0"}],visible:!1,map:g,zIndex:1}):m.setOptions({strokeColor:"#FF0000",strokeWeight:4,icons:[{icon:N,offset:"0",repeat:"0"},{icon:h,offset:"100%",repeat:"0"}],visible:!1,map:g}),m.setMap(g),m}return null}function G(m,P){if(!P||P.length<2)return{index:0,progress:0};let T=1/0,N=0,h=0;for(let f=0;f<P.length-1;f++){const w=P[f],I=P[f+1],A=F(m,w,I),j=H(w,I,A),ce=google.maps.geometry.spherical.computeDistanceBetween(m,j);ce<T&&(T=ce,N=f,h=A)}return{index:N,progress:h}}function F(m,P,T){const N=P.lat(),h=P.lng(),f=T.lat(),w=T.lng(),I=m.lat(),A=m.lng(),j=w-h,ce=f-N,Pe=j*j+ce*ce;if(Pe===0)return 0;const we=((A-h)*j+(I-N)*ce)/Pe;return Math.max(0,Math.min(1,we))}function H(m,P,T){const N=m.lat()+(P.lat()-m.lat())*T,h=m.lng()+(P.lng()-m.lng())*T;return new google.maps.LatLng(N,h)}function ee(m,P,T,N){if(!m||!g)return P;const h=m.getPath().getArray();if(h.length<2)return P;const{index:f,progress:w}=G(T,h),I=[];for(let A=0;A<=f;A++)I.push(h[A]);if(w>0&&f<h.length-1){const A=H(h[f],h[f+1],w);I.push(A)}if(!P){let A="#FF0000";n()&&(A="#00AA00"),P=new google.maps.Polyline({map:g,strokeColor:A,strokeWeight:4,strokeOpacity:1,zIndex:1})}return P.setPath(I),P}Ce(async()=>{var f;ue.set(!0),se.set({key:"loading_map",params:{}}),g=await Cn(_,{center:{lat:58.378,lng:26.729},zoom:13,disableDefaultUI:!0,mapId:"DEMO_MAP_ID"});const{AdvancedMarkerElement:m}=await Dn(),{SymbolPath:P}=await Ha();await Rn(),z=P.CIRCLE,Q=P.FORWARD_OPEN_ARROW,$=await At("/usermarker.svg"),B=await At("/carmarker.svg");const T=document.createElement("img");T.src=B,T.style.width="48px",T.style.height="48px",D=new m({position:(f=u())==null?void 0:f.pose,map:g,content:T});const N=document.createElement("img");N.src=$,N.style.width="32px",N.style.height="32px",M=new m({map:g,content:N});const{Polyline:h}=await Ya();y=K(new h,!0),b=K(new h,!1),k=K(new h,!0),S=K(new h,!1),x=null,C=null,ue.set(!1),se.set({key:"loading",params:{}})}),ve(()=>{i()&&M&&(M.position=i())}),ve(()=>{var m;if((m=u())!=null&&m.pose&&D){D.position=u().pose;const P=new google.maps.LatLng(u().pose.lat,u().pose.lng);S&&o()&&(C=ee(S,C,P)),b&&r()&&(x=ee(b,x,P))}}),ve(()=>{i()&&M&&(M.position=i())}),ve(()=>{s()&&y?(y.setPath(s().pathArray),y.setVisible(!0)):y!=null&&y.getVisible()&&y.setVisible(!1)}),ve(()=>{r()&&b?(b.setPath(r().pathArray),b.setVisible(!0)):b!=null&&b.getVisible()&&(b.setVisible(!1),x&&(x.setMap(null),x=null))}),ve(()=>{d()&&k?(k.setPath(d().pathArray),k.setVisible(!0)):k!=null&&k.getVisible()&&k.setVisible(!1)}),ve(()=>{o()&&S?(S.setPath(o().pathArray),S.setVisible(!0)):S!=null&&S.getVisible()&&(S.setVisible(!1),C&&(C.setMap(null),C=null))}),ve(()=>{var m,P,T,N,h,f,w;if(l()==="all"){if((m=s())!=null&&m.bounds&&((P=r())!=null&&P.bounds)&&((T=d())!=null&&T.bounds)){const I=s().bounds.union(r().bounds).union(d().bounds);g==null||g.fitBounds(I)}}else l()==="pickup"?(N=s())!=null&&N.bounds&&(g==null||g.fitBounds(s().bounds)):l()==="destination"?(h=d())!=null&&h.bounds&&(g==null||g.fitBounds(d().bounds)):l()==="carToPickup"?(f=o())!=null&&f.bounds&&((w=s())!=null&&w.bounds)&&(g==null||g.fitBounds(o().bounds.union(s().bounds))):l()==="default"&&(g==null||g.setCenter({lat:58.378,lng:26.729}),g==null||g.setZoom(13))});const ne=Z("end_session_button");var oe=$n(),de=Nt(oe);bn(de,m=>_=m,()=>_);var re=W(de,2);re.__click=[wn];var E=q(re,!0);R(re);var pe=W(re,2);gn(pe,()=>a.children),ie(()=>V(E,v())),X(e,oe),Le(),c()}qe(["click"]);function Tn(e,a){var t;ue.set(!0),se.set({key:"loading",params:{}}),(t=a())==null||t.publishState("spot-picking")}var xn=J('<button class="order-car-button svelte-1e7pabs"> </button>');function In(e,a){ke(a,!1);const[t,c]=Se(),n=()=>O(Te,"$mqttClient",t),u=()=>O(i,"$orderCarText",t),i=Z("order_car_button");Mn();var o=xn();o.__click=[Tn,n];var r=q(o,!0);R(o),ie(()=>V(r,u())),X(e,o),Le(),c()}qe(["click"]);var zt={},Ke={},Ee={},U={},aa;function ge(){if(aa)return U;aa=1,Object.defineProperty(U,"__esModule",{value:!0}),U.areaConversion=U.timeConversion=U.distanceConversion=U.altitudeKeys=U.latitudeKeys=U.longitudeKeys=U.MAXLON=U.MINLON=U.MAXLAT=U.MINLAT=U.earthRadius=U.sexagesimalPattern=void 0;var e=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;U.sexagesimalPattern=e;var a=6378137;U.earthRadius=a;var t=-90;U.MINLAT=t;var c=90;U.MAXLAT=c;var n=-180;U.MINLON=n;var u=180;U.MAXLON=u;var i=["lng","lon","longitude",0];U.longitudeKeys=i;var o=["lat","latitude",1];U.latitudeKeys=o;var r=["alt","altitude","elevation","elev",2];U.altitudeKeys=r;var s={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};U.distanceConversion=s;var d={m:60,h:3600,d:86400};U.timeConversion=d;var l={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};return U.areaConversion=l,l.sqm=l.m2,l.sqkm=l.km2,l.sqft=l.ft2,l.sqyd=l.yd2,l.sqin=l.in2,U}var Ve={},na;function Gt(){if(na)return Ve;na=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.default=void 0;var e=function(c,n){return n.reduce(function(u,i){if(typeof c>"u"||c===null)throw new Error("'".concat(c,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(c,i)&&typeof i<"u"&&typeof u>"u"?(u=i,i):u},void 0)},a=e;return Ve.default=a,Ve}var We={},Fe={},ra;function Kt(){if(ra)return Fe;ra=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var e=function(c){var n=c.toString().trim();return isNaN(parseFloat(n))?!1:parseFloat(n)===Number(n)},a=e;return Fe.default=a,Fe}var je={},ia;function Et(){if(ia)return je;ia=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var e=ge(),a=function(n){return e.sexagesimalPattern.test(n.toString().trim())},t=a;return je.default=t,je}var Ue={},oa;function Vt(){if(oa)return Ue;oa=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var e=ge(),a=function(n){var u=new RegExp(e.sexagesimalPattern).exec(n.toString().trim());if(typeof u>"u"||u===null)throw new Error("Given value is not in sexagesimal format");var i=Number(u[2])/60||0,o=Number(u[4])/3600||0,r=parseFloat(u[1])+i+o;return["S","W"].includes(u[7])?-r:r},t=a;return Ue.default=t,Ue}var Xe={},ze={},ua;function Qt(){if(ua)return ze;ua=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.default=void 0;var e=ge(),a=t(Gt());function t(r){return r&&r.__esModule?r:{default:r}}function c(r,s){var d=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);s&&(l=l.filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable})),d.push.apply(d,l)}return d}function n(r){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?c(Object(d),!0).forEach(function(l){u(r,l,d[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):c(Object(d)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(d,l))})}return r}function u(r,s,d){return s in r?Object.defineProperty(r,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[s]=d,r}var i=function(s){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:e.longitudeKeys,latitude:e.latitudeKeys,altitude:e.altitudeKeys},l=(0,a.default)(s,d.longitude),v=(0,a.default)(s,d.latitude),_=(0,a.default)(s,d.altitude);return n({latitude:v,longitude:l},_?{altitude:_}:{})},o=i;return ze.default=o,ze}var He={},sa;function Za(){if(sa)return He;sa=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;var e=n(Kt()),a=n(Et()),t=n(Vt()),c=ge();function n(o){return o&&o.__esModule?o:{default:o}}var u=function o(r){return(0,e.default)(r)?!(parseFloat(r)>c.MAXLAT||r<c.MINLAT):(0,a.default)(r)?o((0,t.default)(r)):!1},i=u;return He.default=i,He}var Ye={},la;function Ja(){if(la)return Ye;la=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var e=n(Kt()),a=n(Et()),t=n(Vt()),c=ge();function n(o){return o&&o.__esModule?o:{default:o}}var u=function o(r){return(0,e.default)(r)?!(parseFloat(r)>c.MAXLON||r<c.MINLON):(0,a.default)(r)?o((0,t.default)(r)):!1},i=u;return Ye.default=i,Ye}var da;function Qa(){if(da)return Xe;da=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var e=c(Qt()),a=c(Za()),t=c(Ja());function c(i){return i&&i.__esModule?i:{default:i}}var n=function(o){var r=(0,e.default)(o),s=r.latitude,d=r.longitude;if(Array.isArray(o)&&o.length>=2)return(0,t.default)(o[0])&&(0,a.default)(o[1]);if(typeof s>"u"||typeof d>"u")return!1;var l=o[d],v=o[s];return!(typeof v>"u"||typeof l>"u"||(0,a.default)(v)===!1||(0,t.default)(l)===!1)},u=n;return Xe.default=u,Xe}var ca;function ea(){if(ca)return We;ca=1,Object.defineProperty(We,"__esModule",{value:!0}),We.default=void 0;var e=u(Kt()),a=u(Et()),t=u(Vt()),c=u(Qa()),n=u(Qt());function u(l){return l&&l.__esModule?l:{default:l}}function i(l,v){var _=Object.keys(l);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(l);v&&(g=g.filter(function(y){return Object.getOwnPropertyDescriptor(l,y).enumerable})),_.push.apply(_,g)}return _}function o(l){for(var v=1;v<arguments.length;v++){var _=arguments[v]!=null?arguments[v]:{};v%2?i(Object(_),!0).forEach(function(g){r(l,g,_[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(_)):i(Object(_)).forEach(function(g){Object.defineProperty(l,g,Object.getOwnPropertyDescriptor(_,g))})}return l}function r(l,v,_){return v in l?Object.defineProperty(l,v,{value:_,enumerable:!0,configurable:!0,writable:!0}):l[v]=_,l}var s=function l(v){if((0,e.default)(v))return Number(v);if((0,a.default)(v))return(0,t.default)(v);if((0,c.default)(v)){var _=(0,n.default)(v);return Array.isArray(v)?v.map(function(g,y){return[0,1].includes(y)?l(g):g}):o(o(o({},v),_.latitude&&r({},_.latitude,l(v[_.latitude]))),_.longitude&&r({},_.longitude,l(v[_.longitude])))}return Array.isArray(v)?v.map(function(g){return(0,c.default)(g)?l(g):g}):v},d=s;return We.default=d,We}var fa;function he(){if(fa)return Ee;fa=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.default=void 0;var e=ge(),a=c(Gt()),t=c(ea());function c(i){return i&&i.__esModule?i:{default:i}}var n=function(o,r){var s=(0,a.default)(o,e.latitudeKeys);if(!(typeof s>"u"||s===null)){var d=o[s];return r===!0?d:(0,t.default)(d)}},u=n;return Ee.default=u,Ee}var Ze={},va;function ye(){if(va)return Ze;va=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var e=ge(),a=c(Gt()),t=c(ea());function c(i){return i&&i.__esModule?i:{default:i}}var n=function(o,r){var s=(0,a.default)(o,e.longitudeKeys);if(!(typeof s>"u"||s===null)){var d=o[s];return r===!0?d:(0,t.default)(d)}},u=n;return Ze.default=u,Ze}var Je={},ga;function De(){if(ga)return Je;ga=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var e=function(c){return c*Math.PI/180},a=e;return Je.default=a,Je}var Qe={},pa;function Ne(){if(pa)return Qe;pa=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var e=function(c){return c*180/Math.PI},a=e;return Qe.default=a,Qe}var _a;function An(){if(_a)return Ke;_a=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var e=u(he()),a=u(ye()),t=u(De()),c=u(Ne()),n=ge();function u(r){return r&&r.__esModule?r:{default:r}}var i=function(s,d,l){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6371e3,_=(0,e.default)(s),g=(0,a.default)(s),y=d/v,b=(0,t.default)(l),k=(0,t.default)(_),S=(0,t.default)(g),x=Math.asin(Math.sin(k)*Math.cos(y)+Math.cos(k)*Math.sin(y)*Math.cos(b)),C=S+Math.atan2(Math.sin(b)*Math.sin(y)*Math.cos(k),Math.cos(y)-Math.sin(k)*Math.sin(x)),M=(0,c.default)(C);return(M<n.MINLON||M>n.MAXLON)&&(C=(C+3*Math.PI)%(2*Math.PI)-Math.PI,M=(0,c.default)(C)),{latitude:(0,c.default)(x),longitude:M}},o=i;return Ke.default=o,Ke}var et={},ma;function Nn(){if(ma)return et;ma=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var e=ge(),a=function(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",i=e.areaConversion[u];if(i)return n*i;throw new Error("Invalid unit used for area conversion.")},t=a;return et.default=t,et}var tt={},ha;function Bn(){if(ha)return tt;ha=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var e=ge(),a=function(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",i=e.distanceConversion[u];if(i)return n*i;throw new Error("Invalid unit used for distance conversion.")},t=a;return tt.default=t,tt}var at={},ya;function Gn(){if(ya)return at;ya=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=void 0;var e=ge(),a=function(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kmh";switch(u){case"kmh":return n*e.timeConversion.h*e.distanceConversion.km;case"mph":return n*e.timeConversion.h*e.distanceConversion.mi;default:return n}},t=a;return at.default=t,at}var nt={},ba;function Kn(){if(ba)return nt;ba=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;function e(s,d){return u(s)||n(s,d)||t(s,d)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t(s,d){if(s){if(typeof s=="string")return c(s,d);var l=Object.prototype.toString.call(s).slice(8,-1);if(l==="Object"&&s.constructor&&(l=s.constructor.name),l==="Map"||l==="Set")return Array.from(s);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return c(s,d)}}function c(s,d){(d==null||d>s.length)&&(d=s.length);for(var l=0,v=new Array(d);l<d;l++)v[l]=s[l];return v}function n(s,d){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(s)))){var l=[],v=!0,_=!1,g=void 0;try{for(var y=s[Symbol.iterator](),b;!(v=(b=y.next()).done)&&(l.push(b.value),!(d&&l.length===d));v=!0);}catch(k){_=!0,g=k}finally{try{!v&&y.return!=null&&y.return()}finally{if(_)throw g}}return l}}function u(s){if(Array.isArray(s))return s}var i=function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,v=Math.pow(10,l);return Math.round(d*v)/v},o=function(d){var l=d.toString().split("."),v=e(l,2),_=v[0],g=v[1],y=Math.abs(Number(_)),b=+("0."+(g||0))*60,k=b.toString().split("."),S=Math.floor(b),x=i(+("0."+(k[1]||0))*60).toString(),C=x.split("."),M=e(C,2),D=M[0],$=M[1],B=$===void 0?"0":$;return y+"° "+S.toString().padStart(2,"0")+"' "+D.padStart(2,"0")+"."+B.padEnd(1,"0")+'"'},r=o;return nt.default=r,nt}var rt={},it={},ot={},ut={},Pa;function en(){if(Pa)return ut;Pa=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var e=function(c){return c>1?1:c<-1?-1:c},a=e;return ut.default=a,ut}var Ma;function xe(){if(Ma)return ot;Ma=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var e=u(he()),a=u(ye()),t=u(De()),c=u(en()),n=ge();function u(r){return r&&r.__esModule?r:{default:r}}var i=function(s,d){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;l=typeof l<"u"&&!isNaN(l)?l:1;var v=(0,e.default)(s),_=(0,a.default)(s),g=(0,e.default)(d),y=(0,a.default)(d),b=Math.acos((0,c.default)(Math.sin((0,t.default)(g))*Math.sin((0,t.default)(v))+Math.cos((0,t.default)(g))*Math.cos((0,t.default)(v))*Math.cos((0,t.default)(_)-(0,t.default)(y))))*n.earthRadius;return Math.round(b/l)*l},o=i;return ot.default=o,ot}var ka;function tn(){if(ka)return it;ka=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var e=a(xe());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.default;return o=typeof o=="function"?o:e.default,i.slice().sort(function(r,s){return o(u,r)-o(u,s)})},c=t;return it.default=c,it}var La;function En(){if(La)return rt;La=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;var e=a(tn());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i){return(0,e.default)(u,i)[0]},c=t;return rt.default=c,rt}var st={},Sa;function Vn(){if(Sa)return st;Sa=1,Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;var e=n(De()),a=n(he()),t=n(ye()),c=ge();function n(o){return o&&o.__esModule?o:{default:o}}var u=function(r){var s=0;if(r.length>2){for(var d,l,v,_=0;_<r.length;_++){_===r.length-2?(d=r.length-2,l=r.length-1,v=0):_===r.length-1?(d=r.length-1,l=0,v=1):(d=_,l=_+1,v=_+2);var g=(0,t.default)(r[d]),y=(0,a.default)(r[l]),b=(0,t.default)(r[v]);s+=((0,e.default)(b)-(0,e.default)(g))*Math.sin((0,e.default)(y))}s=s*c.earthRadius*c.earthRadius/2}return Math.abs(s)},i=u;return st.default=i,st}var lt={},Da;function an(){if(Da)return lt;Da=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.default=void 0;var e=t(he()),a=t(ye());function t(u){return u&&u.__esModule?u:{default:u}}var c=function(i){if(Array.isArray(i)===!1||i.length===0)throw new Error("No points were given.");return i.reduce(function(o,r){var s=(0,e.default)(r),d=(0,a.default)(r);return{maxLat:Math.max(s,o.maxLat),minLat:Math.min(s,o.minLat),maxLng:Math.max(d,o.maxLng),minLng:Math.min(d,o.minLng)}},{maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0})},n=c;return lt.default=n,lt}var dt={},Oa;function Wn(){if(Oa)return dt;Oa=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;var e=u(he()),a=u(ye()),t=u(De()),c=u(Ne()),n=ge();function u(r){return r&&r.__esModule?r:{default:r}}var i=function(s,d){var l=(0,e.default)(s),v=(0,a.default)(s),_=(0,t.default)(l),g=(0,t.default)(v),y=d/n.earthRadius,b=_-y,k=_+y,S=(0,t.default)(n.MAXLAT),x=(0,t.default)(n.MINLAT),C=(0,t.default)(n.MAXLON),M=(0,t.default)(n.MINLON),D,$;if(b>x&&k<S){var B=Math.asin(Math.sin(y)/Math.cos(_));D=g-B,D<M&&(D+=Math.PI*2),$=g+B,$>C&&($-=Math.PI*2)}else b=Math.max(b,x),k=Math.min(k,S),D=M,$=C;return[{latitude:(0,c.default)(b),longitude:(0,c.default)(D)},{latitude:(0,c.default)(k),longitude:(0,c.default)($)}]},o=i;return dt.default=o,dt}var ct={},Ra;function Fn(){if(Ra)return ct;Ra=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var e=n(he()),a=n(ye()),t=n(De()),c=n(Ne());function n(o){return o&&o.__esModule?o:{default:o}}var u=function(r){if(Array.isArray(r)===!1||r.length===0)return!1;var s=r.length,d=r.reduce(function(g,y){var b=(0,t.default)((0,e.default)(y)),k=(0,t.default)((0,a.default)(y));return{X:g.X+Math.cos(b)*Math.cos(k),Y:g.Y+Math.cos(b)*Math.sin(k),Z:g.Z+Math.sin(b)}},{X:0,Y:0,Z:0}),l=d.X/s,v=d.Y/s,_=d.Z/s;return{longitude:(0,c.default)(Math.atan2(v,l)),latitude:(0,c.default)(Math.atan2(_,Math.sqrt(l*l+v*v)))}},i=u;return ct.default=i,ct}var ft={},Ca;function jn(){if(Ca)return ft;Ca=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.default=void 0;var e=a(an());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u){var i=(0,e.default)(u),o=i.minLat+(i.maxLat-i.minLat)/2,r=i.minLng+(i.maxLng-i.minLng)/2;return{latitude:parseFloat(o.toFixed(6)),longitude:parseFloat(r.toFixed(6))}},c=t;return ft.default=c,ft}var vt={},gt={},wa;function nn(){if(wa)return gt;wa=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var e=n(he()),a=n(ye()),t=n(De()),c=n(Ne());function n(o){return o&&o.__esModule?o:{default:o}}var u=function(r,s){var d=(0,t.default)((0,a.default)(s))-(0,t.default)((0,a.default)(r)),l=Math.log(Math.tan((0,t.default)((0,e.default)(s))/2+Math.PI/4)/Math.tan((0,t.default)((0,e.default)(r))/2+Math.PI/4));return Math.abs(d)>Math.PI&&(d>0?d=(Math.PI*2-d)*-1:d=Math.PI*2+d),((0,c.default)(Math.atan2(d,l))+360)%360},i=u;return gt.default=i,gt}var $a;function Un(){if($a)return vt;$a=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.default=void 0;var e=a(nn());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.default,r=typeof o=="function"?o(u,i):(0,e.default)(u,i);if(isNaN(r))throw new Error("Could not calculate bearing for given points. Check your bearing function");switch(Math.round(r/22.5)){case 1:return"NNE";case 2:return"NE";case 3:return"ENE";case 4:return"E";case 5:return"ESE";case 6:return"SE";case 7:return"SSE";case 8:return"S";case 9:return"SSW";case 10:return"SW";case 11:return"WSW";case 12:return"W";case 13:return"WNW";case 14:return"NW";case 15:return"NNW";default:return"N"}},c=t;return vt.default=c,vt}var pt={},qa;function rn(){if(qa)return pt;qa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var e=t(xe()),a=t(en());function t(u){return u&&u.__esModule?u:{default:u}}var c=function(i,o,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,d=(0,e.default)(o,i,s),l=(0,e.default)(i,r,s),v=(0,e.default)(o,r,s),_=Math.acos((0,a.default)((d*d+v*v-l*l)/(2*d*v))),g=Math.acos((0,a.default)((l*l+v*v-d*d)/(2*l*v)));return _>Math.PI/2?d:g>Math.PI/2?l:Math.sin(_)*d},n=c;return pt.default=n,pt}var _t={},Ta;function Xn(){if(Ta)return _t;Ta=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var e=n(he()),a=n(ye()),t=n(De()),c=n(Ne());function n(o){return o&&o.__esModule?o:{default:o}}var u=function(r,s){var d=(0,e.default)(s),l=(0,a.default)(s),v=(0,e.default)(r),_=(0,a.default)(r),g=((0,c.default)(Math.atan2(Math.sin((0,t.default)(l)-(0,t.default)(_))*Math.cos((0,t.default)(d)),Math.cos((0,t.default)(v))*Math.sin((0,t.default)(d))-Math.sin((0,t.default)(v))*Math.cos((0,t.default)(d))*Math.cos((0,t.default)(l)-(0,t.default)(_))))+360)%360;return g},i=u;return _t.default=i,_t}var mt={},xa;function zn(){if(xa)return mt;xa=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var e=a(xe());function a(u){return u&&u.__esModule?u:{default:u}}function t(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(o){return typeof o}:t=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},t(u)}var c=function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.default;return i.reduce(function(r,s){return t(r)==="object"&&r.last!==null&&(r.distance+=o(s,r.last)),r.last=s,r},{last:null,distance:0}).distance},n=c;return mt.default=n,mt}var ht={},Ia;function Hn(){if(Ia)return ht;Ia=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var e=n(he()),a=n(ye()),t=n(De()),c=ge();function n(o){return o&&o.__esModule?o:{default:o}}var u=function(r,s){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;d=typeof d<"u"&&!isNaN(d)?d:1;var l=(0,e.default)(r),v=(0,a.default)(r),_=(0,e.default)(s),g=(0,a.default)(s),y=6356752314245e-6,b=1/298.257223563,k=(0,t.default)(g-v),S,x,C,M,D,$,B=Math.atan((1-b)*Math.tan((0,t.default)(parseFloat(l)))),z=Math.atan((1-b)*Math.tan((0,t.default)(parseFloat(_)))),Q=Math.sin(B),K=Math.cos(B),G=Math.sin(z),F=Math.cos(z),H=k,ee,ne=100;do{var oe=Math.sin(H),de=Math.cos(H);if($=Math.sqrt(F*oe*(F*oe)+(K*G-Q*F*de)*(K*G-Q*F*de)),$===0)return 0;S=Q*G+K*F*de,x=Math.atan2($,S),C=K*F*oe/$,M=1-C*C,D=S-2*Q*G/M,isNaN(D)&&(D=0);var re=b/16*M*(4+b*(4-3*M));ee=H,H=k+(1-re)*b*C*(x+re*$*(D+re*S*(-1+2*D*D)))}while(Math.abs(H-ee)>1e-12&&--ne>0);if(ne===0)return NaN;var E=M*(c.earthRadius*c.earthRadius-y*y)/(y*y),pe=1+E/16384*(4096+E*(-768+E*(320-175*E))),m=E/1024*(256+E*(-128+E*(74-47*E))),P=m*$*(D+m/4*(S*(-1+2*D*D)-m/6*D*(-3+4*$*$)*(-3+4*D*D))),T=y*pe*(x-P);return Math.round(T/d)*d},i=u;return ht.default=i,ht}var yt={},Aa;function Yn(){if(Aa)return yt;Aa=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var e=function(c){if(/^(NNE|NE|NNW|N)$/.test(c))return"N";if(/^(ENE|E|ESE|SE)$/.test(c))return"E";if(/^(SSE|S|SSW|SW)$/.test(c))return"S";if(/^(WSW|W|WNW|NW)$/.test(c))return"W"},a=e;return yt.default=a,yt}var bt={},Na;function Zn(){if(Na)return bt;Na=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.default=void 0;var e=a(xe());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.default,r=o(u,i),s=Number(i.time)-Number(u.time),d=r/s*1e3;return d},c=t;return bt.default=c,bt}var Pt={},Ba;function Jn(){if(Ba)return Pt;Ba=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var e=a(xe());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i,o){return(0,e.default)(i,u)+(0,e.default)(u,o)===(0,e.default)(i,o)},c=t;return Pt.default=c,Pt}var Mt={},Ga;function Qn(){if(Ga)return Mt;Ga=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var e=t(he()),a=t(ye());function t(u){return u&&u.__esModule?u:{default:u}}var c=function(i,o){for(var r=!1,s=o.length,d=-1,l=s-1;++d<s;l=d)((0,a.default)(o[d])<=(0,a.default)(i)&&(0,a.default)(i)<(0,a.default)(o[l])||(0,a.default)(o[l])<=(0,a.default)(i)&&(0,a.default)(i)<(0,a.default)(o[d]))&&(0,e.default)(i)<((0,e.default)(o[l])-(0,e.default)(o[d]))*((0,a.default)(i)-(0,a.default)(o[d]))/((0,a.default)(o[l])-(0,a.default)(o[d]))+(0,e.default)(o[d])&&(r=!r);return r},n=c;return Mt.default=n,Mt}var kt={},Ka;function er(){if(Ka)return kt;Ka=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var e=a(rn());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i,o,r){return(0,e.default)(u,i,o)<r},c=t;return kt.default=c,kt}var Lt={},Ea;function tr(){if(Ea)return Lt;Ea=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var e=a(xe());function a(n){return n&&n.__esModule?n:{default:n}}var t=function(u,i,o){var r=.01;return(0,e.default)(u,i,r)<o},c=t;return Lt.default=c,Lt}var St={},Va;function ar(){if(Va)return St;Va=1,Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;function e(r,s){return u(r)||n(r,s)||t(r,s)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t(r,s){if(r){if(typeof r=="string")return c(r,s);var d=Object.prototype.toString.call(r).slice(8,-1);if(d==="Object"&&r.constructor&&(d=r.constructor.name),d==="Map"||d==="Set")return Array.from(r);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return c(r,s)}}function c(r,s){(s==null||s>r.length)&&(s=r.length);for(var d=0,l=new Array(s);d<s;d++)l[d]=r[d];return l}function n(r,s){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(r)))){var d=[],l=!0,v=!1,_=void 0;try{for(var g=r[Symbol.iterator](),y;!(l=(y=g.next()).done)&&(d.push(y.value),!(s&&d.length===s));l=!0);}catch(b){v=!0,_=b}finally{try{!l&&g.return!=null&&g.return()}finally{if(v)throw _}}return d}}function u(r){if(Array.isArray(r))return r}var i=function(s){if(!s.startsWith("POLYGON"))throw new Error("Invalid wkt.");var d=s.slice(s.indexOf("(")+2,s.indexOf(")")).split(", "),l=d.map(function(v){var _=v.split(" "),g=e(_,2),y=g[0],b=g[1];return{longitude:parseFloat(y),latitude:parseFloat(b)}});return l},o=i;return St.default=o,St}var Wa;function nr(){return Wa||(Wa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a={computeDestinationPoint:!0,convertArea:!0,convertDistance:!0,convertSpeed:!0,decimalToSexagesimal:!0,findNearest:!0,getAreaOfPolygon:!0,getBounds:!0,getBoundsOfDistance:!0,getCenter:!0,getCenterOfBounds:!0,getCompassDirection:!0,getCoordinateKey:!0,getCoordinateKeys:!0,getDistance:!0,getDistanceFromLine:!0,getGreatCircleBearing:!0,getLatitude:!0,getLongitude:!0,getPathLength:!0,getPreciseDistance:!0,getRhumbLineBearing:!0,getRoughCompassDirection:!0,getSpeed:!0,isDecimal:!0,isPointInLine:!0,isPointInPolygon:!0,isPointNearLine:!0,isPointWithinRadius:!0,isSexagesimal:!0,isValidCoordinate:!0,isValidLatitude:!0,isValidLongitude:!0,orderByDistance:!0,sexagesimalToDecimal:!0,toDecimal:!0,toRad:!0,toDeg:!0,wktToPolygon:!0};Object.defineProperty(e,"computeDestinationPoint",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"convertArea",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"convertDistance",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"convertSpeed",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"decimalToSexagesimal",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"findNearest",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"getAreaOfPolygon",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"getBounds",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"getBoundsOfDistance",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"getCenter",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"getCenterOfBounds",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(e,"getCompassDirection",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(e,"getCoordinateKey",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"getCoordinateKeys",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(e,"getDistance",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(e,"getDistanceFromLine",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(e,"getGreatCircleBearing",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(e,"getLatitude",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(e,"getLongitude",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(e,"getPathLength",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(e,"getPreciseDistance",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(e,"getRhumbLineBearing",{enumerable:!0,get:function(){return $.default}}),Object.defineProperty(e,"getRoughCompassDirection",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(e,"getSpeed",{enumerable:!0,get:function(){return z.default}}),Object.defineProperty(e,"isDecimal",{enumerable:!0,get:function(){return Q.default}}),Object.defineProperty(e,"isPointInLine",{enumerable:!0,get:function(){return K.default}}),Object.defineProperty(e,"isPointInPolygon",{enumerable:!0,get:function(){return G.default}}),Object.defineProperty(e,"isPointNearLine",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(e,"isPointWithinRadius",{enumerable:!0,get:function(){return H.default}}),Object.defineProperty(e,"isSexagesimal",{enumerable:!0,get:function(){return ee.default}}),Object.defineProperty(e,"isValidCoordinate",{enumerable:!0,get:function(){return ne.default}}),Object.defineProperty(e,"isValidLatitude",{enumerable:!0,get:function(){return oe.default}}),Object.defineProperty(e,"isValidLongitude",{enumerable:!0,get:function(){return de.default}}),Object.defineProperty(e,"orderByDistance",{enumerable:!0,get:function(){return re.default}}),Object.defineProperty(e,"sexagesimalToDecimal",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(e,"toDecimal",{enumerable:!0,get:function(){return pe.default}}),Object.defineProperty(e,"toRad",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(e,"toDeg",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(e,"wktToPolygon",{enumerable:!0,get:function(){return T.default}});var t=h(An()),c=h(Nn()),n=h(Bn()),u=h(Gn()),i=h(Kn()),o=h(En()),r=h(Vn()),s=h(an()),d=h(Wn()),l=h(Fn()),v=h(jn()),_=h(Un()),g=h(Gt()),y=h(Qt()),b=h(xe()),k=h(rn()),S=h(Xn()),x=h(he()),C=h(ye()),M=h(zn()),D=h(Hn()),$=h(nn()),B=h(Yn()),z=h(Zn()),Q=h(Kt()),K=h(Jn()),G=h(Qn()),F=h(er()),H=h(tr()),ee=h(Et()),ne=h(Qa()),oe=h(Za()),de=h(Ja()),re=h(tn()),E=h(Vt()),pe=h(ea()),m=h(De()),P=h(Ne()),T=h(ar()),N=ge();Object.keys(N).forEach(function(f){f==="default"||f==="__esModule"||Object.prototype.hasOwnProperty.call(a,f)||Object.defineProperty(e,f,{enumerable:!0,get:function(){return N[f]}})});function h(f){return f&&f.__esModule?f:{default:f}}}(zt)),zt}var rr=nr();const ir=[{name:"Atlantis (linna sisenev)",position:{lat:58.381230525460914,lng:26.72889596227438,height:34.64125061035156}},{name:"Delta tasku",position:{lat:58.38532325807102,lng:26.726263920563593,height:34.514373779296875}},{name:"Kaare (FI suunas)",position:{lat:58.36614410204848,lng:26.703119272055886,height:70.58875274658203}},{name:"Kaare (Kesklinna suunas)",position:{lat:58.36655441206589,lng:26.70448564279842,height:69.93562316894531}},{name:"Kesklinn (Lõpp-peatus)",position:{lat:58.37722696432968,lng:26.727870192267574,height:37.182498931884766}},{name:"Kesklinn I",position:{lat:58.37677386173414,lng:26.726861434698954,height:40.59937286376953}},{name:"Kesklinn II",position:{lat:58.37724738605336,lng:26.727917843058677,height:37.10874938964844}},{name:"Kesklinn III",position:{lat:58.37750266291346,lng:26.728538760409922,height:35.79312515258789}},{name:"Kesklinn IV",position:{lat:58.3775891647219,lng:26.72790850432179,height:36.48999786376953}},{name:"Kesklinn V",position:{lat:58.37745946055825,lng:26.727636310464657,height:37.046875}},{name:"Kesklinn VI",position:{lat:58.37690994056366,lng:26.72651058815396,height:40.94687271118164}},{name:"Lembitu",position:{lat:58.36929652044244,lng:26.710742889251737,height:61.71999740600586}},{name:"Linnamuuseum",position:{lat:58.38253304252881,lng:26.72806896214309,height:34.234375}},{name:"Lõunakeskus III",position:{lat:58.35891035335472,lng:26.672449303297384,height:71.6668701171875}},{name:"Pauluse (Kesklinna suunas)",position:{lat:58.37105710554966,lng:26.715580324006314,height:58.765625}},{name:"Pauluse (linnast väljuv)",position:{lat:58.37152909953232,lng:26.716283875904026,height:58.869998931884766}},{name:"Raeplats (linna)",position:{lat:58.37972237038812,lng:26.72581852210892,height:35.46437454223633}},{name:"Raeplats (maale)",position:{lat:58.38120012638039,lng:26.72476568930152,height:34.47312545776367}},{name:"Raja (Kesklinna suunas)",position:{lat:58.36172667219093,lng:26.69139868654175,height:76.3699951171875}},{name:"Raja (linnast väljuv)",position:{lat:58.36130422741691,lng:26.69002816255349,height:76.52749633789062}},{name:"Raudteejaam (Kesklinna ja Riia tn. suunas)",position:{lat:58.373738612726946,lng:26.70719863057582,height:62.53562545776367}},{name:"Raudteejaam (Lõpp-peatus)",position:{lat:58.374010636859865,lng:26.706755122576055,height:62.573123931884766}},{name:"Raudteejaam (Tähtvere suunas)",position:{lat:58.373990914208264,lng:26.706784008304183,height:62.584999084472656}},{name:"Raudteejaam III",position:{lat:58.373482349592585,lng:26.707849053555996,height:62.34187316894531}},{name:"Riia ring (Kesklinna suunas)",position:{lat:58.35872329519622,lng:26.68492227877388,height:79.62874603271484}},{name:"Riia ring (linnast väljuv)",position:{lat:58.35856540771666,lng:26.684148802519463,height:79.58562469482422}},{name:"Riiamäe (linnast väljuv)",position:{lat:58.37382799680585,lng:26.72187467909106,height:58.49187469482422}},{name:"Soinaste I (kesklinna suunas)",position:{lat:58.36436772678991,lng:26.699246176498228,height:71.17562103271484}},{name:"Soinaste II (linnast väljuv)",position:{lat:58.36389463157283,lng:26.69743277395492,height:73.04374694824219}},{name:"Soola (Tasku)",position:{lat:58.3774615077504,lng:26.730195491001425,height:34.204376220703125}},{name:"Soola I (Kvartali kõrval, Sõpruse silla suunas)",position:{lat:58.377171779855765,lng:26.730051873472686,height:34.244998931884766}},{name:"Soola I (Lõpp-peatus)",position:{lat:58.377253856444206,lng:26.729919938749543,height:34.3224983215332}},{name:"Turu",position:{lat:58.37800120091765,lng:26.733779321636387,height:33.57749938964844}},{name:"Turu (Lõpp-peatus)",position:{lat:58.37796681499288,lng:26.733854521849253,height:33.58374786376953}},{name:"Vabaduse puiestee (maale)",position:{lat:58.37912232867339,lng:26.727219079875574,height:35.69062423706055}},{name:"Vabadussild-Palmihoone (linna)",position:{lat:58.38358901386241,lng:26.72340282293865,height:34.34562301635742}},{name:"Vabadussild-Palmihoone (maale)",position:{lat:58.38336485937513,lng:26.723665688422646,height:34.36249923706055}},{name:"Vene (Kesklinna suunas)",position:{lat:58.3857869621336,lng:26.726394134951548,height:34.65999984741211}},{name:"Vene (linnast väljuv)",position:{lat:58.38667217015892,lng:26.72685540137343,height:35.373748779296875}}],or={stops:ir};class ur{constructor(){Dt(this,"stops");this.stops=or.stops}findClosestStops(a,t=.5,c=3){return this.stops.map(i=>{const o=rr.getDistance({latitude:a[0],longitude:a[1]},{latitude:i.position.lat,longitude:i.position.lng})/1e3;return{name:i.name,position:i.position,dist_from_point:o}}).filter(i=>i.dist_from_point<=t).sort((i,o)=>i.dist_from_point-o.dist_from_point).slice(0,c)}}var sr=J('<label for="spot-search-input"> </label>'),lr=(e,a)=>L(a,!0),dr=J('<button type="button" class="clear-searchbar svelte-94s185" aria-label="Clear"><img src="/clearsearchbar.svg" alt="Clear" class="clear-searchbar-icon svelte-94s185"/></button>'),cr=J('<div class="loading"> </div>'),fr=J('<li><button type="button" class="suggestion-item svelte-94s185"><div class="suggestion-name-text"> </div> <div class="secondary-suggestion-text"> </div></button></li>'),vr=J('<li><div class="suggestion-item svelte-94s185"><div class="suggestion-name-text"> </div></div></li>'),gr=(e,a,t)=>a(p(t)),pr=J('<div class="secondary-suggestion-text"> </div>'),_r=J('<li><button type="button" class="suggestion-item svelte-94s185"><div class="suggestion-name-text"> </div> <!></button></li>'),mr=J('<ul class="suggestions-list"><!> <!></ul>'),hr=J('<div class="spot-search-bar"><!> <div class="searchbar-wrapper svelte-94s185"><input id="spot-search-input" type="text"/> <!></div> <!> <!></div>');function Fa(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(Bt,"$locale",t),u=()=>O($t,"$userLocation",t),i=()=>O(C,"$yourLocationMessage",t),o=()=>O(D,"$loadingText",t),r=()=>O(M,"$yourLocationErrorMessage",t);let s=Y(""),d=Y(Ht([])),l=Y(!1),v=null,_=Y(!1),g=null,y=Ot(a,"label",3,""),b=Ot(a,"placeholder",3,""),k=Ot(a,"error",3,!1),S=Ot(a,"value",3,"");Ce(async()=>{const{AutocompleteSuggestion:m}=await On();v=m});async function x(m){var P;if(v){L(l,!0);const T={input:m.input,includedRegionCodes:["ee"],region:"ee",language:n()},N=await v.fetchAutocompleteSuggestions(T);let h=[];if(N.suggestions&&N.suggestions.length>0)for(const f of N.suggestions){let w=await f.placePrediction.toPlace().fetchFields({fields:["location"]});h.push({name:f.placePrediction.mainText.text,secondaryText:((P=f.placePrediction.secondaryText)==null?void 0:P.text)??"",position:{lat:w.place.location.lat(),lng:w.place.location.lng()}})}return L(l,!1),h}return[]}ve(()=>{p(s)?x({input:p(s)}).then(m=>{L(d,m,!0)}):L(d,[],!0)}),ve(()=>{S()!==void 0&&S()!==null&&L(s,S())});const C=Z("your_location"),M=Z("your_location_error"),D=Z("loading");function $(m){var P;g=m,L(s,m.name,!0),L(_,!1),(P=a.onSelect)==null||P.call(a,m)}function B(){var P;if(!u())return;const m={name:i(),position:{lat:u().lat,lng:u().lng},secondaryText:`${u().lat}, ${u().lng}`};g=m,L(s,m.name,!0),L(_,!1),(P=a.onSelect)==null||P.call(a,m)}function z(){L(_,!1),g&&p(s)!==g.name&&L(s,g.name,!0)}function Q(){var m;L(s,""),g=null,L(d,[],!0),L(_,!1),(m=a.onSelect)==null||m.call(a,null)}var K=hr(),G=q(K);{var F=m=>{var P=sr(),T=q(P,!0);R(P),ie(()=>V(T,y())),X(m,P)};te(G,m=>{y()&&m(F)})}var H=W(G,2),ee=q(H);kn(ee),ee.__click=[lr,_];var ne=W(ee,2);{var oe=m=>{var P=dr();P.__click=Q,X(m,P)};te(ne,m=>{p(s)&&m(oe)})}R(H);var de=W(H,2);{var re=m=>{var P=cr(),T=q(P,!0);R(P),ie(()=>V(T,o())),X(m,P)};te(de,m=>{p(l)&&m(re)})}var E=W(de,2);{var pe=m=>{var P=mr(),T=q(P);{var N=w=>{var I=fr(),A=q(I);A.__mousedown=B;var j=q(A),ce=q(j,!0);R(j);var Pe=W(j,2),we=q(Pe);R(Pe),R(A),R(I),ie(()=>{V(ce,i()),V(we,`${u().lat??""}, ${u().lng??""}`)}),X(w,I)},h=w=>{var I=vr(),A=q(I),j=q(A),ce=q(j,!0);R(j),R(A),R(I),ie(()=>V(ce,r())),X(w,I)};te(T,w=>{u()?w(N):w(h,!1)})}var f=W(T,2);xt(f,17,()=>p(d),It,(w,I)=>{var A=_r(),j=q(A);j.__mousedown=[gr,$,I];var ce=q(j),Pe=q(ce,!0);R(ce);var we=W(ce,2);{var Wt=Ie=>{var Be=pr(),Ge=q(Be,!0);R(Be),ie(()=>V(Ge,p(I).secondaryText)),X(Ie,Be)};te(we,Ie=>{p(I).secondaryText&&Ie(Wt)})}R(j),R(A),ie(()=>V(Pe,p(I).name)),X(w,A)}),R(P),X(m,P)};te(E,m=>{p(_)&&m(pe)})}R(K),ie(()=>{Oe(ee,"placeholder",b()),Jt(ee,1,`spot-search ${k()?"error":""}`,"svelte-94s185")}),wt("focus",ee,()=>L(_,!0)),wt("blur",ee,z),Sn(ee,()=>p(s),m=>L(s,m)),X(e,K),Le(),c()}qe(["click","mousedown"]);function yr(e,a){var t,c;ue.set(!0),se.set({key:"loading",params:{}}),(t=a())==null||t.publishClearChosenSpots(),(c=a())==null||c.publishState("map-idle")}var br=J('<div class="no-stops-message"> </div>'),Pr=J('<div class="no-stops-message"> </div>'),Mr=(e,a)=>{L(a,!1)},kr=J("<button> </button>"),Lr=J('<button class="cancel-button"> </button> <div class="spot-picking-container"><!> <!> <!> <!> <!></div>',1);function Sr(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(Te,"$mqttClient",t),u=()=>O(Me,"$carStatus",t),i=()=>O(M,"$cancelButtonText",t),o=()=>O(D,"$spotPickingPickupLabel",t),r=()=>O($,"$spotPickingPickupPlaceholder",t),s=()=>O(Q,"$noStopsNearPickup",t),d=()=>O(B,"$spotPickingDestinationLabel",t),l=()=>O(z,"$spotPickingDestinationPlaceholder",t),v=()=>O(K,"$noStopsNearDestination",t),_=()=>O(G,"$confirmButtonText",t);let g=new ur,y=Y(null),b=Y(null),k=Y(!1),S=Y(!1),x=Y(!1),C=Y(!1);Ce(()=>{ue.set(!0),se.set({key:"loading",params:{}}),u()&&u().chosen_spots&&u().chosen_spots.pickup&&u().chosen_spots.destination&&(L(x,!0),L(y,u().chosen_spots.pickup,!0),L(b,u().chosen_spots.destination,!0)),ue.set(!1),se.set({key:"loading",params:{}})}),ve(()=>{var f,w,I;if(p(y)&&p(b)){let A=g.findClosestStops([p(y).position.lat,p(y).position.lng]),j=g.findClosestStops([p(b).position.lat,p(b).position.lng]);A.length===0&&L(k,!0),j.length===0&&L(S,!0),A.length>0&&j.length>0&&(L(C,!0),p(x)||(ue.set(!0),se.set({key:"loading",params:{}}),(f=n())==null||f.publishChosenSpots(p(y),p(b)),(w=n())==null||w.publishFoundBusStops(A,j),(I=n())==null||I.publishState("bus-stop-picking")))}});const M=Z("spot_picking_cancel_button"),D=Z("spot_picking_pickup_label"),$=Z("spot_picking_search_placeholder"),B=Z("spot_picking_destination_label"),z=Z("spot_picking_search_placeholder"),Q=Z("spot_pickup_no_bus_stop_found"),K=Z("spot_destination_no_bus_stop_found"),G=Z("spot_picking_confirm");var F=Lr(),H=Nt(F);H.__click=[yr,n];var ee=q(H,!0);R(H);var ne=W(H,2),oe=q(ne);const de=Yt(()=>{var f;return((f=p(y))==null?void 0:f.name)??""});Fa(oe,{get label(){return o()},get placeholder(){return r()},get error(){return p(k)},get value(){return p(de)},onSelect:f=>{L(y,f,!0),L(k,!1)}});var re=W(oe,2);{var E=f=>{var w=br(),I=q(w,!0);R(w),ie(()=>V(I,s())),X(f,w)};te(re,f=>{p(k)&&f(E)})}var pe=W(re,2);const m=Yt(()=>{var f;return((f=p(b))==null?void 0:f.name)??""});Fa(pe,{get label(){return d()},get placeholder(){return l()},get error(){return p(S)},get value(){return p(m)},onSelect:f=>{L(b,f,!0),L(S,!1)}});var P=W(pe,2);{var T=f=>{var w=Pr(),I=q(w,!0);R(w),ie(()=>V(I,v())),X(f,w)};te(P,f=>{p(S)&&f(T)})}var N=W(P,2);{var h=f=>{var w=kr();w.__click=[Mr,x];var I=q(w,!0);R(w),ie(()=>V(I,_())),X(f,w)};te(N,f=>{p(C)&&p(x)&&p(y)&&p(b)&&!p(k)&&!p(S)&&f(h)})}R(ne),ie(()=>V(ee,i())),X(e,F),Le(),c()}qe(["click"]);class me{static async initialize(){if(!this.travelModeConstants||!this.directionsStatusConstants){const{TravelMode:a,DirectionsStatus:t}=await ta();this.travelModeConstants=a,this.directionsStatusConstants=t}}static async getRoute(a){await this.initialize();const{DirectionsService:t}=await ta(),n=await new t().route(a);return n.status===this.directionsStatusConstants.OK?{pathArray:n.routes[0].overview_path.map(i=>({lat:i.lat(),lng:i.lng()})),bounds:n.routes[0].bounds}:null}static async calculatePreliminaryRoutes(a,t,c,n="en",u=!0){if(await this.initialize(),!a||!t||!c){console.warn("RouteService: Missing required data for route calculation");return}const i=a;if(!i.pickup||!i.destination){console.warn("RouteService: Invalid chosen spots data");return}const o={origin:{lat:i.pickup.position.lat,lng:i.pickup.position.lng},destination:{lat:t.position.lat,lng:t.position.lng},travelMode:this.travelModeConstants.WALKING,language:n,region:"ee"},r={origin:{lat:t.position.lat,lng:t.position.lng},destination:{lat:c.position.lat,lng:c.position.lng},travelMode:this.travelModeConstants.DRIVING,language:n,region:"ee"},s={origin:{lat:c.position.lat,lng:c.position.lng},destination:{lat:i.destination.position.lat,lng:i.destination.position.lng},travelMode:this.travelModeConstants.WALKING,language:n,region:"ee"};if(u){const[d,l,v]=await Promise.all([this.getRoute(o),this.getRoute(r),this.getRoute(s)]);qt.set(d),Ct.set(l),Tt.set(v)}else{const[d,l]=await Promise.all([this.getRoute(o),this.getRoute(s)]);qt.set(d),Tt.set(l)}}static nullDrivingRoutes(){Ct.set(null),Zt.set(null)}static async calculateCarRouteHelper(a,t){const{LatLngBounds:c}=await Ha(),n=new c;let u=[];if(a)for(const i of a)n.extend({lat:i[0],lng:i[1]}),u.push({lat:i[0],lng:i[1]});else t&&n.extend({lat:t.position.lat,lng:t.position.lng});return{mappedWaypoints:u,latLngBounds:n}}static async calculateCarToPickupRoute(a,t){const{mappedWaypoints:c,latLngBounds:n}=await this.calculateCarRouteHelper(a,t);Zt.set({pathArray:c,bounds:n})}static async calculatePickupBusStopToDestinationRoute(a,t){const{mappedWaypoints:c,latLngBounds:n}=await this.calculateCarRouteHelper(a,t);Ct.set({pathArray:c,bounds:n})}}Dt(me,"travelModeConstants",null),Dt(me,"directionsStatusConstants",null);function Dr(e,a){var t,c;ue.set(!0),se.set({key:"loading",params:{}}),(t=a())==null||t.publishClearFoundBusStops(),(c=a())==null||c.publishState("spot-picking")}var Or=(e,a)=>L(a,!p(a)),Rr=(e,a,t)=>a(p(t)),Cr=J('<button type="button" role="option"> </button>'),wr=J('<div class="dropdown-list" role="listbox" aria-labelledby="pickup-dropdown"></div>'),$r=(e,a)=>L(a,!p(a)),qr=(e,a,t)=>a(p(t)),Tr=J('<button type="button" role="option"> </button>'),xr=J('<div class="dropdown-list" role="listbox" aria-labelledby="destination-dropdown"></div>'),Ir=J('<button class="svelte-6vl3uk"> </button>'),Ar=J('<div class="bus-stop-picking svelte-6vl3uk"><div class="dropdown-group"><h2> </h2> <label for="pickup-dropdown"> </label> <div class="custom-dropdown"><button id="pickup-dropdown" type="button" class="dropdown-selected svelte-6vl3uk" aria-haspopup="listbox"> <span class="dropdown-arrow"> </span></button> <!></div></div> <div class="dropdown-group"><label for="destination-dropdown"> </label> <div class="custom-dropdown"><button id="destination-dropdown" type="button" class="dropdown-selected svelte-6vl3uk" aria-haspopup="listbox"> <span class="dropdown-arrow"> </span></button> <!></div></div> <!> <button class="svelte-6vl3uk"> </button></div>');function Nr(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(Me,"$carStatus",t),u=()=>O(Bt,"$locale",t),i=()=>O(Te,"$mqttClient",t),o=()=>O(Q,"$busStopPickHeadingText",t),r=()=>O(K,"$busStopPickupText",t),s=()=>O(G,"$busStopDestinationText",t),d=()=>O(B,"$orderCarText",t),l=()=>O(z,"$backButtonText",t);let v=Y(!1),_=Y(!1),g=Y(null),y=Y(Ht([])),b=Y(Ht([])),k=Y(null),S=Y(null);Ce(async()=>{await me.initialize()}),ve(()=>{n()&&n().found_bus_stops&&n().chosen_spots&&!p(v)&&(L(y,n().found_bus_stops.pickup,!0),L(b,n().found_bus_stops.destination,!0),L(k,p(y)[0],!0),L(S,p(b)[0],!0),L(g,n().chosen_spots,!0),ue.set(!1),se.set({key:"loading",params:{}}),L(v,!0))}),ve(()=>{p(k)&&p(S)&&p(g)&&(me.calculatePreliminaryRoutes(p(g),p(k),p(S),u()),p(_)||(Re.set("all"),L(_,!0)))});function x(){var ae,le;if(p(k)&&p(S)){ue.set(!0),se.set({key:"loading",params:{}}),(ae=i())==null||ae.publishChosenRouteStops(p(k),p(S)),(le=i())==null||le.publishGoal(p(k).position);const $e=Me.subscribe(_e=>{var fe;_e&&_e.are_waypoints_sent&&(me.nullDrivingRoutes(),(fe=i())==null||fe.publishState("driving-to-pickup"),$e())})}}let C=Y(!1),M=Y(!1);function D(ae){L(k,ae,!0),L(C,!1),Re.set("pickup")}function $(ae){L(S,ae,!0),L(M,!1),Re.set("destination")}const B=Z("order_car_button"),z=Z("bus_stop_back_button"),Q=Z("bus_stop_pick_heading"),K=Z("bus_stop_pickup"),G=Z("bus_stop_destination");var F=Ar(),H=q(F),ee=q(H),ne=q(ee,!0);R(ee);var oe=W(ee,2),de=q(oe,!0);R(oe);var re=W(oe,2),E=q(re);E.__click=[Or,C];var pe=q(E),m=W(pe),P=q(m,!0);R(m),R(E);var T=W(E,2);{var N=ae=>{var le=wr();xt(le,21,()=>p(y),It,($e,_e)=>{var fe=Cr();fe.__click=[Rr,D,_e];var Ft=q(fe,!0);R(fe),ie(()=>{Jt(fe,1,`dropdown-item ${p(k)&&p(_e).name===p(k).name?"selected":""}`,"svelte-6vl3uk"),Oe(fe,"aria-selected",p(k)&&p(_e).name===p(k).name),V(Ft,p(_e).name)}),X($e,fe)}),R(le),X(ae,le)};te(T,ae=>{p(C)&&ae(N)})}R(re),R(H);var h=W(H,2),f=q(h),w=q(f,!0);R(f);var I=W(f,2),A=q(I);A.__click=[$r,M];var j=q(A),ce=W(j),Pe=q(ce,!0);R(ce),R(A);var we=W(A,2);{var Wt=ae=>{var le=xr();xt(le,21,()=>p(b),It,($e,_e)=>{var fe=Tr();fe.__click=[qr,$,_e];var Ft=q(fe,!0);R(fe),ie(()=>{Jt(fe,1,`dropdown-item ${p(S)&&p(_e).name===p(S).name?"selected":""}`,"svelte-6vl3uk"),Oe(fe,"aria-selected",p(S)&&p(_e).name===p(S).name),V(Ft,p(_e).name)}),X($e,fe)}),R(le),X(ae,le)};te(we,ae=>{p(M)&&ae(Wt)})}R(I),R(h);var Ie=W(h,2);{var Be=ae=>{var le=Ir();le.__click=x;var $e=q(le,!0);R(le),ie(()=>V($e,d())),X(ae,le)};te(Ie,ae=>{p(k)&&p(S)&&ae(Be)})}var Ge=W(Ie,2);Ge.__click=[Dr,i];var on=q(Ge,!0);R(Ge),R(F),ie(()=>{var ae,le;V(ne,o()),V(de,r()),Oe(E,"aria-expanded",p(C)),V(pe,`${((ae=p(k))==null?void 0:ae.name)??""} `),V(P,p(C)?"▲":"▼"),V(w,s()),Oe(A,"aria-expanded",p(M)),V(j,`${((le=p(S))==null?void 0:le.name)??""} `),V(Pe,p(M)?"▲":"▼"),V(on,l())}),X(e,F),Le(),c()}qe(["click"]);function ja(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(Me,"$carStatus",t),u=()=>O(Bt,"$locale",t),i=()=>O(Te,"$mqttClient",t);Ce(async()=>{var o,r,s,d,l,v,_;ue.set(!0),se.set({key:"loading",params:{}}),await me.initialize(),await me.calculatePreliminaryRoutes(((o=n())==null?void 0:o.chosen_spots)??null,((r=n())==null?void 0:r.chosen_route_stops.pickup)??null,((s=n())==null?void 0:s.chosen_route_stops.destination)??null,u(),!1),za.set(!0),a.type=="pickup"?(await me.calculateCarToPickupRoute(((d=n())==null?void 0:d.route)??null,((l=n())==null?void 0:l.chosen_route_stops.pickup)??null),Re.set("carToPickup")):a.type=="destination"&&(await me.calculatePickupBusStopToDestinationRoute(((v=n())==null?void 0:v.route)??null,((_=n())==null?void 0:_.chosen_route_stops.destination)??null),Re.set("all")),ue.set(!1),se.set({key:"loading",params:{}})}),ve(()=>{var o,r;n()&&n().are_waypoints_sent&&n().route.length===0&&(a.type==="pickup"?(o=i())==null||o.publishState("arrived-to-pickup"):a.type==="destination"&&((r=i())==null||r.publishState("arrived-to-destination")))}),Le(),c()}var Br=J('<h2 class="svelte-1a58aos"> </h2> <button class="svelte-1a58aos"> </button>',1);function Ua(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(qt,"$pathChosenPickupToBusStopPickup",t),u=()=>O(Tt,"$pathBusStopDestinationToChosenDestination",t),i=()=>O(Me,"$carStatus",t),o=()=>O(Bt,"$locale",t),r=()=>O(Te,"$mqttClient",t),s=()=>O(v,"$confirmHeadingMessage",t),d=()=>O(_,"$confirmButtonMessage",t);Ce(async()=>{var x,C,M;await me.initialize(),(!n()||!u())&&await me.calculatePreliminaryRoutes(((x=i())==null?void 0:x.chosen_spots)??null,((C=i())==null?void 0:C.chosen_route_stops.pickup)??null,((M=i())==null?void 0:M.chosen_route_stops.destination)??null,o(),!1),a.type=="pickup"?Re.set("pickup"):a.type=="destination"&&Re.set("destination")});async function l(){var x,C,M,D,$,B,z;if(ue.set(!0),se.set({key:"loading",params:{}}),(x=r())==null||x.publishClearAreWaypointsSent(),await new Promise(Q=>{var G;if(!((G=i())!=null&&G.are_waypoints_sent)){Q();return}const K=Me.subscribe(F=>{F&&!F.are_waypoints_sent&&(K(),Q())})}),a.type==="pickup"){const Q=(C=i())==null?void 0:C.chosen_route_stops.destination.position;(M=r())==null||M.publishGoal(Q);let K;K=Me.subscribe(G=>{var F;G&&G.are_waypoints_sent&&(me.nullDrivingRoutes(),(F=r())==null||F.publishState("driving-to-destination"),K==null||K())})}else a.type==="destination"&&((D=r())==null||D.publishClearChosenSpots(),($=r())==null||$.publishClearFoundBusStops(),(B=r())==null||B.publishClearChosenRouteStops(),mn(),(z=r())==null||z.publishState("rating"))}const v=a.type==="pickup"?Z("confirm_in_car_info"):Z("confirm_destination_info"),_=a.type==="pickup"?Z("confirm_in_car_button"):Z("confirm_destination_button");var g=Br(),y=Nt(g),b=q(y,!0);R(y);var k=W(y,2);k.__click=l;var S=q(k,!0);R(k),ie(()=>{V(b,s()),V(S,d())}),X(e,g),Le(),c()}qe(["click"]);var Gr=J('<button type="button" class="star-btn svelte-139mv0"><img class="star svelte-139mv0"/></button>'),Kr=(e,a)=>{var t;ue.set(!0),se.set({key:"loading",params:{}}),(t=a())==null||t.publishState("map-idle")},Er=J('<div class="rating-container svelte-139mv0"><div class="stars svelte-139mv0"></div> <div class="rating-label svelte-139mv0"> </div> <button class="skip-btn svelte-139mv0"> </button></div>');function Vr(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(Te,"$mqttClient",t),u=()=>O(_,"$ratingRefuseText",t);let i=Y(0),o=Y(0),r=Y(""),s=Y("");Ce(async()=>{L(r,await At("/star_filled.svg"),!0),L(s,await At("/star_empty.svg"),!0),ue.set(!1),se.set({key:"loading",params:{}})});function d(C){var M,D;L(i,C,!0),ue.set(!0),se.set({key:"loading",params:{}}),(M=n())==null||M.publishRating(p(i),new Date().toISOString()),(D=n())==null||D.publishState("map-idle")}function l(C){L(o,C,!0)}function v(){L(o,0)}Z("rating_heading");const _=Z("rating_refuse");var g=Er(),y=q(g);xt(y,20,()=>Array.from({length:5}),It,(C,M,D)=>{var $=Gr();$.__click=()=>d(D+1),Oe($,"aria-label",`Rate ${D+1} star${D===0?"":"s"}`);var B=q($);Oe(B,"alt",D+1+" star"),R($),ie(()=>Oe(B,"src",(p(o)?D<p(o):D<p(i))?p(r):p(s))),wt("mouseenter",$,()=>l(D+1)),wt("mouseleave",$,v),X(C,$)}),R(y);var b=W(y,2),k=q(b,!0);R(b);var S=W(b,2);S.__click=[Kr,n];var x=q(S,!0);R(S),R(g),ie(()=>{V(k,p(i)>0?`${p(i)} / 5`:"PROMPT"),V(x,u())}),X(e,g),Le(),c()}qe(["click"]);var Wr=J('<div class="app-root"><!> <!></div>');function ri(e,a){ke(a,!0);const[t,c]=Se(),n=()=>O(Te,"$mqttClient",t),u=()=>O(Me,"$carStatus",t),i=()=>O(be,"$appState",t),o=()=>O(yn,"$sessionId",t),r=()=>O(se,"$appGlobalLoadingMessageKey",t),s=()=>O(ue,"$appGlobalLoading",t),d=()=>O(p(g),"$appGlobalLoadingMessage",t);let l=Y(!1),v=Y(!1);Ce(()=>{let M=null,D=0;return navigator.geolocation?M=navigator.geolocation.watchPosition($=>{const B=Date.now();B-D>=500&&($t.set({lat:$.coords.latitude,lng:$.coords.longitude}),D=B)},$=>{console.warn("Geolocation denied or unavailable:",$)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:1e3}):($t.set(null),console.warn("Geolocation not supported")),()=>{M!==null&&navigator.geolocation.clearWatch(M)}}),ve(()=>{n()||_n("/login")});let _=null;ve(()=>{if(n()&&u()){if(u().state===_)return;switch(console.log("App state changed from",i(),"to",u().state),_=u().state,u().state){case"None":n().publishState("map-idle"),L(l,!0),be.set("map-idle");break;case"map-idle":L(l,!0),be.set("map-idle");break;case"spot-picking":L(l,!1),be.set("spot-picking");break;case"bus-stop-picking":L(l,!0),be.set("bus-stop-picking");break;case"driving-to-pickup":L(l,!0),be.set("driving-to-pickup");break;case"arrived-to-pickup":L(l,!0),be.set("arrived-to-pickup");break;case"driving-to-destination":L(l,!0),be.set("driving-to-destination");break;case"arrived-to-destination":L(l,!0),be.set("arrived-to-destination");break;case"rating":L(l,!1),be.set("rating");break;case"shutting-down":ue.set(!0),se.set({key:"car_shutting_down"}),L(v,!0),L(l,!1);const M=o()??"";hn.set({key:"session_closed",params:{id:M}}),Xa();break;default:L(l,!1),console.error("Unknown car status state:",JSON.stringify(u().state));break}}});const g=Yt(()=>r()?Z(r().key,r().params):null);var y=Wr(),b=q(y);{var k=M=>{qn(M,{children:(D,$)=>{var B=pn(),z=Nt(B);{var Q=G=>{In(G,{})},K=(G,F)=>{{var H=ne=>{Nr(ne,{})},ee=(ne,oe)=>{{var de=E=>{ja(E,{type:"pickup"})},re=(E,pe)=>{{var m=T=>{Ua(T,{type:"pickup"})},P=(T,N)=>{{var h=w=>{ja(w,{type:"destination"})},f=(w,I)=>{{var A=j=>{Ua(j,{type:"destination"})};te(w,j=>{i()==="arrived-to-destination"&&j(A)},I)}};te(T,w=>{i()==="driving-to-destination"?w(h):w(f,!1)},N)}};te(E,T=>{i()==="arrived-to-pickup"?T(m):T(P,!1)},pe)}};te(ne,E=>{i()==="driving-to-pickup"?E(de):E(re,!1)},oe)}};te(G,ne=>{i()==="bus-stop-picking"?ne(H):ne(ee,!1)},F)}};te(z,G=>{i()==="map-idle"?G(Q):G(K,!1)})}X(D,B)},$$slots:{default:!0}})},S=(M,D)=>{{var $=z=>{Sr(z,{})},B=(z,Q)=>{{var K=G=>{Vr(G,{})};te(z,G=>{i()==="rating"&&G(K)},Q)}};te(M,z=>{i()==="spot-picking"?z($):z(B,!1)},D)}};te(b,M=>{p(l)?M(k):M(S,!1)})}var x=W(b,2);{var C=M=>{Ln(M,{get loadingMsg(){return d()}})};te(x,M=>{s()&&M(C)})}R(y),X(e,y),Le(),c()}export{ri as component};
