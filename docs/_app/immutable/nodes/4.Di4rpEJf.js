var vr=Object.defineProperty;var gr=(t,a,e)=>a in t?vr(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var wt=(t,a,e)=>gr(t,typeof a!="symbol"?a+"":a,e);import"../chunks/CWj6FrbW.js";import{aJ as pr,aK as _r,O as mr,d as hr,a3 as br,z as $e,p as Se,o as qe,s as q,C as ne,b as ge,f,A as oe,G as xt,F as G,D as P,E as y,H as yr,I as ce,J as E,B as re,a as Oe,n as Pr,aI as $t,K as Me,aG as kr}from"../chunks/CM7s3TdM.js";import{a as S,b as Jt,s as we,i as le}from"../chunks/CZY1Q9bT.js";import{g as Mr}from"../chunks/Cc_3-6qk.js";import{e as fe,f as ve,c as St,u as Tt,p as Qt,g as Ct,h as Bt,i as At,j as De,k as Ot,r as Ya,n as Ja,o as be,l as Et,q as qt,t as ea,b as zt,v as Lr,d as Dr,s as Sr}from"../chunks/D_mHE8iR.js";import{_ as Or,p as Ge}from"../chunks/CvhVpWJc.js";import{f as Nt,L as wr}from"../chunks/DKuJeQhF.js";import{t as z,r as Rr,s as Ce,a as xe,e as It,i as Gt}from"../chunks/V3qXSBpL.js";import"../chunks/PCJ5bLI3.js";import{i as Cr}from"../chunks/DJhY8YgZ.js";function qr(t,a,e=a){var c=pr();_r(t,"input",r=>{var i=r?t.defaultValue:t.value;if(i=Xt(t)?Ut(i):i,e(i),c&&i!==(i=a())){var s=t.selectionStart,o=t.selectionEnd;t.value=i??"",o!==null&&(t.selectionStart=s,t.selectionEnd=Math.min(o,t.value.length))}}),(mr&&t.defaultValue!==t.value||hr(a)==null&&t.value)&&e(Xt(t)?Ut(t.value):t.value),br(()=>{var r=a();Xt(t)&&r===Ut(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function Xt(t){var a=t.type;return a==="number"||a==="range"}function Ut(t){return t===""?null:+t}let Zt=null,Rt=null;async function Be(){return Rt||(Zt||(Zt=(async()=>{const t=await Or(()=>import("../chunks/D-8nYH0_.js"),[],import.meta.url),a=t.Loader||t.default&&t.default.Loader;if(!a)throw new Error("Could not load Google Maps Loader");return Rt=new a({apiKey:"AIzaSyAixRzVqb7kii3XrzzL3OxsN7k_2CoMeaM",version:"weekly"}),Rt})()),Zt)}async function Qa(){return await(await Be()).importLibrary("core")}async function er(){return await(await Be()).importLibrary("maps")}async function xr(){return await(await Be()).importLibrary("marker")}async function $r(){return await(await Be()).importLibrary("places")}async function ia(){return await(await Be()).importLibrary("routes")}async function Tr(){return await(await Be()).importLibrary("geometry")}async function Br(t,a={}){const{Map:e}=await er();return new e(t,a)}function Ar(){fe.set(!0),ve.set({key:"ending_session",params:{}}),Ya()}var Nr=oe('<div class="map-container svelte-1bz92gb"></div> <button class="end-session-button svelte-1bz92gb"> </button> <!>',1);function Ir(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(Ja,"$isDriving",e),i=()=>S(St,"$carStatus",e),s=()=>S(Tt,"$userLocation",e),o=()=>S(Qt,"$pathCarToBusStopPickup",e),n=()=>S(Ct,"$pathBusStopPickupToBusStopDestination",e),l=()=>S(Bt,"$pathChosenPickupToBusStopPickup",e),u=()=>S(At,"$pathBusStopDestinationToChosenDestination",e),d=()=>S(De,"$fitBoundsTarget",e),v=()=>S(Ot,"$fitBoundsVerticalPadding",e),_=()=>S(j,"$endSessionText",e);let h,p=null,D=ne(null),k=ne(null),w=ne(null),A=ne(null),M=null,R=null,x=null,$=null,N=null,K=null,V=null,W=null;async function U(b,L){for(;!p;)await new Promise(T=>setTimeout(T,10));if(b){const T={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},m={path:V,strokeOpacity:1,scale:4},g={path:W,strokeOpacity:1,scale:4};return L?b.setOptions({strokeOpacity:0,icons:[{icon:T,offset:"0",repeat:"20px"},{icon:m,offset:"0",repeat:"0"},{icon:g,offset:"100%",repeat:"0"}],visible:!1,map:p,zIndex:1}):b.setOptions({strokeColor:"#FF0000",strokeWeight:4,icons:[{icon:m,offset:"0",repeat:"0"},{icon:g,offset:"100%",repeat:"0"}],visible:!1,map:p}),b.setMap(p),b}return null}function Q(b,L){if(!L||L.length<2)return{index:0,progress:0};let T=1/0,m=0,g=0;for(let I=0;I<L.length-1;I++){const te=L[I],Y=L[I+1],J=se(b,te,Y),ue=ee(te,Y,J),de=google.maps.geometry.spherical.computeDistanceBetween(b,ue);de<T&&(T=de,m=I,g=J)}return{index:m,progress:g}}function se(b,L,T){const m=L.lat(),g=L.lng(),I=T.lat(),te=T.lng(),Y=b.lat(),J=b.lng(),ue=te-g,de=I-m,X=ue*ue+de*de;if(X===0)return 0;const pe=((J-g)*ue+(Y-m)*de)/X;return Math.max(0,Math.min(1,pe))}function ee(b,L,T){const m=b.lat()+(L.lat()-b.lat())*T,g=b.lng()+(L.lng()-b.lng())*T;return new google.maps.LatLng(m,g)}function Z(b,L,T,m){if(!b||!p)return L;const g=b.getPath().getArray();if(g.length<2)return L;const{index:I,progress:te}=Q(T,g),Y=[];for(let J=0;J<=I;J++)Y.push(g[J]);if(te>0&&I<g.length-1){const J=ee(g[I],g[I+1],te);Y.push(J)}if(!L){let J="#FF0000";r()&&(J="#00AA00"),L=new google.maps.Polyline({map:p,strokeColor:J,strokeWeight:4,strokeOpacity:1,zIndex:1})}return L.setPath(Y),L}qe(async()=>{var I;fe.set(!0),ve.set({key:"loading_map",params:{}}),p=await Br(h,{center:{lat:58.378,lng:26.729},zoom:13,disableDefaultUI:!0,mapId:"DEMO_MAP_ID"});const{AdvancedMarkerElement:b}=await xr(),{SymbolPath:L}=await Qa();await Tr(),V=L.CIRCLE,W=L.FORWARD_OPEN_ARROW,N=await Nt("/usermarker.svg"),K=await Nt("/carmarker.svg");const T=document.createElement("img");T.src=K,T.style.width="48px",T.style.height="48px",$=new b({position:(I=i())==null?void 0:I.pose,map:p,content:T});const m=document.createElement("img");m.src=N,m.style.width="32px",m.style.height="32px",x=new b({map:p,content:m});const{Polyline:g}=await er();q(D,await U(new g,!0),!0),q(k,await U(new g,!1),!0),q(w,await U(new g,!0),!0),q(A,await U(new g,!1),!0),M=null,R=null,fe.set(!1),ve.set({key:"loading",params:{}})}),ge(()=>{s()&&x&&(x.position=s())}),ge(()=>{var b;if((b=i())!=null&&b.pose&&$){$.position=i().pose;const L=new google.maps.LatLng(i().pose.lat,i().pose.lng);f(A)&&o()&&(R=Z(f(A),R,L)),f(k)&&n()&&(M=Z(f(k),M,L))}}),ge(()=>{s()&&x&&(x.position=s())}),ge(()=>{var b;l()&&f(D)?(f(D).setPath(l().pathArray),f(D).setVisible(!0)):(b=f(D))!=null&&b.getVisible()&&f(D).setVisible(!1)}),ge(()=>{var b;n()&&f(k)?(f(k).setPath(n().pathArray),f(k).setVisible(!0)):(b=f(k))!=null&&b.getVisible()&&(f(k).setVisible(!1),M&&(M.setMap(null),M=null))}),ge(()=>{var b;u()&&f(w)?(f(w).setPath(u().pathArray),f(w).setVisible(!0)):(b=f(w))!=null&&b.getVisible()&&f(w).setVisible(!1)}),ge(()=>{var b;o()&&f(A)?(f(A).setPath(o().pathArray),f(A).setVisible(!0)):(b=f(A))!=null&&b.getVisible()&&(f(A).setVisible(!1),R&&(R.setMap(null),R=null))}),ge(()=>{var b,L,T,m,g,I,te;if(d()==="all"){if((b=l())!=null&&b.bounds&&((L=n())!=null&&L.bounds)&&((T=u())!=null&&T.bounds)){const Y=new google.maps.LatLngBounds(l().bounds.getSouthWest(),l().bounds.getNorthEast()),J=new google.maps.LatLngBounds(n().bounds.getSouthWest(),n().bounds.getNorthEast()),ue=new google.maps.LatLngBounds(u().bounds.getSouthWest(),u().bounds.getNorthEast());Y.union(J),Y.union(ue),p==null||p.fitBounds(Y,{top:v().top,bottom:v().bottom})}}else d()==="pickup"?(m=l())!=null&&m.bounds&&(p==null||p.fitBounds(l().bounds,{top:v().top,bottom:v().bottom})):d()==="destination"?(g=u())!=null&&g.bounds&&(p==null||p.fitBounds(u().bounds,{top:v().top,bottom:v().bottom})):d()==="carToPickup"?(I=o())!=null&&I.bounds&&((te=l())!=null&&te.bounds)&&(p==null||p.fitBounds(o().bounds.union(l().bounds),{top:v().top,bottom:v().bottom})):d()==="default"&&(p==null||p.setCenter({lat:58.378,lng:26.729}),p==null||p.setZoom(13))});const j=z("end_session_button");var O=Nr(),C=xt(O);Jt(C,b=>h=b,()=>h);var B=G(C,2);B.__click=[Ar];var F=P(B,!0);y(B);var H=G(B,2);yr(H,()=>a.children),ce(()=>E(F,_())),re(t,O),Oe(),c()}$e(["click"]);function Gr(){fe.set(!0),ve.set({key:"loading",params:{}}),be.set("spot-picking")}var Er=oe('<div class="footer-background svelte-1iqii79"><button class="order-car-button svelte-1iqii79"> </button></div>');function zr(t,a){Se(a,!1);const[e,c]=we(),r=()=>S(i,"$orderCarText",e),i=z("order_car_button");Cr();var s=Er(),o=P(s);o.__click=[Gr];var n=P(o,!0);y(o),y(s),ce(()=>E(n,r())),re(t,s),Oe(),c()}$e(["click"]);var Yt={},Ee={},ze={},ae={},oa;function _e(){if(oa)return ae;oa=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.areaConversion=ae.timeConversion=ae.distanceConversion=ae.altitudeKeys=ae.latitudeKeys=ae.longitudeKeys=ae.MAXLON=ae.MINLON=ae.MAXLAT=ae.MINLAT=ae.earthRadius=ae.sexagesimalPattern=void 0;var t=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;ae.sexagesimalPattern=t;var a=6378137;ae.earthRadius=a;var e=-90;ae.MINLAT=e;var c=90;ae.MAXLAT=c;var r=-180;ae.MINLON=r;var i=180;ae.MAXLON=i;var s=["lng","lon","longitude",0];ae.longitudeKeys=s;var o=["lat","latitude",1];ae.latitudeKeys=o;var n=["alt","altitude","elevation","elev",2];ae.altitudeKeys=n;var l={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};ae.distanceConversion=l;var u={m:60,h:3600,d:86400};ae.timeConversion=u;var d={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};return ae.areaConversion=d,d.sqm=d.m2,d.sqkm=d.km2,d.sqft=d.ft2,d.sqyd=d.yd2,d.sqin=d.in2,ae}var Ve={},sa;function Vt(){if(sa)return Ve;sa=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.default=void 0;var t=function(c,r){return r.reduce(function(i,s){if(typeof c>"u"||c===null)throw new Error("'".concat(c,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(c,s)&&typeof s<"u"&&typeof i>"u"?(i=s,s):i},void 0)},a=t;return Ve.default=a,Ve}var We={},Ke={},ua;function Wt(){if(ua)return Ke;ua=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var t=function(c){var r=c.toString().trim();return isNaN(parseFloat(r))?!1:parseFloat(r)===Number(r)},a=t;return Ke.default=a,Ke}var Fe={},la;function Kt(){if(la)return Fe;la=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var t=_e(),a=function(r){return t.sexagesimalPattern.test(r.toString().trim())},e=a;return Fe.default=e,Fe}var je={},da;function Ft(){if(da)return je;da=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var t=_e(),a=function(r){var i=new RegExp(t.sexagesimalPattern).exec(r.toString().trim());if(typeof i>"u"||i===null)throw new Error("Given value is not in sexagesimal format");var s=Number(i[2])/60||0,o=Number(i[4])/3600||0,n=parseFloat(i[1])+s+o;return["S","W"].includes(i[7])?-n:n},e=a;return je.default=e,je}var He={},Xe={},ca;function ta(){if(ca)return Xe;ca=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var t=_e(),a=e(Vt());function e(n){return n&&n.__esModule?n:{default:n}}function c(n,l){var u=Object.keys(n);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);l&&(d=d.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),u.push.apply(u,d)}return u}function r(n){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?arguments[l]:{};l%2?c(Object(u),!0).forEach(function(d){i(n,d,u[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(u)):c(Object(u)).forEach(function(d){Object.defineProperty(n,d,Object.getOwnPropertyDescriptor(u,d))})}return n}function i(n,l,u){return l in n?Object.defineProperty(n,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[l]=u,n}var s=function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:t.longitudeKeys,latitude:t.latitudeKeys,altitude:t.altitudeKeys},d=(0,a.default)(l,u.longitude),v=(0,a.default)(l,u.latitude),_=(0,a.default)(l,u.altitude);return r({latitude:v,longitude:d},_?{altitude:_}:{})},o=s;return Xe.default=o,Xe}var Ue={},fa;function tr(){if(fa)return Ue;fa=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var t=r(Wt()),a=r(Kt()),e=r(Ft()),c=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function o(n){return(0,t.default)(n)?!(parseFloat(n)>c.MAXLAT||n<c.MINLAT):(0,a.default)(n)?o((0,e.default)(n)):!1},s=i;return Ue.default=s,Ue}var Ze={},va;function ar(){if(va)return Ze;va=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var t=r(Wt()),a=r(Kt()),e=r(Ft()),c=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function o(n){return(0,t.default)(n)?!(parseFloat(n)>c.MAXLON||n<c.MINLON):(0,a.default)(n)?o((0,e.default)(n)):!1},s=i;return Ze.default=s,Ze}var ga;function rr(){if(ga)return He;ga=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;var t=c(ta()),a=c(tr()),e=c(ar());function c(s){return s&&s.__esModule?s:{default:s}}var r=function(o){var n=(0,t.default)(o),l=n.latitude,u=n.longitude;if(Array.isArray(o)&&o.length>=2)return(0,e.default)(o[0])&&(0,a.default)(o[1]);if(typeof l>"u"||typeof u>"u")return!1;var d=o[u],v=o[l];return!(typeof v>"u"||typeof d>"u"||(0,a.default)(v)===!1||(0,e.default)(d)===!1)},i=r;return He.default=i,He}var pa;function aa(){if(pa)return We;pa=1,Object.defineProperty(We,"__esModule",{value:!0}),We.default=void 0;var t=i(Wt()),a=i(Kt()),e=i(Ft()),c=i(rr()),r=i(ta());function i(d){return d&&d.__esModule?d:{default:d}}function s(d,v){var _=Object.keys(d);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(d);v&&(h=h.filter(function(p){return Object.getOwnPropertyDescriptor(d,p).enumerable})),_.push.apply(_,h)}return _}function o(d){for(var v=1;v<arguments.length;v++){var _=arguments[v]!=null?arguments[v]:{};v%2?s(Object(_),!0).forEach(function(h){n(d,h,_[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(_)):s(Object(_)).forEach(function(h){Object.defineProperty(d,h,Object.getOwnPropertyDescriptor(_,h))})}return d}function n(d,v,_){return v in d?Object.defineProperty(d,v,{value:_,enumerable:!0,configurable:!0,writable:!0}):d[v]=_,d}var l=function d(v){if((0,t.default)(v))return Number(v);if((0,a.default)(v))return(0,e.default)(v);if((0,c.default)(v)){var _=(0,r.default)(v);return Array.isArray(v)?v.map(function(h,p){return[0,1].includes(p)?d(h):h}):o(o(o({},v),_.latitude&&n({},_.latitude,d(v[_.latitude]))),_.longitude&&n({},_.longitude,d(v[_.longitude])))}return Array.isArray(v)?v.map(function(h){return(0,c.default)(h)?d(h):h}):v},u=l;return We.default=u,We}var _a;function Pe(){if(_a)return ze;_a=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.default=void 0;var t=_e(),a=c(Vt()),e=c(aa());function c(s){return s&&s.__esModule?s:{default:s}}var r=function(o,n){var l=(0,a.default)(o,t.latitudeKeys);if(!(typeof l>"u"||l===null)){var u=o[l];return n===!0?u:(0,e.default)(u)}},i=r;return ze.default=i,ze}var Ye={},ma;function ke(){if(ma)return Ye;ma=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var t=_e(),a=c(Vt()),e=c(aa());function c(s){return s&&s.__esModule?s:{default:s}}var r=function(o,n){var l=(0,a.default)(o,t.longitudeKeys);if(!(typeof l>"u"||l===null)){var u=o[l];return n===!0?u:(0,e.default)(u)}},i=r;return Ye.default=i,Ye}var Je={},ha;function Re(){if(ha)return Je;ha=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var t=function(c){return c*Math.PI/180},a=t;return Je.default=a,Je}var Qe={},ba;function Ae(){if(ba)return Qe;ba=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var t=function(c){return c*180/Math.PI},a=t;return Qe.default=a,Qe}var ya;function Vr(){if(ya)return Ee;ya=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Re()),c=i(Ae()),r=_e();function i(n){return n&&n.__esModule?n:{default:n}}var s=function(l,u,d){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6371e3,_=(0,t.default)(l),h=(0,a.default)(l),p=u/v,D=(0,e.default)(d),k=(0,e.default)(_),w=(0,e.default)(h),A=Math.asin(Math.sin(k)*Math.cos(p)+Math.cos(k)*Math.sin(p)*Math.cos(D)),M=w+Math.atan2(Math.sin(D)*Math.sin(p)*Math.cos(k),Math.cos(p)-Math.sin(k)*Math.sin(A)),R=(0,c.default)(M);return(R<r.MINLON||R>r.MAXLON)&&(M=(M+3*Math.PI)%(2*Math.PI)-Math.PI,R=(0,c.default)(M)),{latitude:(0,c.default)(A),longitude:R}},o=s;return Ee.default=o,Ee}var et={},Pa;function Wr(){if(Pa)return et;Pa=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var t=_e(),a=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",s=t.areaConversion[i];if(s)return r*s;throw new Error("Invalid unit used for area conversion.")},e=a;return et.default=e,et}var tt={},ka;function Kr(){if(ka)return tt;ka=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var t=_e(),a=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",s=t.distanceConversion[i];if(s)return r*s;throw new Error("Invalid unit used for distance conversion.")},e=a;return tt.default=e,tt}var at={},Ma;function Fr(){if(Ma)return at;Ma=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=void 0;var t=_e(),a=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kmh";switch(i){case"kmh":return r*t.timeConversion.h*t.distanceConversion.km;case"mph":return r*t.timeConversion.h*t.distanceConversion.mi;default:return r}},e=a;return at.default=e,at}var rt={},La;function jr(){if(La)return rt;La=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;function t(l,u){return i(l)||r(l,u)||e(l,u)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(l,u){if(l){if(typeof l=="string")return c(l,u);var d=Object.prototype.toString.call(l).slice(8,-1);if(d==="Object"&&l.constructor&&(d=l.constructor.name),d==="Map"||d==="Set")return Array.from(l);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return c(l,u)}}function c(l,u){(u==null||u>l.length)&&(u=l.length);for(var d=0,v=new Array(u);d<u;d++)v[d]=l[d];return v}function r(l,u){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(l)))){var d=[],v=!0,_=!1,h=void 0;try{for(var p=l[Symbol.iterator](),D;!(v=(D=p.next()).done)&&(d.push(D.value),!(u&&d.length===u));v=!0);}catch(k){_=!0,h=k}finally{try{!v&&p.return!=null&&p.return()}finally{if(_)throw h}}return d}}function i(l){if(Array.isArray(l))return l}var s=function(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,v=Math.pow(10,d);return Math.round(u*v)/v},o=function(u){var d=u.toString().split("."),v=t(d,2),_=v[0],h=v[1],p=Math.abs(Number(_)),D=+("0."+(h||0))*60,k=D.toString().split("."),w=Math.floor(D),A=s(+("0."+(k[1]||0))*60).toString(),M=A.split("."),R=t(M,2),x=R[0],$=R[1],N=$===void 0?"0":$;return p+"° "+w.toString().padStart(2,"0")+"' "+x.padStart(2,"0")+"."+N.padEnd(1,"0")+'"'},n=o;return rt.default=n,rt}var nt={},it={},ot={},st={},Da;function nr(){if(Da)return st;Da=1,Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;var t=function(c){return c>1?1:c<-1?-1:c},a=t;return st.default=a,st}var Sa;function Te(){if(Sa)return ot;Sa=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Re()),c=i(nr()),r=_e();function i(n){return n&&n.__esModule?n:{default:n}}var s=function(l,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;d=typeof d<"u"&&!isNaN(d)?d:1;var v=(0,t.default)(l),_=(0,a.default)(l),h=(0,t.default)(u),p=(0,a.default)(u),D=Math.acos((0,c.default)(Math.sin((0,e.default)(h))*Math.sin((0,e.default)(v))+Math.cos((0,e.default)(h))*Math.cos((0,e.default)(v))*Math.cos((0,e.default)(_)-(0,e.default)(p))))*r.earthRadius;return Math.round(D/d)*d},o=s;return ot.default=o,ot}var Oa;function ir(){if(Oa)return it;Oa=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var t=a(Te());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default;return o=typeof o=="function"?o:t.default,s.slice().sort(function(n,l){return o(i,n)-o(i,l)})},c=e;return it.default=c,it}var wa;function Hr(){if(wa)return nt;wa=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var t=a(ir());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){return(0,t.default)(i,s)[0]},c=e;return nt.default=c,nt}var ut={},Ra;function Xr(){if(Ra)return ut;Ra=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var t=r(Re()),a=r(Pe()),e=r(ke()),c=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n){var l=0;if(n.length>2){for(var u,d,v,_=0;_<n.length;_++){_===n.length-2?(u=n.length-2,d=n.length-1,v=0):_===n.length-1?(u=n.length-1,d=0,v=1):(u=_,d=_+1,v=_+2);var h=(0,e.default)(n[u]),p=(0,a.default)(n[d]),D=(0,e.default)(n[v]);l+=((0,t.default)(D)-(0,t.default)(h))*Math.sin((0,t.default)(p))}l=l*c.earthRadius*c.earthRadius/2}return Math.abs(l)},s=i;return ut.default=s,ut}var lt={},Ca;function or(){if(Ca)return lt;Ca=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.default=void 0;var t=e(Pe()),a=e(ke());function e(i){return i&&i.__esModule?i:{default:i}}var c=function(s){if(Array.isArray(s)===!1||s.length===0)throw new Error("No points were given.");return s.reduce(function(o,n){var l=(0,t.default)(n),u=(0,a.default)(n);return{maxLat:Math.max(l,o.maxLat),minLat:Math.min(l,o.minLat),maxLng:Math.max(u,o.maxLng),minLng:Math.min(u,o.minLng)}},{maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0})},r=c;return lt.default=r,lt}var dt={},qa;function Ur(){if(qa)return dt;qa=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Re()),c=i(Ae()),r=_e();function i(n){return n&&n.__esModule?n:{default:n}}var s=function(l,u){var d=(0,t.default)(l),v=(0,a.default)(l),_=(0,e.default)(d),h=(0,e.default)(v),p=u/r.earthRadius,D=_-p,k=_+p,w=(0,e.default)(r.MAXLAT),A=(0,e.default)(r.MINLAT),M=(0,e.default)(r.MAXLON),R=(0,e.default)(r.MINLON),x,$;if(D>A&&k<w){var N=Math.asin(Math.sin(p)/Math.cos(_));x=h-N,x<R&&(x+=Math.PI*2),$=h+N,$>M&&($-=Math.PI*2)}else D=Math.max(D,A),k=Math.min(k,w),x=R,$=M;return[{latitude:(0,c.default)(D),longitude:(0,c.default)(x)},{latitude:(0,c.default)(k),longitude:(0,c.default)($)}]},o=s;return dt.default=o,dt}var ct={},xa;function Zr(){if(xa)return ct;xa=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),c=r(Ae());function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n){if(Array.isArray(n)===!1||n.length===0)return!1;var l=n.length,u=n.reduce(function(h,p){var D=(0,e.default)((0,t.default)(p)),k=(0,e.default)((0,a.default)(p));return{X:h.X+Math.cos(D)*Math.cos(k),Y:h.Y+Math.cos(D)*Math.sin(k),Z:h.Z+Math.sin(D)}},{X:0,Y:0,Z:0}),d=u.X/l,v=u.Y/l,_=u.Z/l;return{longitude:(0,c.default)(Math.atan2(v,d)),latitude:(0,c.default)(Math.atan2(_,Math.sqrt(d*d+v*v)))}},s=i;return ct.default=s,ct}var ft={},$a;function Yr(){if($a)return ft;$a=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.default=void 0;var t=a(or());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i){var s=(0,t.default)(i),o=s.minLat+(s.maxLat-s.minLat)/2,n=s.minLng+(s.maxLng-s.minLng)/2;return{latitude:parseFloat(o.toFixed(6)),longitude:parseFloat(n.toFixed(6))}},c=e;return ft.default=c,ft}var vt={},gt={},Ta;function sr(){if(Ta)return gt;Ta=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),c=r(Ae());function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n,l){var u=(0,e.default)((0,a.default)(l))-(0,e.default)((0,a.default)(n)),d=Math.log(Math.tan((0,e.default)((0,t.default)(l))/2+Math.PI/4)/Math.tan((0,e.default)((0,t.default)(n))/2+Math.PI/4));return Math.abs(u)>Math.PI&&(u>0?u=(Math.PI*2-u)*-1:u=Math.PI*2+u),((0,c.default)(Math.atan2(u,d))+360)%360},s=i;return gt.default=s,gt}var Ba;function Jr(){if(Ba)return vt;Ba=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.default=void 0;var t=a(sr());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,n=typeof o=="function"?o(i,s):(0,t.default)(i,s);if(isNaN(n))throw new Error("Could not calculate bearing for given points. Check your bearing function");switch(Math.round(n/22.5)){case 1:return"NNE";case 2:return"NE";case 3:return"ENE";case 4:return"E";case 5:return"ESE";case 6:return"SE";case 7:return"SSE";case 8:return"S";case 9:return"SSW";case 10:return"SW";case 11:return"WSW";case 12:return"W";case 13:return"WNW";case 14:return"NW";case 15:return"NNW";default:return"N"}},c=e;return vt.default=c,vt}var pt={},Aa;function ur(){if(Aa)return pt;Aa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var t=e(Te()),a=e(nr());function e(i){return i&&i.__esModule?i:{default:i}}var c=function(s,o,n){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,u=(0,t.default)(o,s,l),d=(0,t.default)(s,n,l),v=(0,t.default)(o,n,l),_=Math.acos((0,a.default)((u*u+v*v-d*d)/(2*u*v))),h=Math.acos((0,a.default)((d*d+v*v-u*u)/(2*d*v)));return _>Math.PI/2?u:h>Math.PI/2?d:Math.sin(_)*u},r=c;return pt.default=r,pt}var _t={},Na;function Qr(){if(Na)return _t;Na=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),c=r(Ae());function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n,l){var u=(0,t.default)(l),d=(0,a.default)(l),v=(0,t.default)(n),_=(0,a.default)(n),h=((0,c.default)(Math.atan2(Math.sin((0,e.default)(d)-(0,e.default)(_))*Math.cos((0,e.default)(u)),Math.cos((0,e.default)(v))*Math.sin((0,e.default)(u))-Math.sin((0,e.default)(v))*Math.cos((0,e.default)(u))*Math.cos((0,e.default)(d)-(0,e.default)(_))))+360)%360;return h},s=i;return _t.default=s,_t}var mt={},Ia;function en(){if(Ia)return mt;Ia=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var t=a(Te());function a(i){return i&&i.__esModule?i:{default:i}}function e(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(i)}var c=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.default;return s.reduce(function(n,l){return e(n)==="object"&&n.last!==null&&(n.distance+=o(l,n.last)),n.last=l,n},{last:null,distance:0}).distance},r=c;return mt.default=r,mt}var ht={},Ga;function tn(){if(Ga)return ht;Ga=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),c=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;u=typeof u<"u"&&!isNaN(u)?u:1;var d=(0,t.default)(n),v=(0,a.default)(n),_=(0,t.default)(l),h=(0,a.default)(l),p=6356752314245e-6,D=1/298.257223563,k=(0,e.default)(h-v),w,A,M,R,x,$,N=Math.atan((1-D)*Math.tan((0,e.default)(parseFloat(d)))),K=Math.atan((1-D)*Math.tan((0,e.default)(parseFloat(_)))),V=Math.sin(N),W=Math.cos(N),U=Math.sin(K),Q=Math.cos(K),se=k,ee,Z=100;do{var j=Math.sin(se),O=Math.cos(se);if($=Math.sqrt(Q*j*(Q*j)+(W*U-V*Q*O)*(W*U-V*Q*O)),$===0)return 0;w=V*U+W*Q*O,A=Math.atan2($,w),M=W*Q*j/$,R=1-M*M,x=w-2*V*U/R,isNaN(x)&&(x=0);var C=D/16*R*(4+D*(4-3*R));ee=se,se=k+(1-C)*D*M*(A+C*$*(x+C*w*(-1+2*x*x)))}while(Math.abs(se-ee)>1e-12&&--Z>0);if(Z===0)return NaN;var B=R*(c.earthRadius*c.earthRadius-p*p)/(p*p),F=1+B/16384*(4096+B*(-768+B*(320-175*B))),H=B/1024*(256+B*(-128+B*(74-47*B))),b=H*$*(x+H/4*(w*(-1+2*x*x)-H/6*x*(-3+4*$*$)*(-3+4*x*x))),L=p*F*(A-b);return Math.round(L/u)*u},s=i;return ht.default=s,ht}var bt={},Ea;function an(){if(Ea)return bt;Ea=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.default=void 0;var t=function(c){if(/^(NNE|NE|NNW|N)$/.test(c))return"N";if(/^(ENE|E|ESE|SE)$/.test(c))return"E";if(/^(SSE|S|SSW|SW)$/.test(c))return"S";if(/^(WSW|W|WNW|NW)$/.test(c))return"W"},a=t;return bt.default=a,bt}var yt={},za;function rn(){if(za)return yt;za=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var t=a(Te());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,n=o(i,s),l=Number(s.time)-Number(i.time),u=n/l*1e3;return u},c=e;return yt.default=c,yt}var Pt={},Va;function nn(){if(Va)return Pt;Va=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=a(Te());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s,o){return(0,t.default)(s,i)+(0,t.default)(i,o)===(0,t.default)(s,o)},c=e;return Pt.default=c,Pt}var kt={},Wa;function on(){if(Wa)return kt;Wa=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var t=e(Pe()),a=e(ke());function e(i){return i&&i.__esModule?i:{default:i}}var c=function(s,o){for(var n=!1,l=o.length,u=-1,d=l-1;++u<l;d=u)((0,a.default)(o[u])<=(0,a.default)(s)&&(0,a.default)(s)<(0,a.default)(o[d])||(0,a.default)(o[d])<=(0,a.default)(s)&&(0,a.default)(s)<(0,a.default)(o[u]))&&(0,t.default)(s)<((0,t.default)(o[d])-(0,t.default)(o[u]))*((0,a.default)(s)-(0,a.default)(o[u]))/((0,a.default)(o[d])-(0,a.default)(o[u]))+(0,t.default)(o[u])&&(n=!n);return n},r=c;return kt.default=r,kt}var Mt={},Ka;function sn(){if(Ka)return Mt;Ka=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var t=a(ur());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s,o,n){return(0,t.default)(i,s,o)<n},c=e;return Mt.default=c,Mt}var Lt={},Fa;function un(){if(Fa)return Lt;Fa=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=a(Te());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s,o){var n=.01;return(0,t.default)(i,s,n)<o},c=e;return Lt.default=c,Lt}var Dt={},ja;function ln(){if(ja)return Dt;ja=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;function t(n,l){return i(n)||r(n,l)||e(n,l)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(n,l){if(n){if(typeof n=="string")return c(n,l);var u=Object.prototype.toString.call(n).slice(8,-1);if(u==="Object"&&n.constructor&&(u=n.constructor.name),u==="Map"||u==="Set")return Array.from(n);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return c(n,l)}}function c(n,l){(l==null||l>n.length)&&(l=n.length);for(var u=0,d=new Array(l);u<l;u++)d[u]=n[u];return d}function r(n,l){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(n)))){var u=[],d=!0,v=!1,_=void 0;try{for(var h=n[Symbol.iterator](),p;!(d=(p=h.next()).done)&&(u.push(p.value),!(l&&u.length===l));d=!0);}catch(D){v=!0,_=D}finally{try{!d&&h.return!=null&&h.return()}finally{if(v)throw _}}return u}}function i(n){if(Array.isArray(n))return n}var s=function(l){if(!l.startsWith("POLYGON"))throw new Error("Invalid wkt.");var u=l.slice(l.indexOf("(")+2,l.indexOf(")")).split(", "),d=u.map(function(v){var _=v.split(" "),h=t(_,2),p=h[0],D=h[1];return{longitude:parseFloat(p),latitude:parseFloat(D)}});return d},o=s;return Dt.default=o,Dt}var Ha;function dn(){return Ha||(Ha=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var a={computeDestinationPoint:!0,convertArea:!0,convertDistance:!0,convertSpeed:!0,decimalToSexagesimal:!0,findNearest:!0,getAreaOfPolygon:!0,getBounds:!0,getBoundsOfDistance:!0,getCenter:!0,getCenterOfBounds:!0,getCompassDirection:!0,getCoordinateKey:!0,getCoordinateKeys:!0,getDistance:!0,getDistanceFromLine:!0,getGreatCircleBearing:!0,getLatitude:!0,getLongitude:!0,getPathLength:!0,getPreciseDistance:!0,getRhumbLineBearing:!0,getRoughCompassDirection:!0,getSpeed:!0,isDecimal:!0,isPointInLine:!0,isPointInPolygon:!0,isPointNearLine:!0,isPointWithinRadius:!0,isSexagesimal:!0,isValidCoordinate:!0,isValidLatitude:!0,isValidLongitude:!0,orderByDistance:!0,sexagesimalToDecimal:!0,toDecimal:!0,toRad:!0,toDeg:!0,wktToPolygon:!0};Object.defineProperty(t,"computeDestinationPoint",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"convertArea",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"convertDistance",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"convertSpeed",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"decimalToSexagesimal",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"findNearest",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"getAreaOfPolygon",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"getBounds",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"getBoundsOfDistance",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"getCenter",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"getCenterOfBounds",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"getCompassDirection",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"getCoordinateKey",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"getCoordinateKeys",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"getDistance",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(t,"getDistanceFromLine",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(t,"getGreatCircleBearing",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"getLatitude",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(t,"getLongitude",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(t,"getPathLength",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"getPreciseDistance",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(t,"getRhumbLineBearing",{enumerable:!0,get:function(){return $.default}}),Object.defineProperty(t,"getRoughCompassDirection",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"getSpeed",{enumerable:!0,get:function(){return K.default}}),Object.defineProperty(t,"isDecimal",{enumerable:!0,get:function(){return V.default}}),Object.defineProperty(t,"isPointInLine",{enumerable:!0,get:function(){return W.default}}),Object.defineProperty(t,"isPointInPolygon",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(t,"isPointNearLine",{enumerable:!0,get:function(){return Q.default}}),Object.defineProperty(t,"isPointWithinRadius",{enumerable:!0,get:function(){return se.default}}),Object.defineProperty(t,"isSexagesimal",{enumerable:!0,get:function(){return ee.default}}),Object.defineProperty(t,"isValidCoordinate",{enumerable:!0,get:function(){return Z.default}}),Object.defineProperty(t,"isValidLatitude",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(t,"isValidLongitude",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(t,"orderByDistance",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"sexagesimalToDecimal",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(t,"toDecimal",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(t,"toRad",{enumerable:!0,get:function(){return H.default}}),Object.defineProperty(t,"toDeg",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(t,"wktToPolygon",{enumerable:!0,get:function(){return L.default}});var e=m(Vr()),c=m(Wr()),r=m(Kr()),i=m(Fr()),s=m(jr()),o=m(Hr()),n=m(Xr()),l=m(or()),u=m(Ur()),d=m(Zr()),v=m(Yr()),_=m(Jr()),h=m(Vt()),p=m(ta()),D=m(Te()),k=m(ur()),w=m(Qr()),A=m(Pe()),M=m(ke()),R=m(en()),x=m(tn()),$=m(sr()),N=m(an()),K=m(rn()),V=m(Wt()),W=m(nn()),U=m(on()),Q=m(sn()),se=m(un()),ee=m(Kt()),Z=m(rr()),j=m(tr()),O=m(ar()),C=m(ir()),B=m(Ft()),F=m(aa()),H=m(Re()),b=m(Ae()),L=m(ln()),T=_e();Object.keys(T).forEach(function(g){g==="default"||g==="__esModule"||Object.prototype.hasOwnProperty.call(a,g)||Object.defineProperty(t,g,{enumerable:!0,get:function(){return T[g]}})});function m(g){return g&&g.__esModule?g:{default:g}}}(Yt)),Yt}var cn=dn();class fn{constructor(){wt(this,"stops",[])}async instantiate(){const e=await(await fetch("/stops.json")).json();this.stops=e.stops}findClosestStops(a,e=.5,c=3){return this.stops.map(s=>{const o=cn.getDistance({latitude:a[0],longitude:a[1]},{latitude:s.position.lat,longitude:s.position.lng})/1e3;return{name:s.name,position:s.position,dist_from_point:o}}).filter(s=>s.dist_from_point<=e).sort((s,o)=>s.dist_from_point-o.dist_from_point).slice(0,c)}}var vn=oe('<label for="spot-search-input" class="svelte-1bz9rsj"> </label>'),gn=(t,a)=>q(a,!0),pn=oe('<div class="loading-spinner svelte-1bz9rsj"></div>'),_n=oe('<button type="button" class="clear-searchbar svelte-1bz9rsj" aria-label="Clear"><img src="/clearsearchbar.svg" alt="Clear" class="clear-searchbar-icon svelte-1bz9rsj"/></button>'),mn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <div class="secondary-suggestion-text svelte-1bz9rsj"> </div></button></li>'),hn=(t,a,e)=>a(f(e)),bn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),yn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),Pn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <!></button></li>'),kn=oe('<ul class="suggestions-list svelte-1bz9rsj"><!> <!></ul>'),Mn=oe('<div class="spot-search-bar svelte-1bz9rsj"><!> <div class="searchbar-wrapper svelte-1bz9rsj"><input id="spot-search-input" type="text"/> <!> <!></div></div>');function Xa(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(Et,"$locale",e),i=()=>S(Tt,"$userLocation",e),s=()=>S(A,"$yourLocationMessage",e);let o=ne(""),n=ne(Pr([])),l=ne(!1),u=null,d=ne(!1),v=null,_=Ge(a,"label",3,""),h=Ge(a,"placeholder",3,""),p=Ge(a,"error",3,!1),D=Ge(a,"value",3,""),k=Ge(a,"providedSpot",3,null);qe(async()=>{const{AutocompleteSuggestion:O}=await $r();u=O,v=k()});async function w(O){var C;if(u){q(l,!0);const B={input:O.input,includedRegionCodes:["ee"],region:"ee",language:r()},F=await u.fetchAutocompleteSuggestions(B);let H=[];if(F.suggestions&&F.suggestions.length>0)for(const b of F.suggestions){let L=await b.placePrediction.toPlace().fetchFields({fields:["location"]});H.push({name:b.placePrediction.mainText.text,secondaryText:((C=b.placePrediction.secondaryText)==null?void 0:C.text)??"",position:{lat:L.place.location.lat(),lng:L.place.location.lng()}})}return q(l,!1),H}return[]}ge(()=>{f(o)?w({input:f(o)}).then(O=>{q(n,O,!0)}):q(n,[],!0)}),ge(()=>{D()!==void 0&&D()!==null&&q(o,D())});const A=z("your_location");function M(O){var C;v=O,q(o,O.name,!0),q(d,!1),(C=a.onSelect)==null||C.call(a,O)}function R(){var C;if(!i())return;const O={name:s(),position:{lat:i().lat,lng:i().lng},secondaryText:`${i().lat}, ${i().lng}`};v=O,q(o,O.name,!0),q(d,!1),(C=a.onSelect)==null||C.call(a,O)}function x(){q(d,!1),v&&f(o)!==v.name&&q(o,v.name,!0)}function $(){var O;q(o,""),v=null,q(n,[],!0),q(d,!1),(O=a.onSelect)==null||O.call(a,null)}var N=Mn(),K=P(N);{var V=O=>{var C=vn(),B=P(C,!0);y(C),ce(()=>E(B,_())),re(O,C)};le(K,O=>{_()&&O(V)})}var W=G(K,2),U=P(W);Rr(U),U.__click=[gn,d];var Q=G(U,2);{var se=O=>{var C=pn();re(O,C)},ee=(O,C)=>{{var B=F=>{var H=_n();H.__click=$,re(F,H)};le(O,F=>{f(o)&&F(B)},C)}};le(Q,O=>{f(l)?O(se):O(ee,!1)})}var Z=G(Q,2);{var j=O=>{var C=kn(),B=P(C);{var F=b=>{var L=mn(),T=P(L);T.__mousedown=R;var m=P(T),g=P(m,!0);y(m);var I=G(m,2),te=P(I);y(I),y(T),y(L),ce((Y,J)=>{E(g,s()),E(te,`${Y??""}, ${J??""}`)},[()=>i().lat.toFixed(5),()=>i().lng.toFixed(5)]),re(b,L)};le(B,b=>{i()&&b(F)})}var H=G(B,2);It(H,17,()=>f(n),Gt,(b,L)=>{var T=Pn(),m=P(T);m.__mousedown=[hn,M,L];var g=P(m),I=P(g,!0);y(g);var te=G(g,2);{var Y=ue=>{var de=bn(),X=P(de,!0);y(de),ce(()=>E(X,f(L).secondaryText)),re(ue,de)},J=ue=>{var de=yn(),X=P(de);y(de),ce((pe,Ne)=>E(X,`${pe??""}, ${Ne??""}`),[()=>f(L).position.lat.toFixed(5),()=>f(L).position.lng.toFixed(5)]),re(ue,de)};le(te,ue=>{f(L).secondaryText?ue(Y):ue(J,!1)})}y(m),y(T),ce(()=>E(I,f(L).name)),re(b,T)}),y(C),re(O,C)};le(Z,O=>{f(d)&&O(j)})}y(W),y(N),ce(()=>{Ce(U,"placeholder",h()),xe(U,1,`spot-search ${p()?"error":""}`,"svelte-1bz9rsj")}),$t("focus",U,()=>q(d,!0)),$t("blur",U,x),qr(U,()=>f(o),O=>q(o,O)),re(t,N),Oe(),c()}$e(["click","mousedown"]);var Ln=(t,a)=>{q(a,!1)},Dn=oe('<button class="confirm-button svelte-3hy2qp"> </button>'),Sn=oe('<div class="component-container svelte-3hy2qp"><div class="spot-picking-container svelte-3hy2qp"><div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div class="buttons-container svelte-3hy2qp"><!> <button class="cancel-button svelte-3hy2qp"> </button></div></div></div>');function On(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(qt,"$chosenSpots",e),i=()=>S(x,"$spotPickingPickupLabel",e),s=()=>S($,"$spotPickingPickupPlaceholder",e),o=()=>S(V,"$noStopsNearPickup",e),n=()=>S(N,"$spotPickingDestinationLabel",e),l=()=>S(K,"$spotPickingDestinationPlaceholder",e),u=()=>S(W,"$noStopsNearDestination",e),d=()=>S(U,"$confirmButtonText",e),v=()=>S(R,"$cancelButtonText",e);let _=ne(null),h=ne(null),p=ne(null);function D(){fe.set(!0),ve.set({key:"loading",params:{}}),qt.set({}),be.set("map-idle")}let k=ne(!1),w=ne(!1),A=ne(!1),M=ne(!1);qe(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),q(_,new fn,!0),await f(_).instantiate(),r()&&(q(A,!0),q(h,r().pickup,!0),q(p,r().destination,!0)),fe.set(!1),ve.set({key:"loading",params:{}})}),ge(()=>{if(f(h)&&f(p)&&f(_)){let X=f(_).findClosestStops([f(h).position.lat,f(h).position.lng]),pe=f(_).findClosestStops([f(p).position.lat,f(p).position.lng]);X.length===0&&q(k,!0),pe.length===0&&q(w,!0),X.length>0&&pe.length>0&&(q(M,!0),f(A)||(fe.set(!0),ve.set({key:"loading",params:{}}),qt.set({pickup:f(h),destination:f(p)}),ea.set({pickup:X,destination:pe}),be.set("bus-stop-picking")))}});const R=z("spot_picking_cancel_button"),x=z("spot_picking_pickup_label"),$=z("spot_pickup_placeholder"),N=z("spot_picking_destination_label"),K=z("spot_destination_placeholder"),V=z("spot_pickup_no_bus_stop_found"),W=z("spot_destination_no_bus_stop_found"),U=z("spot_picking_confirm");var Q=Sn(),se=P(Q),ee=P(se),Z=P(ee);const j=Me(()=>f(h)??null),O=Me(()=>{var X;return((X=f(h))==null?void 0:X.name)??""});Xa(Z,{get label(){return i()},get placeholder(){return s()},get error(){return f(k)},get providedSpot(){return f(j)},get value(){return f(O)},onSelect:X=>{q(h,X,!0),q(k,!1)}});var C=G(Z,2),B=P(C),F=P(B,!0);y(B),y(C),y(ee);var H=G(ee,2),b=P(H);const L=Me(()=>f(p)??null),T=Me(()=>{var X;return((X=f(p))==null?void 0:X.name)??""});Xa(b,{get label(){return n()},get placeholder(){return l()},get error(){return f(w)},get providedSpot(){return f(L)},get value(){return f(T)},onSelect:X=>{q(p,X,!0),q(w,!1)}});var m=G(b,2),g=P(m),I=P(g,!0);y(g),y(m),y(H);var te=G(H,2),Y=P(te);{var J=X=>{var pe=Dn();pe.__click=[Ln,A];var Ne=P(pe,!0);y(pe),ce(()=>{pe.disabled=!(f(M)&&f(h)&&f(p)&&!f(k)&&!f(w)),E(Ne,d())}),re(X,pe)};le(Y,X=>{f(A)&&X(J)})}var ue=G(Y,2);ue.__click=D;var de=P(ue,!0);y(ue),y(te),y(se),y(Q),ce(()=>{xe(ee,1,`spot-search-bar-wrapper${f(k)?" error":""}`,"svelte-3hy2qp"),E(F,f(k)?o():""),xe(H,1,`spot-search-bar-wrapper${f(w)?" error":""}`,"svelte-3hy2qp"),E(I,f(w)?u():""),E(de,v())}),re(t,Q),Oe(),c()}$e(["click"]);class ye{static async initialize(){if(!this.travelModeConstants||!this.directionsStatusConstants){const{TravelMode:a,DirectionsStatus:e}=await ia();this.travelModeConstants=a,this.directionsStatusConstants=e}}static async getRoute(a){await this.initialize();const{DirectionsService:e}=await ia(),r=await new e().route(a);return r.status===this.directionsStatusConstants.OK?{pathArray:r.routes[0].overview_path.map(s=>({lat:s.lat(),lng:s.lng()})),bounds:r.routes[0].bounds}:null}static async calculatePreliminaryRoutes(a,e,c,r="en",i=!0){if(await this.initialize(),!a||!e||!c){console.warn("RouteService: Missing required data for route calculation");return}const s=a;if(!s.pickup||!s.destination){console.warn("RouteService: Invalid chosen spots data");return}const o={origin:{lat:s.pickup.position.lat,lng:s.pickup.position.lng},destination:{lat:e.position.lat,lng:e.position.lng},travelMode:this.travelModeConstants.WALKING,language:r,region:"ee"},n={origin:{lat:e.position.lat,lng:e.position.lng},destination:{lat:c.position.lat,lng:c.position.lng},travelMode:this.travelModeConstants.DRIVING,language:r,region:"ee"},l={origin:{lat:c.position.lat,lng:c.position.lng},destination:{lat:s.destination.position.lat,lng:s.destination.position.lng},travelMode:this.travelModeConstants.WALKING,language:r,region:"ee"};if(i){const[u,d,v]=await Promise.all([this.getRoute(o),this.getRoute(n),this.getRoute(l)]);Bt.set(u),Ct.set(d),At.set(v)}else{const[u,d]=await Promise.all([this.getRoute(o),this.getRoute(l)]);Bt.set(u),At.set(d)}}static nullDrivingRoutes(){Ct.set(null),Qt.set(null)}static async calculateCarRouteHelper(a,e){const{LatLngBounds:c}=await Qa(),r=new c;let i=[];if(a)for(const s of a)r.extend({lat:s[0],lng:s[1]}),i.push({lat:s[0],lng:s[1]});else e&&r.extend({lat:e.position.lat,lng:e.position.lng});return{mappedWaypoints:i,latLngBounds:r}}static async calculateCarToPickupRoute(a,e){const{mappedWaypoints:c,latLngBounds:r}=await this.calculateCarRouteHelper(a,e);Qt.set({pathArray:c,bounds:r})}static async calculatePickupBusStopToDestinationRoute(a,e){const{mappedWaypoints:c,latLngBounds:r}=await this.calculateCarRouteHelper(a,e);Ct.set({pathArray:c,bounds:r})}}wt(ye,"travelModeConstants",null),wt(ye,"directionsStatusConstants",null);function wn(t,a,e,c,r){var i,s,o;a()&&f(e)&&f(c)&&(fe.set(!0),ve.set({key:"loading",params:{}}),ye.nullDrivingRoutes(),(i=r())==null||i.publishChosenSpots(a().pickup,a().destination),(s=r())==null||s.publishChosenRouteStops(f(e),f(c)),(o=r())==null||o.publishGoal({type:"pickup",position:f(e).position}))}var Rn=(t,a)=>q(a,!f(a)),Cn=(t,a,e)=>a(f(e)),qn=oe('<button type="button" role="option"> </button>'),xn=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="pickup-dropdown"></div>'),$n=(t,a)=>q(a,!f(a)),Tn=(t,a,e)=>a(f(e)),Bn=oe('<button type="button" role="option"> </button>'),An=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="destination-dropdown"></div>'),Nn=oe('<button class="order-car-button svelte-5klcor"> </button>'),In=oe('<div class="bus-stop-picking svelte-5klcor"><div class="dropdowns-container svelte-5klcor"><h2 class="svelte-5klcor"> </h2> <div class="dropdown-group svelte-5klcor"><label for="pickup-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="pickup-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div> <div class="dropdown-group svelte-5klcor"><label for="destination-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="destination-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div></div> <div class="buttons-container svelte-5klcor"><!> <button class="back-button svelte-5klcor"> </button></div></div>');function Gn(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(ea,"$foundBusStops",e),i=()=>S(qt,"$chosenSpots",e),s=()=>S(Et,"$locale",e),o=()=>S(zt,"$mqttClient",e),n=()=>S(V,"$busStopPickHeadingText",e),l=()=>S(W,"$busStopPickupText",e),u=()=>S(U,"$busStopDestinationText",e),d=()=>S(N,"$orderCarText",e),v=()=>S(K,"$backButtonText",e);let _=ne(!1),h=ne(!1),p=Me(()=>r().pickup),D=Me(()=>r().destination),k=ne(null),w=ne(null);qe(async()=>{Ot.set({top:400,bottom:100}),await ye.initialize(),f(k)&&f(w)&&i()&&(ye.calculatePreliminaryRoutes(i(),f(k),f(w),s()),f(h)||(De.set("all"),q(h,!0)))}),ge(()=>{i()&&!f(_)&&(q(k,f(p)[0],!0),q(w,f(D)[0],!0),fe.set(!1),ve.set({key:"loading",params:{}}),q(_,!0))}),ge(()=>{f(k)&&f(w)&&i()&&(ye.calculatePreliminaryRoutes(i(),f(k),f(w),s()),f(h)||(De.set("all"),q(h,!0)))});function A(){fe.set(!0),ve.set({key:"loading",params:{}}),ea.set({}),be.set("spot-picking")}let M=ne(!1),R=ne(!1);function x(ie){q(k,ie,!0),q(M,!1),De.set("pickup")}function $(ie){q(w,ie,!0),q(R,!1),De.set("destination")}const N=z("bus_stop_order_car_button"),K=z("bus_stop_back_button"),V=z("bus_stop_pick_heading"),W=z("bus_stop_pickup"),U=z("bus_stop_destination");let Q=ne(void 0),se=ne(void 0);function ee(ie){f(M)&&f(Q)&&!f(Q).contains(ie.target)&&q(M,!1)}function Z(ie){f(R)&&f(se)&&!f(se).contains(ie.target)&&q(R,!1)}ge(()=>{if(f(M))return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)}),ge(()=>{if(f(R))return document.addEventListener("mousedown",Z),()=>document.removeEventListener("mousedown",Z)});var j=In(),O=P(j),C=P(O),B=P(C,!0);y(C);var F=G(C,2),H=P(F),b=P(H,!0);y(H);var L=G(H,2),T=P(L);T.__click=[Rn,M];var m=P(T),g=G(m);y(T);var I=G(T,2);{var te=ie=>{var me=xn();It(me,21,()=>f(p),Gt,(Ie,Le)=>{var he=qn();he.__click=[Cn,x,Le];var Ht=P(he,!0);y(he),ce(()=>{xe(he,1,`dropdown-item ${f(k)&&f(Le).name===f(k).name?"selected":""}`,"svelte-5klcor"),Ce(he,"aria-selected",f(k)&&f(Le).name===f(k).name),E(Ht,f(Le).name)}),re(Ie,he)}),y(me),re(ie,me)};le(I,ie=>{f(M)&&ie(te)})}y(L),Jt(L,ie=>q(Q,ie),()=>f(Q)),y(F);var Y=G(F,2),J=P(Y),ue=P(J,!0);y(J);var de=G(J,2),X=P(de);X.__click=[$n,R];var pe=P(X),Ne=G(pe);y(X);var lr=G(X,2);{var dr=ie=>{var me=An();It(me,21,()=>f(D),Gt,(Ie,Le)=>{var he=Bn();he.__click=[Tn,$,Le];var Ht=P(he,!0);y(he),ce(()=>{xe(he,1,`dropdown-item ${f(w)&&f(Le).name===f(w).name?"selected":""}`,"svelte-5klcor"),Ce(he,"aria-selected",f(w)&&f(Le).name===f(w).name),E(Ht,f(Le).name)}),re(Ie,he)}),y(me),re(ie,me)};le(lr,ie=>{f(R)&&ie(dr)})}y(de),Jt(de,ie=>q(se,ie),()=>f(se)),y(Y),y(O);var ra=G(O,2),na=P(ra);{var cr=ie=>{var me=Nn();me.__click=[wn,i,k,w,o];var Ie=P(me,!0);y(me),ce(()=>E(Ie,d())),re(ie,me)};le(na,ie=>{f(k)&&f(w)&&ie(cr)})}var jt=G(na,2);jt.__click=A;var fr=P(jt,!0);y(jt),y(ra),y(j),ce(()=>{var ie,me;E(B,n()),E(b,l()),Ce(T,"aria-expanded",f(M)),E(m,`${((ie=f(k))==null?void 0:ie.name)??""} `),xe(g,0,`dropdown-arrow${f(M)?" open":""}`,"svelte-5klcor"),E(ue,u()),Ce(X,"aria-expanded",f(R)),E(pe,`${((me=f(w))==null?void 0:me.name)??""} `),xe(Ne,0,`dropdown-arrow${f(R)?" open":""}`,"svelte-5klcor"),E(fr,v())}),re(t,j),Oe(),c()}$e(["click"]);var En=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),zn=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),Vn=oe('<div class="driving-info-container svelte-rznqub"><div class="driving-info-card svelte-rznqub"><!></div></div>');function Ua(t,a){var U,Q,se,ee;Se(a,!0);const[e,c]=we(),r=()=>S(Et,"$locale",e),i=()=>S(St,"$carStatus",e),s=()=>S(h,"$drivingToPickupInfoText",e),o=()=>S(D,"$carSpeedHeadingText",e),n=()=>S(f(w),"$carSpeedInfoText",e),l=()=>S(A,"$chosenPickupHeadingText",e),u=()=>S(M,"$chosenPickupSpotText",e),d=()=>S(p,"$drivingToDestinationInfoText",e),v=()=>S(R,"$chosenDestinationHeadingText",e),_=()=>S(x,"$chosenDestinationSpotText",e);qe(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),Ot.set({top:400,bottom:100});async function Z(){return new Promise(O=>{let C;C=St.subscribe(B=>{B&&(typeof C=="function"&&C(),O(B))})})}const j=await Z();await ye.initialize(),await ye.calculatePreliminaryRoutes(j.chosen_spots,j.chosen_route_stops.pickup,j.chosen_route_stops.destination,r(),!1),Ja.set(!0),a.type=="pickup"?(await ye.calculateCarToPickupRoute(j.route,j.chosen_route_stops.pickup),De.set("carToPickup")):a.type=="destination"&&(await ye.calculatePickupBusStopToDestinationRoute(j.route,j.chosen_route_stops.destination),De.set("all")),fe.set(!1),ve.set({key:"loading",params:{}})});const h=z("driving_to_pickup_info"),p=z("driving_to_destination_info"),D=z("car_speed_heading");let k=Me(()=>{var Z;return(Z=i())!=null&&Z.speed?i().speed.toFixed(1):"0.0"});const w=Me(()=>z("car_speed_info",{speed:f(k)})),A=z("chosen_pickup_heading"),M=z("chosen_pickup_spot",{spot_name:(U=i())!=null&&U.chosen_route_stops&&"pickup"in i().chosen_route_stops&&((Q=i().chosen_route_stops.pickup)!=null&&Q.name)?i().chosen_route_stops.pickup.name:""}),R=z("chosen_destination_heading"),x=z("chosen_destination_spot",{spot_name:(se=i())!=null&&se.chosen_route_stops&&"destination"in i().chosen_route_stops&&((ee=i().chosen_route_stops.destination)!=null&&ee.name)?i().chosen_route_stops.destination.name:""});var $=Vn(),N=P($),K=P(N);{var V=Z=>{var j=En(),O=xt(j),C=P(O,!0);y(O);var B=G(O,2),F=P(B),H=P(F,!0);y(F);var b=G(F,2),L=P(b,!0);y(b),y(B);var T=G(B,2),m=P(T),g=P(m,!0);y(m);var I=G(m,2),te=P(I,!0);y(I),y(T),ce(()=>{E(C,s()),E(H,o()),E(L,n()),E(g,l()),E(te,u())}),re(Z,j)},W=(Z,j)=>{{var O=C=>{var B=zn(),F=xt(B),H=P(F,!0);y(F);var b=G(F,2),L=P(b),T=P(L,!0);y(L);var m=G(L,2),g=P(m,!0);y(m),y(b);var I=G(b,2),te=P(I),Y=P(te,!0);y(te);var J=G(te,2),ue=P(J,!0);y(J),y(I),ce(()=>{E(H,d()),E(T,o()),E(g,n()),E(Y,v()),E(ue,_())}),re(C,B)};le(Z,C=>{a.type==="destination"&&C(O)},j)}};le(K,Z=>{a.type==="pickup"?Z(V):Z(W,!1)})}y(N),y($),re(t,$),Oe(),c()}async function Wn(t,a,e,c){var r,i,s,o,n;if(fe.set(!0),ve.set({key:"loading",params:{}}),a.type==="pickup"){const l=(r=e())==null?void 0:r.chosen_route_stops.destination.position;(i=c())==null||i.publishGoal({type:"dropoff",position:l})}else a.type==="destination"&&((s=c())==null||s.publishClearChosenSpots(),(o=c())==null||o.publishClearChosenRouteStops(),Lr(),(n=c())==null||n.publishGoal({type:"done",position:{lat:0,lng:0,height:0}}),be.set("rating"))}var Kn=oe('<div class="arrived-info-container svelte-1pss86t"><div class="arrived-info-card svelte-1pss86t"><h2 class="arrived-heading svelte-1pss86t"> </h2> <div class="button-container svelte-1pss86t"><h3 class="arrived-subheading svelte-1pss86t"> </h3> <button class="arrived-confirm-btn svelte-1pss86t"> </button></div></div></div>');function Za(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(Bt,"$pathChosenPickupToBusStopPickup",e),i=()=>S(At,"$pathBusStopDestinationToChosenDestination",e),s=()=>S(St,"$carStatus",e),o=()=>S(Et,"$locale",e),n=()=>S(zt,"$mqttClient",e),l=()=>S(v,"$confirmHeadingMessage",e),u=()=>S(_,"$confirmButtonHeadingMessage",e),d=()=>S(h,"$confirmButtonMessage",e);qe(async()=>{var N,K,V;Ot.set({top:400,bottom:100}),await ye.initialize(),(!r()||!i())&&await ye.calculatePreliminaryRoutes(((N=s())==null?void 0:N.chosen_spots)??null,((K=s())==null?void 0:K.chosen_route_stops.pickup)??null,((V=s())==null?void 0:V.chosen_route_stops.destination)??null,o(),!1),a.type=="pickup"?De.set("pickup"):a.type=="destination"&&De.set("destination")});const v=a.type==="pickup"?z("arrived_at_pickup_info"):z("arrived_at_destination_info"),_=a.type==="pickup"?z("confirm_in_car_info"):z("confirm_destination_info"),h=a.type==="pickup"?z("confirm_in_car_button"):z("confirm_destination_button");var p=Kn(),D=P(p),k=P(D),w=P(k,!0);y(k);var A=G(k,2),M=P(A),R=P(M,!0);y(M);var x=G(M,2);x.__click=[Wn,a,s,n];var $=P(x,!0);y(x),y(A),y(D),y(p),ce(()=>{E(w,l()),E(R,u()),E($,d())}),re(t,p),Oe(),c()}$e(["click"]);var Fn=oe('<button type="button" class="star-btn svelte-rv59cl"><img class="star svelte-rv59cl"/></button>'),jn=()=>{fe.set(!0),ve.set({key:"loading",params:{}}),be.set("map-idle")},Hn=oe('<div class="rating-overlay svelte-rv59cl"><div class="rating-card svelte-rv59cl"><h2 class="rating-heading svelte-rv59cl"> </h2> <div class="stars svelte-rv59cl"></div> <button class="skip-btn svelte-rv59cl"> </button></div></div>');function Xn(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(zt,"$mqttClient",e),i=()=>S(h,"$ratingHeadingText",e),s=()=>S(p,"$ratingRefuseText",e);let o=ne(0),n=ne(0),l=ne(""),u=ne("");qe(async()=>{Ot.set({top:200,bottom:200}),q(l,await Nt("/star_filled.svg"),!0),q(u,await Nt("/star_empty.svg"),!0),fe.set(!1),ve.set({key:"loading",params:{}})});function d($){var N;q(o,$,!0),fe.set(!0),ve.set({key:"loading",params:{}}),(N=r())==null||N.publishRating(f(o),new Date().toISOString()),be.set("map-idle")}function v($){q(n,$,!0)}function _(){q(n,0)}const h=z("rating_heading"),p=z("rating_refuse");var D=Hn(),k=P(D),w=P(k),A=P(w,!0);y(w);var M=G(w,2);It(M,20,()=>Array.from({length:5}),Gt,($,N,K)=>{var V=Fn();V.__click=()=>d(K+1),Ce(V,"aria-label",`Rate ${K+1} star${K===0?"":"s"}`);var W=P(V);Ce(W,"alt",K+1+" star"),y(V),ce(()=>Ce(W,"src",(f(n)?K<f(n):K<f(o))?f(l):f(u))),$t("mouseenter",V,()=>v(K+1)),$t("mouseleave",V,_),re($,V)}),y(M);var R=G(M,2);R.__click=[jn];var x=P(R,!0);y(R),y(k),y(D),ce(()=>{E(A,i()),E(x,s())}),re(t,D),Oe(),c()}$e(["click"]);var Un=oe('<div class="app-root"><!> <!></div>');function si(t,a){Se(a,!0);const[e,c]=we(),r=()=>S(zt,"$mqttClient",e),i=()=>S(St,"$carStatus",e),s=()=>S(be,"$appState",e),o=()=>S(Sr,"$sessionId",e),n=()=>S(ve,"$appGlobalLoadingMessageKey",e),l=()=>S(fe,"$appGlobalLoading",e),u=()=>S(f(_),"$appGlobalLoadingMessage",e);qe(()=>{let M=null,R=0;return navigator.geolocation?M=navigator.geolocation.watchPosition(x=>{const $=Date.now();$-R>=500&&(Tt.set({lat:x.coords.latitude,lng:x.coords.longitude}),R=$)},x=>{console.warn("Geolocation denied or unavailable:",x)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:1e3}):(Tt.set(null),console.warn("Geolocation not supported")),()=>{M!==null&&navigator.geolocation.clearWatch(M)}}),ge(()=>{r()||Mr("/login")});let d=null;ge(()=>{if(r()&&i()){if(i().state===d)return;switch(d=i().state,i().state){case"waiting":s()!=="rating"&&be.set("map-idle");break;case"driving-to-pickup":be.set("driving-to-pickup");break;case"arrived-to-pickup":be.set("arrived-to-pickup");break;case"driving-to-destination":be.set("driving-to-destination");break;case"arrived-to-destination":be.set("arrived-to-destination");break;case"shutting-down":fe.set(!0),ve.set({key:"car_shutting_down"});const M=o()??"";Dr.set({key:"session_closed",params:{id:M}}),Ya();break;default:console.error("Unknown car status state:",JSON.stringify(i().state));break}}});let v=Me(()=>s()==="map-idle"||s()==="bus-stop-picking"||s()==="driving-to-pickup"||s()==="arrived-to-pickup"||s()==="driving-to-destination"||s()==="arrived-to-destination");const _=Me(()=>n()?z(n().key,n().params):null);var h=Un(),p=P(h);{var D=M=>{Ir(M,{children:(R,x)=>{var $=kr(),N=xt($);{var K=W=>{zr(W,{})},V=(W,U)=>{{var Q=ee=>{Gn(ee,{})},se=(ee,Z)=>{{var j=C=>{Ua(C,{type:"pickup"})},O=(C,B)=>{{var F=b=>{Za(b,{type:"pickup"})},H=(b,L)=>{{var T=g=>{Ua(g,{type:"destination"})},m=(g,I)=>{{var te=Y=>{Za(Y,{type:"destination"})};le(g,Y=>{s()==="arrived-to-destination"&&Y(te)},I)}};le(b,g=>{s()==="driving-to-destination"?g(T):g(m,!1)},L)}};le(C,b=>{s()==="arrived-to-pickup"?b(F):b(H,!1)},B)}};le(ee,C=>{s()==="driving-to-pickup"?C(j):C(O,!1)},Z)}};le(W,ee=>{s()==="bus-stop-picking"?ee(Q):ee(se,!1)},U)}};le(N,W=>{s()==="map-idle"?W(K):W(V,!1)})}re(R,$)},$$slots:{default:!0}})},k=(M,R)=>{{var x=N=>{On(N,{})},$=(N,K)=>{{var V=W=>{Xn(W,{})};le(N,W=>{s()==="rating"&&W(V)},K)}};le(M,N=>{s()==="spot-picking"?N(x):N($,!1)},R)}};le(p,M=>{f(v)?M(D):M(k,!1)})}var w=G(p,2);{var A=M=>{wr(M,{get loadingMsg(){return u()}})};le(w,M=>{l()&&M(A)})}y(h),re(t,h),Oe(),c()}export{si as component};
