var fr=Object.defineProperty;var vr=(t,a,e)=>a in t?fr(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var qt=(t,a,e)=>vr(t,typeof a!="symbol"?a+"":a,e);import"../chunks/CWj6FrbW.js";import{aJ as gr,aK as pr,O as _r,d as mr,a3 as hr,z as Ae,p as De,o as $e,b as pe,A as oe,G as Tt,F as W,D as k,E as b,H as br,I as ce,J as z,B as ie,a as Oe,C as ne,n as Qt,f,s as L,aI as Bt,K as Te,aG as yr}from"../chunks/CM7s3TdM.js";import{a as O,b as ea,s as we,i as de}from"../chunks/CZY1Q9bT.js";import{g as Pr}from"../chunks/D3ygULbZ.js";import{e as fe,f as ve,c as Me,u as At,p as ta,g as xt,h as Nt,i as It,j as Le,k as Rt,r as Ja,n as Qa,b as Ne,l as zt,o as kr,d as Sr,q as Se,s as Mr}from"../chunks/BvkDkEON.js";import{_ as Lr,p as Fe}from"../chunks/CvhVpWJc.js";import{f as Gt,L as Dr}from"../chunks/DKuJeQhF.js";import{t as H,r as Or,s as qe,a as Be,e as Et,i as Wt}from"../chunks/DUMhEyrb.js";import"../chunks/PCJ5bLI3.js";import{i as wr}from"../chunks/DJhY8YgZ.js";function Cr(t,a,e=a){var c=gr();pr(t,"input",n=>{var i=n?t.defaultValue:t.value;if(i=Ut(t)?Zt(i):i,e(i),c&&i!==(i=a())){var u=t.selectionStart,o=t.selectionEnd;t.value=i??"",o!==null&&(t.selectionStart=u,t.selectionEnd=Math.min(o,t.value.length))}}),(_r&&t.defaultValue!==t.value||mr(a)==null&&t.value)&&e(Ut(t)?Zt(t.value):t.value),hr(()=>{var n=a();Ut(t)&&n===Zt(t.value)||t.type==="date"&&!n&&!t.value||n!==t.value&&(t.value=n??"")})}function Ut(t){var a=t.type;return a==="number"||a==="range"}function Zt(t){return t===""?null:+t}let Yt=null,$t=null;async function Ge(){return $t||(Yt||(Yt=(async()=>{const t=await Lr(()=>import("../chunks/D-8nYH0_.js"),[],import.meta.url),a=t.Loader||t.default&&t.default.Loader;if(!a)throw new Error("Could not load Google Maps Loader");return $t=new a({apiKey:"AIzaSyAixRzVqb7kii3XrzzL3OxsN7k_2CoMeaM",version:"weekly"}),$t})()),Yt)}async function er(){return await(await Ge()).importLibrary("core")}async function tr(){return await(await Ge()).importLibrary("maps")}async function Rr(){return await(await Ge()).importLibrary("marker")}async function qr(){return await(await Ge()).importLibrary("places")}async function oa(){return await(await Ge()).importLibrary("routes")}async function $r(){return await(await Ge()).importLibrary("geometry")}async function xr(t,a={}){const{Map:e}=await tr();return new e(t,a)}function Tr(){fe.set(!0),ve.set({key:"ending_session",params:{}}),Ja()}var Br=oe('<div class="map-container svelte-1bz92gb"></div> <button class="end-session-button svelte-1bz92gb"> </button> <!>',1);function Ar(t,a){De(a,!0);const[e,c]=we(),n=()=>O(Qa,"$isDriving",e),i=()=>O(Me,"$carStatus",e),u=()=>O(At,"$userLocation",e),o=()=>O(ta,"$pathCarToBusStopPickup",e),r=()=>O(xt,"$pathBusStopPickupToBusStopDestination",e),l=()=>O(Nt,"$pathChosenPickupToBusStopPickup",e),d=()=>O(It,"$pathBusStopDestinationToChosenDestination",e),s=()=>O(Le,"$fitBoundsTarget",e),v=()=>O(Rt,"$fitBoundsVerticalPadding",e),_=()=>O(I,"$endSessionText",e);let h,p=null,y=null,S=null,C=null,B=null,M=null,q=null,x=null,$=null,N=null,G=null,F=null,E=null;function U(w,D){if(p&&w){const T={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},m={path:F,strokeOpacity:1,scale:4},g={path:E,strokeOpacity:1,scale:4};return D?w.setOptions({strokeOpacity:0,icons:[{icon:T,offset:"0",repeat:"20px"},{icon:m,offset:"0",repeat:"0"},{icon:g,offset:"100%",repeat:"0"}],visible:!1,map:p,zIndex:1}):w.setOptions({strokeColor:"#FF0000",strokeWeight:4,icons:[{icon:m,offset:"0",repeat:"0"},{icon:g,offset:"100%",repeat:"0"}],visible:!1,map:p}),w.setMap(p),w}return null}function Z(w,D){if(!D||D.length<2)return{index:0,progress:0};let T=1/0,m=0,g=0;for(let K=0;K<D.length-1;K++){const te=D[K],X=D[K+1],ae=ee(w,te,X),ue=Y(te,X,ae),le=google.maps.geometry.spherical.computeDistanceBetween(w,ue);le<T&&(T=le,m=K,g=ae)}return{index:m,progress:g}}function ee(w,D,T){const m=D.lat(),g=D.lng(),K=T.lat(),te=T.lng(),X=w.lat(),ae=w.lng(),ue=te-g,le=K-m,J=ue*ue+le*le;if(J===0)return 0;const he=((ae-g)*ue+(X-m)*le)/J;return Math.max(0,Math.min(1,he))}function Y(w,D,T){const m=w.lat()+(D.lat()-w.lat())*T,g=w.lng()+(D.lng()-w.lng())*T;return new google.maps.LatLng(m,g)}function se(w,D,T,m){if(!w||!p)return D;const g=w.getPath().getArray();if(g.length<2)return D;const{index:K,progress:te}=Z(T,g),X=[];for(let ae=0;ae<=K;ae++)X.push(g[ae]);if(te>0&&K<g.length-1){const ae=Y(g[K],g[K+1],te);X.push(ae)}if(!D){let ae="#FF0000";n()&&(ae="#00AA00"),D=new google.maps.Polyline({map:p,strokeColor:ae,strokeWeight:4,strokeOpacity:1,zIndex:1})}return D.setPath(X),D}$e(async()=>{var K;fe.set(!0),ve.set({key:"loading_map",params:{}}),p=await xr(h,{center:{lat:58.378,lng:26.729},zoom:13,disableDefaultUI:!0,mapId:"DEMO_MAP_ID"});const{AdvancedMarkerElement:w}=await Rr(),{SymbolPath:D}=await er();await $r(),F=D.CIRCLE,E=D.FORWARD_OPEN_ARROW,N=await Gt("/usermarker.svg"),G=await Gt("/carmarker.svg");const T=document.createElement("img");T.src=G,T.style.width="48px",T.style.height="48px",$=new w({position:(K=i())==null?void 0:K.pose,map:p,content:T});const m=document.createElement("img");m.src=N,m.style.width="32px",m.style.height="32px",x=new w({map:p,content:m});const{Polyline:g}=await tr();y=U(new g,!0),S=U(new g,!1),C=U(new g,!0),B=U(new g,!1),M=null,q=null,fe.set(!1),ve.set({key:"loading",params:{}})}),pe(()=>{u()&&x&&(x.position=u())}),pe(()=>{var w;if((w=i())!=null&&w.pose&&$){$.position=i().pose;const D=new google.maps.LatLng(i().pose.lat,i().pose.lng);B&&o()&&(q=se(B,q,D)),S&&r()&&(M=se(S,M,D))}}),pe(()=>{u()&&x&&(x.position=u())}),pe(()=>{l()&&y?(y.setPath(l().pathArray),y.setVisible(!0)):y!=null&&y.getVisible()&&y.setVisible(!1)}),pe(()=>{r()&&S?(S.setPath(r().pathArray),S.setVisible(!0)):S!=null&&S.getVisible()&&(S.setVisible(!1),M&&(M.setMap(null),M=null))}),pe(()=>{d()&&C?(C.setPath(d().pathArray),C.setVisible(!0)):C!=null&&C.getVisible()&&C.setVisible(!1)}),pe(()=>{o()&&B?(B.setPath(o().pathArray),B.setVisible(!0)):B!=null&&B.getVisible()&&(B.setVisible(!1),q&&(q.setMap(null),q=null))}),pe(()=>{var w,D,T,m,g,K,te;if(s()==="all"){if((w=l())!=null&&w.bounds&&((D=r())!=null&&D.bounds)&&((T=d())!=null&&T.bounds)){const X=new google.maps.LatLngBounds(l().bounds.getSouthWest(),l().bounds.getNorthEast()),ae=new google.maps.LatLngBounds(r().bounds.getSouthWest(),r().bounds.getNorthEast()),ue=new google.maps.LatLngBounds(d().bounds.getSouthWest(),d().bounds.getNorthEast());X.union(ae),X.union(ue),p==null||p.fitBounds(X,{top:v().top,bottom:v().bottom})}}else s()==="pickup"?(m=l())!=null&&m.bounds&&(p==null||p.fitBounds(l().bounds,{top:v().top,bottom:v().bottom})):s()==="destination"?(g=d())!=null&&g.bounds&&(p==null||p.fitBounds(d().bounds,{top:v().top,bottom:v().bottom})):s()==="carToPickup"?(K=o())!=null&&K.bounds&&((te=l())!=null&&te.bounds)&&(p==null||p.fitBounds(o().bounds.union(l().bounds),{top:v().top,bottom:v().bottom})):s()==="default"&&(p==null||p.setCenter({lat:58.378,lng:26.729}),p==null||p.setZoom(13))});const I=H("end_session_button");var P=Br(),R=Tt(P);ea(R,w=>h=w,()=>h);var A=W(R,2);A.__click=[Tr];var j=k(A,!0);b(A);var V=W(A,2);br(V,()=>a.children),ce(()=>z(j,_())),ie(t,P),Oe(),c()}Ae(["click"]);function Nr(t,a){var e;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishState("spot-picking")}var Ir=oe('<div class="footer-background svelte-1iqii79"><button class="order-car-button svelte-1iqii79"> </button></div>');function Gr(t,a){De(a,!1);const[e,c]=we(),n=()=>O(Ne,"$mqttClient",e),i=()=>O(u,"$orderCarText",e),u=H("order_car_button");wr();var o=Ir(),r=k(o);r.__click=[Nr,n];var l=k(r,!0);b(r),b(o),ce(()=>z(l,i())),ie(t,o),Oe(),c()}Ae(["click"]);var Jt={},Ve={},Ke={},re={},sa;function me(){if(sa)return re;sa=1,Object.defineProperty(re,"__esModule",{value:!0}),re.areaConversion=re.timeConversion=re.distanceConversion=re.altitudeKeys=re.latitudeKeys=re.longitudeKeys=re.MAXLON=re.MINLON=re.MAXLAT=re.MINLAT=re.earthRadius=re.sexagesimalPattern=void 0;var t=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;re.sexagesimalPattern=t;var a=6378137;re.earthRadius=a;var e=-90;re.MINLAT=e;var c=90;re.MAXLAT=c;var n=-180;re.MINLON=n;var i=180;re.MAXLON=i;var u=["lng","lon","longitude",0];re.longitudeKeys=u;var o=["lat","latitude",1];re.latitudeKeys=o;var r=["alt","altitude","elevation","elev",2];re.altitudeKeys=r;var l={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};re.distanceConversion=l;var d={m:60,h:3600,d:86400};re.timeConversion=d;var s={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};return re.areaConversion=s,s.sqm=s.m2,s.sqkm=s.km2,s.sqft=s.ft2,s.sqyd=s.yd2,s.sqin=s.in2,re}var je={},ua;function Ft(){if(ua)return je;ua=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var t=function(c,n){return n.reduce(function(i,u){if(typeof c>"u"||c===null)throw new Error("'".concat(c,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(c,u)&&typeof u<"u"&&typeof i>"u"?(i=u,u):i},void 0)},a=t;return je.default=a,je}var He={},Xe={},la;function Vt(){if(la)return Xe;la=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var t=function(c){var n=c.toString().trim();return isNaN(parseFloat(n))?!1:parseFloat(n)===Number(n)},a=t;return Xe.default=a,Xe}var Ue={},da;function Kt(){if(da)return Ue;da=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var t=me(),a=function(n){return t.sexagesimalPattern.test(n.toString().trim())},e=a;return Ue.default=e,Ue}var Ze={},ca;function jt(){if(ca)return Ze;ca=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var t=me(),a=function(n){var i=new RegExp(t.sexagesimalPattern).exec(n.toString().trim());if(typeof i>"u"||i===null)throw new Error("Given value is not in sexagesimal format");var u=Number(i[2])/60||0,o=Number(i[4])/3600||0,r=parseFloat(i[1])+u+o;return["S","W"].includes(i[7])?-r:r},e=a;return Ze.default=e,Ze}var Ye={},Je={},fa;function aa(){if(fa)return Je;fa=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var t=me(),a=e(Ft());function e(r){return r&&r.__esModule?r:{default:r}}function c(r,l){var d=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);l&&(s=s.filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable})),d.push.apply(d,s)}return d}function n(r){for(var l=1;l<arguments.length;l++){var d=arguments[l]!=null?arguments[l]:{};l%2?c(Object(d),!0).forEach(function(s){i(r,s,d[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):c(Object(d)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(d,s))})}return r}function i(r,l,d){return l in r?Object.defineProperty(r,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[l]=d,r}var u=function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:t.longitudeKeys,latitude:t.latitudeKeys,altitude:t.altitudeKeys},s=(0,a.default)(l,d.longitude),v=(0,a.default)(l,d.latitude),_=(0,a.default)(l,d.altitude);return n({latitude:v,longitude:s},_?{altitude:_}:{})},o=u;return Je.default=o,Je}var Qe={},va;function ar(){if(va)return Qe;va=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var t=n(Vt()),a=n(Kt()),e=n(jt()),c=me();function n(o){return o&&o.__esModule?o:{default:o}}var i=function o(r){return(0,t.default)(r)?!(parseFloat(r)>c.MAXLAT||r<c.MINLAT):(0,a.default)(r)?o((0,e.default)(r)):!1},u=i;return Qe.default=u,Qe}var et={},ga;function rr(){if(ga)return et;ga=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var t=n(Vt()),a=n(Kt()),e=n(jt()),c=me();function n(o){return o&&o.__esModule?o:{default:o}}var i=function o(r){return(0,t.default)(r)?!(parseFloat(r)>c.MAXLON||r<c.MINLON):(0,a.default)(r)?o((0,e.default)(r)):!1},u=i;return et.default=u,et}var pa;function nr(){if(pa)return Ye;pa=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var t=c(aa()),a=c(ar()),e=c(rr());function c(u){return u&&u.__esModule?u:{default:u}}var n=function(o){var r=(0,t.default)(o),l=r.latitude,d=r.longitude;if(Array.isArray(o)&&o.length>=2)return(0,e.default)(o[0])&&(0,a.default)(o[1]);if(typeof l>"u"||typeof d>"u")return!1;var s=o[d],v=o[l];return!(typeof v>"u"||typeof s>"u"||(0,a.default)(v)===!1||(0,e.default)(s)===!1)},i=n;return Ye.default=i,Ye}var _a;function ra(){if(_a)return He;_a=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;var t=i(Vt()),a=i(Kt()),e=i(jt()),c=i(nr()),n=i(aa());function i(s){return s&&s.__esModule?s:{default:s}}function u(s,v){var _=Object.keys(s);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(s);v&&(h=h.filter(function(p){return Object.getOwnPropertyDescriptor(s,p).enumerable})),_.push.apply(_,h)}return _}function o(s){for(var v=1;v<arguments.length;v++){var _=arguments[v]!=null?arguments[v]:{};v%2?u(Object(_),!0).forEach(function(h){r(s,h,_[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(_)):u(Object(_)).forEach(function(h){Object.defineProperty(s,h,Object.getOwnPropertyDescriptor(_,h))})}return s}function r(s,v,_){return v in s?Object.defineProperty(s,v,{value:_,enumerable:!0,configurable:!0,writable:!0}):s[v]=_,s}var l=function s(v){if((0,t.default)(v))return Number(v);if((0,a.default)(v))return(0,e.default)(v);if((0,c.default)(v)){var _=(0,n.default)(v);return Array.isArray(v)?v.map(function(h,p){return[0,1].includes(p)?s(h):h}):o(o(o({},v),_.latitude&&r({},_.latitude,s(v[_.latitude]))),_.longitude&&r({},_.longitude,s(v[_.longitude])))}return Array.isArray(v)?v.map(function(h){return(0,c.default)(h)?s(h):h}):v},d=l;return He.default=d,He}var ma;function Pe(){if(ma)return Ke;ma=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var t=me(),a=c(Ft()),e=c(ra());function c(u){return u&&u.__esModule?u:{default:u}}var n=function(o,r){var l=(0,a.default)(o,t.latitudeKeys);if(!(typeof l>"u"||l===null)){var d=o[l];return r===!0?d:(0,e.default)(d)}},i=n;return Ke.default=i,Ke}var tt={},ha;function ke(){if(ha)return tt;ha=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var t=me(),a=c(Ft()),e=c(ra());function c(u){return u&&u.__esModule?u:{default:u}}var n=function(o,r){var l=(0,a.default)(o,t.longitudeKeys);if(!(typeof l>"u"||l===null)){var d=o[l];return r===!0?d:(0,e.default)(d)}},i=n;return tt.default=i,tt}var at={},ba;function Ce(){if(ba)return at;ba=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=void 0;var t=function(c){return c*Math.PI/180},a=t;return at.default=a,at}var rt={},ya;function Ee(){if(ya)return rt;ya=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;var t=function(c){return c*180/Math.PI},a=t;return rt.default=a,rt}var Pa;function Er(){if(Pa)return Ve;Pa=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Ce()),c=i(Ee()),n=me();function i(r){return r&&r.__esModule?r:{default:r}}var u=function(l,d,s){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6371e3,_=(0,t.default)(l),h=(0,a.default)(l),p=d/v,y=(0,e.default)(s),S=(0,e.default)(_),C=(0,e.default)(h),B=Math.asin(Math.sin(S)*Math.cos(p)+Math.cos(S)*Math.sin(p)*Math.cos(y)),M=C+Math.atan2(Math.sin(y)*Math.sin(p)*Math.cos(S),Math.cos(p)-Math.sin(S)*Math.sin(B)),q=(0,c.default)(M);return(q<n.MINLON||q>n.MAXLON)&&(M=(M+3*Math.PI)%(2*Math.PI)-Math.PI,q=(0,c.default)(M)),{latitude:(0,c.default)(B),longitude:q}},o=u;return Ve.default=o,Ve}var nt={},ka;function Wr(){if(ka)return nt;ka=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var t=me(),a=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",u=t.areaConversion[i];if(u)return n*u;throw new Error("Invalid unit used for area conversion.")},e=a;return nt.default=e,nt}var it={},Sa;function zr(){if(Sa)return it;Sa=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var t=me(),a=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",u=t.distanceConversion[i];if(u)return n*u;throw new Error("Invalid unit used for distance conversion.")},e=a;return it.default=e,it}var ot={},Ma;function Fr(){if(Ma)return ot;Ma=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var t=me(),a=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kmh";switch(i){case"kmh":return n*t.timeConversion.h*t.distanceConversion.km;case"mph":return n*t.timeConversion.h*t.distanceConversion.mi;default:return n}},e=a;return ot.default=e,ot}var st={},La;function Vr(){if(La)return st;La=1,Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;function t(l,d){return i(l)||n(l,d)||e(l,d)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(l,d){if(l){if(typeof l=="string")return c(l,d);var s=Object.prototype.toString.call(l).slice(8,-1);if(s==="Object"&&l.constructor&&(s=l.constructor.name),s==="Map"||s==="Set")return Array.from(l);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return c(l,d)}}function c(l,d){(d==null||d>l.length)&&(d=l.length);for(var s=0,v=new Array(d);s<d;s++)v[s]=l[s];return v}function n(l,d){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(l)))){var s=[],v=!0,_=!1,h=void 0;try{for(var p=l[Symbol.iterator](),y;!(v=(y=p.next()).done)&&(s.push(y.value),!(d&&s.length===d));v=!0);}catch(S){_=!0,h=S}finally{try{!v&&p.return!=null&&p.return()}finally{if(_)throw h}}return s}}function i(l){if(Array.isArray(l))return l}var u=function(d){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,v=Math.pow(10,s);return Math.round(d*v)/v},o=function(d){var s=d.toString().split("."),v=t(s,2),_=v[0],h=v[1],p=Math.abs(Number(_)),y=+("0."+(h||0))*60,S=y.toString().split("."),C=Math.floor(y),B=u(+("0."+(S[1]||0))*60).toString(),M=B.split("."),q=t(M,2),x=q[0],$=q[1],N=$===void 0?"0":$;return p+"° "+C.toString().padStart(2,"0")+"' "+x.padStart(2,"0")+"."+N.padEnd(1,"0")+'"'},r=o;return st.default=r,st}var ut={},lt={},dt={},ct={},Da;function ir(){if(Da)return ct;Da=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var t=function(c){return c>1?1:c<-1?-1:c},a=t;return ct.default=a,ct}var Oa;function Ie(){if(Oa)return dt;Oa=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Ce()),c=i(ir()),n=me();function i(r){return r&&r.__esModule?r:{default:r}}var u=function(l,d){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;s=typeof s<"u"&&!isNaN(s)?s:1;var v=(0,t.default)(l),_=(0,a.default)(l),h=(0,t.default)(d),p=(0,a.default)(d),y=Math.acos((0,c.default)(Math.sin((0,e.default)(h))*Math.sin((0,e.default)(v))+Math.cos((0,e.default)(h))*Math.cos((0,e.default)(v))*Math.cos((0,e.default)(_)-(0,e.default)(p))))*n.earthRadius;return Math.round(y/s)*s},o=u;return dt.default=o,dt}var wa;function or(){if(wa)return lt;wa=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.default=void 0;var t=a(Ie());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default;return o=typeof o=="function"?o:t.default,u.slice().sort(function(r,l){return o(i,r)-o(i,l)})},c=e;return lt.default=c,lt}var Ca;function Kr(){if(Ca)return ut;Ca=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var t=a(or());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u){return(0,t.default)(i,u)[0]},c=e;return ut.default=c,ut}var ft={},Ra;function jr(){if(Ra)return ft;Ra=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.default=void 0;var t=n(Ce()),a=n(Pe()),e=n(ke()),c=me();function n(o){return o&&o.__esModule?o:{default:o}}var i=function(r){var l=0;if(r.length>2){for(var d,s,v,_=0;_<r.length;_++){_===r.length-2?(d=r.length-2,s=r.length-1,v=0):_===r.length-1?(d=r.length-1,s=0,v=1):(d=_,s=_+1,v=_+2);var h=(0,e.default)(r[d]),p=(0,a.default)(r[s]),y=(0,e.default)(r[v]);l+=((0,t.default)(y)-(0,t.default)(h))*Math.sin((0,t.default)(p))}l=l*c.earthRadius*c.earthRadius/2}return Math.abs(l)},u=i;return ft.default=u,ft}var vt={},qa;function sr(){if(qa)return vt;qa=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.default=void 0;var t=e(Pe()),a=e(ke());function e(i){return i&&i.__esModule?i:{default:i}}var c=function(u){if(Array.isArray(u)===!1||u.length===0)throw new Error("No points were given.");return u.reduce(function(o,r){var l=(0,t.default)(r),d=(0,a.default)(r);return{maxLat:Math.max(l,o.maxLat),minLat:Math.min(l,o.minLat),maxLng:Math.max(d,o.maxLng),minLng:Math.min(d,o.minLng)}},{maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0})},n=c;return vt.default=n,vt}var gt={},$a;function Hr(){if($a)return gt;$a=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Ce()),c=i(Ee()),n=me();function i(r){return r&&r.__esModule?r:{default:r}}var u=function(l,d){var s=(0,t.default)(l),v=(0,a.default)(l),_=(0,e.default)(s),h=(0,e.default)(v),p=d/n.earthRadius,y=_-p,S=_+p,C=(0,e.default)(n.MAXLAT),B=(0,e.default)(n.MINLAT),M=(0,e.default)(n.MAXLON),q=(0,e.default)(n.MINLON),x,$;if(y>B&&S<C){var N=Math.asin(Math.sin(p)/Math.cos(_));x=h-N,x<q&&(x+=Math.PI*2),$=h+N,$>M&&($-=Math.PI*2)}else y=Math.max(y,B),S=Math.min(S,C),x=q,$=M;return[{latitude:(0,c.default)(y),longitude:(0,c.default)(x)},{latitude:(0,c.default)(S),longitude:(0,c.default)($)}]},o=u;return gt.default=o,gt}var pt={},xa;function Xr(){if(xa)return pt;xa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Ce()),c=n(Ee());function n(o){return o&&o.__esModule?o:{default:o}}var i=function(r){if(Array.isArray(r)===!1||r.length===0)return!1;var l=r.length,d=r.reduce(function(h,p){var y=(0,e.default)((0,t.default)(p)),S=(0,e.default)((0,a.default)(p));return{X:h.X+Math.cos(y)*Math.cos(S),Y:h.Y+Math.cos(y)*Math.sin(S),Z:h.Z+Math.sin(y)}},{X:0,Y:0,Z:0}),s=d.X/l,v=d.Y/l,_=d.Z/l;return{longitude:(0,c.default)(Math.atan2(v,s)),latitude:(0,c.default)(Math.atan2(_,Math.sqrt(s*s+v*v)))}},u=i;return pt.default=u,pt}var _t={},Ta;function Ur(){if(Ta)return _t;Ta=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var t=a(sr());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i){var u=(0,t.default)(i),o=u.minLat+(u.maxLat-u.minLat)/2,r=u.minLng+(u.maxLng-u.minLng)/2;return{latitude:parseFloat(o.toFixed(6)),longitude:parseFloat(r.toFixed(6))}},c=e;return _t.default=c,_t}var mt={},ht={},Ba;function ur(){if(Ba)return ht;Ba=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Ce()),c=n(Ee());function n(o){return o&&o.__esModule?o:{default:o}}var i=function(r,l){var d=(0,e.default)((0,a.default)(l))-(0,e.default)((0,a.default)(r)),s=Math.log(Math.tan((0,e.default)((0,t.default)(l))/2+Math.PI/4)/Math.tan((0,e.default)((0,t.default)(r))/2+Math.PI/4));return Math.abs(d)>Math.PI&&(d>0?d=(Math.PI*2-d)*-1:d=Math.PI*2+d),((0,c.default)(Math.atan2(d,s))+360)%360},u=i;return ht.default=u,ht}var Aa;function Zr(){if(Aa)return mt;Aa=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var t=a(ur());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,r=typeof o=="function"?o(i,u):(0,t.default)(i,u);if(isNaN(r))throw new Error("Could not calculate bearing for given points. Check your bearing function");switch(Math.round(r/22.5)){case 1:return"NNE";case 2:return"NE";case 3:return"ENE";case 4:return"E";case 5:return"ESE";case 6:return"SE";case 7:return"SSE";case 8:return"S";case 9:return"SSW";case 10:return"SW";case 11:return"WSW";case 12:return"W";case 13:return"WNW";case 14:return"NW";case 15:return"NNW";default:return"N"}},c=e;return mt.default=c,mt}var bt={},Na;function lr(){if(Na)return bt;Na=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.default=void 0;var t=e(Ie()),a=e(ir());function e(i){return i&&i.__esModule?i:{default:i}}var c=function(u,o,r){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,d=(0,t.default)(o,u,l),s=(0,t.default)(u,r,l),v=(0,t.default)(o,r,l),_=Math.acos((0,a.default)((d*d+v*v-s*s)/(2*d*v))),h=Math.acos((0,a.default)((s*s+v*v-d*d)/(2*s*v)));return _>Math.PI/2?d:h>Math.PI/2?s:Math.sin(_)*d},n=c;return bt.default=n,bt}var yt={},Ia;function Yr(){if(Ia)return yt;Ia=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Ce()),c=n(Ee());function n(o){return o&&o.__esModule?o:{default:o}}var i=function(r,l){var d=(0,t.default)(l),s=(0,a.default)(l),v=(0,t.default)(r),_=(0,a.default)(r),h=((0,c.default)(Math.atan2(Math.sin((0,e.default)(s)-(0,e.default)(_))*Math.cos((0,e.default)(d)),Math.cos((0,e.default)(v))*Math.sin((0,e.default)(d))-Math.sin((0,e.default)(v))*Math.cos((0,e.default)(d))*Math.cos((0,e.default)(s)-(0,e.default)(_))))+360)%360;return h},u=i;return yt.default=u,yt}var Pt={},Ga;function Jr(){if(Ga)return Pt;Ga=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=a(Ie());function a(i){return i&&i.__esModule?i:{default:i}}function e(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(i)}var c=function(u){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.default;return u.reduce(function(r,l){return e(r)==="object"&&r.last!==null&&(r.distance+=o(l,r.last)),r.last=l,r},{last:null,distance:0}).distance},n=c;return Pt.default=n,Pt}var kt={},Ea;function Qr(){if(Ea)return kt;Ea=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Ce()),c=me();function n(o){return o&&o.__esModule?o:{default:o}}var i=function(r,l){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;d=typeof d<"u"&&!isNaN(d)?d:1;var s=(0,t.default)(r),v=(0,a.default)(r),_=(0,t.default)(l),h=(0,a.default)(l),p=6356752314245e-6,y=1/298.257223563,S=(0,e.default)(h-v),C,B,M,q,x,$,N=Math.atan((1-y)*Math.tan((0,e.default)(parseFloat(s)))),G=Math.atan((1-y)*Math.tan((0,e.default)(parseFloat(_)))),F=Math.sin(N),E=Math.cos(N),U=Math.sin(G),Z=Math.cos(G),ee=S,Y,se=100;do{var I=Math.sin(ee),P=Math.cos(ee);if($=Math.sqrt(Z*I*(Z*I)+(E*U-F*Z*P)*(E*U-F*Z*P)),$===0)return 0;C=F*U+E*Z*P,B=Math.atan2($,C),M=E*Z*I/$,q=1-M*M,x=C-2*F*U/q,isNaN(x)&&(x=0);var R=y/16*q*(4+y*(4-3*q));Y=ee,ee=S+(1-R)*y*M*(B+R*$*(x+R*C*(-1+2*x*x)))}while(Math.abs(ee-Y)>1e-12&&--se>0);if(se===0)return NaN;var A=q*(c.earthRadius*c.earthRadius-p*p)/(p*p),j=1+A/16384*(4096+A*(-768+A*(320-175*A))),V=A/1024*(256+A*(-128+A*(74-47*A))),w=V*$*(x+V/4*(C*(-1+2*x*x)-V/6*x*(-3+4*$*$)*(-3+4*x*x))),D=p*j*(B-w);return Math.round(D/d)*d},u=i;return kt.default=u,kt}var St={},Wa;function en(){if(Wa)return St;Wa=1,Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;var t=function(c){if(/^(NNE|NE|NNW|N)$/.test(c))return"N";if(/^(ENE|E|ESE|SE)$/.test(c))return"E";if(/^(SSE|S|SSW|SW)$/.test(c))return"S";if(/^(WSW|W|WNW|NW)$/.test(c))return"W"},a=t;return St.default=a,St}var Mt={},za;function tn(){if(za)return Mt;za=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var t=a(Ie());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,r=o(i,u),l=Number(u.time)-Number(i.time),d=r/l*1e3;return d},c=e;return Mt.default=c,Mt}var Lt={},Fa;function an(){if(Fa)return Lt;Fa=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=a(Ie());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u,o){return(0,t.default)(u,i)+(0,t.default)(i,o)===(0,t.default)(u,o)},c=e;return Lt.default=c,Lt}var Dt={},Va;function rn(){if(Va)return Dt;Va=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var t=e(Pe()),a=e(ke());function e(i){return i&&i.__esModule?i:{default:i}}var c=function(u,o){for(var r=!1,l=o.length,d=-1,s=l-1;++d<l;s=d)((0,a.default)(o[d])<=(0,a.default)(u)&&(0,a.default)(u)<(0,a.default)(o[s])||(0,a.default)(o[s])<=(0,a.default)(u)&&(0,a.default)(u)<(0,a.default)(o[d]))&&(0,t.default)(u)<((0,t.default)(o[s])-(0,t.default)(o[d]))*((0,a.default)(u)-(0,a.default)(o[d]))/((0,a.default)(o[s])-(0,a.default)(o[d]))+(0,t.default)(o[d])&&(r=!r);return r},n=c;return Dt.default=n,Dt}var Ot={},Ka;function nn(){if(Ka)return Ot;Ka=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var t=a(lr());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u,o,r){return(0,t.default)(i,u,o)<r},c=e;return Ot.default=c,Ot}var wt={},ja;function on(){if(ja)return wt;ja=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.default=void 0;var t=a(Ie());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(i,u,o){var r=.01;return(0,t.default)(i,u,r)<o},c=e;return wt.default=c,wt}var Ct={},Ha;function sn(){if(Ha)return Ct;Ha=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.default=void 0;function t(r,l){return i(r)||n(r,l)||e(r,l)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(r,l){if(r){if(typeof r=="string")return c(r,l);var d=Object.prototype.toString.call(r).slice(8,-1);if(d==="Object"&&r.constructor&&(d=r.constructor.name),d==="Map"||d==="Set")return Array.from(r);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return c(r,l)}}function c(r,l){(l==null||l>r.length)&&(l=r.length);for(var d=0,s=new Array(l);d<l;d++)s[d]=r[d];return s}function n(r,l){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(r)))){var d=[],s=!0,v=!1,_=void 0;try{for(var h=r[Symbol.iterator](),p;!(s=(p=h.next()).done)&&(d.push(p.value),!(l&&d.length===l));s=!0);}catch(y){v=!0,_=y}finally{try{!s&&h.return!=null&&h.return()}finally{if(v)throw _}}return d}}function i(r){if(Array.isArray(r))return r}var u=function(l){if(!l.startsWith("POLYGON"))throw new Error("Invalid wkt.");var d=l.slice(l.indexOf("(")+2,l.indexOf(")")).split(", "),s=d.map(function(v){var _=v.split(" "),h=t(_,2),p=h[0],y=h[1];return{longitude:parseFloat(p),latitude:parseFloat(y)}});return s},o=u;return Ct.default=o,Ct}var Xa;function un(){return Xa||(Xa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var a={computeDestinationPoint:!0,convertArea:!0,convertDistance:!0,convertSpeed:!0,decimalToSexagesimal:!0,findNearest:!0,getAreaOfPolygon:!0,getBounds:!0,getBoundsOfDistance:!0,getCenter:!0,getCenterOfBounds:!0,getCompassDirection:!0,getCoordinateKey:!0,getCoordinateKeys:!0,getDistance:!0,getDistanceFromLine:!0,getGreatCircleBearing:!0,getLatitude:!0,getLongitude:!0,getPathLength:!0,getPreciseDistance:!0,getRhumbLineBearing:!0,getRoughCompassDirection:!0,getSpeed:!0,isDecimal:!0,isPointInLine:!0,isPointInPolygon:!0,isPointNearLine:!0,isPointWithinRadius:!0,isSexagesimal:!0,isValidCoordinate:!0,isValidLatitude:!0,isValidLongitude:!0,orderByDistance:!0,sexagesimalToDecimal:!0,toDecimal:!0,toRad:!0,toDeg:!0,wktToPolygon:!0};Object.defineProperty(t,"computeDestinationPoint",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"convertArea",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"convertDistance",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"convertSpeed",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"decimalToSexagesimal",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"findNearest",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"getAreaOfPolygon",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"getBounds",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"getBoundsOfDistance",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"getCenter",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"getCenterOfBounds",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"getCompassDirection",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"getCoordinateKey",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"getCoordinateKeys",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"getDistance",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"getDistanceFromLine",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"getGreatCircleBearing",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"getLatitude",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(t,"getLongitude",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(t,"getPathLength",{enumerable:!0,get:function(){return q.default}}),Object.defineProperty(t,"getPreciseDistance",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(t,"getRhumbLineBearing",{enumerable:!0,get:function(){return $.default}}),Object.defineProperty(t,"getRoughCompassDirection",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"getSpeed",{enumerable:!0,get:function(){return G.default}}),Object.defineProperty(t,"isDecimal",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(t,"isPointInLine",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"isPointInPolygon",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(t,"isPointNearLine",{enumerable:!0,get:function(){return Z.default}}),Object.defineProperty(t,"isPointWithinRadius",{enumerable:!0,get:function(){return ee.default}}),Object.defineProperty(t,"isSexagesimal",{enumerable:!0,get:function(){return Y.default}}),Object.defineProperty(t,"isValidCoordinate",{enumerable:!0,get:function(){return se.default}}),Object.defineProperty(t,"isValidLatitude",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(t,"isValidLongitude",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(t,"orderByDistance",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"sexagesimalToDecimal",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(t,"toDecimal",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(t,"toRad",{enumerable:!0,get:function(){return V.default}}),Object.defineProperty(t,"toDeg",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"wktToPolygon",{enumerable:!0,get:function(){return D.default}});var e=m(Er()),c=m(Wr()),n=m(zr()),i=m(Fr()),u=m(Vr()),o=m(Kr()),r=m(jr()),l=m(sr()),d=m(Hr()),s=m(Xr()),v=m(Ur()),_=m(Zr()),h=m(Ft()),p=m(aa()),y=m(Ie()),S=m(lr()),C=m(Yr()),B=m(Pe()),M=m(ke()),q=m(Jr()),x=m(Qr()),$=m(ur()),N=m(en()),G=m(tn()),F=m(Vt()),E=m(an()),U=m(rn()),Z=m(nn()),ee=m(on()),Y=m(Kt()),se=m(nr()),I=m(ar()),P=m(rr()),R=m(or()),A=m(jt()),j=m(ra()),V=m(Ce()),w=m(Ee()),D=m(sn()),T=me();Object.keys(T).forEach(function(g){g==="default"||g==="__esModule"||Object.prototype.hasOwnProperty.call(a,g)||Object.defineProperty(t,g,{enumerable:!0,get:function(){return T[g]}})});function m(g){return g&&g.__esModule?g:{default:g}}}(Jt)),Jt}var ln=un();class dn{constructor(){qt(this,"stops",[])}async instantiate(){const e=await(await fetch("/stops.json")).json();this.stops=e.stops}findClosestStops(a,e=.5,c=3){return this.stops.map(u=>{const o=ln.getDistance({latitude:a[0],longitude:a[1]},{latitude:u.position.lat,longitude:u.position.lng})/1e3;return{name:u.name,position:u.position,dist_from_point:o}}).filter(u=>u.dist_from_point<=e).sort((u,o)=>u.dist_from_point-o.dist_from_point).slice(0,c)}}var cn=oe('<label for="spot-search-input" class="svelte-1bz9rsj"> </label>'),fn=(t,a)=>L(a,!0),vn=oe('<div class="loading-spinner svelte-1bz9rsj"></div>'),gn=oe('<button type="button" class="clear-searchbar svelte-1bz9rsj" aria-label="Clear"><img src="/clearsearchbar.svg" alt="Clear" class="clear-searchbar-icon svelte-1bz9rsj"/></button>'),pn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <div class="secondary-suggestion-text svelte-1bz9rsj"> </div></button></li>'),_n=(t,a,e)=>a(f(e)),mn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),hn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),bn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <!></button></li>'),yn=oe('<ul class="suggestions-list svelte-1bz9rsj"><!> <!></ul>'),Pn=oe('<div class="spot-search-bar svelte-1bz9rsj"><!> <div class="searchbar-wrapper svelte-1bz9rsj"><input id="spot-search-input" type="text"/> <!> <!></div></div>');function Ua(t,a){De(a,!0);const[e,c]=we(),n=()=>O(zt,"$locale",e),i=()=>O(At,"$userLocation",e),u=()=>O(B,"$yourLocationMessage",e);let o=ne(""),r=ne(Qt([])),l=ne(!1),d=null,s=ne(!1),v=null,_=Fe(a,"label",3,""),h=Fe(a,"placeholder",3,""),p=Fe(a,"error",3,!1),y=Fe(a,"value",3,""),S=Fe(a,"providedSpot",3,null);$e(async()=>{const{AutocompleteSuggestion:P}=await qr();d=P,v=S()});async function C(P){var R;if(d){L(l,!0);const A={input:P.input,includedRegionCodes:["ee"],region:"ee",language:n()},j=await d.fetchAutocompleteSuggestions(A);let V=[];if(j.suggestions&&j.suggestions.length>0)for(const w of j.suggestions){let D=await w.placePrediction.toPlace().fetchFields({fields:["location"]});V.push({name:w.placePrediction.mainText.text,secondaryText:((R=w.placePrediction.secondaryText)==null?void 0:R.text)??"",position:{lat:D.place.location.lat(),lng:D.place.location.lng()}})}return L(l,!1),V}return[]}pe(()=>{f(o)?C({input:f(o)}).then(P=>{L(r,P,!0)}):L(r,[],!0)}),pe(()=>{y()!==void 0&&y()!==null&&L(o,y())});const B=H("your_location");function M(P){var R;v=P,L(o,P.name,!0),L(s,!1),(R=a.onSelect)==null||R.call(a,P)}function q(){var R;if(!i())return;const P={name:u(),position:{lat:i().lat,lng:i().lng},secondaryText:`${i().lat}, ${i().lng}`};v=P,L(o,P.name,!0),L(s,!1),(R=a.onSelect)==null||R.call(a,P)}function x(){L(s,!1),v&&f(o)!==v.name&&L(o,v.name,!0)}function $(){var P;L(o,""),v=null,L(r,[],!0),L(s,!1),(P=a.onSelect)==null||P.call(a,null)}var N=Pn(),G=k(N);{var F=P=>{var R=cn(),A=k(R,!0);b(R),ce(()=>z(A,_())),ie(P,R)};de(G,P=>{_()&&P(F)})}var E=W(G,2),U=k(E);Or(U),U.__click=[fn,s];var Z=W(U,2);{var ee=P=>{var R=vn();ie(P,R)},Y=(P,R)=>{{var A=j=>{var V=gn();V.__click=$,ie(j,V)};de(P,j=>{f(o)&&j(A)},R)}};de(Z,P=>{f(l)?P(ee):P(Y,!1)})}var se=W(Z,2);{var I=P=>{var R=yn(),A=k(R);{var j=w=>{var D=pn(),T=k(D);T.__mousedown=q;var m=k(T),g=k(m,!0);b(m);var K=W(m,2),te=k(K);b(K),b(T),b(D),ce((X,ae)=>{z(g,u()),z(te,`${X??""}, ${ae??""}`)},[()=>i().lat.toFixed(5),()=>i().lng.toFixed(5)]),ie(w,D)};de(A,w=>{i()&&w(j)})}var V=W(A,2);Et(V,17,()=>f(r),Wt,(w,D)=>{var T=bn(),m=k(T);m.__mousedown=[_n,M,D];var g=k(m),K=k(g,!0);b(g);var te=W(g,2);{var X=ue=>{var le=mn(),J=k(le,!0);b(le),ce(()=>z(J,f(D).secondaryText)),ie(ue,le)},ae=ue=>{var le=hn(),J=k(le);b(le),ce((he,Re)=>z(J,`${he??""}, ${Re??""}`),[()=>f(D).position.lat.toFixed(5),()=>f(D).position.lng.toFixed(5)]),ie(ue,le)};de(te,ue=>{f(D).secondaryText?ue(X):ue(ae,!1)})}b(m),b(T),ce(()=>z(K,f(D).name)),ie(w,T)}),b(R),ie(P,R)};de(se,P=>{f(s)&&P(I)})}b(E),b(N),ce(()=>{qe(U,"placeholder",h()),Be(U,1,`spot-search ${p()?"error":""}`,"svelte-1bz9rsj")}),Bt("focus",U,()=>L(s,!0)),Bt("blur",U,x),Cr(U,()=>f(o),P=>L(o,P)),ie(t,N),Oe(),c()}Ae(["click","mousedown"]);function kn(t,a){var e,c;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishClearChosenSpots(),(c=a())==null||c.publishState("map-idle")}var Sn=(t,a)=>{L(a,!1)},Mn=oe('<button class="confirm-button svelte-3hy2qp"> </button>'),Ln=oe('<div class="component-container svelte-3hy2qp"><div class="spot-picking-container svelte-3hy2qp"><div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div class="buttons-container svelte-3hy2qp"><!> <button class="cancel-button svelte-3hy2qp"> </button></div></div></div>');function Dn(t,a){De(a,!0);const[e,c]=we(),n=()=>O(Ne,"$mqttClient",e),i=()=>O(Me,"$carStatus",e),u=()=>O(x,"$spotPickingPickupLabel",e),o=()=>O($,"$spotPickingPickupPlaceholder",e),r=()=>O(F,"$noStopsNearPickup",e),l=()=>O(N,"$spotPickingDestinationLabel",e),d=()=>O(G,"$spotPickingDestinationPlaceholder",e),s=()=>O(E,"$noStopsNearDestination",e),v=()=>O(U,"$confirmButtonText",e),_=()=>O(q,"$cancelButtonText",e);let h=ne(null),p=ne(null),y=ne(null),S=ne(!1),C=ne(!1),B=ne(!1),M=ne(!1);$e(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),L(h,new dn,!0),await f(h).instantiate(),i()&&i().chosen_spots&&i().chosen_spots.pickup&&i().chosen_spots.destination&&(L(B,!0),L(p,i().chosen_spots.pickup,!0),L(y,i().chosen_spots.destination,!0)),fe.set(!1),ve.set({key:"loading",params:{}})}),pe(()=>{var J,he,Re;if(f(p)&&f(y)&&f(h)){let We=f(h).findClosestStops([f(p).position.lat,f(p).position.lng]),ze=f(h).findClosestStops([f(y).position.lat,f(y).position.lng]);We.length===0&&L(S,!0),ze.length===0&&L(C,!0),We.length>0&&ze.length>0&&(L(M,!0),f(B)||(fe.set(!0),ve.set({key:"loading",params:{}}),(J=n())==null||J.publishChosenSpots(f(p),f(y)),(he=n())==null||he.publishFoundBusStops(We,ze),(Re=n())==null||Re.publishState("bus-stop-picking")))}});const q=H("spot_picking_cancel_button"),x=H("spot_picking_pickup_label"),$=H("spot_pickup_placeholder"),N=H("spot_picking_destination_label"),G=H("spot_destination_placeholder"),F=H("spot_pickup_no_bus_stop_found"),E=H("spot_destination_no_bus_stop_found"),U=H("spot_picking_confirm");var Z=Ln(),ee=k(Z),Y=k(ee),se=k(Y);const I=Te(()=>f(p)??null),P=Te(()=>{var J;return((J=f(p))==null?void 0:J.name)??""});Ua(se,{get label(){return u()},get placeholder(){return o()},get error(){return f(S)},get providedSpot(){return f(I)},get value(){return f(P)},onSelect:J=>{L(p,J,!0),L(S,!1)}});var R=W(se,2),A=k(R),j=k(A,!0);b(A),b(R),b(Y);var V=W(Y,2),w=k(V);const D=Te(()=>f(y)??null),T=Te(()=>{var J;return((J=f(y))==null?void 0:J.name)??""});Ua(w,{get label(){return l()},get placeholder(){return d()},get error(){return f(C)},get providedSpot(){return f(D)},get value(){return f(T)},onSelect:J=>{L(y,J,!0),L(C,!1)}});var m=W(w,2),g=k(m),K=k(g,!0);b(g),b(m),b(V);var te=W(V,2),X=k(te);{var ae=J=>{var he=Mn();he.__click=[Sn,B];var Re=k(he,!0);b(he),ce(()=>{he.disabled=!(f(M)&&f(p)&&f(y)&&!f(S)&&!f(C)),z(Re,v())}),ie(J,he)};de(X,J=>{f(B)&&J(ae)})}var ue=W(X,2);ue.__click=[kn,n];var le=k(ue,!0);b(ue),b(te),b(ee),b(Z),ce(()=>{Be(Y,1,`spot-search-bar-wrapper${f(S)?" error":""}`,"svelte-3hy2qp"),z(j,f(S)?r():""),Be(V,1,`spot-search-bar-wrapper${f(C)?" error":""}`,"svelte-3hy2qp"),z(K,f(C)?s():""),z(le,_())}),ie(t,Z),Oe(),c()}Ae(["click"]);class be{static async initialize(){if(!this.travelModeConstants||!this.directionsStatusConstants){const{TravelMode:a,DirectionsStatus:e}=await oa();this.travelModeConstants=a,this.directionsStatusConstants=e}}static async getRoute(a){await this.initialize();const{DirectionsService:e}=await oa(),n=await new e().route(a);return n.status===this.directionsStatusConstants.OK?{pathArray:n.routes[0].overview_path.map(u=>({lat:u.lat(),lng:u.lng()})),bounds:n.routes[0].bounds}:null}static async calculatePreliminaryRoutes(a,e,c,n="en",i=!0){if(await this.initialize(),!a||!e||!c){console.warn("RouteService: Missing required data for route calculation");return}const u=a;if(!u.pickup||!u.destination){console.warn("RouteService: Invalid chosen spots data");return}const o={origin:{lat:u.pickup.position.lat,lng:u.pickup.position.lng},destination:{lat:e.position.lat,lng:e.position.lng},travelMode:this.travelModeConstants.WALKING,language:n,region:"ee"},r={origin:{lat:e.position.lat,lng:e.position.lng},destination:{lat:c.position.lat,lng:c.position.lng},travelMode:this.travelModeConstants.DRIVING,language:n,region:"ee"},l={origin:{lat:c.position.lat,lng:c.position.lng},destination:{lat:u.destination.position.lat,lng:u.destination.position.lng},travelMode:this.travelModeConstants.WALKING,language:n,region:"ee"};if(i){const[d,s,v]=await Promise.all([this.getRoute(o),this.getRoute(r),this.getRoute(l)]);Nt.set(d),xt.set(s),It.set(v)}else{const[d,s]=await Promise.all([this.getRoute(o),this.getRoute(l)]);Nt.set(d),It.set(s)}}static nullDrivingRoutes(){xt.set(null),ta.set(null)}static async calculateCarRouteHelper(a,e){const{LatLngBounds:c}=await er(),n=new c;let i=[];if(a)for(const u of a)n.extend({lat:u[0],lng:u[1]}),i.push({lat:u[0],lng:u[1]});else e&&n.extend({lat:e.position.lat,lng:e.position.lng});return{mappedWaypoints:i,latLngBounds:n}}static async calculateCarToPickupRoute(a,e){const{mappedWaypoints:c,latLngBounds:n}=await this.calculateCarRouteHelper(a,e);ta.set({pathArray:c,bounds:n})}static async calculatePickupBusStopToDestinationRoute(a,e){const{mappedWaypoints:c,latLngBounds:n}=await this.calculateCarRouteHelper(a,e);xt.set({pathArray:c,bounds:n})}}qt(be,"travelModeConstants",null),qt(be,"directionsStatusConstants",null);function On(t,a){var e,c;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishClearFoundBusStops(),(c=a())==null||c.publishState("spot-picking")}var wn=(t,a)=>L(a,!f(a)),Cn=(t,a,e)=>a(f(e)),Rn=oe('<button type="button" role="option"> </button>'),qn=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="pickup-dropdown"></div>'),$n=(t,a)=>L(a,!f(a)),xn=(t,a,e)=>a(f(e)),Tn=oe('<button type="button" role="option"> </button>'),Bn=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="destination-dropdown"></div>'),An=oe('<button class="order-car-button svelte-5klcor"> </button>'),Nn=oe('<div class="bus-stop-picking svelte-5klcor"><div class="dropdowns-container svelte-5klcor"><h2 class="svelte-5klcor"> </h2> <div class="dropdown-group svelte-5klcor"><label for="pickup-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="pickup-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div> <div class="dropdown-group svelte-5klcor"><label for="destination-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="destination-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div></div> <div class="buttons-container svelte-5klcor"><!> <button class="back-button svelte-5klcor"> </button></div></div>');function In(t,a){De(a,!0);const[e,c]=we(),n=()=>O(zt,"$locale",e),i=()=>O(Me,"$carStatus",e),u=()=>O(Ne,"$mqttClient",e),o=()=>O(F,"$busStopPickHeadingText",e),r=()=>O(E,"$busStopPickupText",e),l=()=>O(U,"$busStopDestinationText",e),d=()=>O(N,"$orderCarText",e),s=()=>O(G,"$backButtonText",e);let v=ne(!1),_=ne(!1),h=ne(null),p=ne(Qt([])),y=ne(Qt([])),S=ne(null),C=ne(null);$e(async()=>{Rt.set({top:400,bottom:100}),await be.initialize(),f(S)&&f(C)&&f(h)&&(be.calculatePreliminaryRoutes(f(h),f(S),f(C),n()),f(_)||(Le.set("all"),L(_,!0)))}),pe(()=>{i()&&i().found_bus_stops&&i().chosen_spots&&!f(v)&&(L(p,i().found_bus_stops.pickup,!0),L(y,i().found_bus_stops.destination,!0),L(S,f(p)[0],!0),L(C,f(y)[0],!0),L(h,i().chosen_spots,!0),fe.set(!1),ve.set({key:"loading",params:{}}),L(v,!0))}),pe(()=>{f(S)&&f(C)&&f(h)&&(be.calculatePreliminaryRoutes(f(h),f(S),f(C),n()),f(_)||(Le.set("all"),L(_,!0)))});function B(){var Q,ge;if(f(S)&&f(C)){fe.set(!0),ve.set({key:"loading",params:{}}),(Q=u())==null||Q.publishChosenRouteStops(f(S),f(C)),(ge=u())==null||ge.publishGoal(f(S).position);const xe=Me.subscribe(ye=>{var _e;ye&&ye.are_waypoints_sent&&(be.nullDrivingRoutes(),(_e=u())==null||_e.publishState("driving-to-pickup"),xe())})}}let M=ne(!1),q=ne(!1);function x(Q){L(S,Q,!0),L(M,!1),Le.set("pickup")}function $(Q){L(C,Q,!0),L(q,!1),Le.set("destination")}const N=H("bus_stop_order_car_button"),G=H("bus_stop_back_button"),F=H("bus_stop_pick_heading"),E=H("bus_stop_pickup"),U=H("bus_stop_destination");let Z=ne(void 0),ee=ne(void 0);function Y(Q){f(M)&&f(Z)&&!f(Z).contains(Q.target)&&L(M,!1)}function se(Q){f(q)&&f(ee)&&!f(ee).contains(Q.target)&&L(q,!1)}pe(()=>{if(f(M))return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)}),pe(()=>{if(f(q))return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)});var I=Nn(),P=k(I),R=k(P),A=k(R,!0);b(R);var j=W(R,2),V=k(j),w=k(V,!0);b(V);var D=W(V,2),T=k(D);T.__click=[wn,M];var m=k(T),g=W(m);b(T);var K=W(T,2);{var te=Q=>{var ge=qn();Et(ge,21,()=>f(p),Wt,(xe,ye)=>{var _e=Rn();_e.__click=[Cn,x,ye];var Xt=k(_e,!0);b(_e),ce(()=>{Be(_e,1,`dropdown-item ${f(S)&&f(ye).name===f(S).name?"selected":""}`,"svelte-5klcor"),qe(_e,"aria-selected",f(S)&&f(ye).name===f(S).name),z(Xt,f(ye).name)}),ie(xe,_e)}),b(ge),ie(Q,ge)};de(K,Q=>{f(M)&&Q(te)})}b(D),ea(D,Q=>L(Z,Q),()=>f(Z)),b(j);var X=W(j,2),ae=k(X),ue=k(ae,!0);b(ae);var le=W(ae,2),J=k(le);J.__click=[$n,q];var he=k(J),Re=W(he);b(J);var We=W(J,2);{var ze=Q=>{var ge=Bn();Et(ge,21,()=>f(y),Wt,(xe,ye)=>{var _e=Tn();_e.__click=[xn,$,ye];var Xt=k(_e,!0);b(_e),ce(()=>{Be(_e,1,`dropdown-item ${f(C)&&f(ye).name===f(C).name?"selected":""}`,"svelte-5klcor"),qe(_e,"aria-selected",f(C)&&f(ye).name===f(C).name),z(Xt,f(ye).name)}),ie(xe,_e)}),b(ge),ie(Q,ge)};de(We,Q=>{f(q)&&Q(ze)})}b(le),ea(le,Q=>L(ee,Q),()=>f(ee)),b(X),b(P);var na=W(P,2),ia=k(na);{var dr=Q=>{var ge=An();ge.__click=B;var xe=k(ge,!0);b(ge),ce(()=>z(xe,d())),ie(Q,ge)};de(ia,Q=>{f(S)&&f(C)&&Q(dr)})}var Ht=W(ia,2);Ht.__click=[On,u];var cr=k(Ht,!0);b(Ht),b(na),b(I),ce(()=>{var Q,ge;z(A,o()),z(w,r()),qe(T,"aria-expanded",f(M)),z(m,`${((Q=f(S))==null?void 0:Q.name)??""} `),Be(g,0,`dropdown-arrow${f(M)?" open":""}`,"svelte-5klcor"),z(ue,l()),qe(J,"aria-expanded",f(q)),z(he,`${((ge=f(C))==null?void 0:ge.name)??""} `),Be(Re,0,`dropdown-arrow${f(q)?" open":""}`,"svelte-5klcor"),z(cr,s())}),ie(t,I),Oe(),c()}Ae(["click"]);var Gn=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),En=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),Wn=oe('<div class="driving-info-container svelte-rznqub"><div class="driving-info-card svelte-rznqub"><!></div></div>');function Za(t,a){var Z,ee,Y,se;De(a,!0);const[e,c]=we(),n=()=>O(zt,"$locale",e),i=()=>O(Me,"$carStatus",e),u=()=>O(Ne,"$mqttClient",e),o=()=>O(p,"$drivingToPickupInfoText",e),r=()=>O(S,"$carSpeedHeadingText",e),l=()=>O(f(B),"$carSpeedInfoText",e),d=()=>O(M,"$chosenPickupHeadingText",e),s=()=>O(q,"$chosenPickupSpotText",e),v=()=>O(y,"$drivingToDestinationInfoText",e),_=()=>O(x,"$chosenDestinationHeadingText",e),h=()=>O($,"$chosenDestinationSpotText",e);$e(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),Rt.set({top:400,bottom:100});async function I(){return new Promise(R=>{let A;A=Me.subscribe(j=>{j&&(typeof A=="function"&&A(),R(j))})})}const P=await I();await be.initialize(),await be.calculatePreliminaryRoutes(P.chosen_spots,P.chosen_route_stops.pickup,P.chosen_route_stops.destination,n(),!1),Qa.set(!0),a.type=="pickup"?(await be.calculateCarToPickupRoute(P.route,P.chosen_route_stops.pickup),Le.set("carToPickup")):a.type=="destination"&&(await be.calculatePickupBusStopToDestinationRoute(P.route,P.chosen_route_stops.destination),Le.set("all")),fe.set(!1),ve.set({key:"loading",params:{}})}),pe(()=>{var I,P;i()&&i().are_waypoints_sent&&i().route.length===0&&(a.type==="pickup"?(I=u())==null||I.publishState("arrived-to-pickup"):a.type==="destination"&&((P=u())==null||P.publishState("arrived-to-destination")))});const p=H("driving_to_pickup_info"),y=H("driving_to_destination_info"),S=H("car_speed_heading");let C=Te(()=>{var I;return(I=i())!=null&&I.speed?i().speed.toFixed(1):"0.0"});const B=Te(()=>H("car_speed_info",{speed:f(C)})),M=H("chosen_pickup_heading"),q=H("chosen_pickup_spot",{spot_name:(Z=i())!=null&&Z.chosen_route_stops&&"pickup"in i().chosen_route_stops&&((ee=i().chosen_route_stops.pickup)!=null&&ee.name)?i().chosen_route_stops.pickup.name:""}),x=H("chosen_destination_heading"),$=H("chosen_destination_spot",{spot_name:(Y=i())!=null&&Y.chosen_route_stops&&"destination"in i().chosen_route_stops&&((se=i().chosen_route_stops.destination)!=null&&se.name)?i().chosen_route_stops.destination.name:""});var N=Wn(),G=k(N),F=k(G);{var E=I=>{var P=Gn(),R=Tt(P),A=k(R,!0);b(R);var j=W(R,2),V=k(j),w=k(V,!0);b(V);var D=W(V,2),T=k(D,!0);b(D),b(j);var m=W(j,2),g=k(m),K=k(g,!0);b(g);var te=W(g,2),X=k(te,!0);b(te),b(m),ce(()=>{z(A,o()),z(w,r()),z(T,l()),z(K,d()),z(X,s())}),ie(I,P)},U=(I,P)=>{{var R=A=>{var j=En(),V=Tt(j),w=k(V,!0);b(V);var D=W(V,2),T=k(D),m=k(T,!0);b(T);var g=W(T,2),K=k(g,!0);b(g),b(D);var te=W(D,2),X=k(te),ae=k(X,!0);b(X);var ue=W(X,2),le=k(ue,!0);b(ue),b(te),ce(()=>{z(w,v()),z(m,r()),z(K,l()),z(ae,_()),z(le,h())}),ie(A,j)};de(I,A=>{a.type==="destination"&&A(R)},P)}};de(F,I=>{a.type==="pickup"?I(E):I(U,!1)})}b(G),b(N),ie(t,N),Oe(),c()}var zn=oe('<div class="arrived-info-container svelte-1pss86t"><div class="arrived-info-card svelte-1pss86t"><h2 class="arrived-heading svelte-1pss86t"> </h2> <div class="button-container svelte-1pss86t"><h3 class="arrived-subheading svelte-1pss86t"> </h3> <button class="arrived-confirm-btn svelte-1pss86t"> </button></div></div></div>');function Ya(t,a){De(a,!0);const[e,c]=we(),n=()=>O(Nt,"$pathChosenPickupToBusStopPickup",e),i=()=>O(It,"$pathBusStopDestinationToChosenDestination",e),u=()=>O(Me,"$carStatus",e),o=()=>O(zt,"$locale",e),r=()=>O(Ne,"$mqttClient",e),l=()=>O(_,"$confirmHeadingMessage",e),d=()=>O(h,"$confirmButtonHeadingMessage",e),s=()=>O(p,"$confirmButtonMessage",e);$e(async()=>{var G,F,E;Rt.set({top:400,bottom:100}),await be.initialize(),(!n()||!i())&&await be.calculatePreliminaryRoutes(((G=u())==null?void 0:G.chosen_spots)??null,((F=u())==null?void 0:F.chosen_route_stops.pickup)??null,((E=u())==null?void 0:E.chosen_route_stops.destination)??null,o(),!1),a.type=="pickup"?Le.set("pickup"):a.type=="destination"&&Le.set("destination")});async function v(){var G,F,E,U,Z,ee,Y;if(fe.set(!0),ve.set({key:"loading",params:{}}),(G=r())==null||G.publishClearAreWaypointsSent(),await new Promise(se=>{var P;if(!((P=u())!=null&&P.are_waypoints_sent)){se();return}const I=Me.subscribe(R=>{R&&!R.are_waypoints_sent&&(I(),se())})}),a.type==="pickup"){const se=(F=u())==null?void 0:F.chosen_route_stops.destination.position;(E=r())==null||E.publishGoal(se);let I;I=Me.subscribe(P=>{var R;P&&P.are_waypoints_sent&&(be.nullDrivingRoutes(),(R=r())==null||R.publishState("driving-to-destination"),I==null||I())})}else a.type==="destination"&&((U=r())==null||U.publishClearChosenSpots(),(Z=r())==null||Z.publishClearFoundBusStops(),(ee=r())==null||ee.publishClearChosenRouteStops(),kr(),(Y=r())==null||Y.publishState("rating"))}const _=a.type==="pickup"?H("arrived_at_pickup_info"):H("arrived_at_destination_info"),h=a.type==="pickup"?H("confirm_in_car_info"):H("confirm_destination_info"),p=a.type==="pickup"?H("confirm_in_car_button"):H("confirm_destination_button");var y=zn(),S=k(y),C=k(S),B=k(C,!0);b(C);var M=W(C,2),q=k(M),x=k(q,!0);b(q);var $=W(q,2);$.__click=v;var N=k($,!0);b($),b(M),b(S),b(y),ce(()=>{z(B,l()),z(x,d()),z(N,s())}),ie(t,y),Oe(),c()}Ae(["click"]);var Fn=oe('<button type="button" class="star-btn svelte-rv59cl"><img class="star svelte-rv59cl"/></button>'),Vn=(t,a)=>{var e;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishState("map-idle")},Kn=oe('<div class="rating-overlay svelte-rv59cl"><div class="rating-card svelte-rv59cl"><h2 class="rating-heading svelte-rv59cl"> </h2> <div class="stars svelte-rv59cl"></div> <button class="skip-btn svelte-rv59cl"> </button></div></div>');function jn(t,a){De(a,!0);const[e,c]=we(),n=()=>O(Ne,"$mqttClient",e),i=()=>O(h,"$ratingHeadingText",e),u=()=>O(p,"$ratingRefuseText",e);let o=ne(0),r=ne(0),l=ne(""),d=ne("");$e(async()=>{Rt.set({top:200,bottom:200}),L(l,await Gt("/star_filled.svg"),!0),L(d,await Gt("/star_empty.svg"),!0),fe.set(!1),ve.set({key:"loading",params:{}})});function s($){var N,G;L(o,$,!0),fe.set(!0),ve.set({key:"loading",params:{}}),(N=n())==null||N.publishRating(f(o),new Date().toISOString()),(G=n())==null||G.publishState("map-idle")}function v($){L(r,$,!0)}function _(){L(r,0)}const h=H("rating_heading"),p=H("rating_refuse");var y=Kn(),S=k(y),C=k(S),B=k(C,!0);b(C);var M=W(C,2);Et(M,20,()=>Array.from({length:5}),Wt,($,N,G)=>{var F=Fn();F.__click=()=>s(G+1),qe(F,"aria-label",`Rate ${G+1} star${G===0?"":"s"}`);var E=k(F);qe(E,"alt",G+1+" star"),b(F),ce(()=>qe(E,"src",(f(r)?G<f(r):G<f(o))?f(l):f(d))),Bt("mouseenter",F,()=>v(G+1)),Bt("mouseleave",F,_),ie($,F)}),b(M);var q=W(M,2);q.__click=[Vn,n];var x=k(q,!0);b(q),b(S),b(y),ce(()=>{z(B,i()),z(x,u())}),ie(t,y),Oe(),c()}Ae(["click"]);var Hn=oe('<div class="app-root"><!> <!></div>');function ii(t,a){De(a,!0);const[e,c]=we(),n=()=>O(Ne,"$mqttClient",e),i=()=>O(Me,"$carStatus",e),u=()=>O(Mr,"$sessionId",e),o=()=>O(ve,"$appGlobalLoadingMessageKey",e),r=()=>O(Se,"$appState",e),l=()=>O(fe,"$appGlobalLoading",e),d=()=>O(f(_),"$appGlobalLoadingMessage",e);let s=ne(!1);$e(()=>{let M=null,q=0;return navigator.geolocation?M=navigator.geolocation.watchPosition(x=>{const $=Date.now();$-q>=500&&(At.set({lat:x.coords.latitude,lng:x.coords.longitude}),q=$)},x=>{console.warn("Geolocation denied or unavailable:",x)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:1e3}):(At.set(null),console.warn("Geolocation not supported")),()=>{M!==null&&navigator.geolocation.clearWatch(M)}}),pe(()=>{n()||Pr("/login")});let v=null;pe(()=>{if(n()&&i()){if(i().state===v)return;switch(v=i().state,i().state){case"None":n().publishState("map-idle"),L(s,!0),Se.set("map-idle");break;case"map-idle":L(s,!0),Se.set("map-idle");break;case"spot-picking":L(s,!1),Se.set("spot-picking");break;case"bus-stop-picking":L(s,!0),Se.set("bus-stop-picking");break;case"driving-to-pickup":L(s,!0),Se.set("driving-to-pickup");break;case"arrived-to-pickup":L(s,!0),Se.set("arrived-to-pickup");break;case"driving-to-destination":L(s,!0),Se.set("driving-to-destination");break;case"arrived-to-destination":L(s,!0),Se.set("arrived-to-destination");break;case"rating":L(s,!1),Se.set("rating");break;case"shutting-down":fe.set(!0),ve.set({key:"car_shutting_down"}),L(s,!1);const M=u()??"";Sr.set({key:"session_closed",params:{id:M}}),Ja();break;default:L(s,!1),console.error("Unknown car status state:",JSON.stringify(i().state));break}}});const _=Te(()=>o()?H(o().key,o().params):null);var h=Hn(),p=k(h);{var y=M=>{Ar(M,{children:(q,x)=>{var $=yr(),N=Tt($);{var G=E=>{Gr(E,{})},F=(E,U)=>{{var Z=Y=>{In(Y,{})},ee=(Y,se)=>{{var I=R=>{Za(R,{type:"pickup"})},P=(R,A)=>{{var j=w=>{Ya(w,{type:"pickup"})},V=(w,D)=>{{var T=g=>{Za(g,{type:"destination"})},m=(g,K)=>{{var te=X=>{Ya(X,{type:"destination"})};de(g,X=>{r()==="arrived-to-destination"&&X(te)},K)}};de(w,g=>{r()==="driving-to-destination"?g(T):g(m,!1)},D)}};de(R,w=>{r()==="arrived-to-pickup"?w(j):w(V,!1)},A)}};de(Y,R=>{r()==="driving-to-pickup"?R(I):R(P,!1)},se)}};de(E,Y=>{r()==="bus-stop-picking"?Y(Z):Y(ee,!1)},U)}};de(N,E=>{r()==="map-idle"?E(G):E(F,!1)})}ie(q,$)},$$slots:{default:!0}})},S=(M,q)=>{{var x=N=>{Dn(N,{})},$=(N,G)=>{{var F=E=>{jn(E,{})};de(N,E=>{r()==="rating"&&E(F)},G)}};de(M,N=>{r()==="spot-picking"?N(x):N($,!1)},q)}};de(p,M=>{f(s)?M(y):M(S,!1)})}var C=W(p,2);{var B=M=>{Dr(M,{get loadingMsg(){return d()}})};de(C,M=>{l()&&M(B)})}b(h),ie(t,h),Oe(),c()}export{ii as component};
