var vr=Object.defineProperty;var gr=(t,a,e)=>a in t?vr(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var wt=(t,a,e)=>gr(t,typeof a!="symbol"?a+"":a,e);import"../chunks/CWj6FrbW.js";import{aJ as pr,aK as _r,O as mr,d as hr,a3 as br,z as Te,p as Se,o as qe,s as w,C as Y,b as pe,f as d,A as ne,G as $t,F as E,D as k,E as y,H as yr,I as ge,J as V,B as ee,a as Oe,n as Pr,aI as xt,K as Me,aG as kr}from"../chunks/CM7s3TdM.js";import{a as O,b as Qt,s as we,i as ue}from"../chunks/CZY1Q9bT.js";import{g as Mr}from"../chunks/8Y0VQYtZ.js";import{e as ce,f as fe,c as St,u as Tt,p as ea,g as Ct,h as Bt,i as Nt,j as he,k as De,n as Ot,r as Ja,o as Qa,l as Et,q as qt,t as ta,b as Vt,v as Lr,d as Dr,s as Sr}from"../chunks/DZQUrvsV.js";import{_ as Or,p as Ne}from"../chunks/CvhVpWJc.js";import{f as At,L as wr}from"../chunks/DKuJeQhF.js";import{t as K,r as Rr,s as Ce,a as xe,e as It,i as Gt}from"../chunks/ilezGdhm.js";import"../chunks/PCJ5bLI3.js";import{i as Cr}from"../chunks/DJhY8YgZ.js";function qr(t,a,e=a){var f=pr();_r(t,"input",n=>{var r=n?t.defaultValue:t.value;if(r=Ut(t)?Zt(r):r,e(r),f&&r!==(r=a())){var o=t.selectionStart,s=t.selectionEnd;t.value=r??"",s!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(s,t.value.length))}}),(mr&&t.defaultValue!==t.value||hr(a)==null&&t.value)&&e(Ut(t)?Zt(t.value):t.value),br(()=>{var n=a();Ut(t)&&n===Zt(t.value)||t.type==="date"&&!n&&!t.value||n!==t.value&&(t.value=n??"")})}function Ut(t){var a=t.type;return a==="number"||a==="range"}function Zt(t){return t===""?null:+t}let Yt=null,Rt=null;async function Ae(){return Rt||(Yt||(Yt=(async()=>{const t=await Or(()=>import("../chunks/D-8nYH0_.js"),[],import.meta.url),a=t.Loader||t.default&&t.default.Loader;if(!a)throw new Error("Could not load Google Maps Loader");return Rt=new a({apiKey:"AIzaSyAixRzVqb7kii3XrzzL3OxsN7k_2CoMeaM",version:"weekly"}),Rt})()),Yt)}async function er(){return await(await Ae()).importLibrary("core")}async function tr(){return await(await Ae()).importLibrary("maps")}async function $r(){return await(await Ae()).importLibrary("marker")}async function xr(){return await(await Ae()).importLibrary("places")}async function oa(){return await(await Ae()).importLibrary("routes")}async function Tr(){return await(await Ae()).importLibrary("geometry")}async function Br(t,a={}){const{Map:e}=await tr();return new e(t,a)}function Nr(){ce.set(!0),fe.set({key:"ending_session",params:{}}),Ja()}var Ar=ne('<div class="map-container svelte-1bz92gb"></div> <button class="end-session-button svelte-1bz92gb"> </button> <!>',1);function Ir(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(Qa,"$isDriving",e),r=()=>O(St,"$carStatus",e),o=()=>O(Tt,"$userLocation",e),s=()=>O(ea,"$pathCarToBusStopPickup",e),i=()=>O(Ct,"$pathBusStopPickupToBusStopDestination",e),l=()=>O(Bt,"$pathChosenPickupToBusStopPickup",e),u=()=>O(Nt,"$pathBusStopDestinationToChosenDestination",e),c=()=>O(he,"$appState",e),v=()=>O(De,"$fitBoundsTarget",e),p=()=>O(Ot,"$fitBoundsVerticalPadding",e),h=()=>O(oe,"$endSessionText",e);let M,m=null,S=Y(null),R=Y(null),B=Y(null),L=Y(null),C=Y(null),q=Y(null),$=null,N=null,F=null,z=null,X=null,le=null;async function I(P,b){for(;!m;)await new Promise(_=>setTimeout(_,10));if(P){const _={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},g={path:X,strokeOpacity:1,scale:4},T={path:le,strokeOpacity:1,scale:4};return b?P.setOptions({strokeOpacity:0,icons:[{icon:_,offset:"0",repeat:"20px"},{icon:g,offset:"0",repeat:"0"},{icon:T,offset:"100%",repeat:"0"}],visible:!1,map:m,zIndex:1}):P.setOptions({strokeColor:"#FF0000",strokeWeight:4,icons:[{icon:g,offset:"0",repeat:"0"},{icon:T,offset:"100%",repeat:"0"}],visible:!1,map:m}),P.setMap(m),P}return null}function ie(P,b){if(!b||b.length<2)return{index:0,progress:0};let _=1/0,g=0,T=0;for(let G=0;G<b.length-1;G++){const ae=b[G],se=b[G+1],J=te(P,ae,se),de=Z(ae,se,J),A=google.maps.geometry.spherical.computeDistanceBetween(P,de);A<_&&(_=A,g=G,T=J)}return{index:g,progress:T}}function te(P,b,_){const g=b.lat(),T=b.lng(),G=_.lat(),ae=_.lng(),se=P.lat(),J=P.lng(),de=ae-T,A=G-g,ve=de*de+A*A;if(ve===0)return 0;const $e=((J-T)*de+(se-g)*A)/ve;return Math.max(0,Math.min(1,$e))}function Z(P,b,_){const g=P.lat()+(b.lat()-P.lat())*_,T=P.lng()+(b.lng()-P.lng())*_;return new google.maps.LatLng(g,T)}function U(P,b,_,g){if(!P||!m)return b;const T=P.getPath().getArray();if(T.length<2)return b;const{index:G,progress:ae}=ie(_,T),se=[];for(let J=0;J<=G;J++)se.push(T[J]);if(ae>0&&G<T.length-1){const J=Z(T[G],T[G+1],ae);se.push(J)}if(!b){let J="#FF0000";n()&&(J="#00AA00"),b=new google.maps.Polyline({map:m,strokeColor:J,strokeWeight:4,strokeOpacity:1,zIndex:1})}return b.setPath(se),b}qe(async()=>{var G;ce.set(!0),fe.set({key:"loading_map",params:{}}),m=await Br(M,{center:{lat:58.378,lng:26.729},zoom:13,disableDefaultUI:!0,mapId:"DEMO_MAP_ID"});const{AdvancedMarkerElement:P}=await $r(),{SymbolPath:b}=await er();await Tr(),X=b.CIRCLE,le=b.FORWARD_OPEN_ARROW,F=await At("/usermarker.svg"),z=await At("/carmarker.svg");const _=document.createElement("img");_.src=z,_.style.width="48px",_.style.height="48px",N=new P({position:(G=r())==null?void 0:G.pose,map:m,content:_});const g=document.createElement("img");g.src=F,g.style.width="32px",g.style.height="32px",$=new P({map:m,content:g});const{Polyline:T}=await tr();w(S,await I(new T,!0),!0),w(R,await I(new T,!1),!0),w(B,await I(new T,!0),!0),w(L,await I(new T,!1),!0),w(C,null),w(q,null),ce.set(!1),fe.set({key:"loading",params:{}})}),pe(()=>{o()&&$&&typeof o().lat=="number"&&typeof o().lng=="number"&&!isNaN(o().lat)&&!isNaN(o().lng)&&($.position=o())}),pe(()=>{var P;if((P=r())!=null&&P.pose&&N&&typeof r().pose.lat=="number"&&typeof r().pose.lng=="number"&&!isNaN(r().pose.lat)&&!isNaN(r().pose.lng)){N.position=r().pose;const b=new google.maps.LatLng(r().pose.lat,r().pose.lng);d(L)&&s()&&w(q,U(d(L),d(q),b),!0),d(R)&&i()&&w(C,U(d(R),d(C),b),!0)}}),pe(()=>{o()&&$&&($.position=o())}),pe(()=>{var P,b;l()&&d(S)?(d(S).setPath(l().pathArray),d(S).setVisible(!0)):(P=d(S))!=null&&P.getVisible()&&((b=d(S))==null||b.setVisible(!1))}),pe(()=>{var P,b;i()&&d(R)?(d(R).setPath(i().pathArray),d(R).setVisible(!0)):(P=d(R))!=null&&P.getVisible()&&((b=d(R))==null||b.setVisible(!1),d(C)&&(d(C).setMap(null),w(C,null)))}),pe(()=>{var P,b;u()&&d(B)?(d(B).setPath(u().pathArray),d(B).setVisible(!0)):(P=d(B))!=null&&P.getVisible()&&((b=d(B))==null||b.setVisible(!1))}),pe(()=>{var P,b;s()&&d(L)?(d(L).setPath(s().pathArray),d(L).setVisible(!0)):(P=d(L))!=null&&P.getVisible()&&((b=d(L))==null||b.setVisible(!1),d(q)&&(d(q).setMap(null),w(q,null)))}),pe(()=>{var P,b,_,g;c().includes("arrived")&&((P=d(C))==null||P.setMap(null),(b=d(R))==null||b.setVisible(!1),(_=d(q))==null||_.setMap(null),(g=d(L))==null||g.setVisible(!1))}),pe(()=>{var P,b,_,g,T,G,ae;if(v()==="all"){if((P=l())!=null&&P.bounds&&((b=i())!=null&&b.bounds)&&((_=u())!=null&&_.bounds)){const se=new google.maps.LatLngBounds(l().bounds.getSouthWest(),l().bounds.getNorthEast()),J=new google.maps.LatLngBounds(i().bounds.getSouthWest(),i().bounds.getNorthEast()),de=new google.maps.LatLngBounds(u().bounds.getSouthWest(),u().bounds.getNorthEast());se.union(J),se.union(de),m==null||m.fitBounds(se,{top:p().top,bottom:p().bottom})}}else v()==="pickup"?(g=l())!=null&&g.bounds&&(m==null||m.fitBounds(l().bounds,{top:p().top,bottom:p().bottom})):v()==="destination"?(T=u())!=null&&T.bounds&&(m==null||m.fitBounds(u().bounds,{top:p().top,bottom:p().bottom})):v()==="carToPickup"?(G=s())!=null&&G.bounds&&((ae=l())!=null&&ae.bounds)&&(m==null||m.fitBounds(s().bounds.union(l().bounds),{top:p().top,bottom:p().bottom})):v()==="default"&&(m==null||m.setCenter({lat:58.378,lng:26.729}),m==null||m.setZoom(13))});const oe=K("end_session_button");var D=Ar(),x=$t(D);Qt(x,P=>M=P,()=>M);var W=E(x,2);W.__click=[Nr];var j=k(W,!0);y(W);var H=E(W,2);yr(H,()=>a.children),ge(()=>V(j,h())),ee(t,D),Oe(),f()}Te(["click"]);function Gr(){ce.set(!0),fe.set({key:"loading",params:{}}),he.set("spot-picking")}var Er=ne('<div class="footer-background svelte-1iqii79"><button class="order-car-button svelte-1iqii79"> </button></div>');function Vr(t,a){Se(a,!1);const[e,f]=we(),n=()=>O(r,"$orderCarText",e),r=K("order_car_button");Cr();var o=Er(),s=k(o);s.__click=[Gr];var i=k(s,!0);y(s),y(o),ge(()=>V(i,n())),ee(t,o),Oe(),f()}Te(["click"]);var Jt={},Ee={},Ve={},Q={},sa;function _e(){if(sa)return Q;sa=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.areaConversion=Q.timeConversion=Q.distanceConversion=Q.altitudeKeys=Q.latitudeKeys=Q.longitudeKeys=Q.MAXLON=Q.MINLON=Q.MAXLAT=Q.MINLAT=Q.earthRadius=Q.sexagesimalPattern=void 0;var t=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;Q.sexagesimalPattern=t;var a=6378137;Q.earthRadius=a;var e=-90;Q.MINLAT=e;var f=90;Q.MAXLAT=f;var n=-180;Q.MINLON=n;var r=180;Q.MAXLON=r;var o=["lng","lon","longitude",0];Q.longitudeKeys=o;var s=["lat","latitude",1];Q.latitudeKeys=s;var i=["alt","altitude","elevation","elev",2];Q.altitudeKeys=i;var l={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};Q.distanceConversion=l;var u={m:60,h:3600,d:86400};Q.timeConversion=u;var c={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};return Q.areaConversion=c,c.sqm=c.m2,c.sqkm=c.km2,c.sqft=c.ft2,c.sqyd=c.yd2,c.sqin=c.in2,Q}var ze={},ua;function zt(){if(ua)return ze;ua=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.default=void 0;var t=function(f,n){return n.reduce(function(r,o){if(typeof f>"u"||f===null)throw new Error("'".concat(f,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(f,o)&&typeof o<"u"&&typeof r>"u"?(r=o,o):r},void 0)},a=t;return ze.default=a,ze}var We={},Ke={},la;function Wt(){if(la)return Ke;la=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var t=function(f){var n=f.toString().trim();return isNaN(parseFloat(n))?!1:parseFloat(n)===Number(n)},a=t;return Ke.default=a,Ke}var Fe={},da;function Kt(){if(da)return Fe;da=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var t=_e(),a=function(n){return t.sexagesimalPattern.test(n.toString().trim())},e=a;return Fe.default=e,Fe}var je={},ca;function Ft(){if(ca)return je;ca=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var t=_e(),a=function(n){var r=new RegExp(t.sexagesimalPattern).exec(n.toString().trim());if(typeof r>"u"||r===null)throw new Error("Given value is not in sexagesimal format");var o=Number(r[2])/60||0,s=Number(r[4])/3600||0,i=parseFloat(r[1])+o+s;return["S","W"].includes(r[7])?-i:i},e=a;return je.default=e,je}var He={},Xe={},fa;function aa(){if(fa)return Xe;fa=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var t=_e(),a=e(zt());function e(i){return i&&i.__esModule?i:{default:i}}function f(i,l){var u=Object.keys(i);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(i);l&&(c=c.filter(function(v){return Object.getOwnPropertyDescriptor(i,v).enumerable})),u.push.apply(u,c)}return u}function n(i){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?arguments[l]:{};l%2?f(Object(u),!0).forEach(function(c){r(i,c,u[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(u)):f(Object(u)).forEach(function(c){Object.defineProperty(i,c,Object.getOwnPropertyDescriptor(u,c))})}return i}function r(i,l,u){return l in i?Object.defineProperty(i,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[l]=u,i}var o=function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:t.longitudeKeys,latitude:t.latitudeKeys,altitude:t.altitudeKeys},c=(0,a.default)(l,u.longitude),v=(0,a.default)(l,u.latitude),p=(0,a.default)(l,u.altitude);return n({latitude:v,longitude:c},p?{altitude:p}:{})},s=o;return Xe.default=s,Xe}var Ue={},va;function ar(){if(va)return Ue;va=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var t=n(Wt()),a=n(Kt()),e=n(Ft()),f=_e();function n(s){return s&&s.__esModule?s:{default:s}}var r=function s(i){return(0,t.default)(i)?!(parseFloat(i)>f.MAXLAT||i<f.MINLAT):(0,a.default)(i)?s((0,e.default)(i)):!1},o=r;return Ue.default=o,Ue}var Ze={},ga;function rr(){if(ga)return Ze;ga=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var t=n(Wt()),a=n(Kt()),e=n(Ft()),f=_e();function n(s){return s&&s.__esModule?s:{default:s}}var r=function s(i){return(0,t.default)(i)?!(parseFloat(i)>f.MAXLON||i<f.MINLON):(0,a.default)(i)?s((0,e.default)(i)):!1},o=r;return Ze.default=o,Ze}var pa;function nr(){if(pa)return He;pa=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;var t=f(aa()),a=f(ar()),e=f(rr());function f(o){return o&&o.__esModule?o:{default:o}}var n=function(s){var i=(0,t.default)(s),l=i.latitude,u=i.longitude;if(Array.isArray(s)&&s.length>=2)return(0,e.default)(s[0])&&(0,a.default)(s[1]);if(typeof l>"u"||typeof u>"u")return!1;var c=s[u],v=s[l];return!(typeof v>"u"||typeof c>"u"||(0,a.default)(v)===!1||(0,e.default)(c)===!1)},r=n;return He.default=r,He}var _a;function ra(){if(_a)return We;_a=1,Object.defineProperty(We,"__esModule",{value:!0}),We.default=void 0;var t=r(Wt()),a=r(Kt()),e=r(Ft()),f=r(nr()),n=r(aa());function r(c){return c&&c.__esModule?c:{default:c}}function o(c,v){var p=Object.keys(c);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(c);v&&(h=h.filter(function(M){return Object.getOwnPropertyDescriptor(c,M).enumerable})),p.push.apply(p,h)}return p}function s(c){for(var v=1;v<arguments.length;v++){var p=arguments[v]!=null?arguments[v]:{};v%2?o(Object(p),!0).forEach(function(h){i(c,h,p[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(p)):o(Object(p)).forEach(function(h){Object.defineProperty(c,h,Object.getOwnPropertyDescriptor(p,h))})}return c}function i(c,v,p){return v in c?Object.defineProperty(c,v,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[v]=p,c}var l=function c(v){if((0,t.default)(v))return Number(v);if((0,a.default)(v))return(0,e.default)(v);if((0,f.default)(v)){var p=(0,n.default)(v);return Array.isArray(v)?v.map(function(h,M){return[0,1].includes(M)?c(h):h}):s(s(s({},v),p.latitude&&i({},p.latitude,c(v[p.latitude]))),p.longitude&&i({},p.longitude,c(v[p.longitude])))}return Array.isArray(v)?v.map(function(h){return(0,f.default)(h)?c(h):h}):v},u=l;return We.default=u,We}var ma;function Pe(){if(ma)return Ve;ma=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.default=void 0;var t=_e(),a=f(zt()),e=f(ra());function f(o){return o&&o.__esModule?o:{default:o}}var n=function(s,i){var l=(0,a.default)(s,t.latitudeKeys);if(!(typeof l>"u"||l===null)){var u=s[l];return i===!0?u:(0,e.default)(u)}},r=n;return Ve.default=r,Ve}var Ye={},ha;function ke(){if(ha)return Ye;ha=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var t=_e(),a=f(zt()),e=f(ra());function f(o){return o&&o.__esModule?o:{default:o}}var n=function(s,i){var l=(0,a.default)(s,t.longitudeKeys);if(!(typeof l>"u"||l===null)){var u=s[l];return i===!0?u:(0,e.default)(u)}},r=n;return Ye.default=r,Ye}var Je={},ba;function Re(){if(ba)return Je;ba=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var t=function(f){return f*Math.PI/180},a=t;return Je.default=a,Je}var Qe={},ya;function Ie(){if(ya)return Qe;ya=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var t=function(f){return f*180/Math.PI},a=t;return Qe.default=a,Qe}var Pa;function zr(){if(Pa)return Ee;Pa=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=r(Ie()),n=_e();function r(i){return i&&i.__esModule?i:{default:i}}var o=function(l,u,c){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6371e3,p=(0,t.default)(l),h=(0,a.default)(l),M=u/v,m=(0,e.default)(c),S=(0,e.default)(p),R=(0,e.default)(h),B=Math.asin(Math.sin(S)*Math.cos(M)+Math.cos(S)*Math.sin(M)*Math.cos(m)),L=R+Math.atan2(Math.sin(m)*Math.sin(M)*Math.cos(S),Math.cos(M)-Math.sin(S)*Math.sin(B)),C=(0,f.default)(L);return(C<n.MINLON||C>n.MAXLON)&&(L=(L+3*Math.PI)%(2*Math.PI)-Math.PI,C=(0,f.default)(L)),{latitude:(0,f.default)(B),longitude:C}},s=o;return Ee.default=s,Ee}var et={},ka;function Wr(){if(ka)return et;ka=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var t=_e(),a=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",o=t.areaConversion[r];if(o)return n*o;throw new Error("Invalid unit used for area conversion.")},e=a;return et.default=e,et}var tt={},Ma;function Kr(){if(Ma)return tt;Ma=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var t=_e(),a=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",o=t.distanceConversion[r];if(o)return n*o;throw new Error("Invalid unit used for distance conversion.")},e=a;return tt.default=e,tt}var at={},La;function Fr(){if(La)return at;La=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=void 0;var t=_e(),a=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kmh";switch(r){case"kmh":return n*t.timeConversion.h*t.distanceConversion.km;case"mph":return n*t.timeConversion.h*t.distanceConversion.mi;default:return n}},e=a;return at.default=e,at}var rt={},Da;function jr(){if(Da)return rt;Da=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;function t(l,u){return r(l)||n(l,u)||e(l,u)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(l,u){if(l){if(typeof l=="string")return f(l,u);var c=Object.prototype.toString.call(l).slice(8,-1);if(c==="Object"&&l.constructor&&(c=l.constructor.name),c==="Map"||c==="Set")return Array.from(l);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return f(l,u)}}function f(l,u){(u==null||u>l.length)&&(u=l.length);for(var c=0,v=new Array(u);c<u;c++)v[c]=l[c];return v}function n(l,u){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(l)))){var c=[],v=!0,p=!1,h=void 0;try{for(var M=l[Symbol.iterator](),m;!(v=(m=M.next()).done)&&(c.push(m.value),!(u&&c.length===u));v=!0);}catch(S){p=!0,h=S}finally{try{!v&&M.return!=null&&M.return()}finally{if(p)throw h}}return c}}function r(l){if(Array.isArray(l))return l}var o=function(u){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,v=Math.pow(10,c);return Math.round(u*v)/v},s=function(u){var c=u.toString().split("."),v=t(c,2),p=v[0],h=v[1],M=Math.abs(Number(p)),m=+("0."+(h||0))*60,S=m.toString().split("."),R=Math.floor(m),B=o(+("0."+(S[1]||0))*60).toString(),L=B.split("."),C=t(L,2),q=C[0],$=C[1],N=$===void 0?"0":$;return M+"° "+R.toString().padStart(2,"0")+"' "+q.padStart(2,"0")+"."+N.padEnd(1,"0")+'"'},i=s;return rt.default=i,rt}var nt={},it={},ot={},st={},Sa;function ir(){if(Sa)return st;Sa=1,Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;var t=function(f){return f>1?1:f<-1?-1:f},a=t;return st.default=a,st}var Oa;function Be(){if(Oa)return ot;Oa=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=r(ir()),n=_e();function r(i){return i&&i.__esModule?i:{default:i}}var o=function(l,u){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;c=typeof c<"u"&&!isNaN(c)?c:1;var v=(0,t.default)(l),p=(0,a.default)(l),h=(0,t.default)(u),M=(0,a.default)(u),m=Math.acos((0,f.default)(Math.sin((0,e.default)(h))*Math.sin((0,e.default)(v))+Math.cos((0,e.default)(h))*Math.cos((0,e.default)(v))*Math.cos((0,e.default)(p)-(0,e.default)(M))))*n.earthRadius;return Math.round(m/c)*c},s=o;return ot.default=s,ot}var wa;function or(){if(wa)return it;wa=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var t=a(Be());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default;return s=typeof s=="function"?s:t.default,o.slice().sort(function(i,l){return s(r,i)-s(r,l)})},f=e;return it.default=f,it}var Ra;function Hr(){if(Ra)return nt;Ra=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var t=a(or());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o){return(0,t.default)(r,o)[0]},f=e;return nt.default=f,nt}var ut={},Ca;function Xr(){if(Ca)return ut;Ca=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var t=n(Re()),a=n(Pe()),e=n(ke()),f=_e();function n(s){return s&&s.__esModule?s:{default:s}}var r=function(i){var l=0;if(i.length>2){for(var u,c,v,p=0;p<i.length;p++){p===i.length-2?(u=i.length-2,c=i.length-1,v=0):p===i.length-1?(u=i.length-1,c=0,v=1):(u=p,c=p+1,v=p+2);var h=(0,e.default)(i[u]),M=(0,a.default)(i[c]),m=(0,e.default)(i[v]);l+=((0,t.default)(m)-(0,t.default)(h))*Math.sin((0,t.default)(M))}l=l*f.earthRadius*f.earthRadius/2}return Math.abs(l)},o=r;return ut.default=o,ut}var lt={},qa;function sr(){if(qa)return lt;qa=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.default=void 0;var t=e(Pe()),a=e(ke());function e(r){return r&&r.__esModule?r:{default:r}}var f=function(o){if(Array.isArray(o)===!1||o.length===0)throw new Error("No points were given.");return o.reduce(function(s,i){var l=(0,t.default)(i),u=(0,a.default)(i);return{maxLat:Math.max(l,s.maxLat),minLat:Math.min(l,s.minLat),maxLng:Math.max(u,s.maxLng),minLng:Math.min(u,s.minLng)}},{maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0})},n=f;return lt.default=n,lt}var dt={},$a;function Ur(){if($a)return dt;$a=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=r(Ie()),n=_e();function r(i){return i&&i.__esModule?i:{default:i}}var o=function(l,u){var c=(0,t.default)(l),v=(0,a.default)(l),p=(0,e.default)(c),h=(0,e.default)(v),M=u/n.earthRadius,m=p-M,S=p+M,R=(0,e.default)(n.MAXLAT),B=(0,e.default)(n.MINLAT),L=(0,e.default)(n.MAXLON),C=(0,e.default)(n.MINLON),q,$;if(m>B&&S<R){var N=Math.asin(Math.sin(M)/Math.cos(p));q=h-N,q<C&&(q+=Math.PI*2),$=h+N,$>L&&($-=Math.PI*2)}else m=Math.max(m,B),S=Math.min(S,R),q=C,$=L;return[{latitude:(0,f.default)(m),longitude:(0,f.default)(q)},{latitude:(0,f.default)(S),longitude:(0,f.default)($)}]},s=o;return dt.default=s,dt}var ct={},xa;function Zr(){if(xa)return ct;xa=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Re()),f=n(Ie());function n(s){return s&&s.__esModule?s:{default:s}}var r=function(i){if(Array.isArray(i)===!1||i.length===0)return!1;var l=i.length,u=i.reduce(function(h,M){var m=(0,e.default)((0,t.default)(M)),S=(0,e.default)((0,a.default)(M));return{X:h.X+Math.cos(m)*Math.cos(S),Y:h.Y+Math.cos(m)*Math.sin(S),Z:h.Z+Math.sin(m)}},{X:0,Y:0,Z:0}),c=u.X/l,v=u.Y/l,p=u.Z/l;return{longitude:(0,f.default)(Math.atan2(v,c)),latitude:(0,f.default)(Math.atan2(p,Math.sqrt(c*c+v*v)))}},o=r;return ct.default=o,ct}var ft={},Ta;function Yr(){if(Ta)return ft;Ta=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.default=void 0;var t=a(sr());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r){var o=(0,t.default)(r),s=o.minLat+(o.maxLat-o.minLat)/2,i=o.minLng+(o.maxLng-o.minLng)/2;return{latitude:parseFloat(s.toFixed(6)),longitude:parseFloat(i.toFixed(6))}},f=e;return ft.default=f,ft}var vt={},gt={},Ba;function ur(){if(Ba)return gt;Ba=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Re()),f=n(Ie());function n(s){return s&&s.__esModule?s:{default:s}}var r=function(i,l){var u=(0,e.default)((0,a.default)(l))-(0,e.default)((0,a.default)(i)),c=Math.log(Math.tan((0,e.default)((0,t.default)(l))/2+Math.PI/4)/Math.tan((0,e.default)((0,t.default)(i))/2+Math.PI/4));return Math.abs(u)>Math.PI&&(u>0?u=(Math.PI*2-u)*-1:u=Math.PI*2+u),((0,f.default)(Math.atan2(u,c))+360)%360},o=r;return gt.default=o,gt}var Na;function Jr(){if(Na)return vt;Na=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.default=void 0;var t=a(ur());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,i=typeof s=="function"?s(r,o):(0,t.default)(r,o);if(isNaN(i))throw new Error("Could not calculate bearing for given points. Check your bearing function");switch(Math.round(i/22.5)){case 1:return"NNE";case 2:return"NE";case 3:return"ENE";case 4:return"E";case 5:return"ESE";case 6:return"SE";case 7:return"SSE";case 8:return"S";case 9:return"SSW";case 10:return"SW";case 11:return"WSW";case 12:return"W";case 13:return"WNW";case 14:return"NW";case 15:return"NNW";default:return"N"}},f=e;return vt.default=f,vt}var pt={},Aa;function lr(){if(Aa)return pt;Aa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var t=e(Be()),a=e(ir());function e(r){return r&&r.__esModule?r:{default:r}}var f=function(o,s,i){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,u=(0,t.default)(s,o,l),c=(0,t.default)(o,i,l),v=(0,t.default)(s,i,l),p=Math.acos((0,a.default)((u*u+v*v-c*c)/(2*u*v))),h=Math.acos((0,a.default)((c*c+v*v-u*u)/(2*c*v)));return p>Math.PI/2?u:h>Math.PI/2?c:Math.sin(p)*u},n=f;return pt.default=n,pt}var _t={},Ia;function Qr(){if(Ia)return _t;Ia=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Re()),f=n(Ie());function n(s){return s&&s.__esModule?s:{default:s}}var r=function(i,l){var u=(0,t.default)(l),c=(0,a.default)(l),v=(0,t.default)(i),p=(0,a.default)(i),h=((0,f.default)(Math.atan2(Math.sin((0,e.default)(c)-(0,e.default)(p))*Math.cos((0,e.default)(u)),Math.cos((0,e.default)(v))*Math.sin((0,e.default)(u))-Math.sin((0,e.default)(v))*Math.cos((0,e.default)(u))*Math.cos((0,e.default)(c)-(0,e.default)(p))))+360)%360;return h},o=r;return _t.default=o,_t}var mt={},Ga;function en(){if(Ga)return mt;Ga=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var t=a(Be());function a(r){return r&&r.__esModule?r:{default:r}}function e(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(s){return typeof s}:e=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},e(r)}var f=function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.default;return o.reduce(function(i,l){return e(i)==="object"&&i.last!==null&&(i.distance+=s(l,i.last)),i.last=l,i},{last:null,distance:0}).distance},n=f;return mt.default=n,mt}var ht={},Ea;function tn(){if(Ea)return ht;Ea=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var t=n(Pe()),a=n(ke()),e=n(Re()),f=_e();function n(s){return s&&s.__esModule?s:{default:s}}var r=function(i,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;u=typeof u<"u"&&!isNaN(u)?u:1;var c=(0,t.default)(i),v=(0,a.default)(i),p=(0,t.default)(l),h=(0,a.default)(l),M=6356752314245e-6,m=1/298.257223563,S=(0,e.default)(h-v),R,B,L,C,q,$,N=Math.atan((1-m)*Math.tan((0,e.default)(parseFloat(c)))),F=Math.atan((1-m)*Math.tan((0,e.default)(parseFloat(p)))),z=Math.sin(N),X=Math.cos(N),le=Math.sin(F),I=Math.cos(F),ie=S,te,Z=100;do{var U=Math.sin(ie),oe=Math.cos(ie);if($=Math.sqrt(I*U*(I*U)+(X*le-z*I*oe)*(X*le-z*I*oe)),$===0)return 0;R=z*le+X*I*oe,B=Math.atan2($,R),L=X*I*U/$,C=1-L*L,q=R-2*z*le/C,isNaN(q)&&(q=0);var D=m/16*C*(4+m*(4-3*C));te=ie,ie=S+(1-D)*m*L*(B+D*$*(q+D*R*(-1+2*q*q)))}while(Math.abs(ie-te)>1e-12&&--Z>0);if(Z===0)return NaN;var x=C*(f.earthRadius*f.earthRadius-M*M)/(M*M),W=1+x/16384*(4096+x*(-768+x*(320-175*x))),j=x/1024*(256+x*(-128+x*(74-47*x))),H=j*$*(q+j/4*(R*(-1+2*q*q)-j/6*q*(-3+4*$*$)*(-3+4*q*q))),P=M*W*(B-H);return Math.round(P/u)*u},o=r;return ht.default=o,ht}var bt={},Va;function an(){if(Va)return bt;Va=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.default=void 0;var t=function(f){if(/^(NNE|NE|NNW|N)$/.test(f))return"N";if(/^(ENE|E|ESE|SE)$/.test(f))return"E";if(/^(SSE|S|SSW|SW)$/.test(f))return"S";if(/^(WSW|W|WNW|NW)$/.test(f))return"W"},a=t;return bt.default=a,bt}var yt={},za;function rn(){if(za)return yt;za=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var t=a(Be());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,i=s(r,o),l=Number(o.time)-Number(r.time),u=i/l*1e3;return u},f=e;return yt.default=f,yt}var Pt={},Wa;function nn(){if(Wa)return Pt;Wa=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=a(Be());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o,s){return(0,t.default)(o,r)+(0,t.default)(r,s)===(0,t.default)(o,s)},f=e;return Pt.default=f,Pt}var kt={},Ka;function on(){if(Ka)return kt;Ka=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var t=e(Pe()),a=e(ke());function e(r){return r&&r.__esModule?r:{default:r}}var f=function(o,s){for(var i=!1,l=s.length,u=-1,c=l-1;++u<l;c=u)((0,a.default)(s[u])<=(0,a.default)(o)&&(0,a.default)(o)<(0,a.default)(s[c])||(0,a.default)(s[c])<=(0,a.default)(o)&&(0,a.default)(o)<(0,a.default)(s[u]))&&(0,t.default)(o)<((0,t.default)(s[c])-(0,t.default)(s[u]))*((0,a.default)(o)-(0,a.default)(s[u]))/((0,a.default)(s[c])-(0,a.default)(s[u]))+(0,t.default)(s[u])&&(i=!i);return i},n=f;return kt.default=n,kt}var Mt={},Fa;function sn(){if(Fa)return Mt;Fa=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var t=a(lr());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o,s,i){return(0,t.default)(r,o,s)<i},f=e;return Mt.default=f,Mt}var Lt={},ja;function un(){if(ja)return Lt;ja=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=a(Be());function a(n){return n&&n.__esModule?n:{default:n}}var e=function(r,o,s){var i=.01;return(0,t.default)(r,o,i)<s},f=e;return Lt.default=f,Lt}var Dt={},Ha;function ln(){if(Ha)return Dt;Ha=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;function t(i,l){return r(i)||n(i,l)||e(i,l)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(i,l){if(i){if(typeof i=="string")return f(i,l);var u=Object.prototype.toString.call(i).slice(8,-1);if(u==="Object"&&i.constructor&&(u=i.constructor.name),u==="Map"||u==="Set")return Array.from(i);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return f(i,l)}}function f(i,l){(l==null||l>i.length)&&(l=i.length);for(var u=0,c=new Array(l);u<l;u++)c[u]=i[u];return c}function n(i,l){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(i)))){var u=[],c=!0,v=!1,p=void 0;try{for(var h=i[Symbol.iterator](),M;!(c=(M=h.next()).done)&&(u.push(M.value),!(l&&u.length===l));c=!0);}catch(m){v=!0,p=m}finally{try{!c&&h.return!=null&&h.return()}finally{if(v)throw p}}return u}}function r(i){if(Array.isArray(i))return i}var o=function(l){if(!l.startsWith("POLYGON"))throw new Error("Invalid wkt.");var u=l.slice(l.indexOf("(")+2,l.indexOf(")")).split(", "),c=u.map(function(v){var p=v.split(" "),h=t(p,2),M=h[0],m=h[1];return{longitude:parseFloat(M),latitude:parseFloat(m)}});return c},s=o;return Dt.default=s,Dt}var Xa;function dn(){return Xa||(Xa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var a={computeDestinationPoint:!0,convertArea:!0,convertDistance:!0,convertSpeed:!0,decimalToSexagesimal:!0,findNearest:!0,getAreaOfPolygon:!0,getBounds:!0,getBoundsOfDistance:!0,getCenter:!0,getCenterOfBounds:!0,getCompassDirection:!0,getCoordinateKey:!0,getCoordinateKeys:!0,getDistance:!0,getDistanceFromLine:!0,getGreatCircleBearing:!0,getLatitude:!0,getLongitude:!0,getPathLength:!0,getPreciseDistance:!0,getRhumbLineBearing:!0,getRoughCompassDirection:!0,getSpeed:!0,isDecimal:!0,isPointInLine:!0,isPointInPolygon:!0,isPointNearLine:!0,isPointWithinRadius:!0,isSexagesimal:!0,isValidCoordinate:!0,isValidLatitude:!0,isValidLongitude:!0,orderByDistance:!0,sexagesimalToDecimal:!0,toDecimal:!0,toRad:!0,toDeg:!0,wktToPolygon:!0};Object.defineProperty(t,"computeDestinationPoint",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"convertArea",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"convertDistance",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"convertSpeed",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"decimalToSexagesimal",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"findNearest",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"getAreaOfPolygon",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"getBounds",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"getBoundsOfDistance",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"getCenter",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"getCenterOfBounds",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"getCompassDirection",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"getCoordinateKey",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"getCoordinateKeys",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(t,"getDistance",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"getDistanceFromLine",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"getGreatCircleBearing",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"getLatitude",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(t,"getLongitude",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(t,"getPathLength",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"getPreciseDistance",{enumerable:!0,get:function(){return q.default}}),Object.defineProperty(t,"getRhumbLineBearing",{enumerable:!0,get:function(){return $.default}}),Object.defineProperty(t,"getRoughCompassDirection",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"getSpeed",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(t,"isDecimal",{enumerable:!0,get:function(){return z.default}}),Object.defineProperty(t,"isPointInLine",{enumerable:!0,get:function(){return X.default}}),Object.defineProperty(t,"isPointInPolygon",{enumerable:!0,get:function(){return le.default}}),Object.defineProperty(t,"isPointNearLine",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(t,"isPointWithinRadius",{enumerable:!0,get:function(){return ie.default}}),Object.defineProperty(t,"isSexagesimal",{enumerable:!0,get:function(){return te.default}}),Object.defineProperty(t,"isValidCoordinate",{enumerable:!0,get:function(){return Z.default}}),Object.defineProperty(t,"isValidLatitude",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(t,"isValidLongitude",{enumerable:!0,get:function(){return oe.default}}),Object.defineProperty(t,"orderByDistance",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(t,"sexagesimalToDecimal",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(t,"toDecimal",{enumerable:!0,get:function(){return W.default}}),Object.defineProperty(t,"toRad",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(t,"toDeg",{enumerable:!0,get:function(){return H.default}}),Object.defineProperty(t,"wktToPolygon",{enumerable:!0,get:function(){return P.default}});var e=_(zr()),f=_(Wr()),n=_(Kr()),r=_(Fr()),o=_(jr()),s=_(Hr()),i=_(Xr()),l=_(sr()),u=_(Ur()),c=_(Zr()),v=_(Yr()),p=_(Jr()),h=_(zt()),M=_(aa()),m=_(Be()),S=_(lr()),R=_(Qr()),B=_(Pe()),L=_(ke()),C=_(en()),q=_(tn()),$=_(ur()),N=_(an()),F=_(rn()),z=_(Wt()),X=_(nn()),le=_(on()),I=_(sn()),ie=_(un()),te=_(Kt()),Z=_(nr()),U=_(ar()),oe=_(rr()),D=_(or()),x=_(Ft()),W=_(ra()),j=_(Re()),H=_(Ie()),P=_(ln()),b=_e();Object.keys(b).forEach(function(g){g==="default"||g==="__esModule"||Object.prototype.hasOwnProperty.call(a,g)||Object.defineProperty(t,g,{enumerable:!0,get:function(){return b[g]}})});function _(g){return g&&g.__esModule?g:{default:g}}}(Jt)),Jt}var cn=dn();class fn{constructor(){wt(this,"stops",[])}async instantiate(){const e=await(await fetch("/stops.json")).json();this.stops=e.stops}findClosestStops(a,e=.5,f=3){return this.stops.map(o=>{const s=cn.getDistance({latitude:a[0],longitude:a[1]},{latitude:o.position.lat,longitude:o.position.lng})/1e3;return{name:o.name,position:o.position,dist_from_point:s}}).filter(o=>o.dist_from_point<=e).sort((o,s)=>o.dist_from_point-s.dist_from_point).slice(0,f)}}var vn=ne('<label for="spot-search-input" class="svelte-1bz9rsj"> </label>'),gn=(t,a)=>w(a,!0),pn=ne('<div class="loading-spinner svelte-1bz9rsj"></div>'),_n=ne('<button type="button" class="clear-searchbar svelte-1bz9rsj" aria-label="Clear"><img src="/clearsearchbar.svg" alt="Clear" class="clear-searchbar-icon svelte-1bz9rsj"/></button>'),mn=ne('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <div class="secondary-suggestion-text svelte-1bz9rsj"> </div></button></li>'),hn=(t,a,e)=>a(d(e)),bn=ne('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),yn=ne('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),Pn=ne('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <!></button></li>'),kn=ne('<ul class="suggestions-list svelte-1bz9rsj"><!> <!></ul>'),Mn=ne('<div class="spot-search-bar svelte-1bz9rsj"><!> <div class="searchbar-wrapper svelte-1bz9rsj"><input id="spot-search-input" type="text"/> <!> <!></div></div>');function Ua(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(Et,"$locale",e),r=()=>O(Tt,"$userLocation",e),o=()=>O(L,"$yourLocationMessage",e);let s=Y(""),i=Y(Pr([])),l=Y(!1),u=null,c=Y(!1),v=null,p=Ne(a,"label",3,""),h=Ne(a,"placeholder",3,""),M=Ne(a,"error",3,!1),m=Ne(a,"value",3,""),S=Ne(a,"providedSpot",3,null),R=Ne(a,"userLocationOption",3,!1);qe(async()=>{const{AutocompleteSuggestion:D}=await xr();u=D,v=S()});async function B(D){var x;if(u){w(l,!0);const W={input:D.input,includedRegionCodes:["ee"],region:"ee",language:n()},j=await u.fetchAutocompleteSuggestions(W);let H=[];if(j.suggestions&&j.suggestions.length>0)for(const P of j.suggestions){let b=await P.placePrediction.toPlace().fetchFields({fields:["location"]});H.push({name:P.placePrediction.mainText.text,secondaryText:((x=P.placePrediction.secondaryText)==null?void 0:x.text)??"",position:{lat:b.place.location.lat(),lng:b.place.location.lng()}})}return w(l,!1),H}return[]}pe(()=>{d(s)?B({input:d(s)}).then(D=>{w(i,D,!0)}):w(i,[],!0)}),pe(()=>{m()!==void 0&&m()!==null&&w(s,m())});const L=K("your_location");function C(D){var x;v=D,w(s,D.name,!0),w(c,!1),(x=a.onSelect)==null||x.call(a,D)}function q(){var x;if(!r())return;const D={name:o(),position:{lat:r().lat,lng:r().lng},secondaryText:`${r().lat}, ${r().lng}`};v=D,w(s,D.name,!0),w(c,!1),(x=a.onSelect)==null||x.call(a,D)}function $(){w(c,!1),v&&d(s)!==v.name&&w(s,v.name,!0)}function N(){var D;w(s,""),v=null,w(i,[],!0),w(c,!1),(D=a.onSelect)==null||D.call(a,null)}var F=Mn(),z=k(F);{var X=D=>{var x=vn(),W=k(x,!0);y(x),ge(()=>V(W,p())),ee(D,x)};ue(z,D=>{p()&&D(X)})}var le=E(z,2),I=k(le);Rr(I),I.__click=[gn,c];var ie=E(I,2);{var te=D=>{var x=pn();ee(D,x)},Z=(D,x)=>{{var W=j=>{var H=_n();H.__click=N,ee(j,H)};ue(D,j=>{d(s)&&j(W)},x)}};ue(ie,D=>{d(l)?D(te):D(Z,!1)})}var U=E(ie,2);{var oe=D=>{var x=kn(),W=k(x);{var j=P=>{var b=mn(),_=k(b);_.__mousedown=q;var g=k(_),T=k(g,!0);y(g);var G=E(g,2),ae=k(G);y(G),y(_),y(b),ge((se,J)=>{V(T,o()),V(ae,`${se??""}, ${J??""}`)},[()=>r().lat.toFixed(5),()=>r().lng.toFixed(5)]),ee(P,b)};ue(W,P=>{r()&&R()&&P(j)})}var H=E(W,2);It(H,17,()=>d(i),Gt,(P,b)=>{var _=Pn(),g=k(_);g.__mousedown=[hn,C,b];var T=k(g),G=k(T,!0);y(T);var ae=E(T,2);{var se=de=>{var A=bn(),ve=k(A,!0);y(A),ge(()=>V(ve,d(b).secondaryText)),ee(de,A)},J=de=>{var A=yn(),ve=k(A);y(A),ge(($e,jt)=>V(ve,`${$e??""}, ${jt??""}`),[()=>d(b).position.lat.toFixed(5),()=>d(b).position.lng.toFixed(5)]),ee(de,A)};ue(ae,de=>{d(b).secondaryText?de(se):de(J,!1)})}y(g),y(_),ge(()=>V(G,d(b).name)),ee(P,_)}),y(x),ee(D,x)};ue(U,D=>{d(c)&&D(oe)})}y(le),y(F),ge(()=>{Ce(I,"placeholder",h()),xe(I,1,`spot-search ${M()?"error":""}`,"svelte-1bz9rsj")}),xt("focus",I,()=>w(c,!0)),xt("blur",I,$),qr(I,()=>d(s),D=>w(s,D)),ee(t,F),Oe(),f()}Te(["click","mousedown"]);var Ln=(t,a)=>{w(a,!1)},Dn=ne('<button class="confirm-button svelte-3hy2qp"> </button>'),Sn=ne('<div class="component-container svelte-3hy2qp"><div class="spot-picking-container svelte-3hy2qp"><div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div class="buttons-container svelte-3hy2qp"><!> <button class="cancel-button svelte-3hy2qp"> </button></div></div></div>');function On(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(qt,"$chosenSpots",e),r=()=>O(q,"$spotPickingPickupLabel",e),o=()=>O($,"$spotPickingPickupPlaceholder",e),s=()=>O(z,"$noStopsNearPickup",e),i=()=>O(N,"$spotPickingDestinationLabel",e),l=()=>O(F,"$spotPickingDestinationPlaceholder",e),u=()=>O(X,"$noStopsNearDestination",e),c=()=>O(le,"$confirmButtonText",e),v=()=>O(C,"$cancelButtonText",e);let p=Y(null),h=Y(null),M=Y(null);function m(){ce.set(!0),fe.set({key:"loading",params:{}}),qt.set({}),he.set("map-idle")}let S=Y(!1),R=Y(!1),B=Y(!1),L=Y(!1);qe(async()=>{ce.set(!0),fe.set({key:"loading",params:{}}),w(p,new fn,!0),await d(p).instantiate(),n()&&(w(B,!0),w(h,n().pickup,!0),w(M,n().destination,!0)),ce.set(!1),fe.set({key:"loading",params:{}})}),pe(()=>{if(d(h)&&d(M)&&d(p)){let A=d(p).findClosestStops([d(h).position.lat,d(h).position.lng]),ve=d(p).findClosestStops([d(M).position.lat,d(M).position.lng]);A.length===0&&w(S,!0),ve.length===0&&w(R,!0),A.length>0&&ve.length>0&&(w(L,!0),d(B)||(ce.set(!0),fe.set({key:"loading",params:{}}),qt.set({pickup:d(h),destination:d(M)}),ta.set({pickup:A,destination:ve}),he.set("bus-stop-picking")))}});const C=K("spot_picking_cancel_button"),q=K("spot_picking_pickup_label"),$=K("spot_pickup_placeholder"),N=K("spot_picking_destination_label"),F=K("spot_destination_placeholder"),z=K("spot_pickup_no_bus_stop_found"),X=K("spot_destination_no_bus_stop_found"),le=K("spot_picking_confirm");var I=Sn(),ie=k(I),te=k(ie),Z=k(te);const U=Me(()=>d(h)??null),oe=Me(()=>{var A;return((A=d(h))==null?void 0:A.name)??""});Ua(Z,{get label(){return r()},get placeholder(){return o()},get error(){return d(S)},get providedSpot(){return d(U)},get value(){return d(oe)},onSelect:A=>{w(h,A,!0),w(S,!1)},userLocationOption:!0});var D=E(Z,2),x=k(D),W=k(x,!0);y(x),y(D),y(te);var j=E(te,2),H=k(j);const P=Me(()=>d(M)??null),b=Me(()=>{var A;return((A=d(M))==null?void 0:A.name)??""});Ua(H,{get label(){return i()},get placeholder(){return l()},get error(){return d(R)},get providedSpot(){return d(P)},get value(){return d(b)},onSelect:A=>{w(M,A,!0),w(R,!1)},userLocationOption:!1});var _=E(H,2),g=k(_),T=k(g,!0);y(g),y(_),y(j);var G=E(j,2),ae=k(G);{var se=A=>{var ve=Dn();ve.__click=[Ln,B];var $e=k(ve,!0);y(ve),ge(()=>{ve.disabled=!(d(L)&&d(h)&&d(M)&&!d(S)&&!d(R)),V($e,c())}),ee(A,ve)};ue(ae,A=>{d(B)&&A(se)})}var J=E(ae,2);J.__click=m;var de=k(J,!0);y(J),y(G),y(ie),y(I),ge(()=>{xe(te,1,`spot-search-bar-wrapper${d(S)?" error":""}`,"svelte-3hy2qp"),V(W,d(S)?s():""),xe(j,1,`spot-search-bar-wrapper${d(R)?" error":""}`,"svelte-3hy2qp"),V(T,d(R)?u():""),V(de,v())}),ee(t,I),Oe(),f()}Te(["click"]);class ye{static async initialize(){if(!this.travelModeConstants||!this.directionsStatusConstants){const{TravelMode:a,DirectionsStatus:e}=await oa();this.travelModeConstants=a,this.directionsStatusConstants=e}}static async getRoute(a){await this.initialize();const{DirectionsService:e}=await oa(),n=await new e().route(a);return n.status===this.directionsStatusConstants.OK?{pathArray:n.routes[0].overview_path.map(o=>({lat:o.lat(),lng:o.lng()})),bounds:n.routes[0].bounds}:null}static async calculatePreliminaryRoutes(a,e,f,n="en",r=!0){if(await this.initialize(),!a||!e||!f){console.warn("RouteService: Missing required data for route calculation");return}const o=a;if(!o.pickup||!o.destination){console.warn("RouteService: Invalid chosen spots data");return}const s={origin:{lat:o.pickup.position.lat,lng:o.pickup.position.lng},destination:{lat:e.position.lat,lng:e.position.lng},travelMode:this.travelModeConstants.WALKING,language:n,region:"ee"},i={origin:{lat:e.position.lat,lng:e.position.lng},destination:{lat:f.position.lat,lng:f.position.lng},travelMode:this.travelModeConstants.DRIVING,language:n,region:"ee"},l={origin:{lat:f.position.lat,lng:f.position.lng},destination:{lat:o.destination.position.lat,lng:o.destination.position.lng},travelMode:this.travelModeConstants.WALKING,language:n,region:"ee"};if(r){const[u,c,v]=await Promise.all([this.getRoute(s),this.getRoute(i),this.getRoute(l)]);Bt.set(u),Ct.set(c),Nt.set(v)}else{const[u,c]=await Promise.all([this.getRoute(s),this.getRoute(l)]);Bt.set(u),Nt.set(c)}}static nullDrivingRoutes(){Ct.set(null),ea.set(null)}static async calculateCarRouteHelper(a,e){const{LatLngBounds:f}=await er(),n=new f;let r=[];if(a)for(const o of a)n.extend({lat:o[0],lng:o[1]}),r.push({lat:o[0],lng:o[1]});else e&&n.extend({lat:e.position.lat,lng:e.position.lng});return{mappedWaypoints:r,latLngBounds:n}}static async calculateCarToPickupRoute(a,e){const{mappedWaypoints:f,latLngBounds:n}=await this.calculateCarRouteHelper(a,e);ea.set({pathArray:f,bounds:n})}static async calculatePickupBusStopToDestinationRoute(a,e){const{mappedWaypoints:f,latLngBounds:n}=await this.calculateCarRouteHelper(a,e);Ct.set({pathArray:f,bounds:n})}}wt(ye,"travelModeConstants",null),wt(ye,"directionsStatusConstants",null);function wn(t,a,e,f,n){var r;a()&&d(e)&&d(f)&&(ce.set(!0),fe.set({key:"loading",params:{}}),ye.nullDrivingRoutes(),(r=n())==null||r.publishGoal({type:"pickup",position:d(e).position,chosen_spots:a(),chosen_route_stops:{pickup:d(e),destination:d(f)}}))}var Rn=(t,a)=>w(a,!d(a)),Cn=(t,a,e)=>a(d(e)),qn=ne('<button type="button" role="option"> </button>'),$n=ne('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="pickup-dropdown"></div>'),xn=(t,a)=>w(a,!d(a)),Tn=(t,a,e)=>a(d(e)),Bn=ne('<button type="button" role="option"> </button>'),Nn=ne('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="destination-dropdown"></div>'),An=ne('<button class="order-car-button svelte-5klcor"> </button>'),In=ne('<div class="bus-stop-picking svelte-5klcor"><div class="dropdowns-container svelte-5klcor"><h2 class="svelte-5klcor"> </h2> <div class="dropdown-group svelte-5klcor"><label for="pickup-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="pickup-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div> <div class="dropdown-group svelte-5klcor"><label for="destination-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="destination-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div></div> <div class="buttons-container svelte-5klcor"><!> <button class="back-button svelte-5klcor"> </button></div></div>');function Gn(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(ta,"$foundBusStops",e),r=()=>O(qt,"$chosenSpots",e),o=()=>O(Et,"$locale",e),s=()=>O(Vt,"$mqttClient",e),i=()=>O(z,"$busStopPickHeadingText",e),l=()=>O(X,"$busStopPickupText",e),u=()=>O(le,"$busStopDestinationText",e),c=()=>O(N,"$orderCarText",e),v=()=>O(F,"$backButtonText",e);let p=Y(!1),h=Y(!1),M=Me(()=>n().pickup),m=Me(()=>n().destination),S=Y(null),R=Y(null);qe(async()=>{Ot.set({top:400,bottom:100}),await ye.initialize(),d(S)&&d(R)&&r()&&(ye.calculatePreliminaryRoutes(r(),d(S),d(R),o()),d(h)||(De.set("all"),w(h,!0)))}),pe(()=>{r()&&!d(p)&&(w(S,d(M)[0],!0),w(R,d(m)[0],!0),ce.set(!1),fe.set({key:"loading",params:{}}),w(p,!0))}),pe(()=>{d(S)&&d(R)&&r()&&(ye.calculatePreliminaryRoutes(r(),d(S),d(R),o()),d(h)||(De.set("all"),w(h,!0)))});function B(){ce.set(!0),fe.set({key:"loading",params:{}}),ta.set({}),he.set("spot-picking")}let L=Y(!1),C=Y(!1);function q(re){w(S,re,!0),w(L,!1),De.set("pickup")}function $(re){w(R,re,!0),w(C,!1),De.set("destination")}const N=K("bus_stop_order_car_button"),F=K("bus_stop_back_button"),z=K("bus_stop_pick_heading"),X=K("bus_stop_pickup"),le=K("bus_stop_destination");let I=Y(void 0),ie=Y(void 0);function te(re){d(L)&&d(I)&&!d(I).contains(re.target)&&w(L,!1)}function Z(re){d(C)&&d(ie)&&!d(ie).contains(re.target)&&w(C,!1)}pe(()=>{if(d(L))return document.addEventListener("mousedown",te),()=>document.removeEventListener("mousedown",te)}),pe(()=>{if(d(C))return document.addEventListener("mousedown",Z),()=>document.removeEventListener("mousedown",Z)});var U=In(),oe=k(U),D=k(oe),x=k(D,!0);y(D);var W=E(D,2),j=k(W),H=k(j,!0);y(j);var P=E(j,2),b=k(P);b.__click=[Rn,L];var _=k(b),g=E(_);y(b);var T=E(b,2);{var G=re=>{var me=$n();It(me,21,()=>d(M),Gt,(Ge,Le)=>{var be=qn();be.__click=[Cn,q,Le];var Xt=k(be,!0);y(be),ge(()=>{xe(be,1,`dropdown-item ${d(S)&&d(Le).name===d(S).name?"selected":""}`,"svelte-5klcor"),Ce(be,"aria-selected",d(S)&&d(Le).name===d(S).name),V(Xt,d(Le).name)}),ee(Ge,be)}),y(me),ee(re,me)};ue(T,re=>{d(L)&&re(G)})}y(P),Qt(P,re=>w(I,re),()=>d(I)),y(W);var ae=E(W,2),se=k(ae),J=k(se,!0);y(se);var de=E(se,2),A=k(de);A.__click=[xn,C];var ve=k(A),$e=E(ve);y(A);var jt=E(A,2);{var dr=re=>{var me=Nn();It(me,21,()=>d(m),Gt,(Ge,Le)=>{var be=Bn();be.__click=[Tn,$,Le];var Xt=k(be,!0);y(be),ge(()=>{xe(be,1,`dropdown-item ${d(R)&&d(Le).name===d(R).name?"selected":""}`,"svelte-5klcor"),Ce(be,"aria-selected",d(R)&&d(Le).name===d(R).name),V(Xt,d(Le).name)}),ee(Ge,be)}),y(me),ee(re,me)};ue(jt,re=>{d(C)&&re(dr)})}y(de),Qt(de,re=>w(ie,re),()=>d(ie)),y(ae),y(oe);var na=E(oe,2),ia=k(na);{var cr=re=>{var me=An();me.__click=[wn,r,S,R,s];var Ge=k(me,!0);y(me),ge(()=>V(Ge,c())),ee(re,me)};ue(ia,re=>{d(S)&&d(R)&&re(cr)})}var Ht=E(ia,2);Ht.__click=B;var fr=k(Ht,!0);y(Ht),y(na),y(U),ge(()=>{var re,me;V(x,i()),V(H,l()),Ce(b,"aria-expanded",d(L)),V(_,`${((re=d(S))==null?void 0:re.name)??""} `),xe(g,0,`dropdown-arrow${d(L)?" open":""}`,"svelte-5klcor"),V(J,u()),Ce(A,"aria-expanded",d(C)),V(ve,`${((me=d(R))==null?void 0:me.name)??""} `),xe($e,0,`dropdown-arrow${d(C)?" open":""}`,"svelte-5klcor"),V(fr,v())}),ee(t,U),Oe(),f()}Te(["click"]);var En=ne('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),Vn=ne('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),zn=ne('<div class="driving-info-container svelte-rznqub"><div class="driving-info-card svelte-rznqub"><!></div></div>');function Za(t,a){var le,I,ie,te;Se(a,!0);const[e,f]=we(),n=()=>O(Et,"$locale",e),r=()=>O(St,"$carStatus",e),o=()=>O(h,"$drivingToPickupInfoText",e),s=()=>O(m,"$carSpeedHeadingText",e),i=()=>O(d(R),"$carSpeedInfoText",e),l=()=>O(B,"$chosenPickupHeadingText",e),u=()=>O(L,"$chosenPickupSpotText",e),c=()=>O(M,"$drivingToDestinationInfoText",e),v=()=>O(C,"$chosenDestinationHeadingText",e),p=()=>O(q,"$chosenDestinationSpotText",e);qe(async()=>{ce.set(!0),fe.set({key:"loading",params:{}}),Ot.set({top:400,bottom:100});async function Z(){return new Promise(oe=>{let D;D=St.subscribe(x=>{x&&(typeof D=="function"&&D(),oe(x))})})}const U=await Z();await ye.initialize(),await ye.calculatePreliminaryRoutes(U.chosen_spots,U.chosen_route_stops.pickup,U.chosen_route_stops.destination,n(),!1),Qa.set(!0),a.type=="pickup"?(await ye.calculateCarToPickupRoute(U.route,U.chosen_route_stops.pickup),De.set("carToPickup")):a.type=="destination"&&(await ye.calculatePickupBusStopToDestinationRoute(U.route,U.chosen_route_stops.destination),De.set("all")),ce.set(!1),fe.set({key:"loading",params:{}})});const h=K("driving_to_pickup_info"),M=K("driving_to_destination_info"),m=K("car_speed_heading");let S=Me(()=>{var Z;return(Z=r())!=null&&Z.speed?r().speed.toFixed(1):"0.0"});const R=Me(()=>K("car_speed_info",{speed:d(S)})),B=K("chosen_pickup_heading"),L=K("chosen_pickup_spot",{spot_name:(le=r())!=null&&le.chosen_route_stops&&"pickup"in r().chosen_route_stops&&((I=r().chosen_route_stops.pickup)!=null&&I.name)?r().chosen_route_stops.pickup.name:""}),C=K("chosen_destination_heading"),q=K("chosen_destination_spot",{spot_name:(ie=r())!=null&&ie.chosen_route_stops&&"destination"in r().chosen_route_stops&&((te=r().chosen_route_stops.destination)!=null&&te.name)?r().chosen_route_stops.destination.name:""});var $=zn(),N=k($),F=k(N);{var z=Z=>{var U=En(),oe=$t(U),D=k(oe,!0);y(oe);var x=E(oe,2),W=k(x),j=k(W,!0);y(W);var H=E(W,2),P=k(H,!0);y(H),y(x);var b=E(x,2),_=k(b),g=k(_,!0);y(_);var T=E(_,2),G=k(T,!0);y(T),y(b),ge(()=>{V(D,o()),V(j,s()),V(P,i()),V(g,l()),V(G,u())}),ee(Z,U)},X=(Z,U)=>{{var oe=D=>{var x=Vn(),W=$t(x),j=k(W,!0);y(W);var H=E(W,2),P=k(H),b=k(P,!0);y(P);var _=E(P,2),g=k(_,!0);y(_),y(H);var T=E(H,2),G=k(T),ae=k(G,!0);y(G);var se=E(G,2),J=k(se,!0);y(se),y(T),ge(()=>{V(j,c()),V(b,s()),V(g,i()),V(ae,v()),V(J,p())}),ee(D,x)};ue(Z,D=>{a.type==="destination"&&D(oe)},U)}};ue(F,Z=>{a.type==="pickup"?Z(z):Z(X,!1)})}y(N),y($),ee(t,$),Oe(),f()}async function Wn(t,a,e,f){var n,r,o;if(ce.set(!0),fe.set({key:"loading",params:{}}),a())if(e.type==="pickup"){const s=(n=a())==null?void 0:n.chosen_route_stops.destination.position;(r=f())==null||r.publishGoal({type:"dropoff",position:s,chosen_spots:a().chosen_spots,chosen_route_stops:a().chosen_route_stops})}else e.type==="destination"&&(Lr(),(o=f())==null||o.publishGoal({type:"done",position:{lat:0,lng:0,height:0},chosen_spots:{},chosen_route_stops:{}}),he.set("rating"))}var Kn=ne('<div class="arrived-info-container svelte-1pss86t"><div class="arrived-info-card svelte-1pss86t"><h2 class="arrived-heading svelte-1pss86t"> </h2> <div class="button-container svelte-1pss86t"><h3 class="arrived-subheading svelte-1pss86t"> </h3> <button class="arrived-confirm-btn svelte-1pss86t"> </button></div></div></div>');function Ya(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(Bt,"$pathChosenPickupToBusStopPickup",e),r=()=>O(Nt,"$pathBusStopDestinationToChosenDestination",e),o=()=>O(St,"$carStatus",e),s=()=>O(Et,"$locale",e),i=()=>O(Vt,"$mqttClient",e),l=()=>O(v,"$confirmHeadingMessage",e),u=()=>O(p,"$confirmButtonHeadingMessage",e),c=()=>O(h,"$confirmButtonMessage",e);qe(async()=>{var N,F,z;Ot.set({top:400,bottom:100}),await ye.initialize(),(!n()||!r())&&await ye.calculatePreliminaryRoutes(((N=o())==null?void 0:N.chosen_spots)??null,((F=o())==null?void 0:F.chosen_route_stops.pickup)??null,((z=o())==null?void 0:z.chosen_route_stops.destination)??null,s(),!1),a.type=="pickup"?De.set("pickup"):a.type=="destination"&&De.set("destination"),ce.set(!1),fe.set({key:"loading",params:{}})});const v=a.type==="pickup"?K("arrived_at_pickup_info"):K("arrived_at_destination_info"),p=a.type==="pickup"?K("confirm_in_car_info"):K("confirm_destination_info"),h=a.type==="pickup"?K("confirm_in_car_button"):K("confirm_destination_button");var M=Kn(),m=k(M),S=k(m),R=k(S,!0);y(S);var B=E(S,2),L=k(B),C=k(L,!0);y(L);var q=E(L,2);q.__click=[Wn,o,a,i];var $=k(q,!0);y(q),y(B),y(m),y(M),ge(()=>{V(R,l()),V(C,u()),V($,c())}),ee(t,M),Oe(),f()}Te(["click"]);var Fn=ne('<button type="button" class="star-btn svelte-rv59cl"><img class="star svelte-rv59cl"/></button>'),jn=()=>{ce.set(!0),fe.set({key:"loading",params:{}}),he.set("map-idle")},Hn=ne('<div class="rating-overlay svelte-rv59cl"><div class="rating-card svelte-rv59cl"><h2 class="rating-heading svelte-rv59cl"> </h2> <div class="stars svelte-rv59cl"></div> <button class="skip-btn svelte-rv59cl"> </button></div></div>');function Xn(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(Vt,"$mqttClient",e),r=()=>O(h,"$ratingHeadingText",e),o=()=>O(M,"$ratingRefuseText",e);let s=Y(0),i=Y(0),l=Y(""),u=Y("");qe(async()=>{Ot.set({top:200,bottom:200}),w(l,await At("/star_filled.svg"),!0),w(u,await At("/star_empty.svg"),!0),ce.set(!1),fe.set({key:"loading",params:{}})});function c($){var N;w(s,$,!0),ce.set(!0),fe.set({key:"loading",params:{}}),(N=n())==null||N.publishRating(d(s),new Date().toISOString()),he.set("map-idle")}function v($){w(i,$,!0)}function p(){w(i,0)}const h=K("rating_heading"),M=K("rating_refuse");var m=Hn(),S=k(m),R=k(S),B=k(R,!0);y(R);var L=E(R,2);It(L,20,()=>Array.from({length:5}),Gt,($,N,F)=>{var z=Fn();z.__click=()=>c(F+1),Ce(z,"aria-label",`Rate ${F+1} star${F===0?"":"s"}`);var X=k(z);Ce(X,"alt",F+1+" star"),y(z),ge(()=>Ce(X,"src",(d(i)?F<d(i):F<d(s))?d(l):d(u))),xt("mouseenter",z,()=>v(F+1)),xt("mouseleave",z,p),ee($,z)}),y(L);var C=E(L,2);C.__click=[jn];var q=k(C,!0);y(C),y(S),y(m),ge(()=>{V(B,r()),V(q,o())}),ee(t,m),Oe(),f()}Te(["click"]);var Un=ne('<div class="app-root"><!> <!></div>');function si(t,a){Se(a,!0);const[e,f]=we(),n=()=>O(Vt,"$mqttClient",e),r=()=>O(St,"$carStatus",e),o=()=>O(he,"$appState",e),s=()=>O(Sr,"$sessionId",e),i=()=>O(fe,"$appGlobalLoadingMessageKey",e),l=()=>O(ce,"$appGlobalLoading",e),u=()=>O(d(p),"$appGlobalLoadingMessage",e);qe(()=>{let L=null,C=0;return navigator.geolocation?L=navigator.geolocation.watchPosition(q=>{const $=Date.now();$-C>=500&&(Tt.set({lat:q.coords.latitude,lng:q.coords.longitude}),C=$)},q=>{console.warn("Geolocation denied or unavailable:",q)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:1e3}):(Tt.set(null),console.warn("Geolocation not supported")),()=>{L!==null&&navigator.geolocation.clearWatch(L)}}),pe(()=>{n()||Mr("/login")});let c=null;pe(()=>{if(n()&&r()){if(r().state===c)return;switch(c=r().state,r().state){case"waiting":o()!=="rating"&&he.set("map-idle");break;case"driving-to-pickup":he.set("driving-to-pickup");break;case"arrived-to-pickup":he.set("arrived-to-pickup");break;case"driving-to-destination":he.set("driving-to-destination");break;case"arrived-to-destination":he.set("arrived-to-destination");break;case"shutting-down":ce.set(!0),fe.set({key:"car_shutting_down"});const L=s()??"";Dr.set({key:"session_closed",params:{id:L}}),Ja();break;default:console.error("Unknown car status state:",JSON.stringify(r().state));break}}});let v=Me(()=>o()==="map-idle"||o()==="bus-stop-picking"||o()==="driving-to-pickup"||o()==="arrived-to-pickup"||o()==="driving-to-destination"||o()==="arrived-to-destination");const p=Me(()=>i()?K(i().key,i().params):null);var h=Un(),M=k(h);{var m=L=>{Ir(L,{children:(C,q)=>{var $=kr(),N=$t($);{var F=X=>{Vr(X,{})},z=(X,le)=>{{var I=te=>{Gn(te,{})},ie=(te,Z)=>{{var U=D=>{Za(D,{type:"pickup"})},oe=(D,x)=>{{var W=H=>{Ya(H,{type:"pickup"})},j=(H,P)=>{{var b=g=>{Za(g,{type:"destination"})},_=(g,T)=>{{var G=ae=>{Ya(ae,{type:"destination"})};ue(g,ae=>{o()==="arrived-to-destination"&&ae(G)},T)}};ue(H,g=>{o()==="driving-to-destination"?g(b):g(_,!1)},P)}};ue(D,H=>{o()==="arrived-to-pickup"?H(W):H(j,!1)},x)}};ue(te,D=>{o()==="driving-to-pickup"?D(U):D(oe,!1)},Z)}};ue(X,te=>{o()==="bus-stop-picking"?te(I):te(ie,!1)},le)}};ue(N,X=>{o()==="map-idle"?X(F):X(z,!1)})}ee(C,$)},$$slots:{default:!0}})},S=(L,C)=>{{var q=N=>{On(N,{})},$=(N,F)=>{{var z=X=>{Xn(X,{})};ue(N,X=>{o()==="rating"&&X(z)},F)}};ue(L,N=>{o()==="spot-picking"?N(q):N($,!1)},C)}};ue(M,L=>{d(v)?L(m):L(S,!1)})}var R=E(M,2);{var B=L=>{wr(L,{get loadingMsg(){return u()}})};ue(R,L=>{l()&&L(B)})}y(h),ee(t,h),Oe(),f()}export{si as component};
