var vr=Object.defineProperty;var gr=(t,a,e)=>a in t?vr(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var wt=(t,a,e)=>gr(t,typeof a!="symbol"?a+"":a,e);import"../chunks/CWj6FrbW.js";import{aJ as pr,aK as _r,O as mr,d as hr,a3 as br,z as Te,p as De,o as qe,s as O,C as Q,b as ge,f as d,A as oe,G as $t,F as I,D as P,E as y,H as yr,I as ce,J as G,B as ae,a as Oe,n as Pr,aI as xt,K as Me,aG as kr}from"../chunks/CM7s3TdM.js";import{a as D,b as Jt,s as we,i as le}from"../chunks/CZY1Q9bT.js";import{g as Mr}from"../chunks/D4KMYkgP.js";import{e as fe,f as ve,c as Dt,u as Tt,p as Qt,g as Ct,h as Bt,i as At,j as he,k as Se,n as Ot,r as Ya,o as Ja,l as Et,q as qt,t as ea,b as Vt,v as Lr,d as Sr,s as Dr}from"../chunks/Blbe2GpZ.js";import{_ as Or,p as Ge}from"../chunks/CvhVpWJc.js";import{f as Nt,L as wr}from"../chunks/DKuJeQhF.js";import{t as K,r as Rr,s as Ce,a as xe,e as It,i as Gt}from"../chunks/BkN9kBNi.js";import"../chunks/PCJ5bLI3.js";import{i as Cr}from"../chunks/DJhY8YgZ.js";function qr(t,a,e=a){var f=pr();_r(t,"input",r=>{var i=r?t.defaultValue:t.value;if(i=Xt(t)?Ut(i):i,e(i),f&&i!==(i=a())){var s=t.selectionStart,o=t.selectionEnd;t.value=i??"",o!==null&&(t.selectionStart=s,t.selectionEnd=Math.min(o,t.value.length))}}),(mr&&t.defaultValue!==t.value||hr(a)==null&&t.value)&&e(Xt(t)?Ut(t.value):t.value),br(()=>{var r=a();Xt(t)&&r===Ut(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function Xt(t){var a=t.type;return a==="number"||a==="range"}function Ut(t){return t===""?null:+t}let Zt=null,Rt=null;async function Ae(){return Rt||(Zt||(Zt=(async()=>{const t=await Or(()=>import("../chunks/D-8nYH0_.js"),[],import.meta.url),a=t.Loader||t.default&&t.default.Loader;if(!a)throw new Error("Could not load Google Maps Loader");return Rt=new a({apiKey:"AIzaSyAixRzVqb7kii3XrzzL3OxsN7k_2CoMeaM",version:"weekly"}),Rt})()),Zt)}async function Qa(){return await(await Ae()).importLibrary("core")}async function er(){return await(await Ae()).importLibrary("maps")}async function $r(){return await(await Ae()).importLibrary("marker")}async function xr(){return await(await Ae()).importLibrary("places")}async function ia(){return await(await Ae()).importLibrary("routes")}async function Tr(){return await(await Ae()).importLibrary("geometry")}async function Br(t,a={}){const{Map:e}=await er();return new e(t,a)}function Ar(){fe.set(!0),ve.set({key:"ending_session",params:{}}),Ya()}var Nr=oe('<div class="map-container svelte-1bz92gb"></div> <button class="end-session-button svelte-1bz92gb"> </button> <!>',1);function Ir(t,a){De(a,!0);const[e,f]=we(),r=()=>D(Ja,"$isDriving",e),i=()=>D(Dt,"$carStatus",e),s=()=>D(Tt,"$userLocation",e),o=()=>D(Qt,"$pathCarToBusStopPickup",e),n=()=>D(Ct,"$pathBusStopPickupToBusStopDestination",e),l=()=>D(Bt,"$pathChosenPickupToBusStopPickup",e),u=()=>D(At,"$pathBusStopDestinationToChosenDestination",e),c=()=>D(he,"$appState",e),v=()=>D(Se,"$fitBoundsTarget",e),p=()=>D(Ot,"$fitBoundsVerticalPadding",e),h=()=>D(R,"$endSessionText",e);let M,m=null,S=Q(null),w=Q(null),N=Q(null),L=Q(null),C=Q(null),$=Q(null),x=null,B=null,H=null,F=null,j=null,ee=null;async function U(b,k){for(;!m;)await new Promise(_=>setTimeout(_,10));if(b){const _={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},g={path:j,strokeOpacity:1,scale:4},T={path:ee,strokeOpacity:1,scale:4};return k?b.setOptions({strokeOpacity:0,icons:[{icon:_,offset:"0",repeat:"20px"},{icon:g,offset:"0",repeat:"0"},{icon:T,offset:"100%",repeat:"0"}],visible:!1,map:m,zIndex:1}):b.setOptions({strokeColor:"#FF0000",strokeWeight:4,icons:[{icon:g,offset:"0",repeat:"0"},{icon:T,offset:"100%",repeat:"0"}],visible:!1,map:m}),b.setMap(m),b}return null}function ue(b,k){if(!k||k.length<2)return{index:0,progress:0};let _=1/0,g=0,T=0;for(let E=0;E<k.length-1;E++){const ne=k[E],se=k[E+1],Y=re(b,ne,se),de=J(ne,se,Y),W=google.maps.geometry.spherical.computeDistanceBetween(b,de);W<_&&(_=W,g=E,T=Y)}return{index:g,progress:T}}function re(b,k,_){const g=k.lat(),T=k.lng(),E=_.lat(),ne=_.lng(),se=b.lat(),Y=b.lng(),de=ne-T,W=E-g,pe=de*de+W*W;if(pe===0)return 0;const $e=((Y-T)*de+(se-g)*W)/pe;return Math.max(0,Math.min(1,$e))}function J(b,k,_){const g=b.lat()+(k.lat()-b.lat())*_,T=b.lng()+(k.lng()-b.lng())*_;return new google.maps.LatLng(g,T)}function X(b,k,_,g){if(!b||!m)return k;const T=b.getPath().getArray();if(T.length<2)return k;const{index:E,progress:ne}=ue(_,T),se=[];for(let Y=0;Y<=E;Y++)se.push(T[Y]);if(ne>0&&E<T.length-1){const Y=J(T[E],T[E+1],ne);se.push(Y)}if(!k){let Y="#FF0000";r()&&(Y="#00AA00"),k=new google.maps.Polyline({map:m,strokeColor:Y,strokeWeight:4,strokeOpacity:1,zIndex:1})}return k.setPath(se),k}qe(async()=>{var E;fe.set(!0),ve.set({key:"loading_map",params:{}}),m=await Br(M,{center:{lat:58.378,lng:26.729},zoom:13,disableDefaultUI:!0,mapId:"DEMO_MAP_ID"});const{AdvancedMarkerElement:b}=await $r(),{SymbolPath:k}=await Qa();await Tr(),j=k.CIRCLE,ee=k.FORWARD_OPEN_ARROW,H=await Nt("/usermarker.svg"),F=await Nt("/carmarker.svg");const _=document.createElement("img");_.src=F,_.style.width="48px",_.style.height="48px",B=new b({position:(E=i())==null?void 0:E.pose,map:m,content:_});const g=document.createElement("img");g.src=H,g.style.width="32px",g.style.height="32px",x=new b({map:m,content:g});const{Polyline:T}=await er();O(S,await U(new T,!0),!0),O(w,await U(new T,!1),!0),O(N,await U(new T,!0),!0),O(L,await U(new T,!1),!0),O(C,null),O($,null),fe.set(!1),ve.set({key:"loading",params:{}})}),ge(()=>{s()&&x&&(x.position=s())}),ge(()=>{var b;if((b=i())!=null&&b.pose&&B){B.position=i().pose;const k=new google.maps.LatLng(i().pose.lat,i().pose.lng);d(L)&&o()&&O($,X(d(L),d($),k),!0),d(w)&&n()&&O(C,X(d(w),d(C),k),!0)}}),ge(()=>{s()&&x&&(x.position=s())}),ge(()=>{var b,k;l()&&d(S)?(d(S).setPath(l().pathArray),d(S).setVisible(!0)):(b=d(S))!=null&&b.getVisible()&&((k=d(S))==null||k.setVisible(!1))}),ge(()=>{var b,k;n()&&d(w)?(d(w).setPath(n().pathArray),d(w).setVisible(!0)):(b=d(w))!=null&&b.getVisible()&&((k=d(w))==null||k.setVisible(!1),d(C)&&(d(C).setMap(null),O(C,null)))}),ge(()=>{var b,k;u()&&d(N)?(d(N).setPath(u().pathArray),d(N).setVisible(!0)):(b=d(N))!=null&&b.getVisible()&&((k=d(N))==null||k.setVisible(!1))}),ge(()=>{var b,k;o()&&d(L)?(d(L).setPath(o().pathArray),d(L).setVisible(!0)):(b=d(L))!=null&&b.getVisible()&&((k=d(L))==null||k.setVisible(!1),d($)&&(d($).setMap(null),O($,null)))}),ge(()=>{var b,k,_,g;c().includes("arrived")&&((b=d(C))==null||b.setMap(null),(k=d(w))==null||k.setVisible(!1),(_=d($))==null||_.setMap(null),(g=d(L))==null||g.setVisible(!1))}),ge(()=>{var b,k,_,g,T,E,ne;if(v()==="all"){if((b=l())!=null&&b.bounds&&((k=n())!=null&&k.bounds)&&((_=u())!=null&&_.bounds)){const se=new google.maps.LatLngBounds(l().bounds.getSouthWest(),l().bounds.getNorthEast()),Y=new google.maps.LatLngBounds(n().bounds.getSouthWest(),n().bounds.getNorthEast()),de=new google.maps.LatLngBounds(u().bounds.getSouthWest(),u().bounds.getNorthEast());se.union(Y),se.union(de),m==null||m.fitBounds(se,{top:p().top,bottom:p().bottom})}}else v()==="pickup"?(g=l())!=null&&g.bounds&&(m==null||m.fitBounds(l().bounds,{top:p().top,bottom:p().bottom})):v()==="destination"?(T=u())!=null&&T.bounds&&(m==null||m.fitBounds(u().bounds,{top:p().top,bottom:p().bottom})):v()==="carToPickup"?(E=o())!=null&&E.bounds&&((ne=l())!=null&&ne.bounds)&&(m==null||m.fitBounds(o().bounds.union(l().bounds),{top:p().top,bottom:p().bottom})):v()==="default"&&(m==null||m.setCenter({lat:58.378,lng:26.729}),m==null||m.setZoom(13))});const R=K("end_session_button");var q=Nr(),A=$t(q);Jt(A,b=>M=b,()=>M);var V=I(A,2);V.__click=[Ar];var Z=P(V,!0);y(V);var z=I(V,2);yr(z,()=>a.children),ce(()=>G(Z,h())),ae(t,q),Oe(),f()}Te(["click"]);function Gr(){fe.set(!0),ve.set({key:"loading",params:{}}),he.set("spot-picking")}var Er=oe('<div class="footer-background svelte-1iqii79"><button class="order-car-button svelte-1iqii79"> </button></div>');function Vr(t,a){De(a,!1);const[e,f]=we(),r=()=>D(i,"$orderCarText",e),i=K("order_car_button");Cr();var s=Er(),o=P(s);o.__click=[Gr];var n=P(o,!0);y(o),y(s),ce(()=>G(n,r())),ae(t,s),Oe(),f()}Te(["click"]);var Yt={},Ee={},Ve={},te={},oa;function _e(){if(oa)return te;oa=1,Object.defineProperty(te,"__esModule",{value:!0}),te.areaConversion=te.timeConversion=te.distanceConversion=te.altitudeKeys=te.latitudeKeys=te.longitudeKeys=te.MAXLON=te.MINLON=te.MAXLAT=te.MINLAT=te.earthRadius=te.sexagesimalPattern=void 0;var t=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;te.sexagesimalPattern=t;var a=6378137;te.earthRadius=a;var e=-90;te.MINLAT=e;var f=90;te.MAXLAT=f;var r=-180;te.MINLON=r;var i=180;te.MAXLON=i;var s=["lng","lon","longitude",0];te.longitudeKeys=s;var o=["lat","latitude",1];te.latitudeKeys=o;var n=["alt","altitude","elevation","elev",2];te.altitudeKeys=n;var l={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};te.distanceConversion=l;var u={m:60,h:3600,d:86400};te.timeConversion=u;var c={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};return te.areaConversion=c,c.sqm=c.m2,c.sqkm=c.km2,c.sqft=c.ft2,c.sqyd=c.yd2,c.sqin=c.in2,te}var ze={},sa;function zt(){if(sa)return ze;sa=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.default=void 0;var t=function(f,r){return r.reduce(function(i,s){if(typeof f>"u"||f===null)throw new Error("'".concat(f,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(f,s)&&typeof s<"u"&&typeof i>"u"?(i=s,s):i},void 0)},a=t;return ze.default=a,ze}var We={},Ke={},ua;function Wt(){if(ua)return Ke;ua=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var t=function(f){var r=f.toString().trim();return isNaN(parseFloat(r))?!1:parseFloat(r)===Number(r)},a=t;return Ke.default=a,Ke}var Fe={},la;function Kt(){if(la)return Fe;la=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var t=_e(),a=function(r){return t.sexagesimalPattern.test(r.toString().trim())},e=a;return Fe.default=e,Fe}var je={},da;function Ft(){if(da)return je;da=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var t=_e(),a=function(r){var i=new RegExp(t.sexagesimalPattern).exec(r.toString().trim());if(typeof i>"u"||i===null)throw new Error("Given value is not in sexagesimal format");var s=Number(i[2])/60||0,o=Number(i[4])/3600||0,n=parseFloat(i[1])+s+o;return["S","W"].includes(i[7])?-n:n},e=a;return je.default=e,je}var He={},Xe={},ca;function ta(){if(ca)return Xe;ca=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var t=_e(),a=e(zt());function e(n){return n&&n.__esModule?n:{default:n}}function f(n,l){var u=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);l&&(c=c.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),u.push.apply(u,c)}return u}function r(n){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?arguments[l]:{};l%2?f(Object(u),!0).forEach(function(c){i(n,c,u[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(u)):f(Object(u)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(u,c))})}return n}function i(n,l,u){return l in n?Object.defineProperty(n,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[l]=u,n}var s=function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:t.longitudeKeys,latitude:t.latitudeKeys,altitude:t.altitudeKeys},c=(0,a.default)(l,u.longitude),v=(0,a.default)(l,u.latitude),p=(0,a.default)(l,u.altitude);return r({latitude:v,longitude:c},p?{altitude:p}:{})},o=s;return Xe.default=o,Xe}var Ue={},fa;function tr(){if(fa)return Ue;fa=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var t=r(Wt()),a=r(Kt()),e=r(Ft()),f=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function o(n){return(0,t.default)(n)?!(parseFloat(n)>f.MAXLAT||n<f.MINLAT):(0,a.default)(n)?o((0,e.default)(n)):!1},s=i;return Ue.default=s,Ue}var Ze={},va;function ar(){if(va)return Ze;va=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var t=r(Wt()),a=r(Kt()),e=r(Ft()),f=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function o(n){return(0,t.default)(n)?!(parseFloat(n)>f.MAXLON||n<f.MINLON):(0,a.default)(n)?o((0,e.default)(n)):!1},s=i;return Ze.default=s,Ze}var ga;function rr(){if(ga)return He;ga=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;var t=f(ta()),a=f(tr()),e=f(ar());function f(s){return s&&s.__esModule?s:{default:s}}var r=function(o){var n=(0,t.default)(o),l=n.latitude,u=n.longitude;if(Array.isArray(o)&&o.length>=2)return(0,e.default)(o[0])&&(0,a.default)(o[1]);if(typeof l>"u"||typeof u>"u")return!1;var c=o[u],v=o[l];return!(typeof v>"u"||typeof c>"u"||(0,a.default)(v)===!1||(0,e.default)(c)===!1)},i=r;return He.default=i,He}var pa;function aa(){if(pa)return We;pa=1,Object.defineProperty(We,"__esModule",{value:!0}),We.default=void 0;var t=i(Wt()),a=i(Kt()),e=i(Ft()),f=i(rr()),r=i(ta());function i(c){return c&&c.__esModule?c:{default:c}}function s(c,v){var p=Object.keys(c);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(c);v&&(h=h.filter(function(M){return Object.getOwnPropertyDescriptor(c,M).enumerable})),p.push.apply(p,h)}return p}function o(c){for(var v=1;v<arguments.length;v++){var p=arguments[v]!=null?arguments[v]:{};v%2?s(Object(p),!0).forEach(function(h){n(c,h,p[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(p)):s(Object(p)).forEach(function(h){Object.defineProperty(c,h,Object.getOwnPropertyDescriptor(p,h))})}return c}function n(c,v,p){return v in c?Object.defineProperty(c,v,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[v]=p,c}var l=function c(v){if((0,t.default)(v))return Number(v);if((0,a.default)(v))return(0,e.default)(v);if((0,f.default)(v)){var p=(0,r.default)(v);return Array.isArray(v)?v.map(function(h,M){return[0,1].includes(M)?c(h):h}):o(o(o({},v),p.latitude&&n({},p.latitude,c(v[p.latitude]))),p.longitude&&n({},p.longitude,c(v[p.longitude])))}return Array.isArray(v)?v.map(function(h){return(0,f.default)(h)?c(h):h}):v},u=l;return We.default=u,We}var _a;function Pe(){if(_a)return Ve;_a=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.default=void 0;var t=_e(),a=f(zt()),e=f(aa());function f(s){return s&&s.__esModule?s:{default:s}}var r=function(o,n){var l=(0,a.default)(o,t.latitudeKeys);if(!(typeof l>"u"||l===null)){var u=o[l];return n===!0?u:(0,e.default)(u)}},i=r;return Ve.default=i,Ve}var Ye={},ma;function ke(){if(ma)return Ye;ma=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var t=_e(),a=f(zt()),e=f(aa());function f(s){return s&&s.__esModule?s:{default:s}}var r=function(o,n){var l=(0,a.default)(o,t.longitudeKeys);if(!(typeof l>"u"||l===null)){var u=o[l];return n===!0?u:(0,e.default)(u)}},i=r;return Ye.default=i,Ye}var Je={},ha;function Re(){if(ha)return Je;ha=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var t=function(f){return f*Math.PI/180},a=t;return Je.default=a,Je}var Qe={},ba;function Ne(){if(ba)return Qe;ba=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var t=function(f){return f*180/Math.PI},a=t;return Qe.default=a,Qe}var ya;function zr(){if(ya)return Ee;ya=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Re()),f=i(Ne()),r=_e();function i(n){return n&&n.__esModule?n:{default:n}}var s=function(l,u,c){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6371e3,p=(0,t.default)(l),h=(0,a.default)(l),M=u/v,m=(0,e.default)(c),S=(0,e.default)(p),w=(0,e.default)(h),N=Math.asin(Math.sin(S)*Math.cos(M)+Math.cos(S)*Math.sin(M)*Math.cos(m)),L=w+Math.atan2(Math.sin(m)*Math.sin(M)*Math.cos(S),Math.cos(M)-Math.sin(S)*Math.sin(N)),C=(0,f.default)(L);return(C<r.MINLON||C>r.MAXLON)&&(L=(L+3*Math.PI)%(2*Math.PI)-Math.PI,C=(0,f.default)(L)),{latitude:(0,f.default)(N),longitude:C}},o=s;return Ee.default=o,Ee}var et={},Pa;function Wr(){if(Pa)return et;Pa=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var t=_e(),a=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",s=t.areaConversion[i];if(s)return r*s;throw new Error("Invalid unit used for area conversion.")},e=a;return et.default=e,et}var tt={},ka;function Kr(){if(ka)return tt;ka=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var t=_e(),a=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",s=t.distanceConversion[i];if(s)return r*s;throw new Error("Invalid unit used for distance conversion.")},e=a;return tt.default=e,tt}var at={},Ma;function Fr(){if(Ma)return at;Ma=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=void 0;var t=_e(),a=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kmh";switch(i){case"kmh":return r*t.timeConversion.h*t.distanceConversion.km;case"mph":return r*t.timeConversion.h*t.distanceConversion.mi;default:return r}},e=a;return at.default=e,at}var rt={},La;function jr(){if(La)return rt;La=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;function t(l,u){return i(l)||r(l,u)||e(l,u)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(l,u){if(l){if(typeof l=="string")return f(l,u);var c=Object.prototype.toString.call(l).slice(8,-1);if(c==="Object"&&l.constructor&&(c=l.constructor.name),c==="Map"||c==="Set")return Array.from(l);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return f(l,u)}}function f(l,u){(u==null||u>l.length)&&(u=l.length);for(var c=0,v=new Array(u);c<u;c++)v[c]=l[c];return v}function r(l,u){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(l)))){var c=[],v=!0,p=!1,h=void 0;try{for(var M=l[Symbol.iterator](),m;!(v=(m=M.next()).done)&&(c.push(m.value),!(u&&c.length===u));v=!0);}catch(S){p=!0,h=S}finally{try{!v&&M.return!=null&&M.return()}finally{if(p)throw h}}return c}}function i(l){if(Array.isArray(l))return l}var s=function(u){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,v=Math.pow(10,c);return Math.round(u*v)/v},o=function(u){var c=u.toString().split("."),v=t(c,2),p=v[0],h=v[1],M=Math.abs(Number(p)),m=+("0."+(h||0))*60,S=m.toString().split("."),w=Math.floor(m),N=s(+("0."+(S[1]||0))*60).toString(),L=N.split("."),C=t(L,2),$=C[0],x=C[1],B=x===void 0?"0":x;return M+"° "+w.toString().padStart(2,"0")+"' "+$.padStart(2,"0")+"."+B.padEnd(1,"0")+'"'},n=o;return rt.default=n,rt}var nt={},it={},ot={},st={},Sa;function nr(){if(Sa)return st;Sa=1,Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;var t=function(f){return f>1?1:f<-1?-1:f},a=t;return st.default=a,st}var Da;function Be(){if(Da)return ot;Da=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Re()),f=i(nr()),r=_e();function i(n){return n&&n.__esModule?n:{default:n}}var s=function(l,u){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;c=typeof c<"u"&&!isNaN(c)?c:1;var v=(0,t.default)(l),p=(0,a.default)(l),h=(0,t.default)(u),M=(0,a.default)(u),m=Math.acos((0,f.default)(Math.sin((0,e.default)(h))*Math.sin((0,e.default)(v))+Math.cos((0,e.default)(h))*Math.cos((0,e.default)(v))*Math.cos((0,e.default)(p)-(0,e.default)(M))))*r.earthRadius;return Math.round(m/c)*c},o=s;return ot.default=o,ot}var Oa;function ir(){if(Oa)return it;Oa=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var t=a(Be());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default;return o=typeof o=="function"?o:t.default,s.slice().sort(function(n,l){return o(i,n)-o(i,l)})},f=e;return it.default=f,it}var wa;function Hr(){if(wa)return nt;wa=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var t=a(ir());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){return(0,t.default)(i,s)[0]},f=e;return nt.default=f,nt}var ut={},Ra;function Xr(){if(Ra)return ut;Ra=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var t=r(Re()),a=r(Pe()),e=r(ke()),f=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n){var l=0;if(n.length>2){for(var u,c,v,p=0;p<n.length;p++){p===n.length-2?(u=n.length-2,c=n.length-1,v=0):p===n.length-1?(u=n.length-1,c=0,v=1):(u=p,c=p+1,v=p+2);var h=(0,e.default)(n[u]),M=(0,a.default)(n[c]),m=(0,e.default)(n[v]);l+=((0,t.default)(m)-(0,t.default)(h))*Math.sin((0,t.default)(M))}l=l*f.earthRadius*f.earthRadius/2}return Math.abs(l)},s=i;return ut.default=s,ut}var lt={},Ca;function or(){if(Ca)return lt;Ca=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.default=void 0;var t=e(Pe()),a=e(ke());function e(i){return i&&i.__esModule?i:{default:i}}var f=function(s){if(Array.isArray(s)===!1||s.length===0)throw new Error("No points were given.");return s.reduce(function(o,n){var l=(0,t.default)(n),u=(0,a.default)(n);return{maxLat:Math.max(l,o.maxLat),minLat:Math.min(l,o.minLat),maxLng:Math.max(u,o.maxLng),minLng:Math.min(u,o.minLng)}},{maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0})},r=f;return lt.default=r,lt}var dt={},qa;function Ur(){if(qa)return dt;qa=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;var t=i(Pe()),a=i(ke()),e=i(Re()),f=i(Ne()),r=_e();function i(n){return n&&n.__esModule?n:{default:n}}var s=function(l,u){var c=(0,t.default)(l),v=(0,a.default)(l),p=(0,e.default)(c),h=(0,e.default)(v),M=u/r.earthRadius,m=p-M,S=p+M,w=(0,e.default)(r.MAXLAT),N=(0,e.default)(r.MINLAT),L=(0,e.default)(r.MAXLON),C=(0,e.default)(r.MINLON),$,x;if(m>N&&S<w){var B=Math.asin(Math.sin(M)/Math.cos(p));$=h-B,$<C&&($+=Math.PI*2),x=h+B,x>L&&(x-=Math.PI*2)}else m=Math.max(m,N),S=Math.min(S,w),$=C,x=L;return[{latitude:(0,f.default)(m),longitude:(0,f.default)($)},{latitude:(0,f.default)(S),longitude:(0,f.default)(x)}]},o=s;return dt.default=o,dt}var ct={},$a;function Zr(){if($a)return ct;$a=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=r(Ne());function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n){if(Array.isArray(n)===!1||n.length===0)return!1;var l=n.length,u=n.reduce(function(h,M){var m=(0,e.default)((0,t.default)(M)),S=(0,e.default)((0,a.default)(M));return{X:h.X+Math.cos(m)*Math.cos(S),Y:h.Y+Math.cos(m)*Math.sin(S),Z:h.Z+Math.sin(m)}},{X:0,Y:0,Z:0}),c=u.X/l,v=u.Y/l,p=u.Z/l;return{longitude:(0,f.default)(Math.atan2(v,c)),latitude:(0,f.default)(Math.atan2(p,Math.sqrt(c*c+v*v)))}},s=i;return ct.default=s,ct}var ft={},xa;function Yr(){if(xa)return ft;xa=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.default=void 0;var t=a(or());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i){var s=(0,t.default)(i),o=s.minLat+(s.maxLat-s.minLat)/2,n=s.minLng+(s.maxLng-s.minLng)/2;return{latitude:parseFloat(o.toFixed(6)),longitude:parseFloat(n.toFixed(6))}},f=e;return ft.default=f,ft}var vt={},gt={},Ta;function sr(){if(Ta)return gt;Ta=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=r(Ne());function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n,l){var u=(0,e.default)((0,a.default)(l))-(0,e.default)((0,a.default)(n)),c=Math.log(Math.tan((0,e.default)((0,t.default)(l))/2+Math.PI/4)/Math.tan((0,e.default)((0,t.default)(n))/2+Math.PI/4));return Math.abs(u)>Math.PI&&(u>0?u=(Math.PI*2-u)*-1:u=Math.PI*2+u),((0,f.default)(Math.atan2(u,c))+360)%360},s=i;return gt.default=s,gt}var Ba;function Jr(){if(Ba)return vt;Ba=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.default=void 0;var t=a(sr());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,n=typeof o=="function"?o(i,s):(0,t.default)(i,s);if(isNaN(n))throw new Error("Could not calculate bearing for given points. Check your bearing function");switch(Math.round(n/22.5)){case 1:return"NNE";case 2:return"NE";case 3:return"ENE";case 4:return"E";case 5:return"ESE";case 6:return"SE";case 7:return"SSE";case 8:return"S";case 9:return"SSW";case 10:return"SW";case 11:return"WSW";case 12:return"W";case 13:return"WNW";case 14:return"NW";case 15:return"NNW";default:return"N"}},f=e;return vt.default=f,vt}var pt={},Aa;function ur(){if(Aa)return pt;Aa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var t=e(Be()),a=e(nr());function e(i){return i&&i.__esModule?i:{default:i}}var f=function(s,o,n){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,u=(0,t.default)(o,s,l),c=(0,t.default)(s,n,l),v=(0,t.default)(o,n,l),p=Math.acos((0,a.default)((u*u+v*v-c*c)/(2*u*v))),h=Math.acos((0,a.default)((c*c+v*v-u*u)/(2*c*v)));return p>Math.PI/2?u:h>Math.PI/2?c:Math.sin(p)*u},r=f;return pt.default=r,pt}var _t={},Na;function Qr(){if(Na)return _t;Na=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=r(Ne());function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n,l){var u=(0,t.default)(l),c=(0,a.default)(l),v=(0,t.default)(n),p=(0,a.default)(n),h=((0,f.default)(Math.atan2(Math.sin((0,e.default)(c)-(0,e.default)(p))*Math.cos((0,e.default)(u)),Math.cos((0,e.default)(v))*Math.sin((0,e.default)(u))-Math.sin((0,e.default)(v))*Math.cos((0,e.default)(u))*Math.cos((0,e.default)(c)-(0,e.default)(p))))+360)%360;return h},s=i;return _t.default=s,_t}var mt={},Ia;function en(){if(Ia)return mt;Ia=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var t=a(Be());function a(i){return i&&i.__esModule?i:{default:i}}function e(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(i)}var f=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.default;return s.reduce(function(n,l){return e(n)==="object"&&n.last!==null&&(n.distance+=o(l,n.last)),n.last=l,n},{last:null,distance:0}).distance},r=f;return mt.default=r,mt}var ht={},Ga;function tn(){if(Ga)return ht;Ga=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Re()),f=_e();function r(o){return o&&o.__esModule?o:{default:o}}var i=function(n,l){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;u=typeof u<"u"&&!isNaN(u)?u:1;var c=(0,t.default)(n),v=(0,a.default)(n),p=(0,t.default)(l),h=(0,a.default)(l),M=6356752314245e-6,m=1/298.257223563,S=(0,e.default)(h-v),w,N,L,C,$,x,B=Math.atan((1-m)*Math.tan((0,e.default)(parseFloat(c)))),H=Math.atan((1-m)*Math.tan((0,e.default)(parseFloat(p)))),F=Math.sin(B),j=Math.cos(B),ee=Math.sin(H),U=Math.cos(H),ue=S,re,J=100;do{var X=Math.sin(ue),R=Math.cos(ue);if(x=Math.sqrt(U*X*(U*X)+(j*ee-F*U*R)*(j*ee-F*U*R)),x===0)return 0;w=F*ee+j*U*R,N=Math.atan2(x,w),L=j*U*X/x,C=1-L*L,$=w-2*F*ee/C,isNaN($)&&($=0);var q=m/16*C*(4+m*(4-3*C));re=ue,ue=S+(1-q)*m*L*(N+q*x*($+q*w*(-1+2*$*$)))}while(Math.abs(ue-re)>1e-12&&--J>0);if(J===0)return NaN;var A=C*(f.earthRadius*f.earthRadius-M*M)/(M*M),V=1+A/16384*(4096+A*(-768+A*(320-175*A))),Z=A/1024*(256+A*(-128+A*(74-47*A))),z=Z*x*($+Z/4*(w*(-1+2*$*$)-Z/6*$*(-3+4*x*x)*(-3+4*$*$))),b=M*V*(N-z);return Math.round(b/u)*u},s=i;return ht.default=s,ht}var bt={},Ea;function an(){if(Ea)return bt;Ea=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.default=void 0;var t=function(f){if(/^(NNE|NE|NNW|N)$/.test(f))return"N";if(/^(ENE|E|ESE|SE)$/.test(f))return"E";if(/^(SSE|S|SSW|SW)$/.test(f))return"S";if(/^(WSW|W|WNW|NW)$/.test(f))return"W"},a=t;return bt.default=a,bt}var yt={},Va;function rn(){if(Va)return yt;Va=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var t=a(Be());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,n=o(i,s),l=Number(s.time)-Number(i.time),u=n/l*1e3;return u},f=e;return yt.default=f,yt}var Pt={},za;function nn(){if(za)return Pt;za=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=a(Be());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s,o){return(0,t.default)(s,i)+(0,t.default)(i,o)===(0,t.default)(s,o)},f=e;return Pt.default=f,Pt}var kt={},Wa;function on(){if(Wa)return kt;Wa=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var t=e(Pe()),a=e(ke());function e(i){return i&&i.__esModule?i:{default:i}}var f=function(s,o){for(var n=!1,l=o.length,u=-1,c=l-1;++u<l;c=u)((0,a.default)(o[u])<=(0,a.default)(s)&&(0,a.default)(s)<(0,a.default)(o[c])||(0,a.default)(o[c])<=(0,a.default)(s)&&(0,a.default)(s)<(0,a.default)(o[u]))&&(0,t.default)(s)<((0,t.default)(o[c])-(0,t.default)(o[u]))*((0,a.default)(s)-(0,a.default)(o[u]))/((0,a.default)(o[c])-(0,a.default)(o[u]))+(0,t.default)(o[u])&&(n=!n);return n},r=f;return kt.default=r,kt}var Mt={},Ka;function sn(){if(Ka)return Mt;Ka=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var t=a(ur());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s,o,n){return(0,t.default)(i,s,o)<n},f=e;return Mt.default=f,Mt}var Lt={},Fa;function un(){if(Fa)return Lt;Fa=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=a(Be());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(i,s,o){var n=.01;return(0,t.default)(i,s,n)<o},f=e;return Lt.default=f,Lt}var St={},ja;function ln(){if(ja)return St;ja=1,Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;function t(n,l){return i(n)||r(n,l)||e(n,l)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(n,l){if(n){if(typeof n=="string")return f(n,l);var u=Object.prototype.toString.call(n).slice(8,-1);if(u==="Object"&&n.constructor&&(u=n.constructor.name),u==="Map"||u==="Set")return Array.from(n);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return f(n,l)}}function f(n,l){(l==null||l>n.length)&&(l=n.length);for(var u=0,c=new Array(l);u<l;u++)c[u]=n[u];return c}function r(n,l){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(n)))){var u=[],c=!0,v=!1,p=void 0;try{for(var h=n[Symbol.iterator](),M;!(c=(M=h.next()).done)&&(u.push(M.value),!(l&&u.length===l));c=!0);}catch(m){v=!0,p=m}finally{try{!c&&h.return!=null&&h.return()}finally{if(v)throw p}}return u}}function i(n){if(Array.isArray(n))return n}var s=function(l){if(!l.startsWith("POLYGON"))throw new Error("Invalid wkt.");var u=l.slice(l.indexOf("(")+2,l.indexOf(")")).split(", "),c=u.map(function(v){var p=v.split(" "),h=t(p,2),M=h[0],m=h[1];return{longitude:parseFloat(M),latitude:parseFloat(m)}});return c},o=s;return St.default=o,St}var Ha;function dn(){return Ha||(Ha=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var a={computeDestinationPoint:!0,convertArea:!0,convertDistance:!0,convertSpeed:!0,decimalToSexagesimal:!0,findNearest:!0,getAreaOfPolygon:!0,getBounds:!0,getBoundsOfDistance:!0,getCenter:!0,getCenterOfBounds:!0,getCompassDirection:!0,getCoordinateKey:!0,getCoordinateKeys:!0,getDistance:!0,getDistanceFromLine:!0,getGreatCircleBearing:!0,getLatitude:!0,getLongitude:!0,getPathLength:!0,getPreciseDistance:!0,getRhumbLineBearing:!0,getRoughCompassDirection:!0,getSpeed:!0,isDecimal:!0,isPointInLine:!0,isPointInPolygon:!0,isPointNearLine:!0,isPointWithinRadius:!0,isSexagesimal:!0,isValidCoordinate:!0,isValidLatitude:!0,isValidLongitude:!0,orderByDistance:!0,sexagesimalToDecimal:!0,toDecimal:!0,toRad:!0,toDeg:!0,wktToPolygon:!0};Object.defineProperty(t,"computeDestinationPoint",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"convertArea",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"convertDistance",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"convertSpeed",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"decimalToSexagesimal",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"findNearest",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"getAreaOfPolygon",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"getBounds",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"getBoundsOfDistance",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"getCenter",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"getCenterOfBounds",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"getCompassDirection",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"getCoordinateKey",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"getCoordinateKeys",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(t,"getDistance",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"getDistanceFromLine",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"getGreatCircleBearing",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"getLatitude",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"getLongitude",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(t,"getPathLength",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"getPreciseDistance",{enumerable:!0,get:function(){return $.default}}),Object.defineProperty(t,"getRhumbLineBearing",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(t,"getRoughCompassDirection",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(t,"getSpeed",{enumerable:!0,get:function(){return H.default}}),Object.defineProperty(t,"isDecimal",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(t,"isPointInLine",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(t,"isPointInPolygon",{enumerable:!0,get:function(){return ee.default}}),Object.defineProperty(t,"isPointNearLine",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(t,"isPointWithinRadius",{enumerable:!0,get:function(){return ue.default}}),Object.defineProperty(t,"isSexagesimal",{enumerable:!0,get:function(){return re.default}}),Object.defineProperty(t,"isValidCoordinate",{enumerable:!0,get:function(){return J.default}}),Object.defineProperty(t,"isValidLatitude",{enumerable:!0,get:function(){return X.default}}),Object.defineProperty(t,"isValidLongitude",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"orderByDistance",{enumerable:!0,get:function(){return q.default}}),Object.defineProperty(t,"sexagesimalToDecimal",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(t,"toDecimal",{enumerable:!0,get:function(){return V.default}}),Object.defineProperty(t,"toRad",{enumerable:!0,get:function(){return Z.default}}),Object.defineProperty(t,"toDeg",{enumerable:!0,get:function(){return z.default}}),Object.defineProperty(t,"wktToPolygon",{enumerable:!0,get:function(){return b.default}});var e=_(zr()),f=_(Wr()),r=_(Kr()),i=_(Fr()),s=_(jr()),o=_(Hr()),n=_(Xr()),l=_(or()),u=_(Ur()),c=_(Zr()),v=_(Yr()),p=_(Jr()),h=_(zt()),M=_(ta()),m=_(Be()),S=_(ur()),w=_(Qr()),N=_(Pe()),L=_(ke()),C=_(en()),$=_(tn()),x=_(sr()),B=_(an()),H=_(rn()),F=_(Wt()),j=_(nn()),ee=_(on()),U=_(sn()),ue=_(un()),re=_(Kt()),J=_(rr()),X=_(tr()),R=_(ar()),q=_(ir()),A=_(Ft()),V=_(aa()),Z=_(Re()),z=_(Ne()),b=_(ln()),k=_e();Object.keys(k).forEach(function(g){g==="default"||g==="__esModule"||Object.prototype.hasOwnProperty.call(a,g)||Object.defineProperty(t,g,{enumerable:!0,get:function(){return k[g]}})});function _(g){return g&&g.__esModule?g:{default:g}}}(Yt)),Yt}var cn=dn();class fn{constructor(){wt(this,"stops",[])}async instantiate(){const e=await(await fetch("/stops.json")).json();this.stops=e.stops}findClosestStops(a,e=.5,f=3){return this.stops.map(s=>{const o=cn.getDistance({latitude:a[0],longitude:a[1]},{latitude:s.position.lat,longitude:s.position.lng})/1e3;return{name:s.name,position:s.position,dist_from_point:o}}).filter(s=>s.dist_from_point<=e).sort((s,o)=>s.dist_from_point-o.dist_from_point).slice(0,f)}}var vn=oe('<label for="spot-search-input" class="svelte-1bz9rsj"> </label>'),gn=(t,a)=>O(a,!0),pn=oe('<div class="loading-spinner svelte-1bz9rsj"></div>'),_n=oe('<button type="button" class="clear-searchbar svelte-1bz9rsj" aria-label="Clear"><img src="/clearsearchbar.svg" alt="Clear" class="clear-searchbar-icon svelte-1bz9rsj"/></button>'),mn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <div class="secondary-suggestion-text svelte-1bz9rsj"> </div></button></li>'),hn=(t,a,e)=>a(d(e)),bn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),yn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),Pn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <!></button></li>'),kn=oe('<ul class="suggestions-list svelte-1bz9rsj"><!> <!></ul>'),Mn=oe('<div class="spot-search-bar svelte-1bz9rsj"><!> <div class="searchbar-wrapper svelte-1bz9rsj"><input id="spot-search-input" type="text"/> <!> <!></div></div>');function Xa(t,a){De(a,!0);const[e,f]=we(),r=()=>D(Et,"$locale",e),i=()=>D(Tt,"$userLocation",e),s=()=>D(N,"$yourLocationMessage",e);let o=Q(""),n=Q(Pr([])),l=Q(!1),u=null,c=Q(!1),v=null,p=Ge(a,"label",3,""),h=Ge(a,"placeholder",3,""),M=Ge(a,"error",3,!1),m=Ge(a,"value",3,""),S=Ge(a,"providedSpot",3,null);qe(async()=>{const{AutocompleteSuggestion:R}=await xr();u=R,v=S()});async function w(R){var q;if(u){O(l,!0);const A={input:R.input,includedRegionCodes:["ee"],region:"ee",language:r()},V=await u.fetchAutocompleteSuggestions(A);let Z=[];if(V.suggestions&&V.suggestions.length>0)for(const z of V.suggestions){let b=await z.placePrediction.toPlace().fetchFields({fields:["location"]});Z.push({name:z.placePrediction.mainText.text,secondaryText:((q=z.placePrediction.secondaryText)==null?void 0:q.text)??"",position:{lat:b.place.location.lat(),lng:b.place.location.lng()}})}return O(l,!1),Z}return[]}ge(()=>{d(o)?w({input:d(o)}).then(R=>{O(n,R,!0)}):O(n,[],!0)}),ge(()=>{m()!==void 0&&m()!==null&&O(o,m())});const N=K("your_location");function L(R){var q;v=R,O(o,R.name,!0),O(c,!1),(q=a.onSelect)==null||q.call(a,R)}function C(){var q;if(!i())return;const R={name:s(),position:{lat:i().lat,lng:i().lng},secondaryText:`${i().lat}, ${i().lng}`};v=R,O(o,R.name,!0),O(c,!1),(q=a.onSelect)==null||q.call(a,R)}function $(){O(c,!1),v&&d(o)!==v.name&&O(o,v.name,!0)}function x(){var R;O(o,""),v=null,O(n,[],!0),O(c,!1),(R=a.onSelect)==null||R.call(a,null)}var B=Mn(),H=P(B);{var F=R=>{var q=vn(),A=P(q,!0);y(q),ce(()=>G(A,p())),ae(R,q)};le(H,R=>{p()&&R(F)})}var j=I(H,2),ee=P(j);Rr(ee),ee.__click=[gn,c];var U=I(ee,2);{var ue=R=>{var q=pn();ae(R,q)},re=(R,q)=>{{var A=V=>{var Z=_n();Z.__click=x,ae(V,Z)};le(R,V=>{d(o)&&V(A)},q)}};le(U,R=>{d(l)?R(ue):R(re,!1)})}var J=I(U,2);{var X=R=>{var q=kn(),A=P(q);{var V=z=>{var b=mn(),k=P(b);k.__mousedown=C;var _=P(k),g=P(_,!0);y(_);var T=I(_,2),E=P(T);y(T),y(k),y(b),ce((ne,se)=>{G(g,s()),G(E,`${ne??""}, ${se??""}`)},[()=>i().lat.toFixed(5),()=>i().lng.toFixed(5)]),ae(z,b)};le(A,z=>{i()&&z(V)})}var Z=I(A,2);It(Z,17,()=>d(n),Gt,(z,b)=>{var k=Pn(),_=P(k);_.__mousedown=[hn,L,b];var g=P(_),T=P(g,!0);y(g);var E=I(g,2);{var ne=Y=>{var de=bn(),W=P(de,!0);y(de),ce(()=>G(W,d(b).secondaryText)),ae(Y,de)},se=Y=>{var de=yn(),W=P(de);y(de),ce((pe,$e)=>G(W,`${pe??""}, ${$e??""}`),[()=>d(b).position.lat.toFixed(5),()=>d(b).position.lng.toFixed(5)]),ae(Y,de)};le(E,Y=>{d(b).secondaryText?Y(ne):Y(se,!1)})}y(_),y(k),ce(()=>G(T,d(b).name)),ae(z,k)}),y(q),ae(R,q)};le(J,R=>{d(c)&&R(X)})}y(j),y(B),ce(()=>{Ce(ee,"placeholder",h()),xe(ee,1,`spot-search ${M()?"error":""}`,"svelte-1bz9rsj")}),xt("focus",ee,()=>O(c,!0)),xt("blur",ee,$),qr(ee,()=>d(o),R=>O(o,R)),ae(t,B),Oe(),f()}Te(["click","mousedown"]);var Ln=(t,a)=>{O(a,!1)},Sn=oe('<button class="confirm-button svelte-3hy2qp"> </button>'),Dn=oe('<div class="component-container svelte-3hy2qp"><div class="spot-picking-container svelte-3hy2qp"><div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div class="buttons-container svelte-3hy2qp"><!> <button class="cancel-button svelte-3hy2qp"> </button></div></div></div>');function On(t,a){De(a,!0);const[e,f]=we(),r=()=>D(qt,"$chosenSpots",e),i=()=>D($,"$spotPickingPickupLabel",e),s=()=>D(x,"$spotPickingPickupPlaceholder",e),o=()=>D(F,"$noStopsNearPickup",e),n=()=>D(B,"$spotPickingDestinationLabel",e),l=()=>D(H,"$spotPickingDestinationPlaceholder",e),u=()=>D(j,"$noStopsNearDestination",e),c=()=>D(ee,"$confirmButtonText",e),v=()=>D(C,"$cancelButtonText",e);let p=Q(null),h=Q(null),M=Q(null);function m(){fe.set(!0),ve.set({key:"loading",params:{}}),qt.set({}),he.set("map-idle")}let S=Q(!1),w=Q(!1),N=Q(!1),L=Q(!1);qe(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),O(p,new fn,!0),await d(p).instantiate(),r()&&(O(N,!0),O(h,r().pickup,!0),O(M,r().destination,!0)),fe.set(!1),ve.set({key:"loading",params:{}})}),ge(()=>{if(d(h)&&d(M)&&d(p)){let W=d(p).findClosestStops([d(h).position.lat,d(h).position.lng]),pe=d(p).findClosestStops([d(M).position.lat,d(M).position.lng]);W.length===0&&O(S,!0),pe.length===0&&O(w,!0),W.length>0&&pe.length>0&&(O(L,!0),d(N)||(fe.set(!0),ve.set({key:"loading",params:{}}),qt.set({pickup:d(h),destination:d(M)}),ea.set({pickup:W,destination:pe}),he.set("bus-stop-picking")))}});const C=K("spot_picking_cancel_button"),$=K("spot_picking_pickup_label"),x=K("spot_pickup_placeholder"),B=K("spot_picking_destination_label"),H=K("spot_destination_placeholder"),F=K("spot_pickup_no_bus_stop_found"),j=K("spot_destination_no_bus_stop_found"),ee=K("spot_picking_confirm");var U=Dn(),ue=P(U),re=P(ue),J=P(re);const X=Me(()=>d(h)??null),R=Me(()=>{var W;return((W=d(h))==null?void 0:W.name)??""});Xa(J,{get label(){return i()},get placeholder(){return s()},get error(){return d(S)},get providedSpot(){return d(X)},get value(){return d(R)},onSelect:W=>{O(h,W,!0),O(S,!1)}});var q=I(J,2),A=P(q),V=P(A,!0);y(A),y(q),y(re);var Z=I(re,2),z=P(Z);const b=Me(()=>d(M)??null),k=Me(()=>{var W;return((W=d(M))==null?void 0:W.name)??""});Xa(z,{get label(){return n()},get placeholder(){return l()},get error(){return d(w)},get providedSpot(){return d(b)},get value(){return d(k)},onSelect:W=>{O(M,W,!0),O(w,!1)}});var _=I(z,2),g=P(_),T=P(g,!0);y(g),y(_),y(Z);var E=I(Z,2),ne=P(E);{var se=W=>{var pe=Sn();pe.__click=[Ln,N];var $e=P(pe,!0);y(pe),ce(()=>{pe.disabled=!(d(L)&&d(h)&&d(M)&&!d(S)&&!d(w)),G($e,c())}),ae(W,pe)};le(ne,W=>{d(N)&&W(se)})}var Y=I(ne,2);Y.__click=m;var de=P(Y,!0);y(Y),y(E),y(ue),y(U),ce(()=>{xe(re,1,`spot-search-bar-wrapper${d(S)?" error":""}`,"svelte-3hy2qp"),G(V,d(S)?o():""),xe(Z,1,`spot-search-bar-wrapper${d(w)?" error":""}`,"svelte-3hy2qp"),G(T,d(w)?u():""),G(de,v())}),ae(t,U),Oe(),f()}Te(["click"]);class ye{static async initialize(){if(!this.travelModeConstants||!this.directionsStatusConstants){const{TravelMode:a,DirectionsStatus:e}=await ia();this.travelModeConstants=a,this.directionsStatusConstants=e}}static async getRoute(a){await this.initialize();const{DirectionsService:e}=await ia(),r=await new e().route(a);return r.status===this.directionsStatusConstants.OK?{pathArray:r.routes[0].overview_path.map(s=>({lat:s.lat(),lng:s.lng()})),bounds:r.routes[0].bounds}:null}static async calculatePreliminaryRoutes(a,e,f,r="en",i=!0){if(await this.initialize(),!a||!e||!f){console.warn("RouteService: Missing required data for route calculation");return}const s=a;if(!s.pickup||!s.destination){console.warn("RouteService: Invalid chosen spots data");return}const o={origin:{lat:s.pickup.position.lat,lng:s.pickup.position.lng},destination:{lat:e.position.lat,lng:e.position.lng},travelMode:this.travelModeConstants.WALKING,language:r,region:"ee"},n={origin:{lat:e.position.lat,lng:e.position.lng},destination:{lat:f.position.lat,lng:f.position.lng},travelMode:this.travelModeConstants.DRIVING,language:r,region:"ee"},l={origin:{lat:f.position.lat,lng:f.position.lng},destination:{lat:s.destination.position.lat,lng:s.destination.position.lng},travelMode:this.travelModeConstants.WALKING,language:r,region:"ee"};if(i){const[u,c,v]=await Promise.all([this.getRoute(o),this.getRoute(n),this.getRoute(l)]);Bt.set(u),Ct.set(c),At.set(v)}else{const[u,c]=await Promise.all([this.getRoute(o),this.getRoute(l)]);Bt.set(u),At.set(c)}}static nullDrivingRoutes(){Ct.set(null),Qt.set(null)}static async calculateCarRouteHelper(a,e){const{LatLngBounds:f}=await Qa(),r=new f;let i=[];if(a)for(const s of a)r.extend({lat:s[0],lng:s[1]}),i.push({lat:s[0],lng:s[1]});else e&&r.extend({lat:e.position.lat,lng:e.position.lng});return{mappedWaypoints:i,latLngBounds:r}}static async calculateCarToPickupRoute(a,e){const{mappedWaypoints:f,latLngBounds:r}=await this.calculateCarRouteHelper(a,e);Qt.set({pathArray:f,bounds:r})}static async calculatePickupBusStopToDestinationRoute(a,e){const{mappedWaypoints:f,latLngBounds:r}=await this.calculateCarRouteHelper(a,e);Ct.set({pathArray:f,bounds:r})}}wt(ye,"travelModeConstants",null),wt(ye,"directionsStatusConstants",null);function wn(t,a,e,f,r){var i,s,o;a()&&d(e)&&d(f)&&(fe.set(!0),ve.set({key:"loading",params:{}}),ye.nullDrivingRoutes(),(i=r())==null||i.publishChosenSpots(a().pickup,a().destination),(s=r())==null||s.publishChosenRouteStops(d(e),d(f)),(o=r())==null||o.publishGoal({type:"pickup",position:d(e).position}))}var Rn=(t,a)=>O(a,!d(a)),Cn=(t,a,e)=>a(d(e)),qn=oe('<button type="button" role="option"> </button>'),$n=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="pickup-dropdown"></div>'),xn=(t,a)=>O(a,!d(a)),Tn=(t,a,e)=>a(d(e)),Bn=oe('<button type="button" role="option"> </button>'),An=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="destination-dropdown"></div>'),Nn=oe('<button class="order-car-button svelte-5klcor"> </button>'),In=oe('<div class="bus-stop-picking svelte-5klcor"><div class="dropdowns-container svelte-5klcor"><h2 class="svelte-5klcor"> </h2> <div class="dropdown-group svelte-5klcor"><label for="pickup-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="pickup-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div> <div class="dropdown-group svelte-5klcor"><label for="destination-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="destination-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div></div> <div class="buttons-container svelte-5klcor"><!> <button class="back-button svelte-5klcor"> </button></div></div>');function Gn(t,a){De(a,!0);const[e,f]=we(),r=()=>D(ea,"$foundBusStops",e),i=()=>D(qt,"$chosenSpots",e),s=()=>D(Et,"$locale",e),o=()=>D(Vt,"$mqttClient",e),n=()=>D(F,"$busStopPickHeadingText",e),l=()=>D(j,"$busStopPickupText",e),u=()=>D(ee,"$busStopDestinationText",e),c=()=>D(B,"$orderCarText",e),v=()=>D(H,"$backButtonText",e);let p=Q(!1),h=Q(!1),M=Me(()=>r().pickup),m=Me(()=>r().destination),S=Q(null),w=Q(null);qe(async()=>{Ot.set({top:400,bottom:100}),await ye.initialize(),d(S)&&d(w)&&i()&&(ye.calculatePreliminaryRoutes(i(),d(S),d(w),s()),d(h)||(Se.set("all"),O(h,!0)))}),ge(()=>{i()&&!d(p)&&(O(S,d(M)[0],!0),O(w,d(m)[0],!0),fe.set(!1),ve.set({key:"loading",params:{}}),O(p,!0))}),ge(()=>{d(S)&&d(w)&&i()&&(ye.calculatePreliminaryRoutes(i(),d(S),d(w),s()),d(h)||(Se.set("all"),O(h,!0)))});function N(){fe.set(!0),ve.set({key:"loading",params:{}}),ea.set({}),he.set("spot-picking")}let L=Q(!1),C=Q(!1);function $(ie){O(S,ie,!0),O(L,!1),Se.set("pickup")}function x(ie){O(w,ie,!0),O(C,!1),Se.set("destination")}const B=K("bus_stop_order_car_button"),H=K("bus_stop_back_button"),F=K("bus_stop_pick_heading"),j=K("bus_stop_pickup"),ee=K("bus_stop_destination");let U=Q(void 0),ue=Q(void 0);function re(ie){d(L)&&d(U)&&!d(U).contains(ie.target)&&O(L,!1)}function J(ie){d(C)&&d(ue)&&!d(ue).contains(ie.target)&&O(C,!1)}ge(()=>{if(d(L))return document.addEventListener("mousedown",re),()=>document.removeEventListener("mousedown",re)}),ge(()=>{if(d(C))return document.addEventListener("mousedown",J),()=>document.removeEventListener("mousedown",J)});var X=In(),R=P(X),q=P(R),A=P(q,!0);y(q);var V=I(q,2),Z=P(V),z=P(Z,!0);y(Z);var b=I(Z,2),k=P(b);k.__click=[Rn,L];var _=P(k),g=I(_);y(k);var T=I(k,2);{var E=ie=>{var me=$n();It(me,21,()=>d(M),Gt,(Ie,Le)=>{var be=qn();be.__click=[Cn,$,Le];var Ht=P(be,!0);y(be),ce(()=>{xe(be,1,`dropdown-item ${d(S)&&d(Le).name===d(S).name?"selected":""}`,"svelte-5klcor"),Ce(be,"aria-selected",d(S)&&d(Le).name===d(S).name),G(Ht,d(Le).name)}),ae(Ie,be)}),y(me),ae(ie,me)};le(T,ie=>{d(L)&&ie(E)})}y(b),Jt(b,ie=>O(U,ie),()=>d(U)),y(V);var ne=I(V,2),se=P(ne),Y=P(se,!0);y(se);var de=I(se,2),W=P(de);W.__click=[xn,C];var pe=P(W),$e=I(pe);y(W);var lr=I(W,2);{var dr=ie=>{var me=An();It(me,21,()=>d(m),Gt,(Ie,Le)=>{var be=Bn();be.__click=[Tn,x,Le];var Ht=P(be,!0);y(be),ce(()=>{xe(be,1,`dropdown-item ${d(w)&&d(Le).name===d(w).name?"selected":""}`,"svelte-5klcor"),Ce(be,"aria-selected",d(w)&&d(Le).name===d(w).name),G(Ht,d(Le).name)}),ae(Ie,be)}),y(me),ae(ie,me)};le(lr,ie=>{d(C)&&ie(dr)})}y(de),Jt(de,ie=>O(ue,ie),()=>d(ue)),y(ne),y(R);var ra=I(R,2),na=P(ra);{var cr=ie=>{var me=Nn();me.__click=[wn,i,S,w,o];var Ie=P(me,!0);y(me),ce(()=>G(Ie,c())),ae(ie,me)};le(na,ie=>{d(S)&&d(w)&&ie(cr)})}var jt=I(na,2);jt.__click=N;var fr=P(jt,!0);y(jt),y(ra),y(X),ce(()=>{var ie,me;G(A,n()),G(z,l()),Ce(k,"aria-expanded",d(L)),G(_,`${((ie=d(S))==null?void 0:ie.name)??""} `),xe(g,0,`dropdown-arrow${d(L)?" open":""}`,"svelte-5klcor"),G(Y,u()),Ce(W,"aria-expanded",d(C)),G(pe,`${((me=d(w))==null?void 0:me.name)??""} `),xe($e,0,`dropdown-arrow${d(C)?" open":""}`,"svelte-5klcor"),G(fr,v())}),ae(t,X),Oe(),f()}Te(["click"]);var En=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),Vn=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),zn=oe('<div class="driving-info-container svelte-rznqub"><div class="driving-info-card svelte-rznqub"><!></div></div>');function Ua(t,a){var ee,U,ue,re;De(a,!0);const[e,f]=we(),r=()=>D(Et,"$locale",e),i=()=>D(Dt,"$carStatus",e),s=()=>D(h,"$drivingToPickupInfoText",e),o=()=>D(m,"$carSpeedHeadingText",e),n=()=>D(d(w),"$carSpeedInfoText",e),l=()=>D(N,"$chosenPickupHeadingText",e),u=()=>D(L,"$chosenPickupSpotText",e),c=()=>D(M,"$drivingToDestinationInfoText",e),v=()=>D(C,"$chosenDestinationHeadingText",e),p=()=>D($,"$chosenDestinationSpotText",e);qe(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),Ot.set({top:400,bottom:100});async function J(){return new Promise(R=>{let q;q=Dt.subscribe(A=>{A&&(typeof q=="function"&&q(),R(A))})})}const X=await J();await ye.initialize(),await ye.calculatePreliminaryRoutes(X.chosen_spots,X.chosen_route_stops.pickup,X.chosen_route_stops.destination,r(),!1),Ja.set(!0),a.type=="pickup"?(await ye.calculateCarToPickupRoute(X.route,X.chosen_route_stops.pickup),Se.set("carToPickup")):a.type=="destination"&&(await ye.calculatePickupBusStopToDestinationRoute(X.route,X.chosen_route_stops.destination),Se.set("all")),fe.set(!1),ve.set({key:"loading",params:{}})});const h=K("driving_to_pickup_info"),M=K("driving_to_destination_info"),m=K("car_speed_heading");let S=Me(()=>{var J;return(J=i())!=null&&J.speed?i().speed.toFixed(1):"0.0"});const w=Me(()=>K("car_speed_info",{speed:d(S)})),N=K("chosen_pickup_heading"),L=K("chosen_pickup_spot",{spot_name:(ee=i())!=null&&ee.chosen_route_stops&&"pickup"in i().chosen_route_stops&&((U=i().chosen_route_stops.pickup)!=null&&U.name)?i().chosen_route_stops.pickup.name:""}),C=K("chosen_destination_heading"),$=K("chosen_destination_spot",{spot_name:(ue=i())!=null&&ue.chosen_route_stops&&"destination"in i().chosen_route_stops&&((re=i().chosen_route_stops.destination)!=null&&re.name)?i().chosen_route_stops.destination.name:""});var x=zn(),B=P(x),H=P(B);{var F=J=>{var X=En(),R=$t(X),q=P(R,!0);y(R);var A=I(R,2),V=P(A),Z=P(V,!0);y(V);var z=I(V,2),b=P(z,!0);y(z),y(A);var k=I(A,2),_=P(k),g=P(_,!0);y(_);var T=I(_,2),E=P(T,!0);y(T),y(k),ce(()=>{G(q,s()),G(Z,o()),G(b,n()),G(g,l()),G(E,u())}),ae(J,X)},j=(J,X)=>{{var R=q=>{var A=Vn(),V=$t(A),Z=P(V,!0);y(V);var z=I(V,2),b=P(z),k=P(b,!0);y(b);var _=I(b,2),g=P(_,!0);y(_),y(z);var T=I(z,2),E=P(T),ne=P(E,!0);y(E);var se=I(E,2),Y=P(se,!0);y(se),y(T),ce(()=>{G(Z,c()),G(k,o()),G(g,n()),G(ne,v()),G(Y,p())}),ae(q,A)};le(J,q=>{a.type==="destination"&&q(R)},X)}};le(H,J=>{a.type==="pickup"?J(F):J(j,!1)})}y(B),y(x),ae(t,x),Oe(),f()}async function Wn(t,a,e,f){var r,i,s,o,n;if(fe.set(!0),ve.set({key:"loading",params:{}}),a.type==="pickup"){const l=(r=e())==null?void 0:r.chosen_route_stops.destination.position;(i=f())==null||i.publishGoal({type:"dropoff",position:l})}else a.type==="destination"&&((s=f())==null||s.publishClearChosenSpots(),(o=f())==null||o.publishClearChosenRouteStops(),Lr(),(n=f())==null||n.publishGoal({type:"done",position:{lat:0,lng:0,height:0}}),he.set("rating"))}var Kn=oe('<div class="arrived-info-container svelte-1pss86t"><div class="arrived-info-card svelte-1pss86t"><h2 class="arrived-heading svelte-1pss86t"> </h2> <div class="button-container svelte-1pss86t"><h3 class="arrived-subheading svelte-1pss86t"> </h3> <button class="arrived-confirm-btn svelte-1pss86t"> </button></div></div></div>');function Za(t,a){De(a,!0);const[e,f]=we(),r=()=>D(Bt,"$pathChosenPickupToBusStopPickup",e),i=()=>D(At,"$pathBusStopDestinationToChosenDestination",e),s=()=>D(Dt,"$carStatus",e),o=()=>D(Et,"$locale",e),n=()=>D(Vt,"$mqttClient",e),l=()=>D(v,"$confirmHeadingMessage",e),u=()=>D(p,"$confirmButtonHeadingMessage",e),c=()=>D(h,"$confirmButtonMessage",e);qe(async()=>{var B,H,F;Ot.set({top:400,bottom:100}),await ye.initialize(),(!r()||!i())&&await ye.calculatePreliminaryRoutes(((B=s())==null?void 0:B.chosen_spots)??null,((H=s())==null?void 0:H.chosen_route_stops.pickup)??null,((F=s())==null?void 0:F.chosen_route_stops.destination)??null,o(),!1),a.type=="pickup"?Se.set("pickup"):a.type=="destination"&&Se.set("destination")});const v=a.type==="pickup"?K("arrived_at_pickup_info"):K("arrived_at_destination_info"),p=a.type==="pickup"?K("confirm_in_car_info"):K("confirm_destination_info"),h=a.type==="pickup"?K("confirm_in_car_button"):K("confirm_destination_button");var M=Kn(),m=P(M),S=P(m),w=P(S,!0);y(S);var N=I(S,2),L=P(N),C=P(L,!0);y(L);var $=I(L,2);$.__click=[Wn,a,s,n];var x=P($,!0);y($),y(N),y(m),y(M),ce(()=>{G(w,l()),G(C,u()),G(x,c())}),ae(t,M),Oe(),f()}Te(["click"]);var Fn=oe('<button type="button" class="star-btn svelte-rv59cl"><img class="star svelte-rv59cl"/></button>'),jn=()=>{fe.set(!0),ve.set({key:"loading",params:{}}),he.set("map-idle")},Hn=oe('<div class="rating-overlay svelte-rv59cl"><div class="rating-card svelte-rv59cl"><h2 class="rating-heading svelte-rv59cl"> </h2> <div class="stars svelte-rv59cl"></div> <button class="skip-btn svelte-rv59cl"> </button></div></div>');function Xn(t,a){De(a,!0);const[e,f]=we(),r=()=>D(Vt,"$mqttClient",e),i=()=>D(h,"$ratingHeadingText",e),s=()=>D(M,"$ratingRefuseText",e);let o=Q(0),n=Q(0),l=Q(""),u=Q("");qe(async()=>{Ot.set({top:200,bottom:200}),O(l,await Nt("/star_filled.svg"),!0),O(u,await Nt("/star_empty.svg"),!0),fe.set(!1),ve.set({key:"loading",params:{}})});function c(x){var B;O(o,x,!0),fe.set(!0),ve.set({key:"loading",params:{}}),(B=r())==null||B.publishRating(d(o),new Date().toISOString()),he.set("map-idle")}function v(x){O(n,x,!0)}function p(){O(n,0)}const h=K("rating_heading"),M=K("rating_refuse");var m=Hn(),S=P(m),w=P(S),N=P(w,!0);y(w);var L=I(w,2);It(L,20,()=>Array.from({length:5}),Gt,(x,B,H)=>{var F=Fn();F.__click=()=>c(H+1),Ce(F,"aria-label",`Rate ${H+1} star${H===0?"":"s"}`);var j=P(F);Ce(j,"alt",H+1+" star"),y(F),ce(()=>Ce(j,"src",(d(n)?H<d(n):H<d(o))?d(l):d(u))),xt("mouseenter",F,()=>v(H+1)),xt("mouseleave",F,p),ae(x,F)}),y(L);var C=I(L,2);C.__click=[jn];var $=P(C,!0);y(C),y(S),y(m),ce(()=>{G(N,i()),G($,s())}),ae(t,m),Oe(),f()}Te(["click"]);var Un=oe('<div class="app-root"><!> <!></div>');function si(t,a){De(a,!0);const[e,f]=we(),r=()=>D(Vt,"$mqttClient",e),i=()=>D(Dt,"$carStatus",e),s=()=>D(he,"$appState",e),o=()=>D(Dr,"$sessionId",e),n=()=>D(ve,"$appGlobalLoadingMessageKey",e),l=()=>D(fe,"$appGlobalLoading",e),u=()=>D(d(p),"$appGlobalLoadingMessage",e);qe(()=>{let L=null,C=0;return navigator.geolocation?L=navigator.geolocation.watchPosition($=>{const x=Date.now();x-C>=500&&(Tt.set({lat:$.coords.latitude,lng:$.coords.longitude}),C=x)},$=>{console.warn("Geolocation denied or unavailable:",$)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:1e3}):(Tt.set(null),console.warn("Geolocation not supported")),()=>{L!==null&&navigator.geolocation.clearWatch(L)}}),ge(()=>{r()||Mr("/login")});let c=null;ge(()=>{if(r()&&i()){if(i().state===c)return;switch(c=i().state,i().state){case"waiting":s()!=="rating"&&he.set("map-idle");break;case"driving-to-pickup":he.set("driving-to-pickup");break;case"arrived-to-pickup":he.set("arrived-to-pickup");break;case"driving-to-destination":he.set("driving-to-destination");break;case"arrived-to-destination":he.set("arrived-to-destination");break;case"shutting-down":fe.set(!0),ve.set({key:"car_shutting_down"});const L=o()??"";Sr.set({key:"session_closed",params:{id:L}}),Ya();break;default:console.error("Unknown car status state:",JSON.stringify(i().state));break}}});let v=Me(()=>s()==="map-idle"||s()==="bus-stop-picking"||s()==="driving-to-pickup"||s()==="arrived-to-pickup"||s()==="driving-to-destination"||s()==="arrived-to-destination");const p=Me(()=>n()?K(n().key,n().params):null);var h=Un(),M=P(h);{var m=L=>{Ir(L,{children:(C,$)=>{var x=kr(),B=$t(x);{var H=j=>{Vr(j,{})},F=(j,ee)=>{{var U=re=>{Gn(re,{})},ue=(re,J)=>{{var X=q=>{Ua(q,{type:"pickup"})},R=(q,A)=>{{var V=z=>{Za(z,{type:"pickup"})},Z=(z,b)=>{{var k=g=>{Ua(g,{type:"destination"})},_=(g,T)=>{{var E=ne=>{Za(ne,{type:"destination"})};le(g,ne=>{s()==="arrived-to-destination"&&ne(E)},T)}};le(z,g=>{s()==="driving-to-destination"?g(k):g(_,!1)},b)}};le(q,z=>{s()==="arrived-to-pickup"?z(V):z(Z,!1)},A)}};le(re,q=>{s()==="driving-to-pickup"?q(X):q(R,!1)},J)}};le(j,re=>{s()==="bus-stop-picking"?re(U):re(ue,!1)},ee)}};le(B,j=>{s()==="map-idle"?j(H):j(F,!1)})}ae(C,x)},$$slots:{default:!0}})},S=(L,C)=>{{var $=B=>{On(B,{})},x=(B,H)=>{{var F=j=>{Xn(j,{})};le(B,j=>{s()==="rating"&&j(F)},H)}};le(L,B=>{s()==="spot-picking"?B($):B(x,!1)},C)}};le(M,L=>{d(v)?L(m):L(S,!1)})}var w=I(M,2);{var N=L=>{wr(L,{get loadingMsg(){return u()}})};le(w,L=>{l()&&L(N)})}y(h),ae(t,h),Oe(),f()}export{si as component};
