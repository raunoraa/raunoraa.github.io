var fr=Object.defineProperty;var vr=(t,a,e)=>a in t?fr(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e;var qt=(t,a,e)=>vr(t,typeof a!="symbol"?a+"":a,e);import"../chunks/CWj6FrbW.js";import{aJ as gr,aK as pr,O as _r,d as mr,a3 as hr,z as Ae,p as De,o as $e,b as pe,A as oe,G as Tt,F as z,D as P,E as b,H as br,I as ce,J as V,B as ie,a as Oe,C as ne,n as Qt,f,s as D,aI as Bt,K as Te,aG as yr}from"../chunks/CM7s3TdM.js";import{a as w,b as ea,s as we,i as de}from"../chunks/CZY1Q9bT.js";import{g as Pr}from"../chunks/dZ2pQE2n.js";import{e as fe,f as ve,c as Le,u as At,p as ta,g as xt,h as Nt,i as It,j as Se,k as Rt,r as Ja,n as Qa,b as Ne,l as zt,o as kr,d as Mr,q as Me,s as Sr}from"../chunks/BvkDkEON.js";import{_ as Lr,p as Ve}from"../chunks/CvhVpWJc.js";import{f as Gt,L as Dr}from"../chunks/DKuJeQhF.js";import{t as H,r as Or,s as qe,a as Be,e as Et,i as Wt}from"../chunks/DUMhEyrb.js";import"../chunks/PCJ5bLI3.js";import{i as wr}from"../chunks/DJhY8YgZ.js";function Cr(t,a,e=a){var c=gr();pr(t,"input",r=>{var o=r?t.defaultValue:t.value;if(o=Ut(t)?Zt(o):o,e(o),c&&o!==(o=a())){var u=t.selectionStart,i=t.selectionEnd;t.value=o??"",i!==null&&(t.selectionStart=u,t.selectionEnd=Math.min(i,t.value.length))}}),(_r&&t.defaultValue!==t.value||mr(a)==null&&t.value)&&e(Ut(t)?Zt(t.value):t.value),hr(()=>{var r=a();Ut(t)&&r===Zt(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function Ut(t){var a=t.type;return a==="number"||a==="range"}function Zt(t){return t===""?null:+t}let Yt=null,$t=null;async function Ge(){return $t||(Yt||(Yt=(async()=>{const t=await Lr(()=>import("../chunks/D-8nYH0_.js"),[],import.meta.url),a=t.Loader||t.default&&t.default.Loader;if(!a)throw new Error("Could not load Google Maps Loader");return $t=new a({apiKey:"AIzaSyAixRzVqb7kii3XrzzL3OxsN7k_2CoMeaM",version:"weekly"}),$t})()),Yt)}async function er(){return await(await Ge()).importLibrary("core")}async function tr(){return await(await Ge()).importLibrary("maps")}async function Rr(){return await(await Ge()).importLibrary("marker")}async function qr(){return await(await Ge()).importLibrary("places")}async function oa(){return await(await Ge()).importLibrary("routes")}async function $r(){return await(await Ge()).importLibrary("geometry")}async function xr(t,a={}){const{Map:e}=await tr();return new e(t,a)}function Tr(){fe.set(!0),ve.set({key:"ending_session",params:{}}),Ja()}var Br=oe('<div class="map-container svelte-1bz92gb"></div> <button class="end-session-button svelte-1bz92gb"> </button> <!>',1);function Ar(t,a){De(a,!0);const[e,c]=we(),r=()=>w(Qa,"$isDriving",e),o=()=>w(Le,"$carStatus",e),u=()=>w(At,"$userLocation",e),i=()=>w(ta,"$pathCarToBusStopPickup",e),n=()=>w(xt,"$pathBusStopPickupToBusStopDestination",e),l=()=>w(Nt,"$pathChosenPickupToBusStopPickup",e),d=()=>w(It,"$pathBusStopDestinationToChosenDestination",e),s=()=>w(Se,"$fitBoundsTarget",e),v=()=>w(Rt,"$fitBoundsVerticalPadding",e),_=()=>w(A,"$endSessionText",e);let h,p=null,y=null,k=null,C=null,B=null,S=null,q=null,x=null,$=null,I=null,G=null,F=null,E=null;function U(L,O){if(p&&L){const T={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},m={path:F,strokeOpacity:1,scale:4},g={path:E,strokeOpacity:1,scale:4};return O?L.setOptions({strokeOpacity:0,icons:[{icon:T,offset:"0",repeat:"20px"},{icon:m,offset:"0",repeat:"0"},{icon:g,offset:"100%",repeat:"0"}],visible:!1,map:p,zIndex:1}):L.setOptions({strokeColor:"#FF0000",strokeWeight:4,icons:[{icon:m,offset:"0",repeat:"0"},{icon:g,offset:"100%",repeat:"0"}],visible:!1,map:p}),L.setMap(p),L}return null}function Z(L,O){if(!O||O.length<2)return{index:0,progress:0};let T=1/0,m=0,g=0;for(let K=0;K<O.length-1;K++){const te=O[K],X=O[K+1],ae=ee(L,te,X),ue=Y(te,X,ae),le=google.maps.geometry.spherical.computeDistanceBetween(L,ue);le<T&&(T=le,m=K,g=ae)}return{index:m,progress:g}}function ee(L,O,T){const m=O.lat(),g=O.lng(),K=T.lat(),te=T.lng(),X=L.lat(),ae=L.lng(),ue=te-g,le=K-m,J=ue*ue+le*le;if(J===0)return 0;const he=((ae-g)*ue+(X-m)*le)/J;return Math.max(0,Math.min(1,he))}function Y(L,O,T){const m=L.lat()+(O.lat()-L.lat())*T,g=L.lng()+(O.lng()-L.lng())*T;return new google.maps.LatLng(m,g)}function se(L,O,T,m){if(!L||!p)return O;const g=L.getPath().getArray();if(g.length<2)return O;const{index:K,progress:te}=Z(T,g),X=[];for(let ae=0;ae<=K;ae++)X.push(g[ae]);if(te>0&&K<g.length-1){const ae=Y(g[K],g[K+1],te);X.push(ae)}if(!O){let ae="#FF0000";r()&&(ae="#00AA00"),O=new google.maps.Polyline({map:p,strokeColor:ae,strokeWeight:4,strokeOpacity:1,zIndex:1})}return O.setPath(X),O}$e(async()=>{var K;fe.set(!0),ve.set({key:"loading_map",params:{}}),p=await xr(h,{center:{lat:58.378,lng:26.729},zoom:13,disableDefaultUI:!0,mapId:"DEMO_MAP_ID"});const{AdvancedMarkerElement:L}=await Rr(),{SymbolPath:O}=await er();await $r(),F=O.CIRCLE,E=O.FORWARD_OPEN_ARROW,I=await Gt("/usermarker.svg"),G=await Gt("/carmarker.svg");const T=document.createElement("img");T.src=G,T.style.width="48px",T.style.height="48px",$=new L({position:(K=o())==null?void 0:K.pose,map:p,content:T});const m=document.createElement("img");m.src=I,m.style.width="32px",m.style.height="32px",x=new L({map:p,content:m});const{Polyline:g}=await tr();y=U(new g,!0),k=U(new g,!1),C=U(new g,!0),B=U(new g,!1),S=null,q=null,fe.set(!1),ve.set({key:"loading",params:{}})}),pe(()=>{u()&&x&&(x.position=u())}),pe(()=>{var L;if((L=o())!=null&&L.pose&&$){$.position=o().pose;const O=new google.maps.LatLng(o().pose.lat,o().pose.lng);B&&i()&&(q=se(B,q,O)),k&&n()&&(S=se(k,S,O))}}),pe(()=>{u()&&x&&(x.position=u())}),pe(()=>{l()&&y?(y.setPath(l().pathArray),y.setVisible(!0)):y!=null&&y.getVisible()&&y.setVisible(!1)}),pe(()=>{n()&&k?(k.setPath(n().pathArray),k.setVisible(!0)):k!=null&&k.getVisible()&&(k.setVisible(!1),S&&(S.setMap(null),S=null))}),pe(()=>{d()&&C?(C.setPath(d().pathArray),C.setVisible(!0)):C!=null&&C.getVisible()&&C.setVisible(!1)}),pe(()=>{i()&&B?(B.setPath(i().pathArray),B.setVisible(!0)):B!=null&&B.getVisible()&&(B.setVisible(!1),q&&(q.setMap(null),q=null))}),pe(()=>{var L,O,T,m,g,K,te;if(s()==="all"){if((L=l())!=null&&L.bounds&&((O=n())!=null&&O.bounds)&&((T=d())!=null&&T.bounds)){const X=new google.maps.LatLngBounds(l().bounds.getSouthWest(),l().bounds.getNorthEast()),ae=new google.maps.LatLngBounds(n().bounds.getSouthWest(),n().bounds.getNorthEast()),ue=new google.maps.LatLngBounds(d().bounds.getSouthWest(),d().bounds.getNorthEast());X.union(ae),X.union(ue),p==null||p.fitBounds(X,{top:v().top,bottom:v().bottom})}}else s()==="pickup"?(m=l())!=null&&m.bounds&&(p==null||p.fitBounds(l().bounds,{top:v().top,bottom:v().bottom})):s()==="destination"?(g=d())!=null&&g.bounds&&(p==null||p.fitBounds(d().bounds,{top:v().top,bottom:v().bottom})):s()==="carToPickup"?(K=i())!=null&&K.bounds&&((te=l())!=null&&te.bounds)&&(p==null||p.fitBounds(i().bounds.union(l().bounds),{top:v().top,bottom:v().bottom})):s()==="default"&&(p==null||p.setCenter({lat:58.378,lng:26.729}),p==null||p.setZoom(13))});const A=H("end_session_button");var M=Br(),R=Tt(M);ea(R,L=>h=L,()=>h);var N=z(R,2);N.__click=[Tr];var j=P(N,!0);b(N);var W=z(N,2);br(W,()=>a.children),ce(()=>V(j,_())),ie(t,M),Oe(),c()}Ae(["click"]);function Nr(t,a){var e;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishState("spot-picking")}var Ir=oe('<div class="footer-background svelte-1iqii79"><button class="order-car-button svelte-1iqii79"> </button></div>');function Gr(t,a){De(a,!1);const[e,c]=we(),r=()=>w(Ne,"$mqttClient",e),o=()=>w(u,"$orderCarText",e),u=H("order_car_button");wr();var i=Ir(),n=P(i);n.__click=[Nr,r];var l=P(n,!0);b(n),b(i),ce(()=>V(l,o())),ie(t,i),Oe(),c()}Ae(["click"]);var Jt={},Fe={},Ke={},re={},sa;function me(){if(sa)return re;sa=1,Object.defineProperty(re,"__esModule",{value:!0}),re.areaConversion=re.timeConversion=re.distanceConversion=re.altitudeKeys=re.latitudeKeys=re.longitudeKeys=re.MAXLON=re.MINLON=re.MAXLAT=re.MINLAT=re.earthRadius=re.sexagesimalPattern=void 0;var t=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;re.sexagesimalPattern=t;var a=6378137;re.earthRadius=a;var e=-90;re.MINLAT=e;var c=90;re.MAXLAT=c;var r=-180;re.MINLON=r;var o=180;re.MAXLON=o;var u=["lng","lon","longitude",0];re.longitudeKeys=u;var i=["lat","latitude",1];re.latitudeKeys=i;var n=["alt","altitude","elevation","elev",2];re.altitudeKeys=n;var l={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};re.distanceConversion=l;var d={m:60,h:3600,d:86400};re.timeConversion=d;var s={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};return re.areaConversion=s,s.sqm=s.m2,s.sqkm=s.km2,s.sqft=s.ft2,s.sqyd=s.yd2,s.sqin=s.in2,re}var je={},ua;function Vt(){if(ua)return je;ua=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var t=function(c,r){return r.reduce(function(o,u){if(typeof c>"u"||c===null)throw new Error("'".concat(c,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(c,u)&&typeof u<"u"&&typeof o>"u"?(o=u,u):o},void 0)},a=t;return je.default=a,je}var He={},Xe={},la;function Ft(){if(la)return Xe;la=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var t=function(c){var r=c.toString().trim();return isNaN(parseFloat(r))?!1:parseFloat(r)===Number(r)},a=t;return Xe.default=a,Xe}var Ue={},da;function Kt(){if(da)return Ue;da=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var t=me(),a=function(r){return t.sexagesimalPattern.test(r.toString().trim())},e=a;return Ue.default=e,Ue}var Ze={},ca;function jt(){if(ca)return Ze;ca=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var t=me(),a=function(r){var o=new RegExp(t.sexagesimalPattern).exec(r.toString().trim());if(typeof o>"u"||o===null)throw new Error("Given value is not in sexagesimal format");var u=Number(o[2])/60||0,i=Number(o[4])/3600||0,n=parseFloat(o[1])+u+i;return["S","W"].includes(o[7])?-n:n},e=a;return Ze.default=e,Ze}var Ye={},Je={},fa;function aa(){if(fa)return Je;fa=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var t=me(),a=e(Vt());function e(n){return n&&n.__esModule?n:{default:n}}function c(n,l){var d=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);l&&(s=s.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),d.push.apply(d,s)}return d}function r(n){for(var l=1;l<arguments.length;l++){var d=arguments[l]!=null?arguments[l]:{};l%2?c(Object(d),!0).forEach(function(s){o(n,s,d[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(d)):c(Object(d)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(d,s))})}return n}function o(n,l,d){return l in n?Object.defineProperty(n,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):n[l]=d,n}var u=function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:t.longitudeKeys,latitude:t.latitudeKeys,altitude:t.altitudeKeys},s=(0,a.default)(l,d.longitude),v=(0,a.default)(l,d.latitude),_=(0,a.default)(l,d.altitude);return r({latitude:v,longitude:s},_?{altitude:_}:{})},i=u;return Je.default=i,Je}var Qe={},va;function ar(){if(va)return Qe;va=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var t=r(Ft()),a=r(Kt()),e=r(jt()),c=me();function r(i){return i&&i.__esModule?i:{default:i}}var o=function i(n){return(0,t.default)(n)?!(parseFloat(n)>c.MAXLAT||n<c.MINLAT):(0,a.default)(n)?i((0,e.default)(n)):!1},u=o;return Qe.default=u,Qe}var et={},ga;function rr(){if(ga)return et;ga=1,Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var t=r(Ft()),a=r(Kt()),e=r(jt()),c=me();function r(i){return i&&i.__esModule?i:{default:i}}var o=function i(n){return(0,t.default)(n)?!(parseFloat(n)>c.MAXLON||n<c.MINLON):(0,a.default)(n)?i((0,e.default)(n)):!1},u=o;return et.default=u,et}var pa;function nr(){if(pa)return Ye;pa=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.default=void 0;var t=c(aa()),a=c(ar()),e=c(rr());function c(u){return u&&u.__esModule?u:{default:u}}var r=function(i){var n=(0,t.default)(i),l=n.latitude,d=n.longitude;if(Array.isArray(i)&&i.length>=2)return(0,e.default)(i[0])&&(0,a.default)(i[1]);if(typeof l>"u"||typeof d>"u")return!1;var s=i[d],v=i[l];return!(typeof v>"u"||typeof s>"u"||(0,a.default)(v)===!1||(0,e.default)(s)===!1)},o=r;return Ye.default=o,Ye}var _a;function ra(){if(_a)return He;_a=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;var t=o(Ft()),a=o(Kt()),e=o(jt()),c=o(nr()),r=o(aa());function o(s){return s&&s.__esModule?s:{default:s}}function u(s,v){var _=Object.keys(s);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(s);v&&(h=h.filter(function(p){return Object.getOwnPropertyDescriptor(s,p).enumerable})),_.push.apply(_,h)}return _}function i(s){for(var v=1;v<arguments.length;v++){var _=arguments[v]!=null?arguments[v]:{};v%2?u(Object(_),!0).forEach(function(h){n(s,h,_[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(_)):u(Object(_)).forEach(function(h){Object.defineProperty(s,h,Object.getOwnPropertyDescriptor(_,h))})}return s}function n(s,v,_){return v in s?Object.defineProperty(s,v,{value:_,enumerable:!0,configurable:!0,writable:!0}):s[v]=_,s}var l=function s(v){if((0,t.default)(v))return Number(v);if((0,a.default)(v))return(0,e.default)(v);if((0,c.default)(v)){var _=(0,r.default)(v);return Array.isArray(v)?v.map(function(h,p){return[0,1].includes(p)?s(h):h}):i(i(i({},v),_.latitude&&n({},_.latitude,s(v[_.latitude]))),_.longitude&&n({},_.longitude,s(v[_.longitude])))}return Array.isArray(v)?v.map(function(h){return(0,c.default)(h)?s(h):h}):v},d=l;return He.default=d,He}var ma;function Pe(){if(ma)return Ke;ma=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var t=me(),a=c(Vt()),e=c(ra());function c(u){return u&&u.__esModule?u:{default:u}}var r=function(i,n){var l=(0,a.default)(i,t.latitudeKeys);if(!(typeof l>"u"||l===null)){var d=i[l];return n===!0?d:(0,e.default)(d)}},o=r;return Ke.default=o,Ke}var tt={},ha;function ke(){if(ha)return tt;ha=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var t=me(),a=c(Vt()),e=c(ra());function c(u){return u&&u.__esModule?u:{default:u}}var r=function(i,n){var l=(0,a.default)(i,t.longitudeKeys);if(!(typeof l>"u"||l===null)){var d=i[l];return n===!0?d:(0,e.default)(d)}},o=r;return tt.default=o,tt}var at={},ba;function Ce(){if(ba)return at;ba=1,Object.defineProperty(at,"__esModule",{value:!0}),at.default=void 0;var t=function(c){return c*Math.PI/180},a=t;return at.default=a,at}var rt={},ya;function Ee(){if(ya)return rt;ya=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.default=void 0;var t=function(c){return c*180/Math.PI},a=t;return rt.default=a,rt}var Pa;function Er(){if(Pa)return Fe;Pa=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var t=o(Pe()),a=o(ke()),e=o(Ce()),c=o(Ee()),r=me();function o(n){return n&&n.__esModule?n:{default:n}}var u=function(l,d,s){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6371e3,_=(0,t.default)(l),h=(0,a.default)(l),p=d/v,y=(0,e.default)(s),k=(0,e.default)(_),C=(0,e.default)(h),B=Math.asin(Math.sin(k)*Math.cos(p)+Math.cos(k)*Math.sin(p)*Math.cos(y)),S=C+Math.atan2(Math.sin(y)*Math.sin(p)*Math.cos(k),Math.cos(p)-Math.sin(k)*Math.sin(B)),q=(0,c.default)(S);return(q<r.MINLON||q>r.MAXLON)&&(S=(S+3*Math.PI)%(2*Math.PI)-Math.PI,q=(0,c.default)(S)),{latitude:(0,c.default)(B),longitude:q}},i=u;return Fe.default=i,Fe}var nt={},ka;function Wr(){if(ka)return nt;ka=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default=void 0;var t=me(),a=function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",u=t.areaConversion[o];if(u)return r*u;throw new Error("Invalid unit used for area conversion.")},e=a;return nt.default=e,nt}var it={},Ma;function zr(){if(Ma)return it;Ma=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;var t=me(),a=function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"m",u=t.distanceConversion[o];if(u)return r*u;throw new Error("Invalid unit used for distance conversion.")},e=a;return it.default=e,it}var ot={},Sa;function Vr(){if(Sa)return ot;Sa=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.default=void 0;var t=me(),a=function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kmh";switch(o){case"kmh":return r*t.timeConversion.h*t.distanceConversion.km;case"mph":return r*t.timeConversion.h*t.distanceConversion.mi;default:return r}},e=a;return ot.default=e,ot}var st={},La;function Fr(){if(La)return st;La=1,Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;function t(l,d){return o(l)||r(l,d)||e(l,d)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(l,d){if(l){if(typeof l=="string")return c(l,d);var s=Object.prototype.toString.call(l).slice(8,-1);if(s==="Object"&&l.constructor&&(s=l.constructor.name),s==="Map"||s==="Set")return Array.from(l);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return c(l,d)}}function c(l,d){(d==null||d>l.length)&&(d=l.length);for(var s=0,v=new Array(d);s<d;s++)v[s]=l[s];return v}function r(l,d){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(l)))){var s=[],v=!0,_=!1,h=void 0;try{for(var p=l[Symbol.iterator](),y;!(v=(y=p.next()).done)&&(s.push(y.value),!(d&&s.length===d));v=!0);}catch(k){_=!0,h=k}finally{try{!v&&p.return!=null&&p.return()}finally{if(_)throw h}}return s}}function o(l){if(Array.isArray(l))return l}var u=function(d){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,v=Math.pow(10,s);return Math.round(d*v)/v},i=function(d){var s=d.toString().split("."),v=t(s,2),_=v[0],h=v[1],p=Math.abs(Number(_)),y=+("0."+(h||0))*60,k=y.toString().split("."),C=Math.floor(y),B=u(+("0."+(k[1]||0))*60).toString(),S=B.split("."),q=t(S,2),x=q[0],$=q[1],I=$===void 0?"0":$;return p+"° "+C.toString().padStart(2,"0")+"' "+x.padStart(2,"0")+"."+I.padEnd(1,"0")+'"'},n=i;return st.default=n,st}var ut={},lt={},dt={},ct={},Da;function ir(){if(Da)return ct;Da=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var t=function(c){return c>1?1:c<-1?-1:c},a=t;return ct.default=a,ct}var Oa;function Ie(){if(Oa)return dt;Oa=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;var t=o(Pe()),a=o(ke()),e=o(Ce()),c=o(ir()),r=me();function o(n){return n&&n.__esModule?n:{default:n}}var u=function(l,d){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;s=typeof s<"u"&&!isNaN(s)?s:1;var v=(0,t.default)(l),_=(0,a.default)(l),h=(0,t.default)(d),p=(0,a.default)(d),y=Math.acos((0,c.default)(Math.sin((0,e.default)(h))*Math.sin((0,e.default)(v))+Math.cos((0,e.default)(h))*Math.cos((0,e.default)(v))*Math.cos((0,e.default)(_)-(0,e.default)(p))))*r.earthRadius;return Math.round(y/s)*s},i=u;return dt.default=i,dt}var wa;function or(){if(wa)return lt;wa=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.default=void 0;var t=a(Ie());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default;return i=typeof i=="function"?i:t.default,u.slice().sort(function(n,l){return i(o,n)-i(o,l)})},c=e;return lt.default=c,lt}var Ca;function Kr(){if(Ca)return ut;Ca=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var t=a(or());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u){return(0,t.default)(o,u)[0]},c=e;return ut.default=c,ut}var ft={},Ra;function jr(){if(Ra)return ft;Ra=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.default=void 0;var t=r(Ce()),a=r(Pe()),e=r(ke()),c=me();function r(i){return i&&i.__esModule?i:{default:i}}var o=function(n){var l=0;if(n.length>2){for(var d,s,v,_=0;_<n.length;_++){_===n.length-2?(d=n.length-2,s=n.length-1,v=0):_===n.length-1?(d=n.length-1,s=0,v=1):(d=_,s=_+1,v=_+2);var h=(0,e.default)(n[d]),p=(0,a.default)(n[s]),y=(0,e.default)(n[v]);l+=((0,t.default)(y)-(0,t.default)(h))*Math.sin((0,t.default)(p))}l=l*c.earthRadius*c.earthRadius/2}return Math.abs(l)},u=o;return ft.default=u,ft}var vt={},qa;function sr(){if(qa)return vt;qa=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.default=void 0;var t=e(Pe()),a=e(ke());function e(o){return o&&o.__esModule?o:{default:o}}var c=function(u){if(Array.isArray(u)===!1||u.length===0)throw new Error("No points were given.");return u.reduce(function(i,n){var l=(0,t.default)(n),d=(0,a.default)(n);return{maxLat:Math.max(l,i.maxLat),minLat:Math.min(l,i.minLat),maxLng:Math.max(d,i.maxLng),minLng:Math.min(d,i.minLng)}},{maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0})},r=c;return vt.default=r,vt}var gt={},$a;function Hr(){if($a)return gt;$a=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var t=o(Pe()),a=o(ke()),e=o(Ce()),c=o(Ee()),r=me();function o(n){return n&&n.__esModule?n:{default:n}}var u=function(l,d){var s=(0,t.default)(l),v=(0,a.default)(l),_=(0,e.default)(s),h=(0,e.default)(v),p=d/r.earthRadius,y=_-p,k=_+p,C=(0,e.default)(r.MAXLAT),B=(0,e.default)(r.MINLAT),S=(0,e.default)(r.MAXLON),q=(0,e.default)(r.MINLON),x,$;if(y>B&&k<C){var I=Math.asin(Math.sin(p)/Math.cos(_));x=h-I,x<q&&(x+=Math.PI*2),$=h+I,$>S&&($-=Math.PI*2)}else y=Math.max(y,B),k=Math.min(k,C),x=q,$=S;return[{latitude:(0,c.default)(y),longitude:(0,c.default)(x)},{latitude:(0,c.default)(k),longitude:(0,c.default)($)}]},i=u;return gt.default=i,gt}var pt={},xa;function Xr(){if(xa)return pt;xa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Ce()),c=r(Ee());function r(i){return i&&i.__esModule?i:{default:i}}var o=function(n){if(Array.isArray(n)===!1||n.length===0)return!1;var l=n.length,d=n.reduce(function(h,p){var y=(0,e.default)((0,t.default)(p)),k=(0,e.default)((0,a.default)(p));return{X:h.X+Math.cos(y)*Math.cos(k),Y:h.Y+Math.cos(y)*Math.sin(k),Z:h.Z+Math.sin(y)}},{X:0,Y:0,Z:0}),s=d.X/l,v=d.Y/l,_=d.Z/l;return{longitude:(0,c.default)(Math.atan2(v,s)),latitude:(0,c.default)(Math.atan2(_,Math.sqrt(s*s+v*v)))}},u=o;return pt.default=u,pt}var _t={},Ta;function Ur(){if(Ta)return _t;Ta=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var t=a(sr());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o){var u=(0,t.default)(o),i=u.minLat+(u.maxLat-u.minLat)/2,n=u.minLng+(u.maxLng-u.minLng)/2;return{latitude:parseFloat(i.toFixed(6)),longitude:parseFloat(n.toFixed(6))}},c=e;return _t.default=c,_t}var mt={},ht={},Ba;function ur(){if(Ba)return ht;Ba=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Ce()),c=r(Ee());function r(i){return i&&i.__esModule?i:{default:i}}var o=function(n,l){var d=(0,e.default)((0,a.default)(l))-(0,e.default)((0,a.default)(n)),s=Math.log(Math.tan((0,e.default)((0,t.default)(l))/2+Math.PI/4)/Math.tan((0,e.default)((0,t.default)(n))/2+Math.PI/4));return Math.abs(d)>Math.PI&&(d>0?d=(Math.PI*2-d)*-1:d=Math.PI*2+d),((0,c.default)(Math.atan2(d,s))+360)%360},u=o;return ht.default=u,ht}var Aa;function Zr(){if(Aa)return mt;Aa=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var t=a(ur());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,n=typeof i=="function"?i(o,u):(0,t.default)(o,u);if(isNaN(n))throw new Error("Could not calculate bearing for given points. Check your bearing function");switch(Math.round(n/22.5)){case 1:return"NNE";case 2:return"NE";case 3:return"ENE";case 4:return"E";case 5:return"ESE";case 6:return"SE";case 7:return"SSE";case 8:return"S";case 9:return"SSW";case 10:return"SW";case 11:return"WSW";case 12:return"W";case 13:return"WNW";case 14:return"NW";case 15:return"NNW";default:return"N"}},c=e;return mt.default=c,mt}var bt={},Na;function lr(){if(Na)return bt;Na=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.default=void 0;var t=e(Ie()),a=e(ir());function e(o){return o&&o.__esModule?o:{default:o}}var c=function(u,i,n){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,d=(0,t.default)(i,u,l),s=(0,t.default)(u,n,l),v=(0,t.default)(i,n,l),_=Math.acos((0,a.default)((d*d+v*v-s*s)/(2*d*v))),h=Math.acos((0,a.default)((s*s+v*v-d*d)/(2*s*v)));return _>Math.PI/2?d:h>Math.PI/2?s:Math.sin(_)*d},r=c;return bt.default=r,bt}var yt={},Ia;function Yr(){if(Ia)return yt;Ia=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Ce()),c=r(Ee());function r(i){return i&&i.__esModule?i:{default:i}}var o=function(n,l){var d=(0,t.default)(l),s=(0,a.default)(l),v=(0,t.default)(n),_=(0,a.default)(n),h=((0,c.default)(Math.atan2(Math.sin((0,e.default)(s)-(0,e.default)(_))*Math.cos((0,e.default)(d)),Math.cos((0,e.default)(v))*Math.sin((0,e.default)(d))-Math.sin((0,e.default)(v))*Math.cos((0,e.default)(d))*Math.cos((0,e.default)(s)-(0,e.default)(_))))+360)%360;return h},u=o;return yt.default=u,yt}var Pt={},Ga;function Jr(){if(Ga)return Pt;Ga=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=a(Ie());function a(o){return o&&o.__esModule?o:{default:o}}function e(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(i){return typeof i}:e=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},e(o)}var c=function(u){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.default;return u.reduce(function(n,l){return e(n)==="object"&&n.last!==null&&(n.distance+=i(l,n.last)),n.last=l,n},{last:null,distance:0}).distance},r=c;return Pt.default=r,Pt}var kt={},Ea;function Qr(){if(Ea)return kt;Ea=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var t=r(Pe()),a=r(ke()),e=r(Ce()),c=me();function r(i){return i&&i.__esModule?i:{default:i}}var o=function(n,l){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;d=typeof d<"u"&&!isNaN(d)?d:1;var s=(0,t.default)(n),v=(0,a.default)(n),_=(0,t.default)(l),h=(0,a.default)(l),p=6356752314245e-6,y=1/298.257223563,k=(0,e.default)(h-v),C,B,S,q,x,$,I=Math.atan((1-y)*Math.tan((0,e.default)(parseFloat(s)))),G=Math.atan((1-y)*Math.tan((0,e.default)(parseFloat(_)))),F=Math.sin(I),E=Math.cos(I),U=Math.sin(G),Z=Math.cos(G),ee=k,Y,se=100;do{var A=Math.sin(ee),M=Math.cos(ee);if($=Math.sqrt(Z*A*(Z*A)+(E*U-F*Z*M)*(E*U-F*Z*M)),$===0)return 0;C=F*U+E*Z*M,B=Math.atan2($,C),S=E*Z*A/$,q=1-S*S,x=C-2*F*U/q,isNaN(x)&&(x=0);var R=y/16*q*(4+y*(4-3*q));Y=ee,ee=k+(1-R)*y*S*(B+R*$*(x+R*C*(-1+2*x*x)))}while(Math.abs(ee-Y)>1e-12&&--se>0);if(se===0)return NaN;var N=q*(c.earthRadius*c.earthRadius-p*p)/(p*p),j=1+N/16384*(4096+N*(-768+N*(320-175*N))),W=N/1024*(256+N*(-128+N*(74-47*N))),L=W*$*(x+W/4*(C*(-1+2*x*x)-W/6*x*(-3+4*$*$)*(-3+4*x*x))),O=p*j*(B-L);return Math.round(O/d)*d},u=o;return kt.default=u,kt}var Mt={},Wa;function en(){if(Wa)return Mt;Wa=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var t=function(c){if(/^(NNE|NE|NNW|N)$/.test(c))return"N";if(/^(ENE|E|ESE|SE)$/.test(c))return"E";if(/^(SSE|S|SSW|SW)$/.test(c))return"S";if(/^(WSW|W|WNW|NW)$/.test(c))return"W"},a=t;return Mt.default=a,Mt}var St={},za;function tn(){if(za)return St;za=1,Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;var t=a(Ie());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.default,n=i(o,u),l=Number(u.time)-Number(o.time),d=n/l*1e3;return d},c=e;return St.default=c,St}var Lt={},Va;function an(){if(Va)return Lt;Va=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=a(Ie());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u,i){return(0,t.default)(u,o)+(0,t.default)(o,i)===(0,t.default)(u,i)},c=e;return Lt.default=c,Lt}var Dt={},Fa;function rn(){if(Fa)return Dt;Fa=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var t=e(Pe()),a=e(ke());function e(o){return o&&o.__esModule?o:{default:o}}var c=function(u,i){for(var n=!1,l=i.length,d=-1,s=l-1;++d<l;s=d)((0,a.default)(i[d])<=(0,a.default)(u)&&(0,a.default)(u)<(0,a.default)(i[s])||(0,a.default)(i[s])<=(0,a.default)(u)&&(0,a.default)(u)<(0,a.default)(i[d]))&&(0,t.default)(u)<((0,t.default)(i[s])-(0,t.default)(i[d]))*((0,a.default)(u)-(0,a.default)(i[d]))/((0,a.default)(i[s])-(0,a.default)(i[d]))+(0,t.default)(i[d])&&(n=!n);return n},r=c;return Dt.default=r,Dt}var Ot={},Ka;function nn(){if(Ka)return Ot;Ka=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var t=a(lr());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u,i,n){return(0,t.default)(o,u,i)<n},c=e;return Ot.default=c,Ot}var wt={},ja;function on(){if(ja)return wt;ja=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.default=void 0;var t=a(Ie());function a(r){return r&&r.__esModule?r:{default:r}}var e=function(o,u,i){var n=.01;return(0,t.default)(o,u,n)<i},c=e;return wt.default=c,wt}var Ct={},Ha;function sn(){if(Ha)return Ct;Ha=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.default=void 0;function t(n,l){return o(n)||r(n,l)||e(n,l)||a()}function a(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(n,l){if(n){if(typeof n=="string")return c(n,l);var d=Object.prototype.toString.call(n).slice(8,-1);if(d==="Object"&&n.constructor&&(d=n.constructor.name),d==="Map"||d==="Set")return Array.from(n);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return c(n,l)}}function c(n,l){(l==null||l>n.length)&&(l=n.length);for(var d=0,s=new Array(l);d<l;d++)s[d]=n[d];return s}function r(n,l){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(n)))){var d=[],s=!0,v=!1,_=void 0;try{for(var h=n[Symbol.iterator](),p;!(s=(p=h.next()).done)&&(d.push(p.value),!(l&&d.length===l));s=!0);}catch(y){v=!0,_=y}finally{try{!s&&h.return!=null&&h.return()}finally{if(v)throw _}}return d}}function o(n){if(Array.isArray(n))return n}var u=function(l){if(!l.startsWith("POLYGON"))throw new Error("Invalid wkt.");var d=l.slice(l.indexOf("(")+2,l.indexOf(")")).split(", "),s=d.map(function(v){var _=v.split(" "),h=t(_,2),p=h[0],y=h[1];return{longitude:parseFloat(p),latitude:parseFloat(y)}});return s},i=u;return Ct.default=i,Ct}var Xa;function un(){return Xa||(Xa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var a={computeDestinationPoint:!0,convertArea:!0,convertDistance:!0,convertSpeed:!0,decimalToSexagesimal:!0,findNearest:!0,getAreaOfPolygon:!0,getBounds:!0,getBoundsOfDistance:!0,getCenter:!0,getCenterOfBounds:!0,getCompassDirection:!0,getCoordinateKey:!0,getCoordinateKeys:!0,getDistance:!0,getDistanceFromLine:!0,getGreatCircleBearing:!0,getLatitude:!0,getLongitude:!0,getPathLength:!0,getPreciseDistance:!0,getRhumbLineBearing:!0,getRoughCompassDirection:!0,getSpeed:!0,isDecimal:!0,isPointInLine:!0,isPointInPolygon:!0,isPointNearLine:!0,isPointWithinRadius:!0,isSexagesimal:!0,isValidCoordinate:!0,isValidLatitude:!0,isValidLongitude:!0,orderByDistance:!0,sexagesimalToDecimal:!0,toDecimal:!0,toRad:!0,toDeg:!0,wktToPolygon:!0};Object.defineProperty(t,"computeDestinationPoint",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"convertArea",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"convertDistance",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"convertSpeed",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"decimalToSexagesimal",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"findNearest",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"getAreaOfPolygon",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"getBounds",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"getBoundsOfDistance",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"getCenter",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"getCenterOfBounds",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"getCompassDirection",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"getCoordinateKey",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"getCoordinateKeys",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"getDistance",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"getDistanceFromLine",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(t,"getGreatCircleBearing",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"getLatitude",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(t,"getLongitude",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"getPathLength",{enumerable:!0,get:function(){return q.default}}),Object.defineProperty(t,"getPreciseDistance",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(t,"getRhumbLineBearing",{enumerable:!0,get:function(){return $.default}}),Object.defineProperty(t,"getRoughCompassDirection",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(t,"getSpeed",{enumerable:!0,get:function(){return G.default}}),Object.defineProperty(t,"isDecimal",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(t,"isPointInLine",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"isPointInPolygon",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(t,"isPointNearLine",{enumerable:!0,get:function(){return Z.default}}),Object.defineProperty(t,"isPointWithinRadius",{enumerable:!0,get:function(){return ee.default}}),Object.defineProperty(t,"isSexagesimal",{enumerable:!0,get:function(){return Y.default}}),Object.defineProperty(t,"isValidCoordinate",{enumerable:!0,get:function(){return se.default}}),Object.defineProperty(t,"isValidLatitude",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(t,"isValidLongitude",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(t,"orderByDistance",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(t,"sexagesimalToDecimal",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(t,"toDecimal",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(t,"toRad",{enumerable:!0,get:function(){return W.default}}),Object.defineProperty(t,"toDeg",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(t,"wktToPolygon",{enumerable:!0,get:function(){return O.default}});var e=m(Er()),c=m(Wr()),r=m(zr()),o=m(Vr()),u=m(Fr()),i=m(Kr()),n=m(jr()),l=m(sr()),d=m(Hr()),s=m(Xr()),v=m(Ur()),_=m(Zr()),h=m(Vt()),p=m(aa()),y=m(Ie()),k=m(lr()),C=m(Yr()),B=m(Pe()),S=m(ke()),q=m(Jr()),x=m(Qr()),$=m(ur()),I=m(en()),G=m(tn()),F=m(Ft()),E=m(an()),U=m(rn()),Z=m(nn()),ee=m(on()),Y=m(Kt()),se=m(nr()),A=m(ar()),M=m(rr()),R=m(or()),N=m(jt()),j=m(ra()),W=m(Ce()),L=m(Ee()),O=m(sn()),T=me();Object.keys(T).forEach(function(g){g==="default"||g==="__esModule"||Object.prototype.hasOwnProperty.call(a,g)||Object.defineProperty(t,g,{enumerable:!0,get:function(){return T[g]}})});function m(g){return g&&g.__esModule?g:{default:g}}}(Jt)),Jt}var ln=un();class dn{constructor(){qt(this,"stops",[])}async instantiate(){const e=await(await fetch("/stops.json")).json();this.stops=e.stops}findClosestStops(a,e=.5,c=3){return this.stops.map(u=>{const i=ln.getDistance({latitude:a[0],longitude:a[1]},{latitude:u.position.lat,longitude:u.position.lng})/1e3;return{name:u.name,position:u.position,dist_from_point:i}}).filter(u=>u.dist_from_point<=e).sort((u,i)=>u.dist_from_point-i.dist_from_point).slice(0,c)}}var cn=oe('<label for="spot-search-input" class="svelte-1bz9rsj"> </label>'),fn=(t,a)=>D(a,!0),vn=oe('<div class="loading-spinner svelte-1bz9rsj"></div>'),gn=oe('<button type="button" class="clear-searchbar svelte-1bz9rsj" aria-label="Clear"><img src="/clearsearchbar.svg" alt="Clear" class="clear-searchbar-icon svelte-1bz9rsj"/></button>'),pn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <div class="secondary-suggestion-text svelte-1bz9rsj"> </div></button></li>'),_n=(t,a,e)=>a(f(e)),mn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),hn=oe('<div class="secondary-suggestion-text svelte-1bz9rsj"> </div>'),bn=oe('<li class="svelte-1bz9rsj"><button type="button" class="suggestion-item svelte-1bz9rsj"><div class="suggestion-name-text svelte-1bz9rsj"> </div> <!></button></li>'),yn=oe('<ul class="suggestions-list svelte-1bz9rsj"><!> <!></ul>'),Pn=oe('<div class="spot-search-bar svelte-1bz9rsj"><!> <div class="searchbar-wrapper svelte-1bz9rsj"><input id="spot-search-input" type="text"/> <!> <!></div></div>');function Ua(t,a){De(a,!0);const[e,c]=we(),r=()=>w(zt,"$locale",e),o=()=>w(At,"$userLocation",e),u=()=>w(B,"$yourLocationMessage",e);let i=ne(""),n=ne(Qt([])),l=ne(!1),d=null,s=ne(!1),v=null,_=Ve(a,"label",3,""),h=Ve(a,"placeholder",3,""),p=Ve(a,"error",3,!1),y=Ve(a,"value",3,""),k=Ve(a,"providedSpot",3,null);$e(async()=>{const{AutocompleteSuggestion:M}=await qr();d=M,v=k()});async function C(M){var R;if(d){D(l,!0);const N={input:M.input,includedRegionCodes:["ee"],region:"ee",language:r()},j=await d.fetchAutocompleteSuggestions(N);let W=[];if(j.suggestions&&j.suggestions.length>0)for(const L of j.suggestions){let O=await L.placePrediction.toPlace().fetchFields({fields:["location"]});W.push({name:L.placePrediction.mainText.text,secondaryText:((R=L.placePrediction.secondaryText)==null?void 0:R.text)??"",position:{lat:O.place.location.lat(),lng:O.place.location.lng()}})}return D(l,!1),W}return[]}pe(()=>{f(i)?C({input:f(i)}).then(M=>{D(n,M,!0)}):D(n,[],!0)}),pe(()=>{y()!==void 0&&y()!==null&&D(i,y())});const B=H("your_location");function S(M){var R;v=M,D(i,M.name,!0),D(s,!1),(R=a.onSelect)==null||R.call(a,M)}function q(){var R;if(!o())return;const M={name:u(),position:{lat:o().lat,lng:o().lng},secondaryText:`${o().lat}, ${o().lng}`};v=M,D(i,M.name,!0),D(s,!1),(R=a.onSelect)==null||R.call(a,M)}function x(){D(s,!1),v&&f(i)!==v.name&&D(i,v.name,!0)}function $(){var M;D(i,""),v=null,D(n,[],!0),D(s,!1),(M=a.onSelect)==null||M.call(a,null)}var I=Pn(),G=P(I);{var F=M=>{var R=cn(),N=P(R,!0);b(R),ce(()=>V(N,_())),ie(M,R)};de(G,M=>{_()&&M(F)})}var E=z(G,2),U=P(E);Or(U),U.__click=[fn,s];var Z=z(U,2);{var ee=M=>{var R=vn();ie(M,R)},Y=(M,R)=>{{var N=j=>{var W=gn();W.__click=$,ie(j,W)};de(M,j=>{f(i)&&j(N)},R)}};de(Z,M=>{f(l)?M(ee):M(Y,!1)})}var se=z(Z,2);{var A=M=>{var R=yn(),N=P(R);{var j=L=>{var O=pn(),T=P(O);T.__mousedown=q;var m=P(T),g=P(m,!0);b(m);var K=z(m,2),te=P(K);b(K),b(T),b(O),ce((X,ae)=>{V(g,u()),V(te,`${X??""}, ${ae??""}`)},[()=>o().lat.toFixed(5),()=>o().lng.toFixed(5)]),ie(L,O)};de(N,L=>{o()&&L(j)})}var W=z(N,2);Et(W,17,()=>f(n),Wt,(L,O)=>{var T=bn(),m=P(T);m.__mousedown=[_n,S,O];var g=P(m),K=P(g,!0);b(g);var te=z(g,2);{var X=ue=>{var le=mn(),J=P(le,!0);b(le),ce(()=>V(J,f(O).secondaryText)),ie(ue,le)},ae=ue=>{var le=hn(),J=P(le);b(le),ce((he,Re)=>V(J,`${he??""}, ${Re??""}`),[()=>f(O).position.lat.toFixed(5),()=>f(O).position.lng.toFixed(5)]),ie(ue,le)};de(te,ue=>{f(O).secondaryText?ue(X):ue(ae,!1)})}b(m),b(T),ce(()=>V(K,f(O).name)),ie(L,T)}),b(R),ie(M,R)};de(se,M=>{f(s)&&M(A)})}b(E),b(I),ce(()=>{qe(U,"placeholder",h()),Be(U,1,`spot-search ${p()?"error":""}`,"svelte-1bz9rsj")}),Bt("focus",U,()=>D(s,!0)),Bt("blur",U,x),Cr(U,()=>f(i),M=>D(i,M)),ie(t,I),Oe(),c()}Ae(["click","mousedown"]);function kn(t,a){var e,c;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishClearChosenSpots(),(c=a())==null||c.publishState("map-idle")}var Mn=(t,a)=>{D(a,!1)},Sn=oe('<button class="confirm-button svelte-3hy2qp"> </button>'),Ln=oe('<div class="component-container svelte-3hy2qp"><div class="spot-picking-container svelte-3hy2qp"><div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div><!> <div class="no-stops-message-container svelte-3hy2qp"><div class="no-stops-message svelte-3hy2qp"> </div></div></div> <div class="buttons-container svelte-3hy2qp"><!> <button class="cancel-button svelte-3hy2qp"> </button></div></div></div>');function Dn(t,a){De(a,!0);const[e,c]=we(),r=()=>w(Ne,"$mqttClient",e),o=()=>w(Le,"$carStatus",e),u=()=>w(x,"$spotPickingPickupLabel",e),i=()=>w($,"$spotPickingPickupPlaceholder",e),n=()=>w(F,"$noStopsNearPickup",e),l=()=>w(I,"$spotPickingDestinationLabel",e),d=()=>w(G,"$spotPickingDestinationPlaceholder",e),s=()=>w(E,"$noStopsNearDestination",e),v=()=>w(U,"$confirmButtonText",e),_=()=>w(q,"$cancelButtonText",e);let h=ne(null),p=ne(null),y=ne(null),k=ne(!1),C=ne(!1),B=ne(!1),S=ne(!1);$e(async()=>{fe.set(!0),ve.set({key:"loading",params:{}}),D(h,new dn,!0),await f(h).instantiate(),o()&&o().chosen_spots&&o().chosen_spots.pickup&&o().chosen_spots.destination&&(D(B,!0),D(p,o().chosen_spots.pickup,!0),D(y,o().chosen_spots.destination,!0)),fe.set(!1),ve.set({key:"loading",params:{}})}),pe(()=>{var J,he,Re;if(f(p)&&f(y)&&f(h)){let We=f(h).findClosestStops([f(p).position.lat,f(p).position.lng]),ze=f(h).findClosestStops([f(y).position.lat,f(y).position.lng]);We.length===0&&D(k,!0),ze.length===0&&D(C,!0),We.length>0&&ze.length>0&&(D(S,!0),f(B)||(fe.set(!0),ve.set({key:"loading",params:{}}),(J=r())==null||J.publishChosenSpots(f(p),f(y)),(he=r())==null||he.publishFoundBusStops(We,ze),(Re=r())==null||Re.publishState("bus-stop-picking")))}});const q=H("spot_picking_cancel_button"),x=H("spot_picking_pickup_label"),$=H("spot_pickup_placeholder"),I=H("spot_picking_destination_label"),G=H("spot_destination_placeholder"),F=H("spot_pickup_no_bus_stop_found"),E=H("spot_destination_no_bus_stop_found"),U=H("spot_picking_confirm");var Z=Ln(),ee=P(Z),Y=P(ee),se=P(Y);const A=Te(()=>f(p)??null),M=Te(()=>{var J;return((J=f(p))==null?void 0:J.name)??""});Ua(se,{get label(){return u()},get placeholder(){return i()},get error(){return f(k)},get providedSpot(){return f(A)},get value(){return f(M)},onSelect:J=>{D(p,J,!0),D(k,!1)}});var R=z(se,2),N=P(R),j=P(N,!0);b(N),b(R),b(Y);var W=z(Y,2),L=P(W);const O=Te(()=>f(y)??null),T=Te(()=>{var J;return((J=f(y))==null?void 0:J.name)??""});Ua(L,{get label(){return l()},get placeholder(){return d()},get error(){return f(C)},get providedSpot(){return f(O)},get value(){return f(T)},onSelect:J=>{D(y,J,!0),D(C,!1)}});var m=z(L,2),g=P(m),K=P(g,!0);b(g),b(m),b(W);var te=z(W,2),X=P(te);{var ae=J=>{var he=Sn();he.__click=[Mn,B];var Re=P(he,!0);b(he),ce(()=>{he.disabled=!(f(S)&&f(p)&&f(y)&&!f(k)&&!f(C)),V(Re,v())}),ie(J,he)};de(X,J=>{f(B)&&J(ae)})}var ue=z(X,2);ue.__click=[kn,r];var le=P(ue,!0);b(ue),b(te),b(ee),b(Z),ce(()=>{Be(Y,1,`spot-search-bar-wrapper${f(k)?" error":""}`,"svelte-3hy2qp"),V(j,f(k)?n():""),Be(W,1,`spot-search-bar-wrapper${f(C)?" error":""}`,"svelte-3hy2qp"),V(K,f(C)?s():""),V(le,_())}),ie(t,Z),Oe(),c()}Ae(["click"]);class be{static async initialize(){if(!this.travelModeConstants||!this.directionsStatusConstants){const{TravelMode:a,DirectionsStatus:e}=await oa();this.travelModeConstants=a,this.directionsStatusConstants=e}}static async getRoute(a){await this.initialize();const{DirectionsService:e}=await oa(),r=await new e().route(a);return r.status===this.directionsStatusConstants.OK?{pathArray:r.routes[0].overview_path.map(u=>({lat:u.lat(),lng:u.lng()})),bounds:r.routes[0].bounds}:null}static async calculatePreliminaryRoutes(a,e,c,r="en",o=!0){if(await this.initialize(),!a||!e||!c){console.warn("RouteService: Missing required data for route calculation");return}const u=a;if(!u.pickup||!u.destination){console.warn("RouteService: Invalid chosen spots data");return}const i={origin:{lat:u.pickup.position.lat,lng:u.pickup.position.lng},destination:{lat:e.position.lat,lng:e.position.lng},travelMode:this.travelModeConstants.WALKING,language:r,region:"ee"},n={origin:{lat:e.position.lat,lng:e.position.lng},destination:{lat:c.position.lat,lng:c.position.lng},travelMode:this.travelModeConstants.DRIVING,language:r,region:"ee"},l={origin:{lat:c.position.lat,lng:c.position.lng},destination:{lat:u.destination.position.lat,lng:u.destination.position.lng},travelMode:this.travelModeConstants.WALKING,language:r,region:"ee"};if(o){const[d,s,v]=await Promise.all([this.getRoute(i),this.getRoute(n),this.getRoute(l)]);Nt.set(d),xt.set(s),It.set(v)}else{const[d,s]=await Promise.all([this.getRoute(i),this.getRoute(l)]);Nt.set(d),It.set(s)}}static nullDrivingRoutes(){xt.set(null),ta.set(null)}static async calculateCarRouteHelper(a,e){const{LatLngBounds:c}=await er(),r=new c;let o=[];if(a)for(const u of a)r.extend({lat:u[0],lng:u[1]}),o.push({lat:u[0],lng:u[1]});else e&&r.extend({lat:e.position.lat,lng:e.position.lng});return{mappedWaypoints:o,latLngBounds:r}}static async calculateCarToPickupRoute(a,e){const{mappedWaypoints:c,latLngBounds:r}=await this.calculateCarRouteHelper(a,e);ta.set({pathArray:c,bounds:r})}static async calculatePickupBusStopToDestinationRoute(a,e){const{mappedWaypoints:c,latLngBounds:r}=await this.calculateCarRouteHelper(a,e);xt.set({pathArray:c,bounds:r})}}qt(be,"travelModeConstants",null),qt(be,"directionsStatusConstants",null);function On(t,a){var e,c;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishClearFoundBusStops(),(c=a())==null||c.publishState("spot-picking")}var wn=(t,a)=>D(a,!f(a)),Cn=(t,a,e)=>a(f(e)),Rn=oe('<button type="button" role="option"> </button>'),qn=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="pickup-dropdown"></div>'),$n=(t,a)=>D(a,!f(a)),xn=(t,a,e)=>a(f(e)),Tn=oe('<button type="button" role="option"> </button>'),Bn=oe('<div class="dropdown-list svelte-5klcor" role="listbox" aria-labelledby="destination-dropdown"></div>'),An=oe('<button class="order-car-button svelte-5klcor"> </button>'),Nn=oe('<div class="bus-stop-picking svelte-5klcor"><div class="dropdowns-container svelte-5klcor"><h2 class="svelte-5klcor"> </h2> <div class="dropdown-group svelte-5klcor"><label for="pickup-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="pickup-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div> <div class="dropdown-group svelte-5klcor"><label for="destination-dropdown" tabindex="-1" class="svelte-5klcor"> </label> <div class="custom-dropdown svelte-5klcor"><button id="destination-dropdown" type="button" class="dropdown-selected svelte-5klcor" aria-haspopup="listbox"> <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 6l4 4 4-4" stroke="#222" stroke-width="2" fill="none"></path></svg></button> <!></div></div></div> <div class="buttons-container svelte-5klcor"><!> <button class="back-button svelte-5klcor"> </button></div></div>');function In(t,a){De(a,!0);const[e,c]=we(),r=()=>w(zt,"$locale",e),o=()=>w(Le,"$carStatus",e),u=()=>w(Ne,"$mqttClient",e),i=()=>w(F,"$busStopPickHeadingText",e),n=()=>w(E,"$busStopPickupText",e),l=()=>w(U,"$busStopDestinationText",e),d=()=>w(I,"$orderCarText",e),s=()=>w(G,"$backButtonText",e);let v=ne(!1),_=ne(!1),h=ne(null),p=ne(Qt([])),y=ne(Qt([])),k=ne(null),C=ne(null);$e(async()=>{Rt.set({top:400,bottom:100}),await be.initialize(),f(k)&&f(C)&&f(h)&&(be.calculatePreliminaryRoutes(f(h),f(k),f(C),r()),f(_)||(Se.set("all"),D(_,!0)))}),pe(()=>{o()&&o().found_bus_stops&&o().chosen_spots&&!f(v)&&(D(p,o().found_bus_stops.pickup,!0),D(y,o().found_bus_stops.destination,!0),D(k,f(p)[0],!0),D(C,f(y)[0],!0),D(h,o().chosen_spots,!0),fe.set(!1),ve.set({key:"loading",params:{}}),D(v,!0))}),pe(()=>{f(k)&&f(C)&&f(h)&&(be.calculatePreliminaryRoutes(f(h),f(k),f(C),r()),f(_)||(Se.set("all"),D(_,!0)))});function B(){var Q,ge;if(f(k)&&f(C)){fe.set(!0),ve.set({key:"loading",params:{}}),(Q=u())==null||Q.publishChosenRouteStops(f(k),f(C)),(ge=u())==null||ge.publishGoal(f(k).position);const xe=Le.subscribe(ye=>{var _e;ye&&ye.are_waypoints_sent&&(be.nullDrivingRoutes(),(_e=u())==null||_e.publishState("driving-to-pickup"),xe())})}}let S=ne(!1),q=ne(!1);function x(Q){D(k,Q,!0),D(S,!1),Se.set("pickup")}function $(Q){D(C,Q,!0),D(q,!1),Se.set("destination")}const I=H("bus_stop_order_car_button"),G=H("bus_stop_back_button"),F=H("bus_stop_pick_heading"),E=H("bus_stop_pickup"),U=H("bus_stop_destination");let Z=ne(void 0),ee=ne(void 0);function Y(Q){f(S)&&f(Z)&&!f(Z).contains(Q.target)&&D(S,!1)}function se(Q){f(q)&&f(ee)&&!f(ee).contains(Q.target)&&D(q,!1)}pe(()=>{if(f(S))return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)}),pe(()=>{if(f(q))return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)});var A=Nn(),M=P(A),R=P(M),N=P(R,!0);b(R);var j=z(R,2),W=P(j),L=P(W,!0);b(W);var O=z(W,2),T=P(O);T.__click=[wn,S];var m=P(T),g=z(m);b(T);var K=z(T,2);{var te=Q=>{var ge=qn();Et(ge,21,()=>f(p),Wt,(xe,ye)=>{var _e=Rn();_e.__click=[Cn,x,ye];var Xt=P(_e,!0);b(_e),ce(()=>{Be(_e,1,`dropdown-item ${f(k)&&f(ye).name===f(k).name?"selected":""}`,"svelte-5klcor"),qe(_e,"aria-selected",f(k)&&f(ye).name===f(k).name),V(Xt,f(ye).name)}),ie(xe,_e)}),b(ge),ie(Q,ge)};de(K,Q=>{f(S)&&Q(te)})}b(O),ea(O,Q=>D(Z,Q),()=>f(Z)),b(j);var X=z(j,2),ae=P(X),ue=P(ae,!0);b(ae);var le=z(ae,2),J=P(le);J.__click=[$n,q];var he=P(J),Re=z(he);b(J);var We=z(J,2);{var ze=Q=>{var ge=Bn();Et(ge,21,()=>f(y),Wt,(xe,ye)=>{var _e=Tn();_e.__click=[xn,$,ye];var Xt=P(_e,!0);b(_e),ce(()=>{Be(_e,1,`dropdown-item ${f(C)&&f(ye).name===f(C).name?"selected":""}`,"svelte-5klcor"),qe(_e,"aria-selected",f(C)&&f(ye).name===f(C).name),V(Xt,f(ye).name)}),ie(xe,_e)}),b(ge),ie(Q,ge)};de(We,Q=>{f(q)&&Q(ze)})}b(le),ea(le,Q=>D(ee,Q),()=>f(ee)),b(X),b(M);var na=z(M,2),ia=P(na);{var dr=Q=>{var ge=An();ge.__click=B;var xe=P(ge,!0);b(ge),ce(()=>V(xe,d())),ie(Q,ge)};de(ia,Q=>{f(k)&&f(C)&&Q(dr)})}var Ht=z(ia,2);Ht.__click=[On,u];var cr=P(Ht,!0);b(Ht),b(na),b(A),ce(()=>{var Q,ge;V(N,i()),V(L,n()),qe(T,"aria-expanded",f(S)),V(m,`${((Q=f(k))==null?void 0:Q.name)??""} `),Be(g,0,`dropdown-arrow${f(S)?" open":""}`,"svelte-5klcor"),V(ue,l()),qe(J,"aria-expanded",f(q)),V(he,`${((ge=f(C))==null?void 0:ge.name)??""} `),Be(Re,0,`dropdown-arrow${f(q)?" open":""}`,"svelte-5klcor"),V(cr,s())}),ie(t,A),Oe(),c()}Ae(["click"]);var Gn=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),En=oe('<h2 class="driving-heading svelte-rznqub"> </h2> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div> <div class="driving-detail-row svelte-rznqub"><span class="driving-label svelte-rznqub"> </span> <span class="driving-value svelte-rznqub"> </span></div>',1),Wn=oe('<div class="driving-info-container svelte-rznqub"><div class="driving-info-card svelte-rznqub"><!></div></div>');function Za(t,a){var Z,ee,Y,se;De(a,!0);const[e,c]=we(),r=()=>w(Le,"$carStatus",e),o=()=>w(zt,"$locale",e),u=()=>w(Ne,"$mqttClient",e),i=()=>w(p,"$drivingToPickupInfoText",e),n=()=>w(k,"$carSpeedHeadingText",e),l=()=>w(f(B),"$carSpeedInfoText",e),d=()=>w(S,"$chosenPickupHeadingText",e),s=()=>w(q,"$chosenPickupSpotText",e),v=()=>w(y,"$drivingToDestinationInfoText",e),_=()=>w(x,"$chosenDestinationHeadingText",e),h=()=>w($,"$chosenDestinationSpotText",e);$e(async()=>{var A,M,R,N,j,W,L;fe.set(!0),ve.set({key:"loading",params:{}}),Rt.set({top:400,bottom:100}),await be.initialize(),await be.calculatePreliminaryRoutes(((A=r())==null?void 0:A.chosen_spots)??null,((M=r())==null?void 0:M.chosen_route_stops.pickup)??null,((R=r())==null?void 0:R.chosen_route_stops.destination)??null,o(),!1),Qa.set(!0),a.type=="pickup"?(await be.calculateCarToPickupRoute(((N=r())==null?void 0:N.route)??null,((j=r())==null?void 0:j.chosen_route_stops.pickup)??null),Se.set("carToPickup")):a.type=="destination"&&(await be.calculatePickupBusStopToDestinationRoute(((W=r())==null?void 0:W.route)??null,((L=r())==null?void 0:L.chosen_route_stops.destination)??null),Se.set("all")),fe.set(!1),ve.set({key:"loading",params:{}})}),pe(()=>{var A,M;r()&&r().are_waypoints_sent&&r().route.length===0&&(a.type==="pickup"?(A=u())==null||A.publishState("arrived-to-pickup"):a.type==="destination"&&((M=u())==null||M.publishState("arrived-to-destination")))});const p=H("driving_to_pickup_info"),y=H("driving_to_destination_info"),k=H("car_speed_heading");let C=Te(()=>{var A;return(A=r())!=null&&A.speed?r().speed.toFixed(1):"0.0"});const B=Te(()=>H("car_speed_info",{speed:f(C)})),S=H("chosen_pickup_heading"),q=H("chosen_pickup_spot",{spot_name:(Z=r())!=null&&Z.chosen_route_stops&&"pickup"in r().chosen_route_stops&&((ee=r().chosen_route_stops.pickup)!=null&&ee.name)?r().chosen_route_stops.pickup.name:""}),x=H("chosen_destination_heading"),$=H("chosen_destination_spot",{spot_name:(Y=r())!=null&&Y.chosen_route_stops&&"destination"in r().chosen_route_stops&&((se=r().chosen_route_stops.destination)!=null&&se.name)?r().chosen_route_stops.destination.name:""});var I=Wn(),G=P(I),F=P(G);{var E=A=>{var M=Gn(),R=Tt(M),N=P(R,!0);b(R);var j=z(R,2),W=P(j),L=P(W,!0);b(W);var O=z(W,2),T=P(O,!0);b(O),b(j);var m=z(j,2),g=P(m),K=P(g,!0);b(g);var te=z(g,2),X=P(te,!0);b(te),b(m),ce(()=>{V(N,i()),V(L,n()),V(T,l()),V(K,d()),V(X,s())}),ie(A,M)},U=(A,M)=>{{var R=N=>{var j=En(),W=Tt(j),L=P(W,!0);b(W);var O=z(W,2),T=P(O),m=P(T,!0);b(T);var g=z(T,2),K=P(g,!0);b(g),b(O);var te=z(O,2),X=P(te),ae=P(X,!0);b(X);var ue=z(X,2),le=P(ue,!0);b(ue),b(te),ce(()=>{V(L,v()),V(m,n()),V(K,l()),V(ae,_()),V(le,h())}),ie(N,j)};de(A,N=>{a.type==="destination"&&N(R)},M)}};de(F,A=>{a.type==="pickup"?A(E):A(U,!1)})}b(G),b(I),ie(t,I),Oe(),c()}var zn=oe('<div class="arrived-info-container svelte-1pss86t"><div class="arrived-info-card svelte-1pss86t"><h2 class="arrived-heading svelte-1pss86t"> </h2> <div class="button-container svelte-1pss86t"><h3 class="arrived-subheading svelte-1pss86t"> </h3> <button class="arrived-confirm-btn svelte-1pss86t"> </button></div></div></div>');function Ya(t,a){De(a,!0);const[e,c]=we(),r=()=>w(Nt,"$pathChosenPickupToBusStopPickup",e),o=()=>w(It,"$pathBusStopDestinationToChosenDestination",e),u=()=>w(Le,"$carStatus",e),i=()=>w(zt,"$locale",e),n=()=>w(Ne,"$mqttClient",e),l=()=>w(_,"$confirmHeadingMessage",e),d=()=>w(h,"$confirmButtonHeadingMessage",e),s=()=>w(p,"$confirmButtonMessage",e);$e(async()=>{var G,F,E;Rt.set({top:400,bottom:100}),await be.initialize(),(!r()||!o())&&await be.calculatePreliminaryRoutes(((G=u())==null?void 0:G.chosen_spots)??null,((F=u())==null?void 0:F.chosen_route_stops.pickup)??null,((E=u())==null?void 0:E.chosen_route_stops.destination)??null,i(),!1),a.type=="pickup"?Se.set("pickup"):a.type=="destination"&&Se.set("destination")});async function v(){var G,F,E,U,Z,ee,Y;if(fe.set(!0),ve.set({key:"loading",params:{}}),(G=n())==null||G.publishClearAreWaypointsSent(),await new Promise(se=>{var M;if(!((M=u())!=null&&M.are_waypoints_sent)){se();return}const A=Le.subscribe(R=>{R&&!R.are_waypoints_sent&&(A(),se())})}),a.type==="pickup"){const se=(F=u())==null?void 0:F.chosen_route_stops.destination.position;(E=n())==null||E.publishGoal(se);let A;A=Le.subscribe(M=>{var R;M&&M.are_waypoints_sent&&(be.nullDrivingRoutes(),(R=n())==null||R.publishState("driving-to-destination"),A==null||A())})}else a.type==="destination"&&((U=n())==null||U.publishClearChosenSpots(),(Z=n())==null||Z.publishClearFoundBusStops(),(ee=n())==null||ee.publishClearChosenRouteStops(),kr(),(Y=n())==null||Y.publishState("rating"))}const _=a.type==="pickup"?H("arrived_at_pickup_info"):H("arrived_at_destination_info"),h=a.type==="pickup"?H("confirm_in_car_info"):H("confirm_destination_info"),p=a.type==="pickup"?H("confirm_in_car_button"):H("confirm_destination_button");var y=zn(),k=P(y),C=P(k),B=P(C,!0);b(C);var S=z(C,2),q=P(S),x=P(q,!0);b(q);var $=z(q,2);$.__click=v;var I=P($,!0);b($),b(S),b(k),b(y),ce(()=>{V(B,l()),V(x,d()),V(I,s())}),ie(t,y),Oe(),c()}Ae(["click"]);var Vn=oe('<button type="button" class="star-btn svelte-rv59cl"><img class="star svelte-rv59cl"/></button>'),Fn=(t,a)=>{var e;fe.set(!0),ve.set({key:"loading",params:{}}),(e=a())==null||e.publishState("map-idle")},Kn=oe('<div class="rating-overlay svelte-rv59cl"><div class="rating-card svelte-rv59cl"><h2 class="rating-heading svelte-rv59cl"> </h2> <div class="stars svelte-rv59cl"></div> <button class="skip-btn svelte-rv59cl"> </button></div></div>');function jn(t,a){De(a,!0);const[e,c]=we(),r=()=>w(Ne,"$mqttClient",e),o=()=>w(h,"$ratingHeadingText",e),u=()=>w(p,"$ratingRefuseText",e);let i=ne(0),n=ne(0),l=ne(""),d=ne("");$e(async()=>{Rt.set({top:200,bottom:200}),D(l,await Gt("/star_filled.svg"),!0),D(d,await Gt("/star_empty.svg"),!0),fe.set(!1),ve.set({key:"loading",params:{}})});function s($){var I,G;D(i,$,!0),fe.set(!0),ve.set({key:"loading",params:{}}),(I=r())==null||I.publishRating(f(i),new Date().toISOString()),(G=r())==null||G.publishState("map-idle")}function v($){D(n,$,!0)}function _(){D(n,0)}const h=H("rating_heading"),p=H("rating_refuse");var y=Kn(),k=P(y),C=P(k),B=P(C,!0);b(C);var S=z(C,2);Et(S,20,()=>Array.from({length:5}),Wt,($,I,G)=>{var F=Vn();F.__click=()=>s(G+1),qe(F,"aria-label",`Rate ${G+1} star${G===0?"":"s"}`);var E=P(F);qe(E,"alt",G+1+" star"),b(F),ce(()=>qe(E,"src",(f(n)?G<f(n):G<f(i))?f(l):f(d))),Bt("mouseenter",F,()=>v(G+1)),Bt("mouseleave",F,_),ie($,F)}),b(S);var q=z(S,2);q.__click=[Fn,r];var x=P(q,!0);b(q),b(k),b(y),ce(()=>{V(B,o()),V(x,u())}),ie(t,y),Oe(),c()}Ae(["click"]);var Hn=oe('<div class="app-root"><!> <!></div>');function ii(t,a){De(a,!0);const[e,c]=we(),r=()=>w(Ne,"$mqttClient",e),o=()=>w(Le,"$carStatus",e),u=()=>w(Sr,"$sessionId",e),i=()=>w(ve,"$appGlobalLoadingMessageKey",e),n=()=>w(Me,"$appState",e),l=()=>w(fe,"$appGlobalLoading",e),d=()=>w(f(_),"$appGlobalLoadingMessage",e);let s=ne(!1);$e(()=>{let S=null,q=0;return navigator.geolocation?S=navigator.geolocation.watchPosition(x=>{const $=Date.now();$-q>=500&&(At.set({lat:x.coords.latitude,lng:x.coords.longitude}),q=$)},x=>{console.warn("Geolocation denied or unavailable:",x)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:1e3}):(At.set(null),console.warn("Geolocation not supported")),()=>{S!==null&&navigator.geolocation.clearWatch(S)}}),pe(()=>{r()||Pr("/login")});let v=null;pe(()=>{if(r()&&o()){if(o().state===v)return;switch(v=o().state,o().state){case"None":r().publishState("map-idle"),D(s,!0),Me.set("map-idle");break;case"map-idle":D(s,!0),Me.set("map-idle");break;case"spot-picking":D(s,!1),Me.set("spot-picking");break;case"bus-stop-picking":D(s,!0),Me.set("bus-stop-picking");break;case"driving-to-pickup":D(s,!0),Me.set("driving-to-pickup");break;case"arrived-to-pickup":D(s,!0),Me.set("arrived-to-pickup");break;case"driving-to-destination":D(s,!0),Me.set("driving-to-destination");break;case"arrived-to-destination":D(s,!0),Me.set("arrived-to-destination");break;case"rating":D(s,!1),Me.set("rating");break;case"shutting-down":fe.set(!0),ve.set({key:"car_shutting_down"}),D(s,!1);const S=u()??"";Mr.set({key:"session_closed",params:{id:S}}),Ja();break;default:D(s,!1),console.error("Unknown car status state:",JSON.stringify(o().state));break}}});const _=Te(()=>i()?H(i().key,i().params):null);var h=Hn(),p=P(h);{var y=S=>{Ar(S,{children:(q,x)=>{var $=yr(),I=Tt($);{var G=E=>{Gr(E,{})},F=(E,U)=>{{var Z=Y=>{In(Y,{})},ee=(Y,se)=>{{var A=R=>{Za(R,{type:"pickup"})},M=(R,N)=>{{var j=L=>{Ya(L,{type:"pickup"})},W=(L,O)=>{{var T=g=>{Za(g,{type:"destination"})},m=(g,K)=>{{var te=X=>{Ya(X,{type:"destination"})};de(g,X=>{n()==="arrived-to-destination"&&X(te)},K)}};de(L,g=>{n()==="driving-to-destination"?g(T):g(m,!1)},O)}};de(R,L=>{n()==="arrived-to-pickup"?L(j):L(W,!1)},N)}};de(Y,R=>{n()==="driving-to-pickup"?R(A):R(M,!1)},se)}};de(E,Y=>{n()==="bus-stop-picking"?Y(Z):Y(ee,!1)},U)}};de(I,E=>{n()==="map-idle"?E(G):E(F,!1)})}ie(q,$)},$$slots:{default:!0}})},k=(S,q)=>{{var x=I=>{Dn(I,{})},$=(I,G)=>{{var F=E=>{jn(E,{})};de(I,E=>{n()==="rating"&&E(F)},G)}};de(S,I=>{n()==="spot-picking"?I(x):I($,!1)},q)}};de(p,S=>{f(s)?S(y):S(k,!1)})}var C=z(p,2);{var B=S=>{Dr(S,{get loadingMsg(){return d()}})};de(C,S=>{l()&&S(B)})}b(h),ie(t,h),Oe(),c()}export{ii as component};
